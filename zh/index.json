[{"categories":["OpenTool"],"contents":"æˆ‘ä»¬é€šå¸¸å¯ä»¥å°†ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ä½œä¸ºDockerä¸»æœºï¼Œä½¿ç”¨å®¹å™¨è·‘ä¸€äº›å¼€æºçš„å·¥å…·æœåŠ¡ã€‚è€Œå¾€å¾€æˆ‘ä»¬ä¸çŸ¥é“è¯¥ä»€ä¹ˆæ—¶å€™è¿™ä¸ªè¿™äº›åº”ç”¨æœ‰äº†æ›´æ–°çš„ç‰ˆæœ¬ï¼Œæœ€è¿‘å‘ç°äº†ä¸€ä¸ªå¼€æºçš„å·¥å…·ï¼Œå¯ä»¥æ£€æŸ¥ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨çš„é•œåƒæ˜¯å¦æœ‰æ›´æ–°ï¼Œå¹¶å¯ä»¥é€šè¿‡é›†æˆå¤šç§æ¸ é“å‘é€æ›´æ–°é€šçŸ¥ï¼Œè¿™æ¬¾å·¥å…·å°±æ˜¯ DIUN(Docker Image Update Notifier) ã€‚\nDUINä»‹ç» DUINæ˜¯ä¸€æ¬¾ä½¿ç”¨GOè¯­è¨€ç¼–å†™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥æœ¬åœ°è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®¹å™¨è¿è¡Œï¼ˆå¼€å‘è€…æä¾›äº†æ„å»ºå¥½çš„é•œåƒ )ï¼Œå½“ç›‘æ§çš„å®¹å™¨é•œåƒåœ¨ç›¸åº”çš„æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰ä¸­æ›´æ–°æ—¶ï¼Œå¯ä»¥æ¥æ”¶åˆ°ç›¸åº”çš„é€šçŸ¥ã€‚\nDUINæ”¯æŒå¤šç§ç›‘æ§é…ç½®ï¼ˆProvidersï¼‰ï¼š\nDocker - åˆ†æDockerä¸»æœºä¸Šè¿è¡Œå®¹å™¨çš„é•œåƒï¼Œå¹¶æ£€æŸ¥å…¶æ›´æ–° Podman - ç±»ä¼¼Dockerï¼Œéœ€è¦Podmanä»¥æœåŠ¡æ–¹å¼å¯åŠ¨ Kubernetes - åˆ†æKubernetesé›†ç¾¤ä¸­çš„Podsï¼Œæ£€æŸ¥podä½¿ç”¨çš„é•œåƒ Swarm - åˆ†æSwarmé›†ç¾¤ä¸­æœåŠ¡ä½¿ç”¨çš„é•œåƒ Nomad - ç±»ä¼¼Dockerï¼Œåˆ†æNomadå¼•æ“è¿è¡Œçš„é•œåƒ Dockerfile - åˆ†æDockerfileä¸­å¼•ç”¨çš„é•œåƒ File - yamlæ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œç›´æ¥é…ç½®éœ€è¦æ£€æŸ¥çš„é•œåƒä¿¡æ¯ DUINæ”¯æŒé›†æˆå¤šç§é€šçŸ¥æ¸ é“ï¼Œä¾‹å¦‚ Discordï¼Œ Slackï¼ŒMatrixï¼ŒTelegram ä»¥åŠ Webhook ç­‰ã€‚\nDUINä½¿ç”¨ç¤ºä¾‹ è¿™é‡Œå°†æ¼”ç¤ºåœ¨Dockerä¸»æœºä¸Šä½¿ç”¨Docker Composeæ¥è¿è¡ŒduinæœåŠ¡ï¼Œå¹¶é›†æˆSlackï¼Œå°†é€šçŸ¥å‘é€åˆ°ç›¸åº”çš„é¢‘é“ã€‚\ndocker-compose.yml :\nservices: diun: image: crazymax/diun:latest container_name: diun hostname: home200-diun command: serve volumes: - diundata:/data - \u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34; environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; - \u0026#34;LOG_LEVEL=info\u0026#34; - \u0026#34;LOG_JSON=false\u0026#34; - \u0026#34;DIUN_WATCH_WORKERS=20\u0026#34; - \u0026#34;DIUN_WATCH_SCHEDULE=0 */6 * * *\u0026#34; - \u0026#34;DIUN_WATCH_JITTER=30s\u0026#34; - \u0026#34;DIUN_PROVIDERS_DOCKER=true\u0026#34; - \u0026#34;DIUN_PROVIDERS_DOCKER_WATCHBYDEFAULT=true\u0026#34; - \u0026#34;DIUN_NOTIF_SLACK_WEBHOOKURL=https://hooks.slack.com/services/xxxxxxxxxxxxx\u0026#34; restart: on-failure volumes: diundata: ä¸Šé¢çš„ç¯å¢ƒå˜é‡ä¸­\nDIUN_WATCH_SCHEDULE=0 */6 * * * æŒ‡å®šæ¯6å°æ—¶åšä¸€æ¬¡æ£€æŸ¥ DIUN_PROVIDERS_DOCKER=true æŒ‡å®šä½¿ç”¨Docker Providerï¼Œå› æ­¤éœ€è¦ç»‘å®š /var/run/docker.sock:/var/run/docker.sock DIUN_PROVIDERS_DOCKER_WATCHBYDEFAULT=true æŒ‡å®šé»˜è®¤æ£€æŸ¥å½“å‰Dockerç¯å¢ƒä¸­è¿è¡Œçš„æ‰€æœ‰å®¹å™¨çš„é•œåƒï¼Œå¦‚æœè¯¥å€¼è®¾ç½®ä¸º falseï¼Œåˆ™åœ¨è¿è¡Œéœ€è¦æ£€æŸ¥é•œåƒçš„å®¹å™¨æ—¶ï¼Œéœ€è¦æ·»åŠ æ ‡ç­¾ diun.enable=true DIUN_NOTIF_SLACK_WEBHOOKURL= æŒ‡å®šäº†å‘ç°æ›´æ–°æ—¶ï¼Œå°†é€šçŸ¥å‘é€åˆ°Slackçš„é¢‘é“ï¼Œé…ç½®çš„å€¼åªéœ€è¦åœ¨Slackçš„æŸä¸ªé¢‘é“ä¸­æ·»åŠ ä¸€ä¸ªIncoming Webhookåº”ç”¨å³å¯ å¯åŠ¨æ›´å¤šçš„é…ç½®ï¼Œå¯å‚è€ƒæ–‡æ¡£ã€‚\nå¯åŠ¨å®¹å™¨ï¼Œå¯è¿›å…¥å®¹å™¨è¿›è¡Œé€šçŸ¥æµ‹è¯•\nâœ docker compose exec diun sh / # diun notif test Notification sent for slack notifier(s) åœ¨Slackä¸­ï¼Œå°†æ”¶åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„é€šçŸ¥\nä¹‹åï¼Œå½“DIUNå‘ç°æœ‰æ–°çš„é•œåƒå‘å¸ƒåˆ°é•œåƒä»“åº“åï¼Œå°±ä¼šæ”¶åˆ°ç›¸åº”çš„é€šçŸ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€‰æ‹©æ˜¯å¦è¿›è¡Œåº”ç”¨å‡çº§ã€‚\nå½“æˆ‘ä»¬ä¸ºåº”ç”¨ä½¿ç”¨å›ºå®šæ ‡ç­¾çš„é•œåƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‡å®šç›¸åº”çš„æ ‡ç­¾æ¥è¿›è¡Œæ£€æŸ¥ï¼Œå¦‚\nlabels: - \u0026#39;diun.enable=true\u0026#39; - \u0026#39;diun.watch_repo=true\u0026#39; - \u0026#39;diun.include_tags=^\\d+\\.\\d+\\.\\d+$\u0026#39; ä¸Šé¢çš„æ­£åˆ™æŒ‡å®šäº†éœ€è¦æ£€æŸ¥çš„æ ‡ç­¾ã€‚\næ€»ç»“ è¿™é‡Œæ¨èäº†ä¸€ä¸ªå¼€æºçš„å®¹å™¨é•œåƒæ›´æ–°é€šçŸ¥å·¥å…·ï¼ŒåŒæ—¶æ¼”ç¤ºäº†åŸºäºDocker+Slackçš„é›†æˆï¼Œæ›´å¤šçš„ä½¿ç”¨æ–¹å¼è¯·å‚è€ƒå…¶æ–‡æ¡£ ã€‚\n","date":"March 18, 2023","hero":"/zh/posts/opentool/diun-intro/diun-banner.jpg","permalink":"/zh/posts/opentool/diun-intro/","summary":"æˆ‘ä»¬é€šå¸¸å¯ä»¥å°†ä¸€å°æˆ–å¤šå°æœåŠ¡å™¨ä½œä¸ºDockerä¸»æœºï¼Œä½¿ç”¨å®¹å™¨è·‘ä¸€äº›å¼€æºçš„å·¥å…·æœåŠ¡ã€‚è€Œå¾€å¾€æˆ‘ä»¬ä¸çŸ¥é“è¯¥ä»€ä¹ˆæ—¶å€™è¿™ä¸ªè¿™äº›åº”ç”¨æœ‰äº†æ›´æ–°çš„ç‰ˆæœ¬ï¼Œæœ€è¿‘å‘ç°äº†ä¸€ä¸ªå¼€æºçš„å·¥å…·ï¼Œå¯ä»¥æ£€æŸ¥ä¸»æœºä¸Šè¿è¡Œçš„å®¹å™¨çš„é•œåƒæ˜¯å¦æœ‰æ›´æ–°ï¼Œå¹¶å¯ä»¥é€šè¿‡é›†æˆå¤šç§æ¸ é“å‘é€æ›´æ–°é€šçŸ¥ï¼Œè¿™æ¬¾å·¥å…·å°±æ˜¯ DIUN(Docker Image Update Notifier) ã€‚\nDUINä»‹ç» DUINæ˜¯ä¸€æ¬¾ä½¿ç”¨GOè¯­è¨€ç¼–å†™çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯ä»¥æœ¬åœ°è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®¹å™¨è¿è¡Œï¼ˆå¼€å‘è€…æä¾›äº†æ„å»ºå¥½çš„é•œåƒ )ï¼Œå½“ç›‘æ§çš„å®¹å™¨é•œåƒåœ¨ç›¸åº”çš„æ³¨å†Œè¡¨ï¼ˆRegistryï¼‰ä¸­æ›´æ–°æ—¶ï¼Œå¯ä»¥æ¥æ”¶åˆ°ç›¸åº”çš„é€šçŸ¥ã€‚\nDUINæ”¯æŒå¤šç§ç›‘æ§é…ç½®ï¼ˆProvidersï¼‰ï¼š\nDocker - åˆ†æDockerä¸»æœºä¸Šè¿è¡Œå®¹å™¨çš„é•œåƒï¼Œå¹¶æ£€æŸ¥å…¶æ›´æ–° Podman - ç±»ä¼¼Dockerï¼Œéœ€è¦Podmanä»¥æœåŠ¡æ–¹å¼å¯åŠ¨ Kubernetes - åˆ†æKubernetesé›†ç¾¤ä¸­çš„Podsï¼Œæ£€æŸ¥podä½¿ç”¨çš„é•œåƒ Swarm - åˆ†æSwarmé›†ç¾¤ä¸­æœåŠ¡ä½¿ç”¨çš„é•œåƒ Nomad - ç±»ä¼¼Dockerï¼Œåˆ†æNomadå¼•æ“è¿è¡Œçš„é•œåƒ Dockerfile - åˆ†æDockerfileä¸­å¼•ç”¨çš„é•œåƒ File - yamlæ ¼å¼çš„é…ç½®æ–‡ä»¶ï¼Œç›´æ¥é…ç½®éœ€è¦æ£€æŸ¥çš„é•œåƒä¿¡æ¯ DUINæ”¯æŒé›†æˆå¤šç§é€šçŸ¥æ¸ é“ï¼Œä¾‹å¦‚ Discordï¼Œ Slackï¼ŒMatrixï¼ŒTelegram ä»¥åŠ Webhook ç­‰ã€‚\nDUINä½¿ç”¨ç¤ºä¾‹ è¿™é‡Œå°†æ¼”ç¤ºåœ¨Dockerä¸»æœºä¸Šä½¿ç”¨Docker Composeæ¥è¿è¡ŒduinæœåŠ¡ï¼Œå¹¶é›†æˆSlackï¼Œå°†é€šçŸ¥å‘é€åˆ°ç›¸åº”çš„é¢‘é“ã€‚\ndocker-compose.yml :\nservices: diun: image: crazymax/diun:latest container_name: diun hostname: home200-diun command: serve volumes: - diundata:/data - \u0026#34;/var/run/docker.sock:/var/run/docker.sock\u0026#34; environment: - \u0026#34;TZ=Asia/Shanghai\u0026#34; - \u0026#34;LOG_LEVEL=info\u0026#34; - \u0026#34;LOG_JSON=false\u0026#34; - \u0026#34;DIUN_WATCH_WORKERS=20\u0026#34; - \u0026#34;DIUN_WATCH_SCHEDULE=0 */6 * * *\u0026#34; - \u0026#34;DIUN_WATCH_JITTER=30s\u0026#34; - \u0026#34;DIUN_PROVIDERS_DOCKER=true\u0026#34; - \u0026#34;DIUN_PROVIDERS_DOCKER_WATCHBYDEFAULT=true\u0026#34; - \u0026#34;DIUN_NOTIF_SLACK_WEBHOOKURL=https://hooks.","tags":["cotainer","docker","slack"],"title":"DIUN-å®¹å™¨é•œåƒæ›´æ–°é€šçŸ¥"},{"categories":["Container"],"contents":"åœ¨ç°ä»£çš„B/Sæ¶æ„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šåšå‰åç«¯åˆ†ç¦»ï¼ŒæŸäº›å‰ç«¯WebæœåŠ¡ä¼šå°†ç¼–è¯‘å®Œæˆçš„é™æ€æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªwebæœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„åšå®¢ä¹Ÿæ˜¯åŸºäºHugoç¼–è¯‘çš„é™æ€æ–‡ä»¶æ¥è¿›è¡Œéƒ¨ç½²çš„ã€‚\né‚£åœ¨å®¹å™¨åŒ–éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºä¸€ä¸ªwebæœåŠ¡çš„åŸºç¡€å®¹å™¨ï¼ˆé•œåƒï¼‰å°†é™æ€æ–‡ä»¶æ„å»ºæˆç«™ç‚¹æˆ–è€…WebæœåŠ¡çš„å®¹å™¨é•œåƒæ¥è¿›è¡Œéƒ¨ç½²ã€‚åœ¨Dockerå¼€å‘æœ€ä½³å®è·µä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä¿æŒé•œåƒè¶³å¤Ÿå°ï¼ˆSizeå¤§å°ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é€‰æ‹©æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„webæœåŠ¡åŸºç¡€é•œåƒè¶³å¤Ÿå°ã€‚\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©Nginxä½œä¸ºæˆ‘ä»¬çš„webæœåŠ¡å™¨ï¼Œä¸€å¼€å§‹æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆé€‰æ‹©çš„ï¼Œå› ä¸ºç¤¾åŒºåœ¨Docker Hubä¸Šä¸ºæˆ‘ä»¬æä¾›äº†å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼Œä¸‹é¢æ¥çœ‹çœ‹æˆ‘ç”¨æ¥æ„å»ºé™æ€webæœåŠ¡çš„è¿‡ç¨‹ã€‚\nNginx On Alpine æˆ‘ä»¬çŸ¥é“åœ¨å®¹å™¨æ„å»ºçš„å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŸºäºAlpineLinuxä¸ºåˆ†å‘ç³»ç»Ÿçš„é•œåƒï¼Œå…¶æ¯”å…¶ä»–ï¼ˆä¾‹å¦‚ ubuntu, centosç­‰ï¼‰çš„é•œåƒä¼šå°å¾ˆå¤šã€‚å› æ­¤ä¸€å¼€å§‹æˆ‘ä»¬ä¹Ÿæ˜¯é€‰æ‹©åŸºäºAlpineçš„nginxé•œåƒï¼Œä¾‹å¦‚ nginx:1.22-alpineã€‚\n$ docker image pull nginx:1.22-alpine $ docker image ls | grep nginx nginx 1.22-alpine 23.5MB å¯ä»¥çœ‹åˆ°å…¶å¤§å°ä¸º 23.5MB ã€‚\nåŸºäºè¯¥æƒŠé†’æ„å»ºæˆ‘çš„åšå®¢çš„å‘å¸ƒé•œåƒ\nFROM mengzyou/hugo:0.106 AS builder COPY --chown=hugo:hugo . /home/hugo/app RUN hugo FROM nginx:1.22-alpine COPY --from=builder /home/hugo/app/public/ /usr/share/nginx/html $ docker build -t myblog:nginx . $ docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep myblog myblog nginx 29MB æ„å»ºå‡ºæ¥è€Œæœ€ç»ˆäº¤ä»˜é•œåƒçš„å¤§å°ä¸º 29MB ã€‚\nEasyhttpd On Alpine åæ¥ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç”¨GoLangç¼–å†™çš„è½»é‡çº§webæœåŠ¡å™¨ - easyhttpdï¼Œäºæ˜¯æˆ‘Forkäº†è¯¥é¡¹ç›®ï¼Œç¼–å†™äº†ä¸€ä¸ªDockerfileæ¥æ„å»ºè¯¥webæœåŠ¡å™¨çš„é•œåƒï¼Œå…·ä½“å¯æŸ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹ã€‚\né•œåƒæˆ‘å·²å‘å¸ƒåœ¨mengzyou/easyhttpdã€‚\n$ docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep easyhttpd mengzyou/easyhttpd v0.0.1 13.7MB é•œåƒå¤§å°ä¸º 13.7MBï¼Œæ¯” nginx:alpine çš„é•œåƒå°äº†åå‡ MBã€‚ä½¿ç”¨è¯¥é•œåƒæ„å»ºæ¥æ„å»ºæˆ‘çš„åšå®¢ç«™ç‚¹\n... FROM mengzyou/easyhttpd:v0.0.1 COPY --from=builder --chown=http:www /home/hugo/app/public/ /srv/www $ docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep myblog myblog nginx 29MB myblog ehttpd 19.1MB å¾—åˆ°çš„åº”ç”¨é•œåƒå¤§å°ä¸º 19.1MB ï¼Œè¿›ä¸€æ­¥å‡å°‘äº†åº”ç”¨çš„é•œåƒå¤§å°ã€‚\nBusyBox Httpd æœ€è¿‘çœ‹åˆ°äº†ä¸€ä¸ªå›½å¤–çš„åšå®¢æ–‡ç« ï¼Œå¯ä»¥æ„å»ºä¸€ä¸ªåªæœ‰ ~155KB å¤§å°çš„webæœåŠ¡å™¨é•œåƒï¼Œæˆ‘éå¸¸å¥½å¥‡ï¼Œå‘ç€æ˜¯å¦å¯ä»¥è¿›ä¸€æ­¥å‡å°‘æˆ‘çš„é™æ€ç«™ç‚¹çš„é•œåƒå¤§å°ã€‚\næ˜¯ä½¿ç”¨äº†BusyBoxå†…ç½®çš„httpdæ¥é™æ€æ–‡ä»¶æä¾›webæœåŠ¡ã€‚äºæ˜¯æˆ‘ä¹Ÿå­¦ä¹ è¯¥ä½œè€…åˆ›å»ºäº†ä¸€ä¸ªåŸºäºbusybox - httpdçš„webæœåŠ¡å™¨é•œåƒï¼Œå°†å…¶å‘½åä¸º bbhttpdï¼Œå…·ä½“çš„æ„å»ºå†…å®¹è¯·å‚è€ƒGithubä»“åº“ - docker-bbhttpdã€‚\næ„å»ºçš„é•œåƒæˆ‘ä¹Ÿå‘å¸ƒåˆ°Docker Hub - mengzyou/bbhttpd\n$ docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep bbhttpd mengzyou/bbhttpd 1.35 155kB é•œåƒå¤§å°ç¡®å®åªæœ‰ 155KBï¼Œæ˜¯ä¸æ˜¯æŒºæƒŠäººçš„ï¼Ÿä½¿ç”¨è¯¥é•œåƒæ¥æ„å»ºæˆ‘çš„ç«™ç‚¹\n... FROM mengzyou/bbhttpd:1.35 COPY --from=builder --chown=www:www /home/hugo/app/public/ /home/www/html docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep myblog myblog nginx 29MB myblog ehttpd 19.1MB myblog bbhttpd 5.64MB æœ€ç»ˆçš„äº¤ä»˜é•œåƒå¤§å°åªæœ‰ 1.64MBï¼Œå‡ ä¹ä¹Ÿå°±æ˜¯webæœåŠ¡é™æ€æ–‡ä»¶çš„å¤§å°ã€‚\næ€»ç»“ æŒ‰ç…§Dockerå®¹å™¨é•œåƒæ„å»ºçš„æœ€ä½³å®è·µï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä¿æŒæœ€å°çš„ç»é”€å¤§å°ï¼Œè€Œå‡å°‘é•œåƒå¤§å°çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯é€‰æ‹©è¶³å¤Ÿå°çš„åŸºç¡€é•œåƒã€‚å› æ­¤æˆ‘ä»¬åœ¨æ„å»ºé™æ€WebæœåŠ¡çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡è‡ªå·±æ„å»ºåŸºç¡€é•œåƒçš„æ–¹å¼ï¼Œå¤§å¤§å‡å°‘æœ€ç»ˆçš„é•œåƒå¤§å°ã€‚\nåŸºç¡€é•œåƒ nginx:1.22-alpne mengzyou/easyhttpd:v0.0.1 mengzyou/bbhttpd:1.35 Size 23.5MB 13.7MB 155KB ","date":"November 20, 2022","hero":"/zh/posts/container-tech/smallest-web-container/docker-bp.jpg","permalink":"/zh/posts/container-tech/smallest-web-container/","summary":"åœ¨ç°ä»£çš„B/Sæ¶æ„åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬ä¼šåšå‰åç«¯åˆ†ç¦»ï¼ŒæŸäº›å‰ç«¯WebæœåŠ¡ä¼šå°†ç¼–è¯‘å®Œæˆçš„é™æ€æ–‡ä»¶æ”¾åˆ°ä¸€ä¸ªwebæœåŠ¡å™¨è¿›è¡Œéƒ¨ç½²ã€‚ä¾‹å¦‚ï¼Œæˆ‘çš„åšå®¢ä¹Ÿæ˜¯åŸºäºHugoç¼–è¯‘çš„é™æ€æ–‡ä»¶æ¥è¿›è¡Œéƒ¨ç½²çš„ã€‚\né‚£åœ¨å®¹å™¨åŒ–éƒ¨ç½²æ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦åŸºäºä¸€ä¸ªwebæœåŠ¡çš„åŸºç¡€å®¹å™¨ï¼ˆé•œåƒï¼‰å°†é™æ€æ–‡ä»¶æ„å»ºæˆç«™ç‚¹æˆ–è€…WebæœåŠ¡çš„å®¹å™¨é•œåƒæ¥è¿›è¡Œéƒ¨ç½²ã€‚åœ¨Dockerå¼€å‘æœ€ä½³å®è·µä¸­ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä¿æŒé•œåƒè¶³å¤Ÿå°ï¼ˆSizeå¤§å°ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡é€‰æ‹©æ»¡è¶³æˆ‘ä»¬éœ€æ±‚çš„webæœåŠ¡åŸºç¡€é•œåƒè¶³å¤Ÿå°ã€‚\nå¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šé€‰æ‹©Nginxä½œä¸ºæˆ‘ä»¬çš„webæœåŠ¡å™¨ï¼Œä¸€å¼€å§‹æˆ‘ä¹Ÿæ˜¯è¿™ä¹ˆé€‰æ‹©çš„ï¼Œå› ä¸ºç¤¾åŒºåœ¨Docker Hubä¸Šä¸ºæˆ‘ä»¬æä¾›äº†å¼€ç®±å³ç”¨çš„å®¹å™¨é•œåƒï¼Œä¸‹é¢æ¥çœ‹çœ‹æˆ‘ç”¨æ¥æ„å»ºé™æ€webæœåŠ¡çš„è¿‡ç¨‹ã€‚\nNginx On Alpine æˆ‘ä»¬çŸ¥é“åœ¨å®¹å™¨æ„å»ºçš„å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©åŸºäºAlpineLinuxä¸ºåˆ†å‘ç³»ç»Ÿçš„é•œåƒï¼Œå…¶æ¯”å…¶ä»–ï¼ˆä¾‹å¦‚ ubuntu, centosç­‰ï¼‰çš„é•œåƒä¼šå°å¾ˆå¤šã€‚å› æ­¤ä¸€å¼€å§‹æˆ‘ä»¬ä¹Ÿæ˜¯é€‰æ‹©åŸºäºAlpineçš„nginxé•œåƒï¼Œä¾‹å¦‚ nginx:1.22-alpineã€‚\n$ docker image pull nginx:1.22-alpine $ docker image ls | grep nginx nginx 1.22-alpine 23.5MB å¯ä»¥çœ‹åˆ°å…¶å¤§å°ä¸º 23.5MB ã€‚\nåŸºäºè¯¥æƒŠé†’æ„å»ºæˆ‘çš„åšå®¢çš„å‘å¸ƒé•œåƒ\nFROM mengzyou/hugo:0.106 AS builder COPY --chown=hugo:hugo . /home/hugo/app RUN hugo FROM nginx:1.22-alpine COPY --from=builder /home/hugo/app/public/ /usr/share/nginx/html $ docker build -t myblog:nginx . $ docker image ls --format \u0026#34;{{.Repository}}\\t{{.Tag}}\\t{{.Size}}\u0026#34; | grep myblog myblog nginx 29MB æ„å»ºå‡ºæ¥è€Œæœ€ç»ˆäº¤ä»˜é•œåƒçš„å¤§å°ä¸º 29MB ã€‚\nEasyhttpd On Alpine åæ¥ï¼Œæˆ‘å‘ç°äº†ä¸€ä¸ªç”¨GoLangç¼–å†™çš„è½»é‡çº§webæœåŠ¡å™¨ - easyhttpdï¼Œäºæ˜¯æˆ‘Forkäº†è¯¥é¡¹ç›®ï¼Œç¼–å†™äº†ä¸€ä¸ªDockerfileæ¥æ„å»ºè¯¥webæœåŠ¡å™¨çš„é•œåƒï¼Œå…·ä½“å¯æŸ¥çœ‹è¯¥æ–‡ä»¶å†…å®¹ã€‚","tags":["docker","web"],"title":"æœ€å°åŒ–é™æ€WEBå®¹å™¨å®è·µ"},{"categories":["DEVOPS"],"contents":"è½»é‡çº§Kubernetesé›†ç¾¤-K3Sæ–‡ç« ä»‹ç»äº†ä¸€ä¸ªè½»é‡çº§çš„ Kubernetes å‘è¡Œç‰ˆæœ¬ - k3s ã€‚\nè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ª IaCï¼ˆInfrastructure as Codeï¼‰å·¥å…·ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒï¼ˆä¾‹å¦‚ä½ çš„ Linux å·¥ä½œå°ï¼‰è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸€ä¸ªå¯ç”¨çš„ K3S é›†ç¾¤\nPacker - HashiCorp å¼€æºçš„ä¸€ä¸ªç³»ç»Ÿé•œåƒæ„å»ºå·¥å…·ã€‚ Terraform - HashiCorp å¼€æºçš„åŸºç¡€è®¾æ–½åŠä»£ç è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·ã€‚ Ansible - RedHatèµåŠ©çš„ä¸€ä¸ªå¼€æºç¤¾åŒºé¡¹ç›®ï¼ŒITè‡ªåŠ¨åŒ–é…ç½®å·¥å…·ã€‚ ç¯å¢ƒéœ€æ±‚ æœ¬æ¼”ç¤ºå°†çš„æ‰€æœ‰æ“ä½œå°†åœ¨ä¸€å°æ”¯æŒè™šæ‹ŸåŒ–ï¼ˆkvm + qemu + libvirt) Linux ä¸»æœºä¸Šæ‰§è¡Œã€‚\nåœ¨ Ubuntu ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ KVM hypervisor: a beginner\u0026rsquo;s guide ã€‚\nåœ¨ Fedora ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ Getting startyed with virtualization (libvirt) ã€‚\nåœ¨ openSUSE ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ Virtualization Guide ã€‚\nå…¶ä»– Linux å‘è¡Œç‰ˆï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚\næˆ‘æ˜¯åœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šæ‰§è¡Œçš„æ“ä½œï¼Œç³»ç»Ÿæ˜¯ openSUSE Leap 15.4 ã€‚\né™¤äº†ä¸Šè¿°çš„è™šæ‹ŸåŒ–éœ€æ±‚å¤–ï¼Œè¿˜éœ€è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£…ä¸Šé¢æåˆ°çš„å‡ ä¸ªå·¥å…·ã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸­æœ‰ LinuxBrewï¼Œåˆ™å¯é€šè¿‡ Brew ç›´æ¥å®‰è£…\nâ¯ brew install packer terraform ansible å¦åˆ™ï¼Œè¯·ä¸‹è½½å„è‡ªå®˜æ–¹å‘å¸ƒçš„äºŒè¿›åˆ¶åŒ…ï¼Œè§£å‹åæ”¾åˆ° PATH è·¯å¾„ä¸­ã€‚\nâ¯ packer version Packer v1.8.3 â¯ terraform version Terraform v1.3.2 on linux_amd64 â¯ ansible --version ansible [core 2.13.4] å› ä¸ºæœ¬ç¤ºä¾‹ä¸­ï¼Œä½¿ç”¨äº† Terraform çš„ ansbile provisionerï¼Œå› æ­¤è¿˜éœ€è¦å®‰è£…è¿™ä¸ªæ’ä»¶\nâ¯ mkdir -p ~/.terraform.d/plugins â¯ curl -sL \\ https://raw.githubusercontent.com/radekg/terraform-provisioner-ansible/master/bin/deploy-release.sh \\ --output /tmp/deploy-release.sh â¯ chmod +x /tmp/deploy-release.sh â¯ /tmp/deploy-release.sh -v 2.5.0 â¯ rm -rf /tmp/deploy-release.sh å®Œæˆä»¥ä¸Šéœ€æ±‚ä¹‹åï¼Œæˆ‘ä»¬å°†å¼€å§‹æ‰§è¡Œå¦‚ä¸‹æ­¥éª¤\nä½¿ç”¨ Packer åˆ›å»ºä¸€ä¸ªåŸºäº Debian 11.5.0 çš„è™šæ‹Ÿæœºç³»ç»Ÿæ¨¡æ¿é•œåƒï¼Œè¯¥é•œåƒä¸­ï¼Œå°†ä¼šé…ç½®å¥½ SSH å…å¯†ç™»é™†å¯†é’¥ã€‚ ä½¿ç”¨ Terraform åœ¨æœ¬åœ°è™šæ‹Ÿç¯å¢ƒä¸­ï¼Œåˆ›å»ºå‡ºéœ€è¦çš„è™šæ‹Ÿæœºï¼Œå¹¶ç”Ÿæˆåç»­ ansible é…ç½®è™šæ‹Ÿæœºéœ€è¦çš„ inventory æ–‡ä»¶ã€‚ ä½¿ç”¨ Ansible é…ç½®è™šæ‹ŸæœºèŠ‚ç‚¹å®‰è£… k3s é›†ç¾¤ï¼Œä»¥åŠæ¼”ç¤ºåº”ç”¨ã€‚ ä»¥ä¸Šæ‰€æœ‰æ­¥éª¤çš„ä»£ç åœ¨ ï¼ˆhttps://github.com/mengzyou/iac-examplesï¼‰\nå°†ä»£ç å…‹éš†åˆ°æœ¬åœ°\nâ¯ git clone https://github.com/mengzyou/iac-examples.git â¯ cd iac-example/k3scluster/ åˆ›å»ºè™šæ‹Ÿæœºé•œåƒ é¦–å…ˆæˆ‘ä»¬éœ€è¦é€šè¿‡ Packer åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºç³»ç»Ÿé•œåƒï¼Œåç»­éœ€è¦ä½¿ç”¨è¯¥é•œåƒæ¥åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹ï¼Œéœ€è¦çš„ä»£ç åœ¨ k3scluster/packer/ ç›®å½•ä¸‹\nâ¯ cd packer/ â¯ tree . |-- Makefile |-- base.pkr.hcl `-- preseed |-- debian11.txt è¿™é‡Œé€šè¿‡ Makefile æ¥è°ƒç”¨ packer è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œå’Œä¸Šä¼ åˆ°è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œæ³¨æ„ä»¥ä¸‹å˜é‡é…ç½®\nLIBVIRT_HYPERVISOR_URI := \u0026#34;qemu:///system\u0026#34; LIBVIRT_TEMPLATES_IMAGES_POOL := \u0026#34;templates\u0026#34; LIBVIRT_TEMPLATES_IMAGES_POOL_DIR := \u0026#34;/var/lib/libvirt/images/templates\u0026#34; LIBVIRT_IMAGE_NAME := \u0026#34;debian11-5.qcow2\u0026#34; ROOT_PASSWORD := \u0026#34;rootPassword\u0026#34; $(eval SSH_IDENTITY=$(shell find ~/.ssh/ -name \u0026#39;id_*\u0026#39; -not -name \u0026#39;*.pub\u0026#39; | head -n 1)) é»˜è®¤ä½¿ç”¨ ${HOME}/.ssh/id_rsa çš„å¯†é’¥å¯¹ä½œä¸º SSH å…å¯†è®¿é—®çš„å¯†é’¥ï¼Œå¦‚æœæ²¡æœ‰ï¼Œè¯·å…ˆåˆ›å»ºä¸€ä¸ªã€‚\næ‰§è¡Œ make image è¿›è¡Œé•œåƒçš„æ„å»ºï¼Œä»¥åŠåœ¨æœ¬åœ°è™šæ‹ŸåŒ–ç¯å¢ƒåˆ›å»ºåä¸º templates çš„å­˜å‚¨æ± ï¼Œå¹¶å°†é•œåƒä¸Šä¼ åˆ°è¯¥å­˜å‚¨æ± ä¸­ï¼Œå‘½åä¸º debian11-5.qcow2 çš„å·ï¼Œå…·ä½“çš„ä»£ç ï¼Œè¯·æŸ¥çœ‹ Makefile ã€‚\nâ¯ make image ... å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ virsh å‘½ä»¤æŸ¥çœ‹é•œåƒå·\nâ¯ sudo virsh vol-list --pool templates åç§° è·¯å¾„ ------------------------------------------------------------------------ debian11-5.qcow2 /var/lib/libvirt/images/templates/debian11-5.qcow2 è¡¥å……: åœ¨æ–‡ä»¶ base.pkr.hcl ä¸­ï¼Œå¯¹ iso æ–‡ä»¶æºçš„é…ç½®\niso_url = \u0026#34;https://mirrors.ustc.edu.cn/debian-cd/current/amd64/iso-cd/debian-11.5.0-amd64-netinst.iso\u0026#34; é…ç½®ç½‘ç»œåœ°å€æ—¶ï¼Œåœ¨ packer è¿›è¡Œæ„å»ºæ—¶ï¼Œå¯èƒ½ä¼šä¸‹è½½ iso æ–‡ä»¶è¶…æ—¶è€Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚å¯é€šè¿‡é¢„å…ˆä¸‹è½½å¯¹åº”çš„ iso æ–‡ä»¶åˆ°æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œç„¶åå°† iso_url é…ç½®ä¸ºæœ¬åœ°è·¯å¾„ï¼Œä¾‹å¦‚\niso_url = \u0026#34;/data/debian-11.5.0-amd64-netinst.iso\u0026#34; è¿™æ ·å¯ä»¥é¿å…ç”±äºç½‘ç»œé—®é¢˜å¯¼è‡´æ„å»ºå¤±è´¥ã€‚\nåˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ Terraform åˆ›å»ºå¹¶åˆå§‹åŒ–é›†ç¾¤æ‰€éœ€è¦çš„è™šæ‹Ÿæœºå®ä¾‹ï¼Œè¿›å…¥ k3scluster/terraform/ ç›®å½•\nâ¯ cd ../terraform/ è¯¥ç›®å½•ä¸‹åŒ…å«äº†åˆ›å»ºé›†ç¾¤æ‰€éœ€è™šæ‹Ÿæœºèµ„æºçš„å®šä¹‰ï¼Œé¦–å…ˆçœ‹ provider.tf æ–‡ä»¶\nterraform { required_providers { libvirt = { source = \u0026#34;dmacvicar/libvirt\u0026#34; version = \u0026#34;0.7.0\u0026#34; } } required_version = \u0026#34;\u0026gt;= 0.13\u0026#34; } provider \u0026#34;libvirt\u0026#34; { uri = var.libvirt_uri } å› ä¸ºæˆ‘ä»¬éœ€è¦é€šè¿‡ libvirt åˆ›å»ºè™šæ‹Ÿæœºï¼Œå› æ­¤è¿™é‡Œéœ€è¦ dmacvicar/libvirt çš„ Providerï¼Œè¯¥ Provider çš„ uri é…ç½®ä¸ºå˜é‡ var.libvirt_uriï¼Œé»˜è®¤ä¸º qemu:///systemï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°è™šæ‹Ÿç¯å¢ƒã€‚\nå…¶ä»–éœ€è¦çš„å˜é‡å®šä¹‰éƒ½æ”¾åœ¨ variables.tf æ–‡ä»¶ä¸­ã€‚èµ„æºæ–‡ä»¶ vms.tf å®šä¹‰äº†éœ€è¦åˆ›å»ºçš„èµ„æºï¼Œå…¶ä¸­åŒ…æ‹¬\nresource \u0026#34;libvirt_network\u0026#34; \u0026#34;network\u0026#34; { name = var.net_name mode = \u0026#34;nat\u0026#34; domain = var.net_domain addresses = [var.subnet] dhcp { enabled = true } dns { enabled = true local_only = true } } åˆ›å»ºä¸€ä¸ª NAT æ¨¡å¼çš„è™šæ‹Ÿç½‘ç»œï¼Œé»˜è®¤çš„ç½‘ç»œåœ°å€ä¸º 192.168.123.0/24ï¼Œå¯é€šè¿‡å˜é‡ net_domain ä¿®æ”¹ã€‚\nresource \u0026#34;libvirt_volume\u0026#34; \u0026#34;disk\u0026#34; { count = length(var.vms) name = \u0026#34;${var.vms[count.index].name}.qcow2\u0026#34; pool = \u0026#34;default\u0026#34; base_volume_name = var.template_img base_volume_pool = var.templates_pool } æ ¹æ®å˜é‡ vms å®šä¹‰çš„è™šæ‹Ÿæœºå®ä¾‹ï¼Œåˆ›å»ºè™šæ‹Ÿæœºçš„ç³»ç»Ÿç£ç›˜ï¼ŒåŸºäºå˜é‡ templates_pool å’Œ template_image æŒ‡å®šçš„æ¨¡æ¿é•œåƒï¼Œé»˜è®¤ä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä»¬é€šè¿‡ Packer åˆ›å»ºçš„ç³»ç»Ÿé•œåƒã€‚\nresource \u0026#34;libvirt_domain\u0026#34; \u0026#34;vm\u0026#34; { count = length(var.vms) name = var.vms[count.index].name autostart = true qemu_agent = true vcpu = lookup(var.vms[count.index], \u0026#34;cpu\u0026#34;, 1) memory = lookup(var.vms[count.index], \u0026#34;memory\u0026#34;, 512) ... } } libvirt_domain èµ„æºå®šä¹‰äº†éœ€è¦åˆ›å»ºçš„è™šæ‹Ÿæœºå®ä¾‹ï¼Œå¹¶é€šè¿‡ ansible provisioner è¿›è¡Œæ˜¯åˆå§‹åŒ–é…ç½®ï¼ˆé…ç½®é™æ€IPåœ°å€å’Œä¸»æœºåï¼‰ã€‚\nresource \u0026#34;local_file\u0026#34; \u0026#34;ansible_hosts\u0026#34; { content = templatefile(\u0026#34;./tpl/ansible_hosts.tpl\u0026#34;, { vms = var.vms subnet = var.subnet gateway = cidrhost(var.subnet, 1) mask = cidrnetmask(var.subnet) nameserver = cidrhost(var.subnet, 1) user = var.user }) filename = \u0026#34;../ansible/k3s_hosts\u0026#34; file_permission = 0644 directory_permission = 0755 } è¯¥èµ„æºå®šä¹‰é€šè¿‡æ¨¡æ¿æ–‡ä»¶åˆ›å»ºè™šæ‹Ÿæœºå®ä¾‹çš„ Ansible Inventory æ–‡ä»¶ï¼Œä¾¿äºä¸‹ä¸€æ­¥é€šè¿‡ Ansible è¿›è¡Œ K3S é›†ç¾¤çš„åˆ›å»ºã€‚\nåœ¨åº”ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦é…ç½® vms å˜é‡ï¼Œæ¥æŒ‡å®šæˆ‘ä»¬éœ€è¦çš„è™šæ‹Ÿæœºå®ä¾‹ä¿¡æ¯\nâ¯ cp .k3svms.tfvars k3dcluster.auto.tfvars vms = [ { name = \u0026#34;control\u0026#34; cpu = 1 memory = 1024 ip = 10 groups = [\u0026#34;k3s\u0026#34;] vars = { role = \u0026#34;server\u0026#34; } }, { name = \u0026#34;worker1\u0026#34; cpu = 1 memory = 1024 ip = 21 groups = [\u0026#34;k3s\u0026#34;] vars = { role = \u0026#34;agent\u0026#34; } }, { name = \u0026#34;worker2\u0026#34; cpu = 1 memory = 1024 ip = 22 groups = [\u0026#34;k3s\u0026#34;] vars = { role = \u0026#34;agent\u0026#34; } } ] ä¸Šé¢å®šä¹‰äº†3å°å®ä¾‹ï¼Œ1å°ä½œä¸ºk3sé›†ç¾¤çš„ server èŠ‚ç‚¹ï¼Œ2å°ä½œä¸ºk3sé›†ç¾¤çš„ role èŠ‚ç‚¹ï¼Œé»˜è®¤IPåœ°å€å°†ä¼šè¢«é…ç½®ä¸º\ncontrol : 192.168.123.10 worker1 : 192.168.123.21 worker2 : 192.168.123.22 æ¥ä¸‹æ¥æˆ‘ä»¬å°†æ‰§è¡Œ Terrform æ“ä½œ\nâ¯ terraform init â¯ terraform plan â¯ terrafrom apply --auto-approve ... Apply complete! Resources: 8 added, 0 changed, 0 destroyed. Outputs: vms_ip_addresses = { \u0026#34;control\u0026#34; = \u0026#34;192.168.123.10\u0026#34; \u0026#34;worker1\u0026#34; = \u0026#34;192.168.123.21\u0026#34; \u0026#34;worker2\u0026#34; = \u0026#34;192.168.123.22\u0026#34; } å®Œæˆä¹‹åï¼Œ3å°è™šæ‹Ÿæœºå°†ä¼šåˆ›å»ºå¹¶è¿è¡Œï¼ŒåŒæ—¶åœ¨ k3scluster/ansible/ ç›®å½•ä¸­å°†åˆ›å»ºåä¸º k3s_hosts çš„ Inventory æ–‡ä»¶ã€‚\néƒ¨ç½²K3Sé›†ç¾¤ å®Œæˆè™šæ‹Ÿæœºçš„åˆ›å»ºä¹‹åï¼Œæˆ‘ä»¬è¿›å…¥ k3scluster/ansible/ ç›®å½•ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œ\nâ¯ cd ../ansible/ â¯ ls ï’ apps.yml ï’ init.yml ï’ k3s.yaml ï€– k3s_hosts ï’ main.yml ï„• roles å…¶ä¸­æ–‡ä»¶ k3s_hosts æ˜¯åœ¨ä¸Šä¸€æ­¥ç”Ÿæˆçš„ Inventory æ–‡ä»¶ï¼Œinit.yml æ–‡ä»¶æ˜¯åˆå§‹åŒ–èŠ‚ç‚¹çš„ playbookï¼Œåœ¨ä¸Šä¸€æ­¥çš„ Terraform åº”ç”¨ä¸­ä»¥åŠæ‰§è¡Œäº†ã€‚\nmain.yml æ–‡ä»¶æ˜¯å®‰è£…é…ç½® K3S é›†ç¾¤çš„ playbookï¼Œroles/ ç›®å½•åŒ…å«äº†æ‰€æœ‰çš„ä»»åŠ¡ã€‚\nåœ¨æ‰§è¡Œå…·ä½“ä»»åŠ¡ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ansbile æµ‹è¯•ä¸‹è™šæ‹ŸæœºèŠ‚ç‚¹çš„å¯ç”¨æ€§\nâ¯ ansible -i k3s_hosts all -m ping worker1 | SUCCESS =\u0026gt; { \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } worker2 | SUCCESS =\u0026gt; { \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } control | SUCCESS =\u0026gt; { \u0026#34;changed\u0026#34;: false, \u0026#34;ping\u0026#34;: \u0026#34;pong\u0026#34; } æ¥ä¸‹æ¥æ‰§è¡Œ main.yml playbook\nâ¯ ansible-playbook -i k3s_hosts main.yml ... PLAY RECAP ******************************************** control : ok=16 changed=7 unreachable=0 failed=0 skipped=4 rescued=0 ignored=0 worker1 : ok=8 changed=4 unreachable=0 failed=0 skipped=6 rescued=0 ignored=0 worker2 : ok=8 changed=4 unreachable=0 failed=0 skipped=6 rescued=0 ignored=0 è¿™å°†ä¼šè°ƒç”¨ roles/k3s/ é‡Œå®šä¹‰çš„ä»»åŠ¡ï¼Œå®‰è£…å’Œé…ç½® K3S é›†ç¾¤ï¼Œå…·ä½“çš„æ‰§è¡Œä»»åŠ¡ï¼Œè¯·æŸ¥çœ‹ roles é‡Œçš„ä»£ç ã€‚\næˆåŠŸä¹‹åï¼Œä¼šå‘ç°åœ¨å½“å‰ç›®å½•ç”Ÿæˆäº†ä¸€ä¸ª k3s.yaml çš„æ–‡ä»¶ï¼Œè¿™æ˜¯ä» control èŠ‚ç‚¹è·å–çš„ kubeconfig æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æ›¿æ¢ä¸€ä¸‹ api-server çš„ IP\nâ¯ sed -i \u0026#39;s/127.0.0.1/192.168.123.10/g\u0026#39; k3s.yaml ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¯¥ kubeconfig æ–‡ä»¶æ¥è®¿é—®è¯¥é›†ç¾¤äº†ï¼Œä¾‹å¦‚\nâ¯ kubectl --kubeconfig k3s.yaml cluster-info Kubernetes control plane is running at https://192.168.123.10:6443 CoreDNS is running at https://192.168.123.10:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy Metrics-server is running at https://192.168.123.10:6443/api/v1/namespaces/kube-system/services/https:metrics-server:https/proxy â¯ kubectl --kubeconfig k3s.yaml get no NAME STATUS ROLES AGE VERSION worker2.k3s.local Ready \u0026lt;none\u0026gt; 4m19s v1.25.2+k3s1 worker1.k3s.local Ready \u0026lt;none\u0026gt; 4m18s v1.25.2+k3s1 control.k3s.local Ready control-plane,master 4m39s v1.25.2+k3s1 è‡³æ­¤ï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ª K3S é›†ç¾¤çš„éƒ¨ç½²ï¼Œå¹¶å¯ä»¥åœ¨éƒ¨ç½²å…¶ä»–åº”ç”¨ã€‚æœ€åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»§ç»­ä½¿ç”¨ ansible æ¥éƒ¨ç½²æ¼”ç¤ºåº”ç”¨ã€‚\næ–‡ä»¶ apps.yml æ˜¯éƒ¨ç½²æ¼”ç¤ºåº”ç”¨çš„ playbookï¼Œå…¶é€šè¿‡ roles/k3s-app/ ä»»åŠ¡ï¼Œä¸ k3s server èŠ‚ç‚¹äº¤äº’æ¥è¿›è¡Œåº”ç”¨éƒ¨ç½²ï¼Œå…¶ä¼šéƒ¨ç½² Traefik Ingress å’Œä¸€ä¸ª whoami web åº”ç”¨ï¼Œç›´æ¥æ‰§è¡Œ\nâ¯ ansible-playbook -i k3s_hosts apps.yml ... PLAY RECAP ***************************************************** control : ok=4 changed=3 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 å®Œæˆä¹‹åï¼Œé€šè¿‡ kubectl å‘½ä»¤æŸ¥çœ‹éƒ¨ç½²çš„ pod\nâ¯ kubectl --kubeconfig k3s.yaml get po -n whoami NAME READY STATUS RESTARTS AGE whoami-5b844ffb57-mffgf 1/1 Running 0 79s â¯ kubectl --kubeconfig k3s.yaml get ingressroute -n whoami NAME AGE whoami 2m12s å°è¯•è®¿é—® whoami åº”ç”¨\nâ¯ http http://192.168.123.10/ HTTP/1.1 200 OK Content-Length: 413 Content-Type: text/plain; charset=utf-8 Date: Thu, 13 Oct 2022 08:58:06 GMT Hostname: whoami-5b844ffb57-mffgf IP: 127.0.0.1 IP: ::1 IP: 10.42.2.3 IP: fe80::b83a:19ff:febe:7a7f RemoteAddr: 10.42.0.5:60580 GET / HTTP/1.1 Host: 192.168.123.10 User-Agent: HTTPie/3.2.1 Accept: */* Accept-Encoding: gzip, deflate X-Forwarded-For: 192.168.123.1 X-Forwarded-Host: 192.168.123.10 X-Forwarded-Port: 80 X-Forwarded-Proto: http X-Forwarded-Server: traefik-rjbr9 X-Real-Ip: 192.168.123.1 é”€æ¯é›†ç¾¤ é€šè¿‡ä»¥ä¸Šæ–¹å¼åˆ›å»ºçš„ K3S é›†ç¾¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„é€šè¿‡ Terraform é”€æ¯å¹¶é‡æ–°åˆ›å»ºã€‚å½“å®Œæˆäº†ç›¸å…³çš„åº”ç”¨æµ‹è¯•ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹å‘½ä»¤é”€æ¯é›†ç¾¤\nâ¯ rm -f k3s.yaml â¯ cd ../terraform/ â¯ terraform destroy --auto-approve ... Destroy complete! Resources: 8 destroyed. æˆ‘å°±å°†ä¼šåˆ é™¤æ‰€åˆ›å»ºçš„æ‰€æœ‰ç›¸å…³èµ„æºï¼Œæ¢å¤å¹²å‡€çš„æœ¬åœ°ç¯å¢ƒã€‚\nå½“éœ€è¦é›†ç¾¤çš„æ—¶å€™ï¼Œåªéœ€è¦æ‰§è¡Œä¸Šé¢çš„æ­¥éª¤å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ K3S é›†ç¾¤ã€‚\næ€»ç»“ è¿™é‡Œæ¼”ç¤ºäº†ä¸€ä¸ª IaC åœºæ™¯ï¼Œé€šè¿‡ä»£ç åŒ–åŸºç¡€è®¾æ–½èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°é€šè¿‡ Terraformï¼ŒAnsible ç­‰å·¥å…·ç®¡ç†å¹¶ç»´æŠ¤ç›¸åº”çš„åŸºç¡€è®¾æ–½èµ„æºã€‚\nè¿™é‡Œæˆ‘ä»¬æ¼”ç¤ºåœ¨æœ¬åœ°è™šæ‹ŸåŒ–ç¯å¢ƒåˆ›å»ºè™šæ‹Ÿæœºå¹¶éƒ¨ç½²k3Sé›†ç¾¤ï¼Œé‚£é€šè¿‡ Terraform çš„å…¶ä»– Providers (ä¾‹å¦‚ AWS, GCPç­‰å…±æœ‰äº‘)ï¼Œæˆ‘ä»¬å¯ä»¥ä»£ç åŒ–ç®¡ç†æˆ‘ä»¬çš„å…¬æœ‰äº‘åŸºç¡€è®¾æ–½ç¯å¢ƒï¼Œå¹¶å¯ä»¥å°†ç›¸åº”çš„æµç¨‹åŠ å…¥ CI/CD ä¸­ï¼Œå¯å¿«é€Ÿåˆ›å»ºéœ€è¦çš„ç¯å¢ƒåšæµ‹è¯•ã€‚\nIaC æ˜¯ç°ä»£åŒ–åŸºç¡€è®¾æ–½è¿ç»´çš„æ–¹å‘ï¼Œç»“åˆç›¸å…³å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾å®ç°åŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–è¿ç»´ã€‚\n","date":"October 13, 2022","hero":"/zh/posts/devops/k3s-terraform-ansible/k3s-terraform-ansible.jpeg","permalink":"/zh/posts/devops/k3s-terraform-ansible/","summary":"è½»é‡çº§Kubernetesé›†ç¾¤-K3Sæ–‡ç« ä»‹ç»äº†ä¸€ä¸ªè½»é‡çº§çš„ Kubernetes å‘è¡Œç‰ˆæœ¬ - k3s ã€‚\nè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä½¿ç”¨ä»¥ä¸‹å‡ ä¸ª IaCï¼ˆInfrastructure as Codeï¼‰å·¥å…·ï¼Œåœ¨æœ¬åœ°ç¯å¢ƒï¼ˆä¾‹å¦‚ä½ çš„ Linux å·¥ä½œå°ï¼‰è‡ªåŠ¨åŒ–éƒ¨ç½²ä¸€ä¸ªå¯ç”¨çš„ K3S é›†ç¾¤\nPacker - HashiCorp å¼€æºçš„ä¸€ä¸ªç³»ç»Ÿé•œåƒæ„å»ºå·¥å…·ã€‚ Terraform - HashiCorp å¼€æºçš„åŸºç¡€è®¾æ–½åŠä»£ç è‡ªåŠ¨åŒ–ç®¡ç†å·¥å…·ã€‚ Ansible - RedHatèµåŠ©çš„ä¸€ä¸ªå¼€æºç¤¾åŒºé¡¹ç›®ï¼ŒITè‡ªåŠ¨åŒ–é…ç½®å·¥å…·ã€‚ ç¯å¢ƒéœ€æ±‚ æœ¬æ¼”ç¤ºå°†çš„æ‰€æœ‰æ“ä½œå°†åœ¨ä¸€å°æ”¯æŒè™šæ‹ŸåŒ–ï¼ˆkvm + qemu + libvirt) Linux ä¸»æœºä¸Šæ‰§è¡Œã€‚\nåœ¨ Ubuntu ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ KVM hypervisor: a beginner\u0026rsquo;s guide ã€‚\nåœ¨ Fedora ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ Getting startyed with virtualization (libvirt) ã€‚\nåœ¨ openSUSE ä¸Šå¯ç”¨è™šæ‹ŸåŒ–ç¯å¢ƒï¼Œè¯·å‚è€ƒ Virtualization Guide ã€‚\nå…¶ä»– Linux å‘è¡Œç‰ˆï¼Œè¯·å‚è€ƒç›¸å…³æ–‡æ¡£ã€‚\næˆ‘æ˜¯åœ¨æˆ‘çš„ç¬”è®°æœ¬ç”µè„‘ä¸Šæ‰§è¡Œçš„æ“ä½œï¼Œç³»ç»Ÿæ˜¯ openSUSE Leap 15.4 ã€‚\né™¤äº†ä¸Šè¿°çš„è™šæ‹ŸåŒ–éœ€æ±‚å¤–ï¼Œè¿˜éœ€è¦åœ¨ç³»ç»Ÿä¸Šå®‰è£…ä¸Šé¢æåˆ°çš„å‡ ä¸ªå·¥å…·ã€‚å¦‚æœä½ çš„ç¯å¢ƒä¸­æœ‰ LinuxBrewï¼Œåˆ™å¯é€šè¿‡ Brew ç›´æ¥å®‰è£…\nâ¯ brew install packer terraform ansible å¦åˆ™ï¼Œè¯·ä¸‹è½½å„è‡ªå®˜æ–¹å‘å¸ƒçš„äºŒè¿›åˆ¶åŒ…ï¼Œè§£å‹åæ”¾åˆ° PATH è·¯å¾„ä¸­ã€‚","tags":["terraform","ansible","k3s"],"title":"IaCç¤ºä¾‹-TERRAFORM\u0026ANSIBLEåˆ›å»ºK3Sé›†ç¾¤"},{"categories":["Kubernetes"],"contents":"K3S æ˜¯ Rancher ä¸ºç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œè¾¹ç¼˜è®¡ç®—ç¯å¢ƒå¼€å‘çš„è½»é‡çº§ Kubernetes å‘è¡Œç‰ˆæœ¬ã€‚ç›¸æ¯”åŸç”Ÿçš„ Kubernetesï¼Œå…¶ç§»é™¤äº†å¾ˆå¤šéå¿…è¦çš„ç»„ä»¶ï¼Œä¾‹å¦‚äº‘æ§åˆ¶ç®¡ç†å™¨ï¼ˆCCMï¼‰ã€å†…ç½®çš„ï¼ˆIn-Treeï¼‰çš„å­˜å‚¨æ’ä»¶ç­‰ï¼Œä»¥åŠä¸ºARMæ¶æ„çš„åŸºç¡€è®¾æ–½åšäº†ä¼˜åŒ–ã€‚\nK3s çš„è½»é‡çº§åŒæ—¶ä¹Ÿä½“ç°åœ¨å…¶æ‰“åŒ…æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåˆ†å‘ï¼ŒçŠ¶æ€å­˜å‚¨é™¤äº†æ”¯æŒ etcd å¤–ï¼Œè¿˜æ”¯æŒ Sqlite3ã€MySQlå’ŒPostgresã€‚å…¶è·Ÿå¤šç‰¹æ€§å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nK3s æ”¯æŒå•èŠ‚é›†ç¾¤éƒ¨ç½²ï¼ˆå¯ç”¨äºå¼€å‘æµ‹è¯•ç¯å¢ƒï¼‰ï¼Œä¹Ÿæ”¯æŒé«˜å¯ç”¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ã€‚åŒæ—¶è¿˜å¯ä»¥é€šè¿‡ k3d é¡¹ç›®å¿«é€Ÿåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä½¿ç”¨Dockerå®¹å™¨éƒ¨ç½² k3s é›†ç¾¤ä½œä¸ºå¼€å‘ç¯å¢ƒã€‚\nè¿™é‡Œæˆ‘å°†æ¼”ç¤ºé€šè¿‡è™šæ‹Ÿæœºéƒ¨ç½²ä¸€ä¸ªé«˜å¯ç”¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ï¼ˆ3ä¸ªServersèŠ‚ç‚¹ + 3ä¸ªAgentèŠ‚ç‚¹ï¼‰ã€‚\nk3Sæ¶æ„ ä¸Šå›¾æ˜¯æ¥è‡ªk3så®˜ç½‘çš„æ¶æ„å›¾ï¼Œå…¶æ¶æ„ä¸Kubernetesçš„æ¶æ„æ˜¯ç›¸ä¼¼çš„ï¼Œk3sçš„serverèŠ‚ç‚¹ä¹Ÿå°±æ˜¯æ§åˆ¶é¢èŠ‚ç‚¹ï¼ŒagentèŠ‚ç‚¹æ˜¯å·¥ä½œè´Ÿè½½èŠ‚ç‚¹ã€‚k3sé»˜è®¤ä½¿ç”¨ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚\næ›´ä¿¡æ¯çš„éƒ¨ç½²æ¶æ„å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nå‡†å¤‡è™šæ‹ŸæœºèŠ‚ç‚¹ è¿™é‡Œæˆ‘ä»¬å°†éƒ¨ç½² 3 + 3 çš„é›†ç¾¤ï¼Œéœ€è¦6å°è™šæ‹Ÿæœºï¼ŒåŸºæœ¬é…ç½®å¦‚ä¸‹\nä¸»æœºå IP vCPU å†…å­˜ homek3s-server1 192.168.0.150 1 2 GB homek3s-server2 192.168.0.151 1 2 GB homek3s-server3 192.168.0.152 1 2 GB homek3s-agent1 192.168.0.154 2 4 GB homek3s-agent2 192.168.0.155 2 4 GB homek3s-agent3 192.168.0.156 2 4 GB éƒ¨ç½²çš„æœ€å°éœ€æ±‚ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nK3s æ”¯æŒå¤§éƒ¨åˆ†ä¸»æµçš„Linuxæ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ openSUSE Leap Micro 15.2ï¼Œå…¶æ˜¯ä¸€ä¸ªåŸºäºopenSUSEï¼Œä¸ºå®¹å™¨è´Ÿè½½è€Œè®¾è®¡çš„æ“ä½œç³»ç»Ÿã€‚\nä¸ºäº†éƒ¨ç½²ç®€å•ï¼Œè¿™é‡Œæˆ‘ä»¬ç¦ç”¨äº†ç³»ç»Ÿçš„é˜²ç«å¢™ï¼Œå¦‚æœå¼€å¯é˜²ç«å¢™ï¼Œéœ€è¦ä¸ºServerèŠ‚ç‚¹å¼€æ”¾å¦‚ä¸‹ç«¯å£\n6443/TCP - Kubernetes API æœåŠ¡ 8472/UDP - Flannel VXLANæ¨¡å¼éœ€è¦ 51820/UDP - Flannel Wireguardåç«¯éœ€è¦ 10250/TCP - Kubelet metricséœ€è¦ 2379-2380/TCP - åŸºäºå†…åµŒetcdé«˜å¯ç”¨éƒ¨ç½²æ¨¡å¼éœ€è¦ å¯åŠ¨ServerèŠ‚ç‚¹ é¦–å…ˆç™»é™†åˆ°ç¬¬ä¸€ä¸ªServerèŠ‚ç‚¹ homek3s-server1ï¼Œç„¶åä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆv1.24.3+k3s1ï¼‰çš„ k3s äºŒè¿›åˆ¶æ–‡ä»¶\n# curl -sfL https://github.com/k3s-io/k3s/releases/download/v1.24.3%2Bk3s1/k3s -o /usr/local/bin/k3s # chmod +x k3s # k3s --version k3s version v1.24.3+k3s1 (990ba0e8) go version go1.18.1 k3s æ”¯æŒä¸€ä¸‹å‡ ä¸ªå­å‘½ä»¤\nk3s server - ç”¨äºè¿è¡Œç®¡ç†æœåŠ¡èŠ‚ç‚¹ k3s agent - ç”¨äºè¿è¡Œagentå·¥ä½œèŠ‚ç‚¹ k3s kubectl - è¿è¡Œ kubectl å‘½ä»¤ k3s crictl - è¿è¡Œ crictl å®¹å™¨ç®¡ç†å‘½ä»¤ å…¶ä»–çš„å‘½ä»¤å¸®åŠ©ï¼Œè¯·é€šè¿‡ k3s --help æŸ¥çœ‹ã€‚\nè¿™é‡Œæˆ‘ä»¬å°†è¦åˆ›å»ºä¸€ä¸ªä½¿ç”¨å†…ç½®etcdæ•°æ®åº“çš„é«˜å¯ç”¨é›†ç¾¤ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤\n# k3s server --cluster-init --advertise-address=192.168.0.150 --tls-san=homek3s.mengz.lan --write-kubeconfig-mode=644 å‚æ•° \u0026ndash;cluster-init æ˜¯ä½¿ç”¨å†…ç½®çš„etcdåˆå§‹æˆ·ä¸€ä¸ªæ–°çš„é›†ç¾¤;\nå‚æ•° \u0026ndash;advertise-address æ˜¯æŒ‡å®šAPIæœåŠ¡å™¨çš„ç›‘å¬IPåœ°å€ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤ä¸ºèŠ‚ç‚¹çš„IPåœ°å€;\nå‚æ•° \u0026ndash;tls-san æ˜¯æŒ‡å®šé¢å¤–çš„åŸŸåæˆ–è€…IPåœ°å€ä½œä¸ºTLSè¯ä¹¦çš„SANï¼Œä½¿å¾—æˆ‘ä»¬ä»å®¢æˆ·ç«¯å¯é€šè¿‡åŸŸåè®¿é—®è€ŒAPIæœåŠ¡å™¨ã€‚\nè¿è¡ŒæˆåŠŸåï¼Œåœ¨ homek3s-server1 æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯æ‰§è¡Œ\n# k3s kubectl get no NAME STATUS ROLES AGE VERSION homek3s-server1 Ready control-plane,etcd,master 27h v1.24.3+k3s1 å¯ä»¥çœ‹åˆ°ï¼Œé›†ç¾¤ä¸­ä»¥åŠè¿è¡Œäº†ä¸€ä¸ªèŠ‚ç‚¹ï¼Œä¸è¿‡è¿™æ—¶k3sæœåŠ¡æ˜¯å¯åŠ¨åœ¨å‰å°çš„ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸ª systemd æœåŠ¡ï¼Œè®©å…¶ä»¥æœåŠ¡å½¢å¼è¿è¡Œã€‚\nåˆ›å»ºæ–‡ä»¶ /etc/systemd/system/k3s.serviceï¼Œå†…å¦‚å¦‚ä¸‹\n[Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io After=network-online.target Wants=network-online.target [Service] Type=notify EnvironmentFile=-/etc/default/%N EnvironmentFile=-/etc/sysconfig/%N EnvironmentFile=-/etc/systemd/system/k3s.service.env ExecStartPre=/bin/sh -xc \u0026#39;! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service\u0026#39; ExecStart=/usr/local/bin/k3s server KillMode=process Delegate=yes # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s [Install] WantedBy=multi-user.target ç»ˆæ­¢åˆšæ‰è¿è¡Œçš„k3sè¿›ç¨‹ï¼Œç„¶åæ‰§è¡Œ\n# systemctl enable --now k3s.server # systemctl status k3s â— k3s.service - Lightweight Kubernetes Loaded: loaded (/etc/systemd/system/k3s.service; enabled; vendor preset: disabled) Active: active (running) since Fri 2022-07-22 03:31:21 CST; 18h ago Docs: https://k3s.io Process: 1121 ExecStartPre=/bin/sh -xc ! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service (code=exited, status=0/SUCCESS) Main PID: 1129 (k3s-server) Tasks: 120 CGroup: /system.slice/k3s.service ... è¿™æ˜¯åk3sè¿›ç¨‹å°†ä»¥æœåŠ¡çš„å½¢å¼è¿è¡Œåœ¨åå°äº†ã€‚\næ‰§è¡Œå®Œä¸Šè¿°æ­¥éª¤åï¼Œk3så°†ä¼šç”Ÿäº§é›†ç¾¤çš„ç®¡ç†å‘˜ kubeconfig æ–‡ä»¶ - /etc/rancher/k3s/k3s.yamlï¼Œå¯å°†è¯¥æ–‡ä»¶æ‹·è´çš„æœ¬åœ°ç¯å¢ƒï¼Œä¿®æ”¹ server å†…å®¹\nserver: https://127.0.0.1:6443 server: https://192.168.0.150:6443\nè¿™æ ·å°±å¯ä»¥åœ¨æœ¬åœ°ä¸»æœºä¸Šä½¿ç”¨ kubectl è®¿é—®é›†ç¾¤äº†ã€‚\næ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åœ¨å…¶ä»–ServerèŠ‚ç‚¹ä¸Šå¯åŠ¨k3sï¼Œå¹¶ä½œä¸ºç®¡ç†èŠ‚ç‚¹åŠ å…¥é›†ç¾¤ï¼Œé¦–å…ˆåœ¨ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ homek3s-server1 ä¸Šè·å–åˆ°é›†ç¾¤çš„Token\n# cat /var/lib/rancher/k3s/server/node-token K1087c3ff53c94a3c3b20475e84602f1e6d46f1b3903f2979f144800990897b06ac::server:fb8e7aa7ba23d7652942b09cb440ba24 SSHç™»é™†å…¶ä»–ServerèŠ‚ç‚¹ï¼ˆhomek3s-server2 å’Œ homek3s-server3ï¼‰ï¼Œæ‰§è¡Œå¦‚ä¸‹æ­¥éª¤\nä¸‹è½½ç›¸åŒç‰ˆæœ¬çš„ k3s äºŒè¿›åˆ¶æ–‡ä»¶åˆ° /usr/local/bin/k3s\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åŠ å…¥é›†ç¾¤\n# k3s server --server=https://192.168.0.150:6443 --token=${NODE_TOKEN} å…¶ä¸­ ${NODE_TOKEN} æ˜¯ä¸Šé¢ä»ç¬¬ä¸€ä¸ªèŠ‚ç‚¹è·å–çš„ Token å†…å®¹ã€‚\nå¦‚ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸€æ ·ï¼Œé…ç½® etc/systemd/system/k3s.serviceï¼Œå°†k3sè¿›ç¨‹å¯åŠ¨ä»¥æœåŠ¡æ–¹å¼å¯åŠ¨ã€‚ å®Œæˆä¸Šè¿°æ­¥éª¤åï¼Œé€šè¿‡ kubectl æŸ¥çœ‹èŠ‚ç‚¹\nâ¯ k get no NAME STATUS ROLES AGE VERSION homek3s-server1 Ready control-plane,etcd,master 28h v1.24.3+k3s1 homek3s-server2 Ready control-plane,etcd,master 27h v1.24.3+k3s1 homek3s-server3 Ready control-plane,etcd,master 27h v1.24.3+k3s1 å¯åŠ¨AgentèŠ‚ç‚¹ åœ¨å¯åŠ¨å®Œ3ä¸ªç®¡ç†èŠ‚ç‚¹ï¼ˆServerï¼‰çš„é›†ç¾¤ä¹‹åï¼Œæˆ‘æ¥ä¸‹æ¥ç»§ç»­æ·»åŠ å·¥ä½œèŠ‚ç‚¹ï¼ˆAgentï¼‰åˆ°é›†ç¾¤ä¸­ï¼Œç™»é™†åˆ°3ä¸ªAgentèŠ‚ç‚¹ä¹‹ä¸‹å¦‚ä¸‹æ­¥éª¤ï¼ˆ3ä¸ªèŠ‚ç‚¹ä¸Šçš„æ“ä½œç›¸åŒï¼‰\nä¸‹è½½ç›¸åŒç‰ˆæœ¬çš„ k3s äºŒè¿›åˆ¶æ–‡ä»¶åˆ° /usr/local/bin/k3s ï¼ˆæ–¹æ³•ä¸ServerèŠ‚ç‚¹ä¸Šä¸€æ ·ï¼‰\næ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼Œä»¥å·¥ä½œèŠ‚ç‚¹åŠ å…¥é›†ç¾¤\n# k3s agent --server=https://192.168.0.150:6443 --token=${NODE_TOKEN} ${NODE_TOKEN} æ˜¯ä¸Šé¢è·å–çš„èŠ‚ç‚¹Tokenå€¼ã€‚\næ‰§è¡ŒæˆåŠŸä¹‹åï¼Œä¹Ÿéœ€è¦å°† k3s çš„ agent è¿›ç¨‹ä»¥æœåŠ¡æ–¹å¼å¯åŠ¨ï¼Œè¿™é‡Œä¸ServerèŠ‚ç‚¹æœ‰äº›ä¸åŒï¼Œåˆ›å»ºæ–‡ä»¶ /etc/systemd/system/k3s-agent.serviceï¼Œå†…å®¹å¦‚ä¸‹\n[Unit] Description=Lightweight Kubernetes Documentation=https://k3s.io After=network-online.target Wants=network-online.target [Service] Type=notify EnvironmentFile=-/etc/default/%N EnvironmentFile=-/etc/sysconfig/%N EnvironmentFile=-/etc/systemd/system/k3s-agent.service.env ExecStartPre=/bin/sh -xc \u0026#39;! /usr/bin/systemctl is-enabled --quiet nm-cloud-setup.service\u0026#39; ExecStart=/usr/local/bin/k3s agent --server=${K3S_URL} --token=${K3S_TOKEN} KillMode=process Delegate=yes # Having non-zero Limit*s causes performance problems due to accounting overhead # in the kernel. We recommend using cgroups to do container-local accounting. LimitNOFILE=1048576 LimitNPROC=infinity LimitCORE=infinity TasksMax=infinity TimeoutStartSec=0 Restart=always RestartSec=5s [Install] WantedBy=multi-user.target ç„¶åå†åˆ›å»ºæ–‡ä»¶ /etc/systemd/system/k3s-agent.service.envï¼Œå†…å®¹å¦‚ä¸‹\nK3S_URL=\u0026#34;https://192.168.0.150:6443\u0026#34; K3S_TOKEN=\u0026#34;K1087c3ff58c94a3c3b20475e84602f8e6d46f1b3903f2979f144800990897b06ac::server:fb8e7aa7ba23d7652942b09cb440ba24\u0026#34; æ³¨æ„ï¼Œå°†ä»¥ä¸Šçš„ K3S_TOKEN æ›¿æ¢æˆä½ çš„å€¼ã€‚\nç„¶åæ‰§è¡Œ\n# sysetmctl enable --now k3s-agent.service 3ä¸ªAgentèŠ‚ç‚¹éƒ½å¯åŠ¨å®Œæˆä¹‹åï¼Œä½¿ç”¨ kubectl æŸ¥çœ‹èŠ‚ç‚¹\nâ¯ k get no NAME STATUS ROLES AGE VERSION homek3s-agent1 Ready \u0026lt;none\u0026gt; 27h v1.24.3+k3s1 homek3s-agent2 Ready \u0026lt;none\u0026gt; 26h v1.24.3+k3s1 homek3s-agent3 Ready \u0026lt;none\u0026gt; 26h v1.24.3+k3s1 homek3s-server1 Ready control-plane,etcd,master 28h v1.24.3+k3s1 homek3s-server2 Ready control-plane,etcd,master 27h v1.24.3+k3s1 homek3s-server3 Ready control-plane,etcd,master 27h v1.24.3+k3s1 å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä»¥åŠé€šè¿‡K3Séƒ¨ç½²äº†ä¸€ä¸ª3+3çš„é«˜å¯ç”¨Kubernetesé›†ç¾¤ã€‚\néƒ¨ç½²åº”ç”¨ æˆåŠŸå¯åŠ¨ä¸€ä¸ªK3Sé›†ç¾¤ï¼Œé™¤äº†Kuberneteså¿…è¦çš„ç»„ä»¶ä¹‹å¤–ï¼Œè¿˜è‡ªåŠ¨ä¸ºé›†ç¾¤éƒ¨ç½²ä»¥ä¸‹ç»„ä»¶\nFlennelä½œä¸ºCNIæ’ä»¶ rancher-local-path ä½œä¸ºé»˜è®¤çš„å­˜å‚¨ç±»æ’ä»¶ Traefik ä½œä¸º Ingress æ§åˆ¶å™¨ kipper Load Balancer ä½œä¸ºæœåŠ¡çš„è´Ÿè½½å‡å‡è¡¡æ§åˆ¶å™¨ Traefikçš„Load Balancerç±»å‹çš„æœåŠ¡å°±ç›´æ¥é€šè¿‡æ¯ä¸ªèŠ‚ç‚¹çš„ 80 å’Œ 443 ç«¯å£æš´éœ²äº†\nâ¯ k get svc -n kube-system traefik LoadBalancer 10.43.66.163 192.168.0.150,192.168.0.151,192.168.0.152,192.168.0.154,192.168.0.155,192.168.0.156 80:30833/TCP,443:32747/TCP 28h å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºåº”ç”¨ï¼Œå¹¶é€šè¿‡Ingresså‘å¤–æš´éœ²æœåŠ¡ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„WebæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯ Dockerçš„æ•™ç¨‹ï¼Œåˆ›å»ºå¦‚ä¸‹èµ„æºæ–‡ä»¶ docker-tour.yaml\n--- apiVersion: apps/v1 kind: Deployment metadata: labels: com.docker.project: tutorial name: tutorial spec: replicas: 1 selector: matchLabels: com.docker.project: tutorial strategy: type: Recreate template: metadata: labels: com.docker.project: tutorial spec: containers: - image: docker/getting-started name: tutorial ports: - containerPort: 80 protocol: TCP resources: {} restartPolicy: Always --- apiVersion: v1 kind: Service metadata: name: tutorial spec: ports: - name: 80-tcp port: 80 protocol: TCP targetPort: 80 selector: com.docker.project: tutorial type: ClusterIP --- apiVersion: networking.k8s.io/v1 kind: Ingress metadata: name: tutorial labels: com.docker.project: tutorial spec: # ingressClassName: contour rules: - host: \u0026#34;tour.homek3s.lan\u0026#34; http: paths: - pathType: Prefix path: \u0026#34;/\u0026#34; backend: service: name: tutorial port: number: 80 ç„¶åæ‰§è¡Œ\nâ¯ kubectl apply -f docker-tour.yaml åœ¨ä½ çš„å†…éƒ¨DNSæœåŠ¡å™¨ï¼Œæˆ–è€… /etc/hosts ä¸­é…ç½®åŸŸåè§£æï¼Œå°† tour.homek3s.lan è§£æåˆ°ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹çš„IPåœ°å€ï¼Œå¦‚\n192.168.0.150 tour.homek3s.lan é€šè¿‡æµè§ˆå™¨è®¿é—® https://tour.homek3s.lan/ ï¼Œå°†æ‰“å¼€éƒ¨ç½²çš„åº”ç”¨ã€‚\næ€»ç»“ è¿™é‡Œæ¼”ç¤ºäº†å¦‚æœé€šè¿‡K3Séƒ¨ç½²ä¸€ä¸ªé«˜å¯ç”¨çš„Kubernetesé›†ç¾¤ï¼Œä½¿ç”¨k3så†…ç½®etcdçš„æ–¹å¼ä½œä¸ºå…¥é—¨ï¼Œk3sè¿˜æ”¯æŒä½¿ç”¨å¤–éƒ¨çš„æ•°æ®å­˜å‚¨ä»¥åŠå…¶ä»–æ›´å¤šçš„éƒ¨ç½²é€‰é¡¹ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚K3sä½œä¸ºä¸€ä¸ªè½»é‡çº§çš„kubernetesç‰ˆæœ¬ï¼Œä»¥äº†å•ä¸€çš„äºŒè¿›åˆ¶æ–‡ä»¶ - k3sè¿›è¡Œåˆ†å‘ï¼Œå¯ä»¥å¿«é€Ÿéƒ¨ç½²å¼€å‘æµ‹è¯•ï¼Œä»¥åŠè¾¹ç¼˜ç”Ÿäº§çº§åˆ«çš„é›†ç¾¤ã€‚\nåæœŸå°†ä¼šç»§ç»­æ¢ç´¢å¦ä¸€æ¬¾å¼€æºçš„è½»é‡çº§Kubeernetsç‰ˆæœ¬ - K0Sã€‚\n","date":"July 22, 2022","hero":"/zh/posts/k8s/lightweight-k3s/k3s-kubernetes.png","permalink":"/zh/posts/k8s/lightweight-k3s/","summary":"K3S æ˜¯ Rancher ä¸ºç‰©è”ç½‘ï¼ˆIoTï¼‰å’Œè¾¹ç¼˜è®¡ç®—ç¯å¢ƒå¼€å‘çš„è½»é‡çº§ Kubernetes å‘è¡Œç‰ˆæœ¬ã€‚ç›¸æ¯”åŸç”Ÿçš„ Kubernetesï¼Œå…¶ç§»é™¤äº†å¾ˆå¤šéå¿…è¦çš„ç»„ä»¶ï¼Œä¾‹å¦‚äº‘æ§åˆ¶ç®¡ç†å™¨ï¼ˆCCMï¼‰ã€å†…ç½®çš„ï¼ˆIn-Treeï¼‰çš„å­˜å‚¨æ’ä»¶ç­‰ï¼Œä»¥åŠä¸ºARMæ¶æ„çš„åŸºç¡€è®¾æ–½åšäº†ä¼˜åŒ–ã€‚\nK3s çš„è½»é‡çº§åŒæ—¶ä¹Ÿä½“ç°åœ¨å…¶æ‰“åŒ…æˆä¸€ä¸ªäºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶è¿›è¡Œåˆ†å‘ï¼ŒçŠ¶æ€å­˜å‚¨é™¤äº†æ”¯æŒ etcd å¤–ï¼Œè¿˜æ”¯æŒ Sqlite3ã€MySQlå’ŒPostgresã€‚å…¶è·Ÿå¤šç‰¹æ€§å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nK3s æ”¯æŒå•èŠ‚é›†ç¾¤éƒ¨ç½²ï¼ˆå¯ç”¨äºå¼€å‘æµ‹è¯•ç¯å¢ƒï¼‰ï¼Œä¹Ÿæ”¯æŒé«˜å¯ç”¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ã€‚åŒæ—¶è¿˜å¯ä»¥é€šè¿‡ k3d é¡¹ç›®å¿«é€Ÿåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒä½¿ç”¨Dockerå®¹å™¨éƒ¨ç½² k3s é›†ç¾¤ä½œä¸ºå¼€å‘ç¯å¢ƒã€‚\nè¿™é‡Œæˆ‘å°†æ¼”ç¤ºé€šè¿‡è™šæ‹Ÿæœºéƒ¨ç½²ä¸€ä¸ªé«˜å¯ç”¨çš„å¤šèŠ‚ç‚¹é›†ç¾¤ï¼ˆ3ä¸ªServersèŠ‚ç‚¹ + 3ä¸ªAgentèŠ‚ç‚¹ï¼‰ã€‚\nk3Sæ¶æ„ ä¸Šå›¾æ˜¯æ¥è‡ªk3så®˜ç½‘çš„æ¶æ„å›¾ï¼Œå…¶æ¶æ„ä¸Kubernetesçš„æ¶æ„æ˜¯ç›¸ä¼¼çš„ï¼Œk3sçš„serverèŠ‚ç‚¹ä¹Ÿå°±æ˜¯æ§åˆ¶é¢èŠ‚ç‚¹ï¼ŒagentèŠ‚ç‚¹æ˜¯å·¥ä½œè´Ÿè½½èŠ‚ç‚¹ã€‚k3sé»˜è®¤ä½¿ç”¨ containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ã€‚\næ›´ä¿¡æ¯çš„éƒ¨ç½²æ¶æ„å¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nå‡†å¤‡è™šæ‹ŸæœºèŠ‚ç‚¹ è¿™é‡Œæˆ‘ä»¬å°†éƒ¨ç½² 3 + 3 çš„é›†ç¾¤ï¼Œéœ€è¦6å°è™šæ‹Ÿæœºï¼ŒåŸºæœ¬é…ç½®å¦‚ä¸‹\nä¸»æœºå IP vCPU å†…å­˜ homek3s-server1 192.168.0.150 1 2 GB homek3s-server2 192.168.0.151 1 2 GB homek3s-server3 192.168.0.152 1 2 GB homek3s-agent1 192.168.0.154 2 4 GB homek3s-agent2 192.168.0.155 2 4 GB homek3s-agent3 192.168.0.156 2 4 GB éƒ¨ç½²çš„æœ€å°éœ€æ±‚ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nK3s æ”¯æŒå¤§éƒ¨åˆ†ä¸»æµçš„Linuxæ“ä½œç³»ç»Ÿï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯ openSUSE Leap Micro 15.","tags":["contianer","kubernetes","cluster"],"title":"è½»é‡çº§Kubernetesé›†ç¾¤-K3S"},{"categories":["Kubernetes"],"contents":"éšç€ Kubernetes æˆä¸ºä¸»æµçš„åº”ç”¨å®¹å™¨ç¼–æ’å¹³å°ï¼Œå…¶å‘½ä»¤è¡Œå®¢æˆ·ç«¯ kubectl ä¹Ÿæˆä¸ºäº†æˆ‘ä»¬æ—¥å¸¸éƒ¨ç½²åº”ç”¨ï¼Œç»´æŠ¤é›†ç¾¤æœ€å¸¸ç”¨çš„å·¥å…·ã€‚\nkubectl è‡ªèº«æä¾›äº†å¼ºå¤§çš„å†…ç½®è‡ªå‘½ä»¤æ¥æ»¡è¶³æˆ‘ä»¬å¯¹é›†ç¾¤çš„æ“ä½œï¼Œä¾‹å¦‚ get è·å–é›†ç¾¤å†…çš„èµ„æºå¯¹è±¡ï¼Œproxy åˆ›å»ºä»£ç†ä¹‹ç±»çš„ï¼Œé™¤äº†å†…ç½®çš„è¿™äº›è‡ªå‘½ä»¤ï¼Œkubectl è¿˜æä¾›äº†å¯æ‰©å±•çš„èƒ½åŠ›ï¼Œå…è®¸æˆ‘ä»¬å®‰è£…è‡ªå·±ç¼–å†™æˆ–è€…ç¤¾åŒºæä¾›çš„æ’ä»¶æ¥å¢å¼ºæˆ‘ä»¬ä½¿ç”¨ kubectl çš„ç”Ÿäº§åŠ›ã€‚\nè¿™é‡Œå°†ç»™å¤§å®¶ä»‹ç»å¦‚ä½•åœ¨å®‰è£… kubectl æ‰©å±•æ’ä»¶ï¼Œä»¥åŠå‡ æ¬¾æˆ‘åœ¨æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨åˆ°çš„ç¤¾åŒºæä¾›çš„æ’ä»¶ã€‚\nåœ¨å®‰è£…å’Œä½¿ç”¨ kubectl æ’ä»¶çš„ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä»¥åŠå®‰è£…å’Œé…ç½®å¥½ kubectl å‘½ä»¤è¡Œå·¥å…·å’Œ git å·¥å…·ã€‚\nkrew é¦–å…ˆä»‹ç»çš„ç¬¬ä¸€æ¬¾æ‰©å±•æ’ä»¶å°±æ˜¯ krew - k8sç‰¹åˆ«å…´è¶£å°ç»„å¼€å‘çš„ä¸€æ¬¾ç”¨äºå®‰è£…å’Œç®¡ç† kubectl æ‰©å±•æ’ä»¶çš„æ’ä»¶ã€‚\nä»£ç ï¼š https://github.com/kubernetes-sigs/krew\nå®‰è£… krew (åœ¨macOS/Linuxä¸Š):\nåœ¨ç»ˆç«¯æ‰§è¡Œï¼ˆBashæˆ–è€…Zshï¼‰æ‰§è¡Œ ( set -x; cd \u0026#34;$(mktemp -d)\u0026#34; \u0026amp;\u0026amp; OS=\u0026#34;$(uname | tr \u0026#39;[:upper:]\u0026#39; \u0026#39;[:lower:]\u0026#39;)\u0026#34; \u0026amp;\u0026amp; ARCH=\u0026#34;$(uname -m | sed -e \u0026#39;s/x86_64/amd64/\u0026#39; -e \u0026#39;s/\\(arm\\)\\(64\\)\\?.*/\\1\\2/\u0026#39; -e \u0026#39;s/aarch64$/arm64/\u0026#39;)\u0026#34; \u0026amp;\u0026amp; KREW=\u0026#34;krew-${OS}_${ARCH}\u0026#34; \u0026amp;\u0026amp; curl -fsSLO \u0026#34;https://github.com/kubernetes-sigs/krew/releases/latest/download/${KREW}.tar.gz\u0026#34; \u0026amp;\u0026amp; tar zxvf \u0026#34;${KREW}.tar.gz\u0026#34; \u0026amp;\u0026amp; ./\u0026#34;${KREW}\u0026#34; install krew ) å°† $HOME/.krew/bin åŠ å…¥åˆ° PATH ç¯å¢ƒå˜é‡ï¼Œæ›´æ–°ä½ çš„ .bashrc æˆ–è€… .zshrc æ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢ä¸€è¡Œ export PATH=\u0026#34;${KREW_ROOT:-$HOME/.brew}/bin:$PATH\u0026#34; ç„¶åé‡å¯ä½ çš„ç»ˆç«¯ã€‚\næµ‹è¯• krew å·²ç»å®‰è£…æˆåŠŸ â¯ k krew version OPTION VALUE GitTag v0.4.3 GitCommit dbfefa5 IndexURI https://github.com/kubernetes-sigs/krew-index.git BasePath /home/mengz/.krew IndexPath /home/mengz/.krew/index/default InstallPath /home/mengz/.krew/store BinPath /home/mengz/.krew/bin DetectedPlatform linux/amd64 ï¼ˆå¯é€‰ï¼‰è®¾ç½® krew åˆ«å alias krew=\u0026#39;kubectl-krew\u0026#39; echo \u0026#34;alias krew=\u0026#39;kubectl-krew\u0026#39;\u0026#34; \u0026gt;\u0026gt; ~/.alias è¿™æ ·å°±å®‰è£…å®Œæˆäº†ï¼Œkrew æ˜¯ kubectl æ’ä»¶ç®¡ç†å™¨ï¼Œè€Œ krew è‡ªå·±åˆæ˜¯æ’ä»¶ï¼Œæ‰€ä»¥ä¹‹åå¯ä»¥ä½¿ç”¨ krew æ¥æ›´æ–° krewã€‚\nåœ¨ Windows ä¸Šå®‰è£…ï¼Œè¯·å‚è€ƒ https://krew.sigs.k8s.io/docs/user-guide/setup/install/ ã€‚\nä½¿ç”¨ç¤ºä¾‹\nåˆ—å‡ºå½“å‰å·²å®‰è£…çš„æ’ä»¶ â¯ krew list PLUGIN VERSION krew v0.4.3 å®‰è£…æ’ä»¶ï¼ˆä¸‹é¢ä»‹ç»çš„å…¶ä»–æ’ä»¶å°†ä½¿ç”¨è¿™ä¸ªæ–¹å¼å®‰è£…ï¼‰ â¯ krew install [æ’ä»¶å] æ›´æ–°æœ¬åœ°æ’ä»¶ç´¢å¼•ï¼ˆæŸ¥çœ‹æ˜¯å¦æœ‰æ’ä»¶æ›´æ–°ï¼‰ â¯ krew update Updated the local copy of plugin index. New plugins available: * liqo * switch-config Upgrades available for installed plugins: * open-svc v2.5.2 -\u0026gt; v2.5.3 * rbac-tool v1.7.1 -\u0026gt; v1.8.0 * rolesum v1.5.1 -\u0026gt; v1.5.5 å‡çº§æ’ä»¶ â¯ krew upgrade open-svc Updated the local copy of plugin index. Upgrading plugin: open-svc åˆ é™¤æ’ä»¶ â¯ krew uninstall [æ’ä»¶å] krew-index é‡Œç»´æŠ¤äº†ä¸Šç™¾æ¬¾å¯é€šè¿‡ krew ç›´æ¥å®‰è£…çš„æ’ä»¶ã€‚æ¥ä¸‹æ¥å°†ä»‹ç»å…¶ä»–å‡ æ¬¾æˆ‘æ—¥å¸¸ä½¿ç”¨çš„ kubectl æ’ä»¶ã€‚\nexample ä»£ç ï¼š https://github.com/seredot/kubectl-example\nå®‰è£… krew install example\nexample æ’ä»¶å¯ç”¨äºå¿«é€Ÿç”Ÿæˆk8sèµ„æºå¯¹è±¡çš„yamlæ–‡ä»¶ç¤ºä¾‹ï¼Œä¾‹å¦‚\nâ¯ k example deploy --- apiVersion: apps/v1 kind: Deployment metadata: name: nginx-deployment labels: app: nginx spec: replicas: 3 selector: matchLabels: app: nginx template: metadata: labels: app: nginx spec: containers: - name: nginx image: nginx:1.14.2 ports: - containerPort: 80 å½“æˆ‘ä»¬æƒ³ä¸´æ—¶é€šè¿‡èµ„æºå£°æ˜æ–‡ä»¶ä¸ç†Ÿåº”ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨è¯¥æ’ä»¶æ¥ç”Ÿæˆæ¨¡æ¿ã€‚\nfleet ä»£ç ï¼š https://github.com/kubectl-plus/kcf\nå®‰è£…ï¼š krew install fleet\nfleet æ’ä»¶å¯å¿«é€ŸæŸ¥çœ‹å½“å‰é…ç½®çš„é›†ç¾¤çš„æ¦‚è§ˆ\nâ¯ k fleet CLUSTER VERSION NODES NAMESPACES PROVIDER API homek8sc1 v1.23.8 3/3 4 ? https://k8sc1.mengz.lan:6443 api-sandbox-x8i5-p1-openshiftapps-com:6443 v1.23.5+9ce5071 ? ? ? https://api.sandbox.x8i5.p1.openshiftapps.com:6443 minikube v1.22.3 1/1 4 minikube https://192.168.64.3:8443 get-all ä»£ç ï¼š https://github.com/corneliusweig/ketall\nå®‰è£…ï¼š krew install get-all\nget-all æ’ä»¶è·å–é›†ç¾¤ï¼ˆæˆ–è€…æŸä¸€ä¸ªåå­—ç©ºé—´ï¼‰çš„æ‰€æœ‰èµ„æºå¯¹è±¡\nâ¯ k get-all -n kube-system NAME NAMESPACE AGE configmap/calico-config kube-system 13d configmap/coredns kube-system 13d configmap/extension-apiserver-authentication kube-system 13d configmap/kube-proxy kube-system 13d configmap/kube-root-ca.crt kube-system 13d configmap/kubeadm-config kube-system 13d configmap/kubelet-config-1.23 kube-system 13d endpoints/kube-dns kube-system 13d ... htpasswd ä»£ç ï¼š https://github.com/shibumi/kubectl-htpasswd\nå®‰è£…ï¼š krew install htpasswd\nhtpasswd æ˜¯ nginx-ingress å…¼å®¹çš„åŸºç¡€è®¤è¯å¯†ç ç”Ÿæˆå™¨\nâ¯ k htpasswd create aaa-basic-auth user1=user1password user2=user2password -o yaml --dry-run apiVersion: v1 data: auth: dXNlcjE6JDJhJDEwJDVNeEJGT3lEUEJYT0xkUldlblNWME91RGtZTzFQOElJNXJuRnh5blpUdC55L2FUUUNDYzJ1CnVzZXIyOiQyYSQxMCRVbFdHOG5NTU4zRGVpOC5GMmVRM3EuYWhxTENYZGtLYUJ1cXZzT3lEOGl0ODJRdU4zV1c1dQ== kind: Secret metadata: creationTimestamp: null name: aaa-basic-auth namespace: default type: Opaque è¯¥æ’ä»¶åœ¨ä¸ºæœåŠ¡åˆ›å»ºåŸºç¡€è®¤è¯çš„ Ingress å¾ˆæ–¹ä¾¿ã€‚\nimages ä»£ç ï¼š https://github.com/chenjiandongx/kubectl-images\nå®‰è£…ï¼š krew install images\nimages ç°å®åå­—ç©ºé—´ä¸­ä½¿ç”¨çš„å®¹å™¨é•œåƒä¿¡æ¯\nâ¯ k images [Summary]: 1 namespaces, 2 pods, 2 containers and 1 different images +------------------------+---------------+-------------------+ | PodName | ContainerName | ContainerImage | +------------------------+---------------+-------------------+ | webapp-98f7444c5-8772w | nginx | nginx:1.21-alpine | +------------------------+ + + | webapp-98f7444c5-vsxr9 | | | +------------------------+---------------+-------------------+ ktop ä»£ç ï¼š https://github.com/vladimirvivien/ktop\nå®‰è£…ï¼š krew install ktop\nktop æ’ä»¶æ˜¯ä»¥ç±»ä¼¼ Linux Top å·¥å…·çš„æ–¹å¼æ¥æ’ä»¶k8sé›†ç¾¤çš„è´Ÿè½½æƒ…å†µ\nâ¯ k ktop â”Œ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚ API server: https://k8sc1.mengz.lan:6443 Version: v1.23.8 context: admin@homek8sc1 User: kubernetes-admin namespace: (all) metrics: not connected v0.3.0 â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â•” ğŸŒ¡ Cluster Summary â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â•‘ ptime: 13d Nodes: 3 Namespaces: 4 Pods: 15/15 (20 imgs) Deployments: 5/5 Sets: replicas 5, daemons 6, stateful 0 Jobs: 0 (cron: 0) PVs: 0 (0Gi) PVCs: 0 (0Gi) â•‘ PU: [||||||||||| ] 1600m/6000m (26.7% requested) Memory: [|| ] 1Gi/11Gi (2.5% requested) â•š â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â• â”Œ ğŸ­ Nodes (3) â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”‚ NAME STATUS AGE VERSION INT/EXT IPs OS/ARC PODS/IMGs DISK CPU MEM â”‚ homek8sc1-control Ready 13d v1.23.8 192.168.0.140/\u0026lt;none\u0026gt; Ubuntu 20.04.4 LTS/amd64 9/10 16Gi [|||||| ] 1100m/2000m (55%) [|| ] 1Gi/2Gi (13%) â”‚ homek8sc1-worker1 Ready 13d v1.23.8 192.168.0.141/\u0026lt;none\u0026gt; Ubuntu 20.04.4 LTS/amd64 3/5 16Gi [|| ] 250m/2000m (12%) [ ] 0Gi/5Gi (0%) â”‚ homek8sc1-worker2 Ready 13d v1.23.8 192.168.0.142/\u0026lt;none\u0026gt; Ubuntu 20.04.4 LTS/amd64 3/5 16Gi [|| ] 250m/2000m (12%) [ ] 0Gi/5Gi (0%) â”‚ â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”Œ ğŸ“¦ Pods (15) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ AMESPACE POD READY STATUS RESTARTS AGE VOLS IP NODE CPU MEMORY â”‚ ube-system kube-controller-manager-homek8sc1-control 1/1 Running 1 13d 8/8 192.168.0.140 homek8sc1-control [| ] 200m 10.0% [ ] 0Gi 0.0% â”‚ ube-system kube-proxy-4c9nq 1/1 Running 2 13d 4/4 192.168.0.141 homek8sc1-worker1 [ ] 0m 0.0% [ ] 0Gi 0.0% â”‚ ube-system kube-proxy-4whcn 1/1 Running 1 13d 4/4 192.168.0.140 homek8sc1-control [ ] 0m 0.0% [ ] 0Gi 0.0% â”‚ ube-system kube-proxy-bz8lt 1/1 Running 3 13d 4/4 192.168.0.142 homek8sc1-worker2 [ ] 0m 0.0% [ ] 0Gi 0.0% â”‚ ube-system kube-scheduler-homek8sc1-control 1/1 Running 1 13d 1/1 192.168.0.140 homek8sc1-control [| ] 100m 5.0% [ ] 0Gi 0.0% â”” â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ â”€ æ€»ç»“ krew-index é‡ŒåŒ…å«äº†å¤§é‡åŠŸèƒ½å¼ºå¤§çš„æ‰©å±•æ’ä»¶ï¼Œæ¶µç›–äº† RBAC ç®¡ç†ï¼Œèµ„æºç®¡ç†ç­‰åŠŸèƒ½ï¼Œè¿™é‡Œæ²¡æ³•æ„ä¹‰åˆ—å‡ºã€‚ä¸è¿‡æœ‰äº† krew ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„å®‰è£…éœ€è¦çš„æ‰©å±•ï¼Œä»¥åœ¨æ—¥å¸¸å·¥ä½œä¸­æé«˜æˆ‘ä»¬ç®¡ç†k8sé›†ç¾¤çš„çš„ç”Ÿäº§åŠ›ã€‚\nå‚è€ƒ\nhttps://kubernetes.io/docs/tasks/extend-kubectl/kubectl-plugins/ https://krew.sigs.k8s.io/docs/user-guide/quickstart/ ","date":"July 4, 2022","hero":"/zh/posts/k8s/kubectl-plugins/krew-banner.png","permalink":"/zh/posts/k8s/kubectl-plugins/","summary":"éšç€ Kubernetes æˆä¸ºä¸»æµçš„åº”ç”¨å®¹å™¨ç¼–æ’å¹³å°ï¼Œå…¶å‘½ä»¤è¡Œå®¢æˆ·ç«¯ kubectl ä¹Ÿæˆä¸ºäº†æˆ‘ä»¬æ—¥å¸¸éƒ¨ç½²åº”ç”¨ï¼Œç»´æŠ¤é›†ç¾¤æœ€å¸¸ç”¨çš„å·¥å…·ã€‚\nkubectl è‡ªèº«æä¾›äº†å¼ºå¤§çš„å†…ç½®è‡ªå‘½ä»¤æ¥æ»¡è¶³æˆ‘ä»¬å¯¹é›†ç¾¤çš„æ“ä½œï¼Œä¾‹å¦‚ get è·å–é›†ç¾¤å†…çš„èµ„æºå¯¹è±¡ï¼Œproxy åˆ›å»ºä»£ç†ä¹‹ç±»çš„ï¼Œé™¤äº†å†…ç½®çš„è¿™äº›è‡ªå‘½ä»¤ï¼Œkubectl è¿˜æä¾›äº†å¯æ‰©å±•çš„èƒ½åŠ›ï¼Œå…è®¸æˆ‘ä»¬å®‰è£…è‡ªå·±ç¼–å†™æˆ–è€…ç¤¾åŒºæä¾›çš„æ’ä»¶æ¥å¢å¼ºæˆ‘ä»¬ä½¿ç”¨ kubectl çš„ç”Ÿäº§åŠ›ã€‚\nè¿™é‡Œå°†ç»™å¤§å®¶ä»‹ç»å¦‚ä½•åœ¨å®‰è£… kubectl æ‰©å±•æ’ä»¶ï¼Œä»¥åŠå‡ æ¬¾æˆ‘åœ¨æ—¥å¸¸å·¥ä½œä¸­å¸¸ç”¨åˆ°çš„ç¤¾åŒºæä¾›çš„æ’ä»¶ã€‚\nåœ¨å®‰è£…å’Œä½¿ç”¨ kubectl æ’ä»¶çš„ä¹‹å‰ï¼Œè¯·ç¡®ä¿ä»¥åŠå®‰è£…å’Œé…ç½®å¥½ kubectl å‘½ä»¤è¡Œå·¥å…·å’Œ git å·¥å…·ã€‚\nkrew é¦–å…ˆä»‹ç»çš„ç¬¬ä¸€æ¬¾æ‰©å±•æ’ä»¶å°±æ˜¯ krew - k8sç‰¹åˆ«å…´è¶£å°ç»„å¼€å‘çš„ä¸€æ¬¾ç”¨äºå®‰è£…å’Œç®¡ç† kubectl æ‰©å±•æ’ä»¶çš„æ’ä»¶ã€‚\nä»£ç ï¼š https://github.com/kubernetes-sigs/krew\nå®‰è£… krew (åœ¨macOS/Linuxä¸Š):\nåœ¨ç»ˆç«¯æ‰§è¡Œï¼ˆBashæˆ–è€…Zshï¼‰æ‰§è¡Œ ( set -x; cd \u0026#34;$(mktemp -d)\u0026#34; \u0026amp;\u0026amp; OS=\u0026#34;$(uname | tr \u0026#39;[:upper:]\u0026#39; \u0026#39;[:lower:]\u0026#39;)\u0026#34; \u0026amp;\u0026amp; ARCH=\u0026#34;$(uname -m | sed -e \u0026#39;s/x86_64/amd64/\u0026#39; -e \u0026#39;s/\\(arm\\)\\(64\\)\\?.*/\\1\\2/\u0026#39; -e \u0026#39;s/aarch64$/arm64/\u0026#39;)\u0026#34; \u0026amp;\u0026amp; KREW=\u0026#34;krew-${OS}_${ARCH}\u0026#34; \u0026amp;\u0026amp; curl -fsSLO \u0026#34;https://github.com/kubernetes-sigs/krew/releases/latest/download/${KREW}.tar.gz\u0026#34; \u0026amp;\u0026amp; tar zxvf \u0026#34;${KREW}.tar.gz\u0026#34; \u0026amp;\u0026amp; .","tags":["kubernetes","kubectl"],"title":"æ‰©å±•ä½ çš„KUBECTLåŠŸèƒ½"},{"categories":["Container"],"contents":"Compose V2 é¡¹ç›®å¯åŠ¨äº2021å¹´6æœˆï¼Œç›´åˆ°2022å¹´4æœˆ26å·ï¼Œå‘å¸ƒäº†GAç‰ˆæœ¬ã€‚åœ¨å‘å¸ƒGAç‰ˆæœ¬åï¼Œç¤¾åŒºä¹Ÿå®£å¸ƒå¯¹äºCompose V1å°†ä¸ä¼šå†è¿›è¡ŒåŠŸèƒ½æ›´æ–°ï¼Œå°†åœ¨6ä¸ªæœˆåç»“æŸç”Ÿå‘½å‘¨æœŸï¼ˆEOLï¼‰ï¼ŒæœŸé—´ä¼šè¿›è¡Œå…³é”®çš„å®‰å…¨å’Œé”™è¯¯ä¿®å¤ã€‚\nV1ä¸V2çš„å…¼å®¹å¯¹æ¯” ç¡®ä¿ V1 å’Œ V2 ä¹‹é—´çš„å…¼å®¹æ€§å¯¹äºæ—¥å¸¸å·¥ä½œæµç¨‹è‡³å…³é‡è¦ï¼Œä¸‹é¢æ˜¯V2ä¸­ä¸¤ä¸ªå…³é”®çš„æ›´æ”¹\næ›´æ”¹ æ½œåœ¨å½±å“ è¿ç§» V2åŸç”Ÿæ”¯æŒBuildKitï¼Œå¹¶ä¸”é»˜è®¤å¼€å¯ å¼€å‘è€…åœ¨V2ä¸­å°†é»˜è®¤ä½¿ç”¨BuildKitè¿›è¡Œé•œåƒæ„å»º å¯é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ä¸ä½¿ç”¨ DOCKER_BUILDKIT=0 å®¹å™¨åå­—ä¸­ä½¿ç”¨ - æ›¿ä»£äº† _ ä½œä¸ºåˆ†éš”ç¬¦ å¦‚æœåœ¨è„šæœ¬ä¸­ä½¿ç”¨äº†å®¹å™¨åå­—ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ å¯ä»¥é€šè¿‡ \u0026ldquo;\u0026ndash;compatibility\u0026rdquo; æ ‡è®°æ¥å…³é—­æ­¤æ›´æ”¹ å…³äºæ›´å¤šçš„å…¼å®¹æ€§æ›´æ”¹ï¼Œè¯·æŸ¥çœ‹å…¼å®¹æ€§æ–‡æ¡£\nå¦‚ä½•å®‰è£…Compose V2 Windowsï¼ŒMacOSå’ŒLinuxä¸Šä½¿ç”¨Docker Desktopï¼Œå°±è‡ªå¸¦äº†Compose V2ï¼Œå¯é€šè¿‡å‘½ä»¤ docker compose æ‰§è¡Œã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®â€œUse Docker Compose V2â€œæ¥è®¾ç½® docker-compose åˆ«ååˆ° docker composeã€‚\nå¦‚æœæ²¡æœ‰ä½¿ç”¨Docker Desktop for Linuxï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çš„Docker Engineï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£… docker-compose-plugin æˆ–è€…ç‹¬ç«‹çš„äºŒè¿›åˆ¶åŒ…ã€‚\nä¾‹å¦‚å¯¹äºUbuntu,å¯ä»¥é€šè¿‡Dockerå®˜æ–¹çš„APTæºç›´æ¥å®‰è£…\nâ¯ sudo apt update â¯ sudo apt install docker-compose-plugin å…¶ä»–Linux, ä¾‹å¦‚åœ¨æˆ‘çš„ openSUSE ä¸Šï¼Œé€šè¿‡æ‰‹åŠ¨ä»Githubä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œå®‰è£…ï¼ˆæ³¨æ„é€‰æ‹©ç‰ˆæœ¬å’Œå¹³å°æ¶æ„ï¼‰\nâ¯ DOCKER_CONFIG=${DOCKER_CONFIG:-$HOME/.docker} â¯ mkdir -p $DOCKER_CONFIG/cli-plugins â¯ wget https://github.com/docker/compose/releases/download/v2.6.0/docker-compose-linux-x86_64 â¯ mv docker-compose-linux-x86_64 $DOCKER_CONFIG/cli-plugins/docker-compose â¯ chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose æ‰§è¡Œä¸€ä¸‹å‘½ä»¤æµ‹è¯•\nâ¯ docker compose version Docker Compose version 2.6.0 æ›´å¤šå®‰è£…æ–¹å¼ï¼Œè¯·æŸ¥çœ‹å®˜æ–¹æ–‡æ¡£ã€‚\nCompose V2çš„ä¼˜åŠ¿ åœ¨Docker CLIä¸­å¿«é€Ÿäº¤ä»˜æ–°åŠŸèƒ½ æ”¯æŒGPUä¸»æœº - å¦‚æœDockerä¸»æœºæœ‰GPUè®¾å¤‡ï¼ˆæ˜¾å¡)å¹¶ä¸”Dockerå¼•æ“è¿›è¡Œäº†ç›¸å…³é…ç½®, åˆ™ComposeæœåŠ¡å¯ä»¥å®šä¹‰GPUè®¾å¤‡çš„é¢„ç•™ã€‚ æ”¯æŒé…ç½®æœåŠ¡å¯ç”¨ï¼ˆProfilesï¼‰ - é€šè¿‡é€‰æ‹©æ€§æœåŠ¡å™¨å¯ç”¨æ¥ä¸ºå¤šç§ç”¨é€”å’Œç¯å¢ƒå¯åŠ¨Composeåº”ç”¨æ¨¡å‹ï¼Œå¦‚ä¸‹Composeæ–‡ä»¶ version: \u0026#34;3.9\u0026#34; services: frontend: image: frontend profiles: [\u0026#34;frontend\u0026#34;] phpmyadmin: image: phpmyadmin depends_on: - db profiles: - debug backend: image: backend db: image: mysql é»˜è®¤æ‰§è¡Œ docker compose up å°†åªä¼šå¯åŠ¨ backend å’Œ db æœåŠ¡ï¼Œè¦å¯åŠ¨ç›¸åº”é…ç½®çš„æœåŠ¡ï¼Œéœ€è¦ä½¿ç”¨ --profile æ ‡è®°æˆ–è€…è®¾ç½®ç¯å¢ƒå˜é‡ COMPOSE_PROFILESï¼Œä¾‹å¦‚\nâ¯ docker compose --profile debug --profile frontend up â¯ COMPOSE_PROFILES=frontend,debug docker compose up æ–°å¢äº† cp å‘½ä»¤ - åœ¨æœåŠ¡å®¹å™¨å’Œæœ¬åœ°æ–‡ä»¶ç³»ç»Ÿç›´æ¥æ‹·è´æ–‡ä»¶å’Œç›®å½• æ–°å¢äº† ls å‘½ä»¤ - åˆ—å‡ºå½“å‰ç¯å¢ƒä¸­çš„Composeé¡¹ç›®ï¼ˆåº”ç”¨æ ˆï¼‰ å¼€å‘åˆ°ç”Ÿäº§çš„æ— ç¼è½¬æ¢ é€šè¿‡äº‘é›†æˆé¡¹ç›®ï¼Œå¯ä»¥å®¹æ˜“çš„ä½¿ç”¨Compose V2å°†å¤šå®¹å™¨åº”ç”¨éƒ¨ç½²åˆ°AWS ECSæˆ–è€…Azure ACIç¯å¢ƒã€‚\nå…·ä½“ç¤ºä¾‹å¯å‚è€ƒ Deploying WordPress to the Cloudã€‚\nåœ¨Golangä¸­åˆ›å»ºä¸€ä¸ªåŒæ„çš„Dockerç”Ÿæ€ç³»ç»Ÿ åœ¨Compose V2ä¹‹å‰ï¼ŒV1æ˜¯ä½¿ç”¨Pythonè¯­è¨€ç¼–å†™çš„ï¼Œä¸åœ¨Dockerçš„è¯­è¨€ç”Ÿæ€ç³»ç»Ÿé‡Œã€‚è€ŒV2ä½¿ç”¨Golangè¯­è¨€ç¼–å†™ï¼Œå¯ä»¥æä¾›æ¥è‡ªMobyã€CLIæˆ–ä»»ä½•åŸºäºGolangçš„é¡¹ç›®ä»£ç ï¼Œå‡å°‘äº†å¾ˆå¤šé€šè¿‡Pythoné‡å†™æ–°åŠŸèƒ½æˆ–ç¼ºé™·çš„å¼€å‘ï¼Œå®¹æ˜“ä»å…¶ä»–Dockerå·¥å…·ï¼ˆä¾‹å¦‚BuildKitï¼‰å¢åŠ æ–°åŠŸèƒ½åˆ°Composeä¸­ã€‚\né€šè¿‡Golangï¼Œç°åœ¨å¯ä»¥å‘å¸ƒä¸€ä¸ªé™æ€çš„äºŒè¿›åˆ¶æ‰§è¡Œæ–‡ä»¶ï¼Œç›¸æ¯”Pythonï¼Œå¤§å¤§ç®€åŒ–äº†æ›´æ–°å’Œä¾èµ–ç®¡ç†ã€‚\nåœ¨æ²¡æœ‰Composeæ–‡ä»¶çš„æƒ…å†µä¸‹æ‰§è¡Œå‘½ä»¤ Compose V2å¯ä»¥åœ¨ä»¥ä¸‹æƒ…å†µä¸‹é€šè¿‡ --project-name|-p é€‰é¡¹æ¥ç®¡ç†è¿è¡Œçš„Composeé¡¹ç›®å®¹å™¨æœåŠ¡\nå½“å‰ç›®å½•ä¸åŒ…å«é¡¹ç›®Composeæ–‡ä»¶ï¼ˆä¸åœ¨Composeé¡¹ç›®æ–‡ä»¶ç›®å½•ä¸‹ï¼‰ ä¸é€šè¿‡ --file æ ‡è®°æŒ‡å®šComposeæ–‡ä»¶ ä¸é€šè¿‡ --project-directory æ ‡è®°æŒ‡å®šComposeé¡¹ç›®ç›®å½• å¯æ‰§è¡Œçš„å‘½ä»¤ï¼š psï¼Œexec,startï¼Œstopï¼Œrestartï¼Œdown\nå¯ä»¥å…ˆé€šè¿‡ docker compose ls åˆ—å‡ºå½“å‰ç¯å¢ƒçš„Composeé¡¹ç›®\nâ¯ docker compose ls NAME STATUS CONFIG FILES dbweb running(1) docker-compose.yml monitor running(1) /home/mengz/dockerapp/monitor/docker-compose.yml traefik running(1) /home/mengz/dockerapp/traefik/docker-compose.yml truenas running(1) /home/mengz/dockerapp/truenas/docker-compose.yml ç„¶åé€šè¿‡ -p \u0026lt;é¡¹ç›®å\u0026gt; å‘½ä»¤ æ¥ç®¡ç†é¡¹ç›®æœåŠ¡\nâ¯ docker compose -p dbweb ps NAME COMMAND SERVICE STATUS PORTS dbweb_pgadmin \u0026#34;/entrypoint.sh\u0026#34; pgadmin running 443/tcp â¯ docker compose -p dbweb exec pgadmin sh /pgadmin4 $ exit æ€»ç»“ è¿™é‡Œç®€å•ä»‹ç»äº†Docker Compose V2çš„ä¸€äº›ç‰¹æ€§å’ŒåŠŸèƒ½ï¼Œéšç€V1çš„é€æ¸æ·˜æ±°ï¼Œæˆ‘ä»¬è¦æ‹¥æŠ±V2ï¼Œå¹¶ä¸”å°è¯•å…¶æä¾›çš„æ–°åŠŸèƒ½ã€‚\nå…³äºè¯¦ç»†çš„Docker Dockerï¼Œè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nå‚è€ƒï¼š\nAnnouncing Compose V2 General Availability Install Docker Compose ","date":"June 2, 2022","hero":"/zh/posts/container-tech/docker-compose-v2/docker-compose-v2.jpg","permalink":"/zh/posts/container-tech/docker-compose-v2/","summary":"Compose V2 é¡¹ç›®å¯åŠ¨äº2021å¹´6æœˆï¼Œç›´åˆ°2022å¹´4æœˆ26å·ï¼Œå‘å¸ƒäº†GAç‰ˆæœ¬ã€‚åœ¨å‘å¸ƒGAç‰ˆæœ¬åï¼Œç¤¾åŒºä¹Ÿå®£å¸ƒå¯¹äºCompose V1å°†ä¸ä¼šå†è¿›è¡ŒåŠŸèƒ½æ›´æ–°ï¼Œå°†åœ¨6ä¸ªæœˆåç»“æŸç”Ÿå‘½å‘¨æœŸï¼ˆEOLï¼‰ï¼ŒæœŸé—´ä¼šè¿›è¡Œå…³é”®çš„å®‰å…¨å’Œé”™è¯¯ä¿®å¤ã€‚\nV1ä¸V2çš„å…¼å®¹å¯¹æ¯” ç¡®ä¿ V1 å’Œ V2 ä¹‹é—´çš„å…¼å®¹æ€§å¯¹äºæ—¥å¸¸å·¥ä½œæµç¨‹è‡³å…³é‡è¦ï¼Œä¸‹é¢æ˜¯V2ä¸­ä¸¤ä¸ªå…³é”®çš„æ›´æ”¹\næ›´æ”¹ æ½œåœ¨å½±å“ è¿ç§» V2åŸç”Ÿæ”¯æŒBuildKitï¼Œå¹¶ä¸”é»˜è®¤å¼€å¯ å¼€å‘è€…åœ¨V2ä¸­å°†é»˜è®¤ä½¿ç”¨BuildKitè¿›è¡Œé•œåƒæ„å»º å¯é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡ä¸ä½¿ç”¨ DOCKER_BUILDKIT=0 å®¹å™¨åå­—ä¸­ä½¿ç”¨ - æ›¿ä»£äº† _ ä½œä¸ºåˆ†éš”ç¬¦ å¦‚æœåœ¨è„šæœ¬ä¸­ä½¿ç”¨äº†å®¹å™¨åå­—ï¼Œè¿™å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯ å¯ä»¥é€šè¿‡ \u0026ldquo;\u0026ndash;compatibility\u0026rdquo; æ ‡è®°æ¥å…³é—­æ­¤æ›´æ”¹ å…³äºæ›´å¤šçš„å…¼å®¹æ€§æ›´æ”¹ï¼Œè¯·æŸ¥çœ‹å…¼å®¹æ€§æ–‡æ¡£\nå¦‚ä½•å®‰è£…Compose V2 Windowsï¼ŒMacOSå’ŒLinuxä¸Šä½¿ç”¨Docker Desktopï¼Œå°±è‡ªå¸¦äº†Compose V2ï¼Œå¯é€šè¿‡å‘½ä»¤ docker compose æ‰§è¡Œã€‚ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®â€œUse Docker Compose V2â€œæ¥è®¾ç½® docker-compose åˆ«ååˆ° docker composeã€‚\nå¦‚æœæ²¡æœ‰ä½¿ç”¨Docker Desktop for Linuxï¼Œè€Œæ˜¯ç›´æ¥ä½¿ç”¨çš„Docker Engineï¼Œåˆ™éœ€è¦é¢å¤–å®‰è£… docker-compose-plugin æˆ–è€…ç‹¬ç«‹çš„äºŒè¿›åˆ¶åŒ…ã€‚\nä¾‹å¦‚å¯¹äºUbuntu,å¯ä»¥é€šè¿‡Dockerå®˜æ–¹çš„APTæºç›´æ¥å®‰è£…\nâ¯ sudo apt update â¯ sudo apt install docker-compose-plugin å…¶ä»–Linux, ä¾‹å¦‚åœ¨æˆ‘çš„ openSUSE ä¸Šï¼Œé€šè¿‡æ‰‹åŠ¨ä»Githubä¸‹è½½äºŒè¿›åˆ¶æ–‡ä»¶è¿›è¡Œå®‰è£…ï¼ˆæ³¨æ„é€‰æ‹©ç‰ˆæœ¬å’Œå¹³å°æ¶æ„ï¼‰\nâ¯ DOCKER_CONFIG=${DOCKER_CONFIG:-$HOME/.docker} â¯ mkdir -p $DOCKER_CONFIG/cli-plugins â¯ wget https://github.","tags":["docker","compose"],"title":"å¼€å§‹ä½¿ç”¨DOCKER COMPOSE V2"},{"categories":["Container"],"contents":"åœ¨ä¸Šä¸ªæœˆå‘å¸ƒçš„Docker Desktop v4.7.0ä¸­ï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„CLIæ’ä»¶-docker/sbom-cli-pluginï¼Œå…¶ä¸ºDocker CLIå¢åŠ äº†ä¸€ä¸ªå­å‘½ä»¤ - sbomï¼Œç”¨äºæŸ¥çœ‹Dockerå®¹å™¨é•œåƒçš„è½¯ä»¶ç‰©æ–™æ¸…å•ï¼ˆSBOM)ã€‚\nä»€ä¹ˆæ˜¯SBOMï¼Ÿ é¦–å…ˆä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯SBOMï¼ˆSoftware Bill of Materialsï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè½¯ä»¶ç‰©æ–™æ¸…å•ï¼Œæ˜¯è½¯ä»¶ä¾›åº”é“¾ä¸­çš„æœ¯è¯­ã€‚è½¯ä»¶ä¾›åº”é“¾æ˜¯ç”¨äºæ„å»ºè½¯ä»¶åº”ç”¨ç¨‹åºï¼ˆè½¯ä»¶äº§å“ï¼‰çš„ç»„ä»¶ã€åº“å’Œå·¥å…·çš„åˆ—è¡¨ï¼Œè€Œç‰©æ–™æ¸…å•åˆ™å£°æ˜è¿™äº›ç»„ä»¶ã€åº“çš„æ¸…å•ï¼Œç±»ä¼¼äºé£Ÿå“çš„é…æ–™æ¸…å•ã€‚è½¯ä»¶ç‰©æ–™æ¸…å•å¯ä»¥å¸®åŠ©ç»„ç»‡æˆ–è€…ä¸ªäººé¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„è½¯ä»¶ã€‚\nDOCKER SBOMå‘½ä»¤ æ³¨æ„: ä»Docker Desktop 4.7.0ç‰ˆæœ¬å¼€å§‹åˆ°ç°åœ¨ï¼Œdocker sbom å‘½ä»¤è¿˜æ˜¯å®éªŒæ€§çš„ï¼Œè¯¥åŠŸèƒ½ä¹Ÿè®¸ä¼šåœ¨ä»¥åç‰ˆæœ¬ä¸­åˆ é™¤å’Œæ›´æ”¹ï¼Œå½“å‰Linuxçš„Docker CLIè¿˜æœªåŒ…å«è¯¥å­å‘½ä»¤ã€‚\ndocker sbom å‘½ä»¤ç”¨äºç”Ÿäº§ä¸€ä¸ªå®¹å™¨é•œåƒçš„è½¯ä»¶ç‰©æ–™æ¸…å•ï¼ˆSBOMï¼‰\nWSL - mengz î‚° docker sbom --help Usage: docker sbom [OPTIONS] COMMAND View the packaged-based Software Bill Of Materials (SBOM) for an image. EXPERIMENTAL: The flags and outputs of this command may change. Leave feedback on https://github.com/docker/sbom-cli-plugin. Examples: docker sbom alpine:latest a summary of discovered packages docker sbom alpine:latest --format syft-json show all possible cataloging details docker sbom alpine:latest --output sbom.txt write report output to a file docker sbom alpine:latest --exclude /lib --exclude \u0026#39;**/*.db\u0026#39; ignore one or more paths/globs in the image Options: -D, --debug show debug logging --exclude stringArray exclude paths from being scanned using a glob expression --format string report output format, options=[syft-json cyclonedx-xml cyclonedx-json github-0-json spdx-tag-value spdx-json table text] (default \u0026#34;table\u0026#34;) --layers string [experimental] selection of layers to catalog, options=[squashed all] (default \u0026#34;squashed\u0026#34;) -o, --output string file to write the default report output to (default is STDOUT) --platform string an optional platform specifier for container image sources (e.g. \u0026#39;linux/arm64\u0026#39;, \u0026#39;linux/arm64/v8\u0026#39;, \u0026#39;arm64\u0026#39;, \u0026#39;linux\u0026#39;) --quiet suppress all non-report output -v, --version version for sbom Commands: version Show Docker sbom version information Run \u0026#39;docker sbom COMMAND --help\u0026#39; for more information on a command. ä»å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯ä¸­å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ç›´æ¥ç”Ÿæˆè¡¨æ ¼å½¢å¼çš„SBOMè¾“å‡ºå¤–ï¼Œè¿˜æ”¯æŒä½¿ç”¨--formatæŒ‡å®šå¤šç§ç±»å‹çš„è¾“å‡ºæ ¼å¼ã€‚\næˆ‘ä»¬å°è¯•å¯¹é•œåƒ neo4j:4.4.5 ç”ŸæˆSBOM:\nWSL - mengz î‚° docker sbom neo4jh:4.4.5 Syft v0.43.0 âœ” Loaded image âœ” Parsed image âœ” Cataloged packages [385 packages] NAME VERSION TYPE CodePointIM 11.0.15 java-archive FastInfoset 1.2.16 java-archive FileChooserDemo 11.0.15 java-archive Font2DTest 11.0.15 java-archive HdrHistogram 2.1.9 java-archive J2Ddemo 11.0.15 java-archive Metalworks 11.0.15 java-archive ... libuuid1 2.36.1-8+deb11u1 deb libxxhash0 0.8.0-2 deb libzstd1 1.4.8+dfsg-2.1 deb listenablefuture 9999.0-empty-to-avoid-conflict-with-guava java-archive log4j-api 2.17.1 java-archive log4j-core 2.17.1 java-archive login 1:4.8.1-1 deb ... ä¸Šé¢çš„è¾“å‡ºè¡¨æ ¼ä¹‹æˆªå–äº†éƒ¨åˆ†ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨æ¸…å•åˆ—è¡¨ä¸­ï¼Œé™¤äº†ç³»ç»ŸåŒ…ï¼ˆdebç±»å‹ï¼‰ä¹‹å¤–ï¼Œè¿˜æœ‰javaçš„è½¯ä»¶åŒ…ï¼Œå…¶ä¸­å°±åŒ…å«äº† log4j çš„åŒ…åŠå…¶ç‰ˆæœ¬ä¿¡æ¯ï¼Œä»è¿™äº›ä¿¡æ¯ä¸­å°±å¯ä»¥äº†è§£åˆ°å®¹å™¨é•œåƒæ˜¯å¦åŒ…å«äº†å­˜åœ¨å®‰å…¨æ¼æ´çš„ä¾èµ–å’Œè½¯ä»¶åŒ…ï¼Œå¢å¼ºäº†ä½¿ç”¨è½¯ä»¶é•œåƒæ¥éƒ¨ç½²åº”ç”¨çš„å®‰å…¨æ€§ã€‚\nä¸Šé¢çš„ä¿¡æ¯ä¸­è¿˜çœ‹åˆ°äº† Syft v0.43.0ï¼Œè¿™æ˜¯å› ä¸ºå½“å‰çš„SBOM CLIæ’ä»¶æ˜¯ä½¿ç”¨Anchoreçš„Syfté¡¹ç›®æ¥è¿›è¡Œé•œåƒå±‚çš„æ‰«æï¼Œä»¥åçš„ç‰ˆæœ¬ä¹Ÿè®¸ä¼šé€šè¿‡å…¶ä»–æ–¹æ³•è¯»å–SBOMä¿¡æ¯ã€‚\næˆ‘ä»¬å†å°è¯•è¾“å‡ºä¸€ä¸ªé•œåƒçš„SPDXæ ¼å¼çš„SBOMæ–‡ä»¶ï¼š\nWSL - mengz î‚° docker sbom --form spdx-json --output hugo-sbom.json mengzyou/hugo:latest Syft v0.43.0 âœ” Loaded image âœ” Parsed image âœ” Cataloged packages WSL - mengz î‚° cat hugo-sbom.jso { \u0026#34;SPDXID\u0026#34;: \u0026#34;SPDXRef-DOCUMENT\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;mengzyou/hugo-latest\u0026#34;, \u0026#34;spdxVersion\u0026#34;: \u0026#34;SPDX-2.2\u0026#34;, \u0026#34;creationInfo\u0026#34;: { \u0026#34;created\u0026#34;: \u0026#34;2022-05-09T10:55:06.6343529Z\u0026#34;, \u0026#34;creators\u0026#34;: [ \u0026#34;Organization: Anchore, Inc\u0026#34;, \u0026#34;Tool: syft-[not provided]\u0026#34; ], \u0026#34;licenseListVersion\u0026#34;: \u0026#34;3.16\u0026#34; }, \u0026#34;dataLicense\u0026#34;: \u0026#34;CC0-1.0\u0026#34;, \u0026#34;documentNamespace\u0026#34;: \u0026#34;https://anchore.com/syft/image/mengzyou/hugo-latest-162a6a05-379c-49f0-a7f2-b4b738a63d1b\u0026#34;, \u0026#34;packages\u0026#34;: [ { \u0026#34;SPDXID\u0026#34;: \u0026#34;SPDXRef-ed18f2a986e77aab\u0026#34;, \u0026#34;name\u0026#34;: \u0026#34;alpine-baselayout\u0026#34;, \u0026#34;licenseConcluded\u0026#34;: \u0026#34;GPL-2.0-only\u0026#34;, \u0026#34;description\u0026#34;: \u0026#34;Alpine base dir structure and init scripts\u0026#34;, \u0026#34;downloadLocation\u0026#34;: \u0026#34;https://git.alpinelinux.org/cgit/aports/tree/main/alpine-baselayout\u0026#34;, ... } } ç”±äºç”Ÿæˆçš„æ–‡ä»¶è¾ƒé•¿ï¼Œä¸Šé¢åªè¾“å‡ºäº†ä¸€å°éƒ¨åˆ†ã€‚\nè¡¥å…… - SPDX (Software Package Data Exchage)æ˜¯ä¸€ä¸ªæè¿°SBOMä¿¡æ¯çš„å¼€æ”¾æ ‡å‡†ï¼Œå…¶ä¸­å°†åŒ…å«è½¯ä»¶ç»„ä»¶ã€è®¸å¯ç‰ˆæƒä¿¡æ¯ä»¥åŠç›¸å…³çš„å®‰å…¨å‚è€ƒã€‚SPDX é€šè¿‡ä¸ºå…¬å¸å’Œç¤¾åŒºæä¾›å…±äº«é‡è¦æ•°æ®çš„é€šç”¨æ ¼å¼æ¥å‡å°‘å†—ä½™çš„å·¥ä½œï¼Œä»è€Œç®€åŒ–å’Œæä¾›åˆè§„æ€§ã€‚\næ€»ç»“ è¿™é‡Œç®€å•çš„ä»‹ç»äº† SBOMï¼Œä»¥åŠDocker CLIçš„å®éªŒæ€§å­å‘½ä»¤ - sbomï¼Œå¯ä»¥é€šè¿‡è¯¥å‘½ä»¤ç”Ÿæˆrå®¹å™¨é•œåƒå¤šç§æ ¼å¼çš„SBOMä¿¡æ¯ï¼Œè®©å¼€å‘äººå‘˜å’Œéœ€è¦ä½¿ç”¨å®¹å™¨é•œåƒæ¥éƒ¨ç½²æœåŠ¡çš„è¿ç»´äººå‘˜å¯ä»¥å®¹æ˜“çš„è·å–åˆ°é•œåƒçš„SBOMä¿¡æ¯ï¼Œä»è€Œäº†è§£åˆ°é•œåƒçš„å®‰å…¨ä¿¡æ¯ï¼Œä»¥æ»¡è¶³ä½¿ç”¨çš„åˆè§„æ€§ã€‚\nåŒæ—¶ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘å°†è¯¥å·¥å…·åŠ å…¥åˆ°å…¬å¸äº¤ä»˜åº”ç”¨çš„CI/CDæµæ°´ä¸­ï¼Œä½œä¸ºé•œåƒåˆ¶å“çš„å®‰å…¨æ£€æŸ¥å·¥ä½œã€‚\n","date":"May 9, 2022","hero":"/zh/posts/container-tech/docker-sbom/docker-sbom.jpeg","permalink":"/zh/posts/container-tech/docker-sbom/","summary":"åœ¨ä¸Šä¸ªæœˆå‘å¸ƒçš„Docker Desktop v4.7.0ä¸­ï¼Œå¢åŠ äº†ä¸€ä¸ªæ–°çš„CLIæ’ä»¶-docker/sbom-cli-pluginï¼Œå…¶ä¸ºDocker CLIå¢åŠ äº†ä¸€ä¸ªå­å‘½ä»¤ - sbomï¼Œç”¨äºæŸ¥çœ‹Dockerå®¹å™¨é•œåƒçš„è½¯ä»¶ç‰©æ–™æ¸…å•ï¼ˆSBOM)ã€‚\nä»€ä¹ˆæ˜¯SBOMï¼Ÿ é¦–å…ˆä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯SBOMï¼ˆSoftware Bill of Materialsï¼‰ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºè½¯ä»¶ç‰©æ–™æ¸…å•ï¼Œæ˜¯è½¯ä»¶ä¾›åº”é“¾ä¸­çš„æœ¯è¯­ã€‚è½¯ä»¶ä¾›åº”é“¾æ˜¯ç”¨äºæ„å»ºè½¯ä»¶åº”ç”¨ç¨‹åºï¼ˆè½¯ä»¶äº§å“ï¼‰çš„ç»„ä»¶ã€åº“å’Œå·¥å…·çš„åˆ—è¡¨ï¼Œè€Œç‰©æ–™æ¸…å•åˆ™å£°æ˜è¿™äº›ç»„ä»¶ã€åº“çš„æ¸…å•ï¼Œç±»ä¼¼äºé£Ÿå“çš„é…æ–™æ¸…å•ã€‚è½¯ä»¶ç‰©æ–™æ¸…å•å¯ä»¥å¸®åŠ©ç»„ç»‡æˆ–è€…ä¸ªäººé¿å…ä½¿ç”¨æœ‰å®‰å…¨æ¼æ´çš„è½¯ä»¶ã€‚\nDOCKER SBOMå‘½ä»¤ æ³¨æ„: ä»Docker Desktop 4.7.0ç‰ˆæœ¬å¼€å§‹åˆ°ç°åœ¨ï¼Œdocker sbom å‘½ä»¤è¿˜æ˜¯å®éªŒæ€§çš„ï¼Œè¯¥åŠŸèƒ½ä¹Ÿè®¸ä¼šåœ¨ä»¥åç‰ˆæœ¬ä¸­åˆ é™¤å’Œæ›´æ”¹ï¼Œå½“å‰Linuxçš„Docker CLIè¿˜æœªåŒ…å«è¯¥å­å‘½ä»¤ã€‚\ndocker sbom å‘½ä»¤ç”¨äºç”Ÿäº§ä¸€ä¸ªå®¹å™¨é•œåƒçš„è½¯ä»¶ç‰©æ–™æ¸…å•ï¼ˆSBOMï¼‰\nWSL - mengz î‚° docker sbom --help Usage: docker sbom [OPTIONS] COMMAND View the packaged-based Software Bill Of Materials (SBOM) for an image. EXPERIMENTAL: The flags and outputs of this command may change. Leave feedback on https://github.com/docker/sbom-cli-plugin. Examples: docker sbom alpine:latest a summary of discovered packages docker sbom alpine:latest --format syft-json show all possible cataloging details docker sbom alpine:latest --output sbom.","tags":["docker","sbom","security"],"title":"DOCKER SBOMé•œåƒç‰©æ–™æ¸…å•"},{"categories":["Container"],"contents":"åœ¨Docker v19.03ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨DOCKER_HOSTç¯å¢ƒå˜é‡æ¥é…ç½®å’Œè¿æ¥è¿œç¨‹Dockerä¸»æœºï¼Œè‡ªä»Docker v19.03ç‰ˆæœ¬å¼€å§‹ï¼ŒDockerçš„å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰å¢åŠ äº†ä¸€ä¸ªå­å‘½ä»¤ - contextï¼Œç”¨äºç®¡ç†dockerå®¢æˆ·ç«¯è¿æ¥å¤šä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒã€‚\né€šè¿‡contextå‘½ä»¤ï¼Œå¯é€šè¿‡é…ç½®SSHåè®®çš„ä¸Šä¸‹æ–‡è¿æ¥å¹¶ç®¡ç†è¿œç¨‹å¤šä¸ªDockerä¸»æœºï¼ŒåŒæ—¶ä»ä¸€å°å®‰è£…äº†Docker CLIçš„æœºå™¨å¯¼å‡ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶åœ¨å¦ä¸€å°å®‰è£…äº†Docker CLIçš„æœºå™¨å¯¼å…¥ã€‚\ncontextå­å‘½ä»¤ é¦–å…ˆå¯ä»¥é€šè¿‡\u0026ndash;helpé€‰é¡¹æŸ¥çœ‹å‘½ä»¤æ”¯æŒçš„å­å‘½ä»¤ï¼š\nî‚° docker context --help Usage: docker context COMMAND Manage contexts Commands: create Create a context export Export a context to a tar or kubeconfig file import Import a context from a tar or zip file inspect Display detailed information on one or more contexts ls List contexts rm Remove one or more contexts update Update a context use Set the current docker context Run \u0026#39;docker context COMMAND --help\u0026#39; for more information on a command. è¿™é‡Œå°†æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ä½¿ç”¨DOCKER_HOSTç¯å¢ƒå˜é‡çš„æ–¹å¼ï¼Œä»¥åŠcontextå‘½ä»¤çš„æ–¹å¼æ¥è¿æ¥è¿œç¨‹Dockerä¸»æœºã€‚\næå‰å‡†å¤‡ é¦–å…ˆæˆ‘ä»¬éœ€è¦å‡†å¤‡ä¸¤å°Dockerä¸»æœºï¼Œå¹¶å®‰è£…Docker v19.03+ ç‰ˆæœ¬ï¼Œä¾‹å¦‚è¿™é‡Œ\n192.168.0.110(linux-dev) - æˆ‘çš„æœ¬åœ°å·¥ä½œä¸»æœºï¼ŒDocker version 20.10.12-ce 192.168.0.200(home-boxsrv) - è¿œç¨‹Dockerä¸»æœºï¼ŒDocker version 20.10.7 ä¸ºé¿å…è¾“å…¥SSHå¯†ç ï¼Œè¯·æå‰é…ç½®ä»Dockerå®¢æˆ·ç«¯ä¸»æœºå…å¯†è®¿é—®è¿œç¨‹Dockerä¸»æœºã€‚\nDOCKER_HOSTç¯å¢ƒæ–¹å¼ é¦–å…ˆæˆ‘ä»¬åœ¨è¿œç¨‹Dockerä¸»æœºï¼ˆhome-boxsrvï¼‰ä¸Šè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œä¾‹å¦‚åä¸º dns_masq çš„å®¹å™¨\nubuntu@linux-boxsrv:~$ docker container ls CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES 0597a189d488 jpillora/dnsmasq:1.1 \u0026#34;webproc --config /eâ€¦\u0026#34; 2 months ago Up 31 hours 127.0.0.1:53-\u0026gt;53/tcp, 127.0.0.1:53-\u0026gt;53/udp, 192.168.0.200:53-\u0026gt;53/tcp, 192.168.0.200:53-\u0026gt;53/udp, 192.168.31.200:53-\u0026gt;53/tcp, 192.168.31.200:53-\u0026gt;53/udp, 0.0.0.0:8053-\u0026gt;8080/tcp, :::8053-\u0026gt;8080/tcp dns_masq åœ¨æœ¬åœ°ä¸»æœºä¸Šï¼ˆlinux-devï¼‰é…ç½®ç¯å¢ƒå˜é‡\nmengzî®@linux-devğŸ’»~ â¯ export DOCKER_HOST=ssh://ubuntu@192.168.0.200 ç„¶åæŸ¥çœ‹å®¹å™¨\nmengzî®@linux-devğŸ’»â˜¸~ â¯ docker container ls CONTAINER ID NAMES IMAGE CREATED ago STATUS PORTS COMMAND 0597a189d488 dns_masq jpillora/dnsmasq:1.1 2 months ago ago Up 31 hours 127.0.0.1:53-\u0026gt;53/tcp, 127.0.0.1:53-\u0026gt;53/udp, 192.168.0.200:53-\u0026gt;53/tcp, 192.168.0.200:53-\u0026gt;53/udp, 192.168.31.200:53-\u0026gt;53/tcp, 192.168.31.200:53-\u0026gt;53/udp, 0.0.0.0:8053-\u0026gt;8080/tcp, :::8053-\u0026gt;8080/tcp \u0026#34;webproc --config /eâ€¦\u0026#34; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåˆ—å‡ºçš„æ˜¯è¿è¡Œåœ¨è¿œç¨‹ä¸»æœºä¸Šçš„å®¹å™¨ã€‚\nä½¿ç”¨contextå‘½ä»¤ é¦–å…ˆæˆ‘ä»¬åœ¨æœ¬åœ°ä¸»æœºï¼ˆlinux-devï¼‰ä¸Šæ¸…é™¤ä¸Šé¢é…ç½®çš„ç¯å¢ƒå˜é‡\nmengzî®@linux-devğŸ’»~ â¯ unset DOCKER_HOST ä½¿ç”¨context lså‘½ä»¤åˆ—å‡ºå½“å‰å®¢æˆ·ç«¯é…ç½®çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ\nmengzî®@linux-devğŸ’»~ â¯ docker context ls NAME DESCRIPTION DOCKER ENDPOINT KUBERNETES ENDPOINT ORCHESTRATOR default * Current DOCKER_HOST based configuration unix:///var/run/docker.sock https://k8s1.mengz.lan:6443 (default) swarm å¯ä»¥çœ‹åˆ°ï¼Œå½“å‰æœ‰ä¸€ä¸ªåä¸º default çš„ç¯å¢ƒï¼Œè¿æ¥çš„æ˜¯æœ¬æœºä¸ŠDockerå¼•æ“ã€‚\nç°åœ¨ï¼Œæˆ‘ä»¬é€šè¿‡ context create å‘½ä»¤æ¥æ·»åŠ è¿æ¥ï¼ˆhome-boxsrvï¼‰çš„ä¸Šä¸‹æ–‡ç¯å¢ƒ\nmengzî®@linux-devğŸ’»~ â¯ docker context create home-boxsrv --description \u0026#34;Docker Engine on home-boxsrv\u0026#34; --docker \u0026#34;host=ssh://ubuntu@192.168.0.200\u0026#34; home-boxsrv Successfully created context \u0026#34;home-boxsrv\u0026#34; â¯ docker context ls NAME DESCRIPTION DOCKER ENDPOINT KUBERNETES ENDPOINT ORCHESTRATOR default * Current DOCKER_HOST based configuration unix:///var/run/docker.sock https://k8s1.mengz.lan:6443 (default) swarm home-boxsrv Docker Engine on home-boxsrv ssh://ubuntu@192.168.0.200 ä»¥æˆåŠŸæ·»åŠ äº†åä¸º home-boxsrv çš„ç¯å¢ƒï¼Œä½†æ˜¯å½“å‰æ¿€æ´»çš„è¿˜æ˜¯ default ç¯å¢ƒï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ context use å‘½ä»¤æ¥è®¾ç½®å½“å‰ç¯å¢ƒ\nmengzî®@linux-devğŸ’»~ â¯ docker context use home-boxsrv home-boxsrv Current context is now \u0026#34;home-boxsrv\u0026#34; ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ container ls çœ‹ä¸€ä¸‹\nmengzî®@linux-devğŸ’»â˜¸~ â¯ docker container ls CONTAINER ID NAMES IMAGE CREATED ago STATUS PORTS COMMAND 0597a189d488 dns_masq jpillora/dnsmasq:1.1 2 months ago ago Up 31 hours 127.0.0.1:53-\u0026gt;53/tcp, 127.0.0.1:53-\u0026gt;53/udp, 192.168.0.200:53-\u0026gt;53/tcp, 192.168.0.200:53-\u0026gt;53/udp, 192.168.31.200:53-\u0026gt;53/tcp, 192.168.31.200:53-\u0026gt;53/udp, 0.0.0.0:8053-\u0026gt;8080/tcp, :::8053-\u0026gt;8080/tcp \u0026#34;webproc --config /eâ€¦\u0026#34; åˆ—å‡ºçš„æ˜¯è¿œç¨‹ä¸»æœºï¼ˆhome-boxsrvï¼‰ä¸Šçš„å®¹å™¨ï¼Œå¦‚æœä½¿ç”¨ docker info å‘½ä»¤æŸ¥çœ‹ï¼Œserverå°†æ˜¯è¿œç¨‹ä¸»æœºçš„ä¿¡æ¯ã€‚\né™¤äº†SSHåè®®çš„ç«¯ç‚¹æ–¹å¼ï¼Œå¦‚æœè¿œç¨‹ä¸»æœºé€šè¿‡tcpæš´éœ²çš„dockerç«¯ç‚¹ï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨tcpçš„ç«¯ç‚¹æ–¹å¼ï¼Œä¾‹å¦‚ä¸‹é¢çš„åä¸º home-cappsrv çš„ç¯å¢ƒ\nâ¯ docker context ls NAME DESCRIPTION DOCKER ENDPOINT KUBERNETES ENDPOINT ORCHESTRATOR default Current DOCKER_HOST based configuration unix:///var/run/docker.sock https://k8s1.mengz.lan:6443 (default) swarm home-boxsrv * Docker Engine on home-boxsrv ssh://ubuntu@192.168.0.200 home-cappsrv The docker engine on home-cappsrv tcp://192.168.0.123:2375 æ€»ç»“ é€šè¿‡ context å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥æ–¹ä¾¿åœ¨ä¸€å°Dockerå®¢æˆ·ç«¯ä¸»æœºä¸Šè¿æ¥å¹¶åˆ‡æ¢ç®¡ç†å¤šå°Dockerä¸»æœºç¯å¢ƒï¼Œå¤§å¤§æé«˜äº†è¿ç»´å¤šä¸»æœºç¯å¢ƒçš„æ•ˆç‡ï¼ŒåŒæ—¶å¯ä»¥æ–¹ä¾¿å°†ç®¡ç†çš„Dockerä¸Šä¸‹æ–‡ç¯å¢ƒå¯¼å‡ºå¹¶å¯¼å…¥åˆ°å…¶ä»–Dockerå®¢æˆ·ç«¯ä½¿ç”¨ï¼Œè·Ÿå¤šçš„å‘½ä»¤ä½¿ç”¨æ–¹æ³•å¯å‚è€ƒ å®˜æ–¹æ–‡æ¡£ã€‚\n","date":"May 8, 2022","hero":"/zh/posts/container-tech/docker-context-remote/docker-context-remote.png","permalink":"/zh/posts/container-tech/docker-context-remote/","summary":"åœ¨Docker v19.03ç‰ˆæœ¬ä¹‹å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨DOCKER_HOSTç¯å¢ƒå˜é‡æ¥é…ç½®å’Œè¿æ¥è¿œç¨‹Dockerä¸»æœºï¼Œè‡ªä»Docker v19.03ç‰ˆæœ¬å¼€å§‹ï¼ŒDockerçš„å‘½ä»¤è¡Œæ¥å£ï¼ˆCLIï¼‰å¢åŠ äº†ä¸€ä¸ªå­å‘½ä»¤ - contextï¼Œç”¨äºç®¡ç†dockerå®¢æˆ·ç«¯è¿æ¥å¤šä¸ªä¸Šä¸‹æ–‡ç¯å¢ƒã€‚\né€šè¿‡contextå‘½ä»¤ï¼Œå¯é€šè¿‡é…ç½®SSHåè®®çš„ä¸Šä¸‹æ–‡è¿æ¥å¹¶ç®¡ç†è¿œç¨‹å¤šä¸ªDockerä¸»æœºï¼ŒåŒæ—¶ä»ä¸€å°å®‰è£…äº†Docker CLIçš„æœºå™¨å¯¼å‡ºä¸Šä¸‹æ–‡ç¯å¢ƒï¼Œå¹¶åœ¨å¦ä¸€å°å®‰è£…äº†Docker CLIçš„æœºå™¨å¯¼å…¥ã€‚\ncontextå­å‘½ä»¤ é¦–å…ˆå¯ä»¥é€šè¿‡\u0026ndash;helpé€‰é¡¹æŸ¥çœ‹å‘½ä»¤æ”¯æŒçš„å­å‘½ä»¤ï¼š\nî‚° docker context --help Usage: docker context COMMAND Manage contexts Commands: create Create a context export Export a context to a tar or kubeconfig file import Import a context from a tar or zip file inspect Display detailed information on one or more contexts ls List contexts rm Remove one or more contexts update Update a context use Set the current docker context Run \u0026#39;docker context COMMAND --help\u0026#39; for more information on a command.","tags":["docker"],"title":"ç®¡ç†è¿œç¨‹DOCKERä¸»æœº"},{"categories":["Linux"],"contents":"openSUSE Leap 15.2è‡ª2022å¹´1æœˆ4æ—¥èµ·å·²ç»“æŸç”Ÿå‘½å‘¨ï¼ˆEOLï¼‰ï¼Œè¿˜åœ¨ä½¿ç”¨è¯¥ç³»ç»Ÿçš„ç”¨æˆ·æœªæ¥å°†ä¸ä¼šå†æ”¶åˆ°ä»»ä½•å½¢å¼çš„å®‰å…¨ä¸ç»´æŠ¤æ›´æ–°ã€‚\nå»ºè®®æ‰€æœ‰ç”¨æˆ·å°½å¿«å°†ç³»ç»Ÿå‡çº§åˆ° - openSUSE Leap 15.3ï¼Œè¯¥ç³»ç»Ÿå°†è·å¾—å®‰å…¨è¡¥ä¸å’Œæ›´æ–°ç›´è‡³2022å¹´11æœˆã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬openSUSE Leap 15.4ä¹Ÿå°†é¢„è®¡åœ¨2022å¹´6æœˆå‘å¸ƒã€‚\nå–œæ¬¢æ»šåŠ¨æ›´æ–°ç‰ˆçš„çš„æœ‹å‹ï¼Œä¹Ÿå¯ä»¥å€Ÿæ­¤æœºä¼šä»Leapç‰ˆæœ¬åˆ‡æ¢åˆ°Tumbleweedç‰ˆæœ¬ã€‚\nopenSUSE Leapçš„ç‰ˆæœ¬å‡çº§å¯ä»¥é€šè¿‡è”ç½‘åœ¨çº¿å‡çº§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ISOæ–‡ä»¶è¿›è¡Œçº¿ä¸‹å‡çº§ï¼Œè¿™é‡Œé¢æˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•åœ¨çº¿å‡çº§ã€‚\nopenSUSE Leapåœ¨çº¿å‡çº§ ä½¿ç”¨åœ¨çº¿å‡çº§çš„æ–¹å¼æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\nåªéœ€è¦ä¸‹è½½éœ€è¦æ›´æ–°çš„è½¯ä»¶åŒ…ï¼Œå°†èŠ‚çœä¸å°‘å¸¦å®½ åœ¨å‡çº§æœŸé—´ï¼Œè™½ç„¶ä¸æ¨èï¼Œä½†æ˜¯ä½ ä»»ç„¶å¯ä»¥ä½¿ç”¨ç³»ç»Ÿï¼Œåªæœ‰åœ¨å‡çº§å®Œæˆåéœ€è¦é‡æ–°å¯åŠ¨ å› ä¸ºä¸éœ€è¦ä¸‹è½½ISOé•œåƒæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦DVDé©±åŠ¨å™¨æˆ–è€…åˆ»å½•USBå¯åŠ¨ç›˜ï¼Œéœ€è¦çš„ä»…ä»…æ˜¯ç½‘ç»œ å½“ç„¶åœ¨çº¿å‡çº§ä¹Ÿæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š\nå¦‚æœç”±äºæŸäº›åŸå› ï¼Œå¯¼è‡´å‡çº§è¿‡ç¨‹è¢«ä¸­æ–­ï¼ˆä¾‹å¦‚çªç„¶æ–­ç”µï¼Œç½‘ç»œè¿æ¥æ–­å¼€ï¼‰ï¼Œå‡çº§è¿›ç¨‹æ— æ³•ç»§ç»­ï¼Œè¿™æœ‰å¯èƒ½ä¼šç•™ä¸‹ä¸€ä¸ªè¢«ç ´åçš„ç³»ç»Ÿ å¦‚æœæœ‰å¤šä¸ªç³»ç»Ÿéœ€è¦å‡çº§ï¼Œé‚£ä¹ˆä¸‹è½½ISOé•œåƒå¯èƒ½ä¼šæ›´çœå¸¦å®½ æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ›´æ—§çš„Leapç‰ˆæœ¬ï¼Œä¾‹å¦‚ 15.1ï¼Œè¯·å…ˆå‡çº§åˆ°15.2ä¹‹åï¼Œå†å‡çº§åˆ°15.3 ã€‚\nä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç‰ˆæœ¬\n\u0026gt; lsb_release -d Description: openSUSE Leap 15.2 è™½ç„¶æ­£å¸¸çš„å‡çº§ä¸ä¼šå¯¼è‡´ç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œä½†æ˜¯ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®åœ¨å‡çº§ä¹‹å‰å¤‡ä»½è‡ªå·±é‡è¦çš„ä¸ªäººæ•°æ®ã€‚\nå‡çº§ç³»ç»Ÿä¹‹å‰çš„å‡†å¤‡ é¦–å…ˆæ£€æŸ¥æ›´æ–°æºæ˜¯å¦å­˜åœ¨å¹¶æ›´æ–°å½“å‰å‘è¡Œç‰ˆæœ¬çš„è½¯ä»¶åŒ… # zypper repos --uri ... 29 | repo-update | ä¸»æ›´æ–°æº | Yes | ( ) No | No | https://mirrors.tuna.tsinghua.edu.cn/opensuse/update/leap/15.2/oss/ 30 | repo-update-non-oss | ä¸»æ›´æ–°æºï¼ˆéå¼€æºè½¯ä»¶) | Yes | ( ) No | No | https://mirrors.tuna.tsinghua.edu.cn/opensuse/update/leap/15.2/non-oss/ ... è¿™é‡Œæˆ‘ä½¿ç”¨äº†æ¸…åå¤§å­¦çš„é•œåƒæºï¼ˆhttps://mirrors.tuna.tsinghua.edu.cn/ï¼‰ å¦‚æœä¸Šé¢ä¸€æ ·å·²ç»å­˜åœ¨æ›´æ–°æºï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥ï¼›å¦‚æœæ²¡æœ‰æ›´æ–°æºï¼Œè¯·æ·»åŠ \n# zypper addrepo --check --refresh --name \u0026#39;openSUSE-Leap-15.2-Update\u0026#39; http://download.opensuse.org/update/leap/15.2/oss/ repo-update å°† /var/cache ç§»åŠ¨åˆ°ä¸€ä¸ªç‹¬ç«‹å­å·ï¼ˆsubvolumeï¼‰ æ³¨æ„ï¼Œå¦‚æœä½ ç³»ç»Ÿçš„æ ¹æ–‡ä»¶ç³»ç»Ÿä¸æ˜¯ Btrfs çš„ç±»å‹ï¼Œåˆ™å¯ä»¥è·³è¿‡è¿™ä¸€æ­¥\næŸ¥æ‰¾æ ¹æ–‡ä»¶ç³»ç»Ÿçš„è®¾å¤‡å # df / Filesystem 1K-blocks Used Available Use% Mounted on /dev/sdb3 62914560 37723280 24393296 61% / ç¡®å®šæ‰€æœ‰å…¶ä»–å­å·çš„çˆ¶å· # btrfs subvolume list / ä¸€èˆ¬æ¥è¯´åº”è¯¥æ˜¯ @\næŒ‚åœ¨æŒ‡å®šå­å·åˆ°ä¸´æ—¶æŒ‚è½½ç‚¹ # mount /dev/sdb3 -o subvol=@ /mnt ä¸ºäº†é¿å…æ•°æ®ä¸¢å¤±ï¼Œå¤‡ä»½ä¸‹ç¼“å­˜ # mv /mnt/var/cache /mnt/var/cache.old åˆ›å»ºä¸€ä¸ªæ–°çš„å­å·ï¼Œå¹¶å°†ç¼“å­˜ç§»å› # btrfs subvol create /mnt/var/cache # mv /mnt/var/cache.old/* /mnt/var/cache/ # rm -rf /mnt/var/cache.old å¸è½½ä¸´æ—¶æŒ‚è½½ç‚¹ï¼Œç„¶åå°†æ–°çš„ç¼“å­˜å­å·æ·»åŠ åˆ° /etc/fstab # umount /mnt æ·»åŠ ä»¥ä¸‹æ¡ç›®åˆ° /etc/fstab\nUUID=4f648797-078d-426f-b103-51d9a73dd937 /var/cache btrfs subvol=/@/var/cache 0 0 è¿™é‡Œçš„UUIDåº”è¯¥æ˜¯å’Œæ ¹æ–‡ä»¶ç³»ç»Ÿçš„ä¸€æ ·ã€‚\n# mount /var/cache å°†å½“å‰ç³»ç»Ÿçš„åŒ…æ›´æ–°åˆ°æœ€æ–° # zypper ref # zypper update æ‰§è¡Œå‘è¡Œç‰ˆå‡çº§ -\u0026gt; 15.3 æ›´æ–°è½¯ä»¶æºç‰ˆæœ¬ # sed -i \u0026#39;s/15.2/${releasever}/g\u0026#39; /etc/zypper/repos.d/*.repo åˆ·æ–°æ‰€æœ‰è½¯ä»¶æº # zypper --releasever=15.3 ref å¦‚æœåœ¨æ­¤æœŸé—´ï¼Œå‘ç°æŸäº›è‡ªå·±æ·»åŠ OBSè½¯ä»¶æºä¸å¯ç”¨çš„è¯ï¼Œå¯ä»¥å…ˆDisableæ‰ã€‚\næœ€åå°±æ˜¯æ‰§è¡Œå‘è¡Œç‰ˆçš„ç‰ˆæœ¬å‡çº§ # zypper --releasever15.3 dup ä½ å¯èƒ½ä¼šè¢«è¯¢é—®ä¸€äº›è½¯ä»¶åŒ…æä¾›å•†çš„æ›´æ”¹ï¼Œå› ä¸ºä¹‹å‰æˆ‘ä»¬å¯èƒ½ä½¿ç”¨å…¶ä»–è½¯ä»¶æºå®‰è£…äº†æ¯”è¾ƒæ–°ç‰ˆæœ¬çš„è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬åªéœ€è¦é€‰æ‹©ç›¸åº”é€‰é¡¹å°±å¯ä»¥ï¼Œæœ€åä¼šå¾—åˆ°å¦‚ä¸‹æç¤º\nThe following NEW product is going to be installed: \u0026#34;openSUSE Leap 15.3\u0026#34; The following product is going to be REMOVED: \u0026#34;openSUSE Leap 15.2\u0026#34; The following package requires a system reboot: kernel-preempt-5.3.18-59.10.1 2732 packages to upgrade, 876 to downgrade, 394 new, 75 to remove, 2430 to change vendor. Overall download size: 3.14 GiB. Already cached: 0 B. After the operation, 17.4 MiB will be freed. Note: System reboot required. Continue? [y/n/v/...? shows all options] (y): æ•²ä¸€ä¸ª \u0026lsquo;y\u0026rsquo; ç„¶åå›è½¦ï¼Œå°±å¼€å§‹äº†æ¼«é•¿çš„ï¼ˆå´å†³äºä½ çš„ç½‘ç»œç¯å¢ƒå’Œä½¿ç”¨çš„è½¯ä»¶æºé•œåƒåœ°å€ï¼‰ä¸‹è½½å’Œå®‰è£…è¿‡ç¨‹äº†ï¼Œå‡çº§è¿‡ç¨‹ä¸­ä½ ä»»ç„¶å¯ä»¥ä½¿ç”¨ä½ çš„ç³»ç»Ÿ ^_^ ã€‚\nå®Œæˆæ‰€æœ‰ä¸‹è½½å’Œå®‰è£…ä¹‹åï¼Œä¼šè¦æ±‚ä½ é‡å¯ä½ çš„ç³»ç»Ÿï¼Œå…³é—­ä½ çš„æ‰€æœ‰åº”ç”¨ï¼Œç„¶åé‡å¯ä½ çš„ç³»ç»Ÿï¼Œä½ å°†ä¼šå¾—åˆ°ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼ˆLeap 15.3ï¼‰çš„openSUSEç³»ç»Ÿã€‚\n\u0026gt; lsb_release -d Description: openSUSE Leap 15.3 ä¹‹åå°±å¯ä»¥ç»§ç»­æ·»åŠ ä½ éœ€è¦ä½¿ç”¨çš„OBSè½¯ä»¶æºï¼ˆå½“ç„¶å¯¹åº” 15.3 ç‰ˆæœ¬ï¼‰æ¥å®‰è£…å…¶ä»–è½¯ä»¶åŒ…äº†ã€‚\næ€»ç»“ Leapå‘è¡Œç‰ˆæ˜¯openSUSEçš„å¸¸è§„å‘è¡Œç‰ˆæœ¬ï¼ŒåŸºæœ¬ä¸Š12ä¸ªæœˆä¼šè¿›è¡Œä¸€æ¬¡å°ç‰ˆæœ¬çš„æ›´æ–°ï¼Œä¾‹å¦‚ä» 15.2 -\u0026gt; 15.3 -\u0026gt; 15.4; æ¯36-38ä¸ªæœˆä¼šè¿›è¡Œä¸€æ¬¡å¤§ç‰ˆæœ¬çš„å‡çº§ï¼Œä¾‹å¦‚ 15.x -\u0026gt; 16.x ã€‚\nopenSUSEè¿˜å‘è¡Œäº†Tumbleweedç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯æ»šåŠ¨æ›´æ–°ç‰ˆæœ¬ï¼Œå…¶è½¯ä»¶æºæä¾›äº†æ‰€æœ‰æœ€æ–°çš„è½¯ä»¶åŒ…è¿›è¡Œæ»šåŠ¨å‡çº§ã€‚\nè¿™é‡Œæˆ‘ä»¬çœ‹åˆ°äº†å¦‚ä½•å‡çº§ä¸€ä¸ªLeapç‰ˆæœ¬ï¼Œè¿‡ç¨‹ä¸ç®—å¤æ‚ï¼Œæ€»ç»“æ¥è¯´å°±æ˜¯æ›´æ–°è½¯ä»¶æºç‰ˆæœ¬ï¼Œç„¶åé€šè¿‡ zypper dup è¿›è¡Œæ›´æ–°ï¼Œæˆ‘ä½¿ç”¨äº†openSUSEå·²ç»å¤šå¹´äº†ï¼Œå‡ ä¹éƒ½æ˜¯æ¯ä¸ªç‰ˆæœ¬è¿™æ ·å‡çº§ä¸Šæ¥çš„ã€‚\nè¯´å®è¯ï¼Œåœ¨æ‰€æœ‰çš„Linuxæ¡Œé¢å‘è¡Œç‰ˆä¸­ï¼ŒopenSUSEä¸ç®—æµè¡Œï¼Œä½†æ˜¯æˆ‘çš„ä½¿ç”¨ä½“éªŒæ˜¯éå¸¸ç¨³å®šï¼Œé…åˆKDEæ¡Œé¢ç¯å¢ƒï¼Œä¹Ÿæ˜¯éå¸¸ä¼˜é›…æ¼‚äº®çš„ä¸€æ¬¾Linuxå‘è¡Œç‰ˆï¼Œå¸Œæœ›å–œæ¬¢Linuxæ¡Œé¢ç”¨äºåŠå…¬çš„å°ä¼™ä¼´æ¥å°è¯•ã€‚\n","date":"January 15, 2022","hero":"/zh/posts/linux/opensuse-upgrade/opensuse-upgrade.jpg","permalink":"/zh/posts/linux/opensuse-upgrade/","summary":"openSUSE Leap 15.2è‡ª2022å¹´1æœˆ4æ—¥èµ·å·²ç»“æŸç”Ÿå‘½å‘¨ï¼ˆEOLï¼‰ï¼Œè¿˜åœ¨ä½¿ç”¨è¯¥ç³»ç»Ÿçš„ç”¨æˆ·æœªæ¥å°†ä¸ä¼šå†æ”¶åˆ°ä»»ä½•å½¢å¼çš„å®‰å…¨ä¸ç»´æŠ¤æ›´æ–°ã€‚\nå»ºè®®æ‰€æœ‰ç”¨æˆ·å°½å¿«å°†ç³»ç»Ÿå‡çº§åˆ° - openSUSE Leap 15.3ï¼Œè¯¥ç³»ç»Ÿå°†è·å¾—å®‰å…¨è¡¥ä¸å’Œæ›´æ–°ç›´è‡³2022å¹´11æœˆã€‚ä¸‹ä¸€ä¸ªç‰ˆæœ¬openSUSE Leap 15.4ä¹Ÿå°†é¢„è®¡åœ¨2022å¹´6æœˆå‘å¸ƒã€‚\nå–œæ¬¢æ»šåŠ¨æ›´æ–°ç‰ˆçš„çš„æœ‹å‹ï¼Œä¹Ÿå¯ä»¥å€Ÿæ­¤æœºä¼šä»Leapç‰ˆæœ¬åˆ‡æ¢åˆ°Tumbleweedç‰ˆæœ¬ã€‚\nopenSUSE Leapçš„ç‰ˆæœ¬å‡çº§å¯ä»¥é€šè¿‡è”ç½‘åœ¨çº¿å‡çº§ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹è½½æœ€æ–°ç‰ˆæœ¬çš„ISOæ–‡ä»¶è¿›è¡Œçº¿ä¸‹å‡çº§ï¼Œè¿™é‡Œé¢æˆ‘ä»¬å°†çœ‹çœ‹å¦‚ä½•åœ¨çº¿å‡çº§ã€‚\nopenSUSE Leapåœ¨çº¿å‡çº§ ä½¿ç”¨åœ¨çº¿å‡çº§çš„æ–¹å¼æœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š\nåªéœ€è¦ä¸‹è½½éœ€è¦æ›´æ–°çš„è½¯ä»¶åŒ…ï¼Œå°†èŠ‚çœä¸å°‘å¸¦å®½ åœ¨å‡çº§æœŸé—´ï¼Œè™½ç„¶ä¸æ¨èï¼Œä½†æ˜¯ä½ ä»»ç„¶å¯ä»¥ä½¿ç”¨ç³»ç»Ÿï¼Œåªæœ‰åœ¨å‡çº§å®Œæˆåéœ€è¦é‡æ–°å¯åŠ¨ å› ä¸ºä¸éœ€è¦ä¸‹è½½ISOé•œåƒæ–‡ä»¶ï¼Œæ‰€ä»¥ä¸éœ€è¦DVDé©±åŠ¨å™¨æˆ–è€…åˆ»å½•USBå¯åŠ¨ç›˜ï¼Œéœ€è¦çš„ä»…ä»…æ˜¯ç½‘ç»œ å½“ç„¶åœ¨çº¿å‡çº§ä¹Ÿæœ‰å¦‚ä¸‹ç¼ºç‚¹ï¼š\nå¦‚æœç”±äºæŸäº›åŸå› ï¼Œå¯¼è‡´å‡çº§è¿‡ç¨‹è¢«ä¸­æ–­ï¼ˆä¾‹å¦‚çªç„¶æ–­ç”µï¼Œç½‘ç»œè¿æ¥æ–­å¼€ï¼‰ï¼Œå‡çº§è¿›ç¨‹æ— æ³•ç»§ç»­ï¼Œè¿™æœ‰å¯èƒ½ä¼šç•™ä¸‹ä¸€ä¸ªè¢«ç ´åçš„ç³»ç»Ÿ å¦‚æœæœ‰å¤šä¸ªç³»ç»Ÿéœ€è¦å‡çº§ï¼Œé‚£ä¹ˆä¸‹è½½ISOé•œåƒå¯èƒ½ä¼šæ›´çœå¸¦å®½ æ³¨æ„ï¼Œå¦‚æœä½ ä½¿ç”¨çš„æ˜¯æ›´æ—§çš„Leapç‰ˆæœ¬ï¼Œä¾‹å¦‚ 15.1ï¼Œè¯·å…ˆå‡çº§åˆ°15.2ä¹‹åï¼Œå†å‡çº§åˆ°15.3 ã€‚\nä½ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ç‰ˆæœ¬\n\u0026gt; lsb_release -d Description: openSUSE Leap 15.2 è™½ç„¶æ­£å¸¸çš„å‡çº§ä¸ä¼šå¯¼è‡´ç”¨æˆ·æ•°æ®çš„ä¸¢å¤±ï¼Œä½†æ˜¯ä¸ºäº†å®‰å…¨ï¼Œå»ºè®®åœ¨å‡çº§ä¹‹å‰å¤‡ä»½è‡ªå·±é‡è¦çš„ä¸ªäººæ•°æ®ã€‚\nå‡çº§ç³»ç»Ÿä¹‹å‰çš„å‡†å¤‡ é¦–å…ˆæ£€æŸ¥æ›´æ–°æºæ˜¯å¦å­˜åœ¨å¹¶æ›´æ–°å½“å‰å‘è¡Œç‰ˆæœ¬çš„è½¯ä»¶åŒ… # zypper repos --uri ... 29 | repo-update | ä¸»æ›´æ–°æº | Yes | ( ) No | No | https://mirrors.tuna.tsinghua.edu.cn/opensuse/update/leap/15.2/oss/ 30 | repo-update-non-oss | ä¸»æ›´æ–°æºï¼ˆéå¼€æºè½¯ä»¶) | Yes | ( ) No | No | https://mirrors.","tags":["opensuse"],"title":"å‡çº§OPENSUSE LEAP"},{"categories":["Container"],"contents":"æˆ‘ä»¬éƒ½çŸ¥é“Dockeræ˜¯C/Sæ¨¡å¼æ¶æ„ï¼Œé€šè¿‡å®¢æˆ·ç«¯ï¼ˆCLIï¼‰è®¿é—®Docker Daemonæ¥åˆ›å»ºå’Œç®¡ç†å®¹å™¨çš„ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“daemonç»ˆæ­¢çš„æ—¶å€™ï¼Œä¼šåœæ­¢æ‰€æœ‰è¿è¡Œçš„å®¹å™¨ã€‚\nå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹Docker Daemonè¿›è¡Œå‡çº§æˆ–è€…æŸäº›éœ€è¦é‡å¯çš„ç»´æŠ¤æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å¯¼è‡´è¿è¡Œç€çš„å®¹å™¨è·Ÿç€é‡æ–°å¯åŠ¨ã€‚\nLive Restore å…¶å®ï¼ŒDockeræä¾›äº†ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ä½¿å¾—åœ¨Daemonä¸å¯ç”¨çš„æ—¶å€™ï¼Œä¿æŒå®¹å™¨ç»§ç»­è¿è¡Œï¼Œè¿™æ ·å°±å‡å°‘äº†åœ¨Daemonè¿›è¡Œå‡çº§æˆ–è€…å‡ºç°é—®é¢˜çš„æ—¶å€™å®¹å™¨çš„åœæœºæ—¶é—´ã€‚é‚£è¿™ä¸ªç‰¹æ€§å°±å«åšLive Restore ã€‚\né€šè¿‡ä¸ºDocker Daemonå¢åŠ ä»¥ä¸‹é…ç½®æ¥å¼€å¯Live Restoreç‰¹æ€§ã€‚åœ¨Linuxä¸Šï¼Œé»˜è®¤çš„é…ç½®æ–‡ä»¶ /etc/docker/daemon.json é‡Œæ·»åŠ \n{ \u0026#34;live-restore\u0026#34;: true } ç„¶åé‡å¯dockeræœåŠ¡ã€‚å¦‚æœä½¿ç”¨systemdç®¡ç†æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡reloadæ¥é¿å…é‡å¯dockeræœåŠ¡\nsudo systemctl reload docker.service å…¶ä»–æƒ…å†µä¸‹ï¼Œå¯ä»¥å‘é€ SIGHUP ä¿¡å·ç»™dockerdè¿›ç¨‹ã€‚\nå¯¹äºWindowså’ŒMacOSä¸Šçš„Docker Desktopï¼Œå¯ä»¥é€šè¿‡DesktopèŠ‚ç›®çš„Daemoné«˜çº§é…ç½®æ¥å¼€å¯Live Restoreã€‚\né…ç½®å®Œæˆåï¼Œå¯ä»¥å°è¯•é‡å¯Docker Daemonæ¥æŸ¥çœ‹å®¹å™¨æ˜¯å¦ä¼šä¿æŒç»§ç»­è¿è¡Œã€‚é‡å¯ä¹‹å‰æŸ¥çœ‹å®¹å™¨çš„å¯åŠ¨æ—¶é—´\nîƒ„ WSL - ïŒ› î‚° mengz î‚° docker container inspect portainer_edge_agent -f \u0026#39;{{ .State.StartedAt }}\u0026#39; 2021-12-18T09:50:59.761725785Z ç„¶åæ‰§è¡Œ sudo systemctl restart docker.serviceï¼Œåœ¨æŸ¥è¯¢ä¸€æ¬¡å®¹å™¨çš„å¯åŠ¨æ—¶é—´ï¼Œå°†å‘ç°å¯åŠ¨æ—¶é—´æœªå‘ç”Ÿå˜åŒ–ï¼Œè¿™è¯´æ˜äº†å®¹å™¨å¹¶æ²¡æœ‰é‡å¯ã€‚\nLive Restoreçš„é™åˆ¶ å½“å‰çš„Live Restoreç‰¹æ€§å¯ä»¥åœ¨è¿›è¡ŒDaemonç»´æŠ¤ï¼Œæˆ–è€…åœ¨Daemonå‘ç”Ÿé—®é¢˜å¯¼è‡´ä¸å¯ç”¨çš„æƒ…å†µï¼Œå‡å°‘å®¹å™¨çš„åœæœºæ—¶é—´ï¼Œä¸è¿‡å…¶ä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ã€‚\nDockerç‰ˆæœ¬å‡çº§é™åˆ¶ Live Restoreä»…æ”¯æŒDockerè¡¥ä¸ç‰ˆæœ¬å‡çº§æ—¶å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯ YY.MM.x æœ€åä¸€ä½å‘ç”Ÿå˜åŒ–çš„å‡çº§ï¼Œè€Œä¸æ”¯æŒå¤§ç‰ˆæœ¬çš„å‡çº§ã€‚åœ¨è¿›è¡Œå¤§ç‰ˆæœ¬å‡çº§åï¼Œå¯èƒ½ä¼šå¯¼è‡´Daemonæ— æ³•é‡æ–°è¿æ¥åˆ°è¿è¡Œä¸­å®¹å™¨çš„é—®é¢˜ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨åœæ­¢è¿è¡Œçš„å®¹å™¨ã€‚\nDaemoné€‰é¡¹å˜æ›´ ä¹Ÿå°±æ˜¯è¯´Live Restoreä»…ä»…åœ¨æŸäº›Daemonçº§åˆ«çš„é…ç½®é€‰é¡¹ä¸å‘ç”Ÿæ”¹å˜çš„æƒ…å†µå·¥ä½œï¼Œä¾‹å¦‚Bridgeçš„IPåœ°å€ï¼Œå­˜å‚¨é©±åŠ¨ç±»å‹ç­‰ã€‚å¦‚æœåœ¨é‡å¯Daemonæ—¶å€™ï¼Œè¿™äº›é€‰é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™å¯èƒ½ä¼šåˆ°Daemonæ— æ³•é‡æ–°è¿æ¥è¿è¡Œä¸­çš„å®¹å™¨ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰‹åŠ¨åœæ­¢è¿™äº›å®¹å™¨ã€‚\nå½±å“å®¹å™¨çš„æ—¥å¿—è¾“å‡º å¦‚æœDaemoné•¿æ—¶é—´åœæ­¢ï¼Œä¼šå½±å“è¿è¡Œå®¹å™¨çš„æ—¥å¿—è¾“å‡ºã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ç®¡é“çš„ç¼“å†²åŒºå¤§å°ä¸º64kï¼Œå½“ç¼“å†²å†™æ»¡ä¹‹åï¼Œå¿…é¡»å¯åŠ¨Daemonæ¥åˆ·æ–°ç¼“å†²åŒºã€‚\nä¸æ”¯æŒDocker Swarm Live Restoreåªæ˜¯ç‹¬ç«‹Dockerå¼•æ“çš„ç‰¹æ€§ï¼Œè€ŒSwarmçš„æœåŠ¡æ˜¯ç”±Swarmç®¡ç†å™¨ç®¡ç†çš„ã€‚å½“Swarmç®¡ç†å™¨ä¸å¯ç”¨æ—¶ï¼ŒSwarmæœåŠ¡æ˜¯å¯ä»¥åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šç»§ç»­è¿è¡Œçš„ï¼Œåªæ˜¯ä¸åŒé€šè¿‡Swarmç®¡ç†å™¨è¿›è¡Œç®¡ç†ï¼Œç›´åˆ°Swarmç®¡ç†æ¢å¤å·¥ä½œã€‚\næ€»ç»“ é€šè¿‡Docker Daemonçš„ live-restore ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œæ— å®ˆæŠ¤è¿›ç¨‹ï¼ˆdaemonlessï¼‰çš„å®¹å™¨ï¼Œè¿™å¯ä»¥å‡å°å®¹å™¨åº”ç”¨åœ¨å¯¹Docker Daemonè¿›è¡Œç»´æŠ¤æ—¶å€™çš„åœæœºæ—¶é—´ï¼Œä¸è¿‡åœ¨ä½¿ç”¨æ—¶ä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œä¾‹å¦‚å¯¹äºå‡çº§å¼•æ“ç‰ˆæœ¬çš„é™åˆ¶ã€‚å¦‚æœå…³æ³¨æ— å®ˆæŠ¤è¿›ç¨‹çš„å®¹å™¨ï¼Œå¯ä»¥è¿›ä¸€æ­¥äº†è§£ Podman ã€‚\nä»¥ä¸Šå†…å®¹å¤§éƒ¨åˆ†æ¥è‡ªDockerçš„å®˜æ–¹æ–‡æ¡£ï¼Œæ›´è¯¦ç»†çš„ä¿¡æ¯è¯·å‚è€ƒ ã€‚\n","date":"December 19, 2021","hero":"/zh/posts/container-tech/docker-live-restore/docker-banner.png","permalink":"/zh/posts/container-tech/docker-live-restore/","summary":"æˆ‘ä»¬éƒ½çŸ¥é“Dockeræ˜¯C/Sæ¨¡å¼æ¶æ„ï¼Œé€šè¿‡å®¢æˆ·ç«¯ï¼ˆCLIï¼‰è®¿é—®Docker Daemonæ¥åˆ›å»ºå’Œç®¡ç†å®¹å™¨çš„ã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“daemonç»ˆæ­¢çš„æ—¶å€™ï¼Œä¼šåœæ­¢æ‰€æœ‰è¿è¡Œçš„å®¹å™¨ã€‚\nå› æ­¤æˆ‘ä»¬éœ€è¦å¯¹Docker Daemonè¿›è¡Œå‡çº§æˆ–è€…æŸäº›éœ€è¦é‡å¯çš„ç»´æŠ¤æ“ä½œæ—¶ï¼Œéƒ½éœ€è¦å¯¼è‡´è¿è¡Œç€çš„å®¹å™¨è·Ÿç€é‡æ–°å¯åŠ¨ã€‚\nLive Restore å…¶å®ï¼ŒDockeræä¾›äº†ä¸€ä¸ªç‰¹æ€§ï¼Œå¯ä»¥ä½¿å¾—åœ¨Daemonä¸å¯ç”¨çš„æ—¶å€™ï¼Œä¿æŒå®¹å™¨ç»§ç»­è¿è¡Œï¼Œè¿™æ ·å°±å‡å°‘äº†åœ¨Daemonè¿›è¡Œå‡çº§æˆ–è€…å‡ºç°é—®é¢˜çš„æ—¶å€™å®¹å™¨çš„åœæœºæ—¶é—´ã€‚é‚£è¿™ä¸ªç‰¹æ€§å°±å«åšLive Restore ã€‚\né€šè¿‡ä¸ºDocker Daemonå¢åŠ ä»¥ä¸‹é…ç½®æ¥å¼€å¯Live Restoreç‰¹æ€§ã€‚åœ¨Linuxä¸Šï¼Œé»˜è®¤çš„é…ç½®æ–‡ä»¶ /etc/docker/daemon.json é‡Œæ·»åŠ \n{ \u0026#34;live-restore\u0026#34;: true } ç„¶åé‡å¯dockeræœåŠ¡ã€‚å¦‚æœä½¿ç”¨systemdç®¡ç†æœåŠ¡ï¼Œå¯ä»¥é€šè¿‡reloadæ¥é¿å…é‡å¯dockeræœåŠ¡\nsudo systemctl reload docker.service å…¶ä»–æƒ…å†µä¸‹ï¼Œå¯ä»¥å‘é€ SIGHUP ä¿¡å·ç»™dockerdè¿›ç¨‹ã€‚\nå¯¹äºWindowså’ŒMacOSä¸Šçš„Docker Desktopï¼Œå¯ä»¥é€šè¿‡DesktopèŠ‚ç›®çš„Daemoné«˜çº§é…ç½®æ¥å¼€å¯Live Restoreã€‚\né…ç½®å®Œæˆåï¼Œå¯ä»¥å°è¯•é‡å¯Docker Daemonæ¥æŸ¥çœ‹å®¹å™¨æ˜¯å¦ä¼šä¿æŒç»§ç»­è¿è¡Œã€‚é‡å¯ä¹‹å‰æŸ¥çœ‹å®¹å™¨çš„å¯åŠ¨æ—¶é—´\nîƒ„ WSL - ïŒ› î‚° mengz î‚° docker container inspect portainer_edge_agent -f \u0026#39;{{ .State.StartedAt }}\u0026#39; 2021-12-18T09:50:59.761725785Z ç„¶åæ‰§è¡Œ sudo systemctl restart docker.serviceï¼Œåœ¨æŸ¥è¯¢ä¸€æ¬¡å®¹å™¨çš„å¯åŠ¨æ—¶é—´ï¼Œå°†å‘ç°å¯åŠ¨æ—¶é—´æœªå‘ç”Ÿå˜åŒ–ï¼Œè¿™è¯´æ˜äº†å®¹å™¨å¹¶æ²¡æœ‰é‡å¯ã€‚\nLive Restoreçš„é™åˆ¶ å½“å‰çš„Live Restoreç‰¹æ€§å¯ä»¥åœ¨è¿›è¡ŒDaemonç»´æŠ¤ï¼Œæˆ–è€…åœ¨Daemonå‘ç”Ÿé—®é¢˜å¯¼è‡´ä¸å¯ç”¨çš„æƒ…å†µï¼Œå‡å°‘å®¹å™¨çš„åœæœºæ—¶é—´ï¼Œä¸è¿‡å…¶ä¹Ÿæœ‰ä¸€å®šçš„é™åˆ¶ã€‚\nDockerç‰ˆæœ¬å‡çº§é™åˆ¶ Live Restoreä»…æ”¯æŒDockerè¡¥ä¸ç‰ˆæœ¬å‡çº§æ—¶å¯ç”¨ï¼Œä¹Ÿå°±æ˜¯ YY.MM.x æœ€åä¸€ä½å‘ç”Ÿå˜åŒ–çš„å‡çº§ï¼Œè€Œä¸æ”¯æŒå¤§ç‰ˆæœ¬çš„å‡çº§ã€‚åœ¨è¿›è¡Œå¤§ç‰ˆæœ¬å‡çº§åï¼Œå¯èƒ½ä¼šå¯¼è‡´Daemonæ— æ³•é‡æ–°è¿æ¥åˆ°è¿è¡Œä¸­å®¹å™¨çš„é—®é¢˜ï¼Œè¿™æ—¶å€™éœ€è¦æ‰‹åŠ¨åœæ­¢è¿è¡Œçš„å®¹å™¨ã€‚\nDaemoné€‰é¡¹å˜æ›´ ä¹Ÿå°±æ˜¯è¯´Live Restoreä»…ä»…åœ¨æŸäº›Daemonçº§åˆ«çš„é…ç½®é€‰é¡¹ä¸å‘ç”Ÿæ”¹å˜çš„æƒ…å†µå·¥ä½œï¼Œä¾‹å¦‚Bridgeçš„IPåœ°å€ï¼Œå­˜å‚¨é©±åŠ¨ç±»å‹ç­‰ã€‚å¦‚æœåœ¨é‡å¯Daemonæ—¶å€™ï¼Œè¿™äº›é€‰é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼Œåˆ™å¯èƒ½ä¼šåˆ°Daemonæ— æ³•é‡æ–°è¿æ¥è¿è¡Œä¸­çš„å®¹å™¨ï¼Œè¿™æ—¶ä¹Ÿéœ€è¦æ‰‹åŠ¨åœæ­¢è¿™äº›å®¹å™¨ã€‚\nå½±å“å®¹å™¨çš„æ—¥å¿—è¾“å‡º å¦‚æœDaemoné•¿æ—¶é—´åœæ­¢ï¼Œä¼šå½±å“è¿è¡Œå®¹å™¨çš„æ—¥å¿—è¾“å‡ºã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ç®¡é“çš„ç¼“å†²åŒºå¤§å°ä¸º64kï¼Œå½“ç¼“å†²å†™æ»¡ä¹‹åï¼Œå¿…é¡»å¯åŠ¨Daemonæ¥åˆ·æ–°ç¼“å†²åŒºã€‚\nä¸æ”¯æŒDocker Swarm Live Restoreåªæ˜¯ç‹¬ç«‹Dockerå¼•æ“çš„ç‰¹æ€§ï¼Œè€ŒSwarmçš„æœåŠ¡æ˜¯ç”±Swarmç®¡ç†å™¨ç®¡ç†çš„ã€‚å½“Swarmç®¡ç†å™¨ä¸å¯ç”¨æ—¶ï¼ŒSwarmæœåŠ¡æ˜¯å¯ä»¥åœ¨å·¥ä½œèŠ‚ç‚¹ä¸Šç»§ç»­è¿è¡Œçš„ï¼Œåªæ˜¯ä¸åŒé€šè¿‡Swarmç®¡ç†å™¨è¿›è¡Œç®¡ç†ï¼Œç›´åˆ°Swarmç®¡ç†æ¢å¤å·¥ä½œã€‚","tags":["docker"],"title":"DOCKER LIVERESTOREç‰¹æ€§"},{"categories":["Linux"],"contents":"æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„locateæ–‡ä»¶æŸ¥æ‰¾å‘½ä»¤ï¼Œéœ€è¦ä¾èµ–updatedbæ›´æ–°ç´¢å¼•æ‰èƒ½å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦å®šæ—¶è¿è¡Œè¯¥å‘½ä»¤æ¥æ›´æ–°æ–‡ä»¶ç´¢å¼•ã€‚æˆ‘ä»¬çŸ¥é“åœ¨Linuxå’Œç±»Unixç³»ç»Ÿä¸Šé€šå¸¸ä½¿ç”¨crontabæ¥åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚\nåœ¨Ubuntuä¸Šæˆ‘ä»¬ä½¿ç”¨apt install mlocateä¹‹åï¼Œä¼šå®‰è£…ä¸€ä¸ªè„šæœ¬æ–‡ä»¶åˆ° /etc/cron.daily/mlocateï¼Œä¹Ÿå°±æ˜¯é€šè¿‡Cronæœºåˆ¶æ¥æ¯å¤©æ‰§è¡Œupdatedbã€‚ç„¶è€Œåœ¨æˆ‘çš„openSUSEä¸Šå´å¹¶æœªå‘ç°æœ‰ç›¸å…³çš„Crontabé…ç½®ï¼Œä½†æˆ‘å‘ç°ç´¢å¼•æ–‡ä»¶è¿˜æ˜¯åœ¨æ¯å¤©çš„é›¶ç‚¹è¿›è¡Œäº†æ›´æ–°ï¼Œé‚£è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ˜¯è°æ¥æ‰§è¡Œçš„å‘¢ï¼Ÿ\næˆ‘é€šè¿‡æŸ¥æ‰¾ä¸mlocateç›¸å…³çš„æ–‡ä»¶ï¼Œå‘ç°äº†ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š\nâ¯ locate \u0026#34;mlocate\u0026#34; /etc/systemd/system/timers.target.wants/mlocate.timer /usr/lib/systemd/system/mlocate.service /usr/lib/systemd/system/mlocate.timer åŸæ¥åœ¨openSUSEç³»ç»Ÿä¸Šï¼Œä½¿ç”¨çš„æ˜¯Systemdçš„å®šæ—¶å•å…ƒæ¥å®ç°çš„ã€‚Systemdæ˜¯ä¸€ç§Linuxç³»ç»ŸæœåŠ¡ç®¡ç†ç¨‹åºï¼Œåœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« åœ¨OPENSUSEä¸Šä½¿ç”¨SYSTEMCTLç®¡ç†ç³»ç»ŸæœåŠ¡ä¸­ä»‹ç»è¿‡ã€‚\né‚£è¿™é‡Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»ä¸‹Systemdçš„å®šæ—¶æœåŠ¡ï¼ˆsystemd timer unitï¼‰ã€‚\nsystemdå®šæ—¶å•å…ƒ ç±»ä¼¼ä¸Cronï¼Œsystemdçš„å®šæ—¶å•å…ƒåœ¨Linuxç³»ç»Ÿä¸Šæä¾›äº†æœºåˆ¶æ¥è°ƒåº¦ä»»åŠ¡ï¼Œç›¸æ¯”äºCronæœºåˆ¶ï¼Œå…¶ä»–å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼ˆåœ¨ä½¿ç”¨systemdä½œä¸ºåˆå§‹åŒ–å’ŒæœåŠ¡ç®¡ç†çš„ç³»ç»Ÿä¸Šï¼‰ï¼š\nè°ƒåº¦çš„ä»»åŠ¡å¯ä»¥ä¾èµ–äºå…¶ä»–systemdæœåŠ¡ å¯ä»¥ä½¿ç”¨systemctlå‘½ä»¤æ¥ç®¡ç†å®šæ—¶å•å…ƒï¼Œç±»ä¼¼ä¸ç®¡ç†systemdæœåŠ¡ é™¤äº†ç±»ä¼¼Cronçš„å¾ªç¯å®æ—¶å®šæ—¶ä»»åŠ¡ï¼ˆrealtimeï¼‰ä¹‹å¤–ï¼Œè¿˜æ”¯æŒä¸€ç§åŸºäºéæ—¶é—´äº‹ä»¶è§¦å‘çš„ä»»åŠ¡ï¼ˆmonotonicï¼‰ å®šæ—¶å•å…ƒè®°å½•æ—¥å¿—åˆ°systemdçš„æ—¥å¿—ç³»ç»Ÿï¼ˆjournalï¼‰ï¼Œå› æ­¤æ–¹ä¾¿äºç»Ÿä¸€ç›‘æ§å’Œè¯Šæ–­ systemdå®šæ—¶ä»»åŠ¡çš„ç±»å‹ ä¸Šé¢çš„ç‰¹æ€§ä¸­ï¼Œæˆ‘ä»¬æåˆ°å…¶æ”¯æŒä¸¤ç§ç±»å‹ - realtime å’Œ monotonic\nRealtime - ç±»ä¼¼äºCronï¼Œè¿™ç§ç±»å‹çš„å®šæ—¶ä»»åŠ¡ç”±å®šä¹‰çš„ç»å¯¹æ—¶é—´æ¥è§¦å‘ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ OnCalendar é€‰é¡¹æ¥å®šä¹‰ Monotonic - è¿™ç§ç±»å‹çš„å®šæ—¶ä»»åŠ¡å°†ä¼šåœ¨æŒ‡å®šçš„äº‹ä»¶ï¼ˆä¾‹å¦‚ç³»ç»Ÿå¯åŠ¨ï¼ŒæœåŠ¡æ¿€æ´»ï¼‰ä¸€å®šæ—¶é—´åè§¦å‘ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ OnBootSec å’Œ OnUnitActiveSec ï¼ŒOnStartupSec ç­‰é€‰é¡¹æ¥å®šä¹‰ï¼Œå¹¶ä¸”è¯¥ç±»å‹çš„å®šæ—¶ä»»åŠ¡è§¦å‘æ—¶é—´ä¸æ˜¯å›ºå®šçš„ï¼Œåœ¨æ¯ä¸€æ¬¡ç³»ç»Ÿé‡å¯ä¹‹åéƒ½ä¼šè¢«é‡ç½® systemdå®šæ—¶ä»»åŠ¡çš„é…ç½® åœ¨æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä»¬åœ¨å¯»æ‰¾mlocateæ›´æ–°æ–‡ä»¶ç´¢å¼•çš„å®šæ—¶ä»»åŠ¡æ—¶çœ‹åˆ°ï¼Œæœ‰æ–‡ä»¶ /usr/lib/systemd/system/mlocate.timer ï¼Œæ²¡é”™ï¼Œå°±æ˜¯é€šè¿‡ä»¥ .timer ä½œä¸ºæ‰©å±•åçš„systemdå•å…ƒæ–‡ä»¶æ¥å®šä¹‰systemdçš„å®šæ—¶å•å…ƒçš„\n[Unit] Description=Daily locate database update Documentation=man:updatedb [Timer] OnCalendar=daily AccuracySec=12h Unit=mlocate.service Persistent=true [Install] WantedBy=timers.target å¯ä»¥çœ‹åˆ°æ–‡ä»¶æ ¼å¼ä¸systemdæœåŠ¡çš„å•å…ƒæ–‡ä»¶ç±»ä¼¼ï¼Œä¸è¿‡éœ€è¦ [Timer] æ®µï¼Œåœ¨è¯¥æ®µå®šä¹‰äº†å¦‚ä¸‹é€‰é¡¹\nOnCalendar=dailyï¼Œæ„æ€æ˜¯æ¯å¤©è§¦å‘ AccuracySec=12hï¼Œæ„æ€æ˜¯ç”±äºæŸäº›åŸå› éœ€è¦æ¨æµ‹æ‰§è¡Œçš„æ—¶é—´ Unit=mlocate.serviceï¼Œè¿™é‡Œå°±æ˜¯æŒ‡å®šäº†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æœåŠ¡ Persistent=trueï¼ŒæŒ‡å®šå¦‚æœç”±äºå…³æœºç­‰åŸå› åˆ°æ—¶äº†ä¸ºèƒ½æ‰§è¡Œä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¼šç«‹å³è§¦å‘è¯¥ä»»åŠ¡ é‚£è¯¥å®šæ—¶å•å…ƒæŒ‡å®šäº† mlocate.service ä½œä¸ºè§¦å‘æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ /usr/lib/systemd/system/mlocate.service é‡Œå®šä¹‰çš„æœåŠ¡ï¼Œé‚£æœåŠ¡é‡Œå°±æ˜¯å®šä¹‰ä½¿ç”¨ updatedb å‘½ä»¤å»æ›´æ–°æ–‡ä»¶ç´¢å¼•ã€‚\nå¯¹äº OnCalendar ï¼Œå…¶å€¼æ”¯æŒçš„æ ¼å¼ä¸º DayOfWeek Year-Month-Day Hour:Minute:Secondï¼Œä¾‹å¦‚\nOnCalendar=--* 5:00:00ï¼ŒæŒ‡å®šåœ¨æ¯å¤©æ—©ä¸Šçš„5ç‚¹æ‰§è¡Œ OnCalendar=Fri 18:00:00ï¼ŒæŒ‡å®šåœ¨æ¯ä¸ªæœˆçš„å‘¨äº”ä¸‹åˆ6ç‚¹æ‰§è¡Œ åœ¨ä¸€ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œè¿˜å¯ä»¥æŒ‡å®šå¤šä¸ª OnCalendar ï¼Œä¾‹å¦‚\nOnCalendar=Mon..Fri 10:00 OnCalendar=Sat,Sun 22:00 ä¸Šé¢çš„é…ç½®å°±æŒ‡å®šäº†åœ¨å‘¨ä¸€åˆ°å‘¨äº”çš„æ¯å¤©ä¸Šåˆ10ç‚¹ï¼Œä»¥åŠåœ¨å‘¨æœ«ä¸¤å¤©çš„æ™šä¸Š10ç‚¹æ‰§è¡Œã€‚\nä¸‹é¢æˆ‘ä»¬æ¥ä¸¾ä¸€ä¸ªä½¿ç”¨monotonicç±»å‹å®šæ—¶ä»»åŠ¡çš„ä¾‹å­ï¼Œåœ¨ç›®å½• /etc/systemd/system/ ä¸‹æœåŠ¡å•å…ƒæ–‡ä»¶ foo.service\n[Unit] Description=\u0026#34;Foo shell script\u0026#34; [Service] ExecStart=/usr/local/bin/foo.sh åŒæ—¶åˆ›å»ºä¸€ä¸ªå®šæ—¶å•å…ƒæ–‡ä»¶ foo.timer\n[Unit] Description=\u0026#34;Run foo shell script\u0026#34; [Timer] OnBootSec=5min OnUnitActiveSec=24h Unit=foo.service [Install] WantedBy=multi-user.target è¿™é‡Œæˆ‘ä»¬çœ‹åˆ°åœ¨ [Timer] æ®µï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸‹é€‰é¡¹\nOnBootSec=5minï¼ŒæŒ‡å®šäº†åœ¨ç³»ç»Ÿå¯åŠ¨5åˆ†é’Ÿåè§¦å‘æŒ‡å®šæœåŠ¡çš„æ‰§è¡Œ OnUnitActiveSec=24hï¼ŒæŒ‡å®šäº†åœ¨æœåŠ¡åœ¨æ¿€æ´»ä¹‹åçš„24å°æ—¶æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ¯å¤©éƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ï¼ˆä½†æ˜¯æ‰§è¡Œçš„å…·ä½“æ—¶é—´å–å†³äºå¼€æœºæ—¶é—´ï¼‰ Unit=foo.serviceï¼ŒæŒ‡å®šäº†è§¦å‘çš„ä»»åŠ¡æ˜¯æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„fooæœåŠ¡ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œ foo.sh è„šæœ¬ ç®¡ç†timerå•å…ƒ ä¸Šé¢çš„ç‰¹æ€§ä¸­ï¼Œæˆ‘ä»¬è¯´é“timerå•å…ƒå¯ä»¥é€šè¿‡ systemctl å‘½ä»¤è¿›è¡Œç®¡ç†ï¼Œç±»ä¼¼ç®¡ç†æœåŠ¡å•å…ƒ\nsudo systemctl start foo.timer ï¼Œå¯åŠ¨æŒ‡å®šçš„å®šæ—¶å•å…ƒ sudo systemctl enable foo.timer ï¼Œå¼€å¯å®šæ—¶å•å…ƒè‡ªåŠ¨æ¿€æ´»ï¼ˆå¼€æœºè‡ªå¯ï¼‰ sudo systemctl list-timers ï¼Œåˆ—å‡ºå½“å‰ç³»ç»Ÿå·²æ¿€æ´»çš„å®šæ—¶å•å…ƒ ä¾‹å¦‚\nâ¯ sudo systemctl list-timers NEXT LEFT LAST PASSED UNIT ACTIVATES Fri 2021-12-03 17:00:00 CST 22min left Fri 2021-12-03 16:00:03 CST 37min ago snapper-timeline.timer snapper-timeline.service Sat 2021-12-04 00:00:00 CST 7h left Fri 2021-12-03 00:00:03 CST 16h ago logrotate.timer logrotate.service Sat 2021-12-04 00:00:00 CST 7h left Fri 2021-12-03 00:00:03 CST 16h ago mandb.timer mandb.service Sat 2021-12-04 00:00:00 CST 7h left Fri 2021-12-03 00:00:03 CST 16h ago mlocate.timer mlocate.service æˆ‘ä»¬è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨ journalctl æ¥æŸ¥çœ‹ç›¸å…³æ—¥å¿—ï¼Œä¾‹å¦‚\nâ¯ sudo journalctl -u mlocate -- Logs begin at Thu 2021-12-02 06:58:59 CST, end at Fri 2021-12-03 16:41:26 CST. -- Dec 03 00:00:03 linux-dev systemd[1]: Starting Update locate database... Dec 03 00:00:03 linux-dev su[864]: (to nobody) root on none Dec 03 00:00:06 linux-dev systemd[1]: Started Update locate database. åŒæ—¶æŸ¥çœ‹mlocateå®šæ—¶å•å…ƒå’ŒæœåŠ¡çš„æ—¥å¿—ã€‚\nå…³äºæ›´å¤šçš„é…ç½®ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ ã€‚\næ€»ç»“ å¦‚æœä½ çš„ç³»ç»Ÿä½¿ç”¨çš„Systemdä½œä¸ºåˆå§‹åŒ–å’ŒæœåŠ¡ç®¡ç†ç³»ç»Ÿï¼Œå¹¶ä¸”æƒ³ä½¿ç”¨åˆ°æˆ‘ä»¬ä¹‹å‰æåˆ°çš„ç‰¹æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨systemdçš„timerå•å…ƒæ¥å®šä¹‰æˆ‘ä»¬çš„å®šæ—¶ä»»åŠ¡ã€‚å½“ç„¶å¤§éƒ¨åˆ†ç³»ç»Ÿè¿˜æ˜¯æ”¯æŒCrontabæœºåˆ¶çš„å®šæ—¶ä»»åŠ¡ã€‚\n","date":"December 3, 2021","hero":"/zh/posts/linux/systemd-timer/systemd.webp","permalink":"/zh/posts/linux/systemd-timer/","summary":"æˆ‘ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»çš„locateæ–‡ä»¶æŸ¥æ‰¾å‘½ä»¤ï¼Œéœ€è¦ä¾èµ–updatedbæ›´æ–°ç´¢å¼•æ‰èƒ½å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶ï¼Œå› æ­¤éœ€è¦å®šæ—¶è¿è¡Œè¯¥å‘½ä»¤æ¥æ›´æ–°æ–‡ä»¶ç´¢å¼•ã€‚æˆ‘ä»¬çŸ¥é“åœ¨Linuxå’Œç±»Unixç³»ç»Ÿä¸Šé€šå¸¸ä½¿ç”¨crontabæ¥åˆ›å»ºå®šæ—¶ä»»åŠ¡ã€‚\nåœ¨Ubuntuä¸Šæˆ‘ä»¬ä½¿ç”¨apt install mlocateä¹‹åï¼Œä¼šå®‰è£…ä¸€ä¸ªè„šæœ¬æ–‡ä»¶åˆ° /etc/cron.daily/mlocateï¼Œä¹Ÿå°±æ˜¯é€šè¿‡Cronæœºåˆ¶æ¥æ¯å¤©æ‰§è¡Œupdatedbã€‚ç„¶è€Œåœ¨æˆ‘çš„openSUSEä¸Šå´å¹¶æœªå‘ç°æœ‰ç›¸å…³çš„Crontabé…ç½®ï¼Œä½†æˆ‘å‘ç°ç´¢å¼•æ–‡ä»¶è¿˜æ˜¯åœ¨æ¯å¤©çš„é›¶ç‚¹è¿›è¡Œäº†æ›´æ–°ï¼Œé‚£è¿™ä¸ªå®šæ—¶ä»»åŠ¡æ˜¯è°æ¥æ‰§è¡Œçš„å‘¢ï¼Ÿ\næˆ‘é€šè¿‡æŸ¥æ‰¾ä¸mlocateç›¸å…³çš„æ–‡ä»¶ï¼Œå‘ç°äº†ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶ï¼š\nâ¯ locate \u0026#34;mlocate\u0026#34; /etc/systemd/system/timers.target.wants/mlocate.timer /usr/lib/systemd/system/mlocate.service /usr/lib/systemd/system/mlocate.timer åŸæ¥åœ¨openSUSEç³»ç»Ÿä¸Šï¼Œä½¿ç”¨çš„æ˜¯Systemdçš„å®šæ—¶å•å…ƒæ¥å®ç°çš„ã€‚Systemdæ˜¯ä¸€ç§Linuxç³»ç»ŸæœåŠ¡ç®¡ç†ç¨‹åºï¼Œåœ¨æˆ‘ä¹‹å‰çš„æ–‡ç« åœ¨OPENSUSEä¸Šä½¿ç”¨SYSTEMCTLç®¡ç†ç³»ç»ŸæœåŠ¡ä¸­ä»‹ç»è¿‡ã€‚\né‚£è¿™é‡Œæˆ‘ä»¬å°†é‡ç‚¹ä»‹ç»ä¸‹Systemdçš„å®šæ—¶æœåŠ¡ï¼ˆsystemd timer unitï¼‰ã€‚\nsystemdå®šæ—¶å•å…ƒ ç±»ä¼¼ä¸Cronï¼Œsystemdçš„å®šæ—¶å•å…ƒåœ¨Linuxç³»ç»Ÿä¸Šæä¾›äº†æœºåˆ¶æ¥è°ƒåº¦ä»»åŠ¡ï¼Œç›¸æ¯”äºCronæœºåˆ¶ï¼Œå…¶ä»–å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼ˆåœ¨ä½¿ç”¨systemdä½œä¸ºåˆå§‹åŒ–å’ŒæœåŠ¡ç®¡ç†çš„ç³»ç»Ÿä¸Šï¼‰ï¼š\nè°ƒåº¦çš„ä»»åŠ¡å¯ä»¥ä¾èµ–äºå…¶ä»–systemdæœåŠ¡ å¯ä»¥ä½¿ç”¨systemctlå‘½ä»¤æ¥ç®¡ç†å®šæ—¶å•å…ƒï¼Œç±»ä¼¼ä¸ç®¡ç†systemdæœåŠ¡ é™¤äº†ç±»ä¼¼Cronçš„å¾ªç¯å®æ—¶å®šæ—¶ä»»åŠ¡ï¼ˆrealtimeï¼‰ä¹‹å¤–ï¼Œè¿˜æ”¯æŒä¸€ç§åŸºäºéæ—¶é—´äº‹ä»¶è§¦å‘çš„ä»»åŠ¡ï¼ˆmonotonicï¼‰ å®šæ—¶å•å…ƒè®°å½•æ—¥å¿—åˆ°systemdçš„æ—¥å¿—ç³»ç»Ÿï¼ˆjournalï¼‰ï¼Œå› æ­¤æ–¹ä¾¿äºç»Ÿä¸€ç›‘æ§å’Œè¯Šæ–­ systemdå®šæ—¶ä»»åŠ¡çš„ç±»å‹ ä¸Šé¢çš„ç‰¹æ€§ä¸­ï¼Œæˆ‘ä»¬æåˆ°å…¶æ”¯æŒä¸¤ç§ç±»å‹ - realtime å’Œ monotonic\nRealtime - ç±»ä¼¼äºCronï¼Œè¿™ç§ç±»å‹çš„å®šæ—¶ä»»åŠ¡ç”±å®šä¹‰çš„ç»å¯¹æ—¶é—´æ¥è§¦å‘ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ OnCalendar é€‰é¡¹æ¥å®šä¹‰ Monotonic - è¿™ç§ç±»å‹çš„å®šæ—¶ä»»åŠ¡å°†ä¼šåœ¨æŒ‡å®šçš„äº‹ä»¶ï¼ˆä¾‹å¦‚ç³»ç»Ÿå¯åŠ¨ï¼ŒæœåŠ¡æ¿€æ´»ï¼‰ä¸€å®šæ—¶é—´åè§¦å‘ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é€šè¿‡ OnBootSec å’Œ OnUnitActiveSec ï¼ŒOnStartupSec ç­‰é€‰é¡¹æ¥å®šä¹‰ï¼Œå¹¶ä¸”è¯¥ç±»å‹çš„å®šæ—¶ä»»åŠ¡è§¦å‘æ—¶é—´ä¸æ˜¯å›ºå®šçš„ï¼Œåœ¨æ¯ä¸€æ¬¡ç³»ç»Ÿé‡å¯ä¹‹åéƒ½ä¼šè¢«é‡ç½® systemdå®šæ—¶ä»»åŠ¡çš„é…ç½® åœ¨æ–‡ç« å¼€å§‹ï¼Œæˆ‘ä»¬åœ¨å¯»æ‰¾mlocateæ›´æ–°æ–‡ä»¶ç´¢å¼•çš„å®šæ—¶ä»»åŠ¡æ—¶çœ‹åˆ°ï¼Œæœ‰æ–‡ä»¶ /usr/lib/systemd/system/mlocate.timer ï¼Œæ²¡é”™ï¼Œå°±æ˜¯é€šè¿‡ä»¥ .timer ä½œä¸ºæ‰©å±•åçš„systemdå•å…ƒæ–‡ä»¶æ¥å®šä¹‰systemdçš„å®šæ—¶å•å…ƒçš„\n[Unit] Description=Daily locate database update Documentation=man:updatedb [Timer] OnCalendar=daily AccuracySec=12h Unit=mlocate.service Persistent=true [Install] WantedBy=timers.target å¯ä»¥çœ‹åˆ°æ–‡ä»¶æ ¼å¼ä¸systemdæœåŠ¡çš„å•å…ƒæ–‡ä»¶ç±»ä¼¼ï¼Œä¸è¿‡éœ€è¦ [Timer] æ®µï¼Œåœ¨è¯¥æ®µå®šä¹‰äº†å¦‚ä¸‹é€‰é¡¹\nOnCalendar=dailyï¼Œæ„æ€æ˜¯æ¯å¤©è§¦å‘ AccuracySec=12hï¼Œæ„æ€æ˜¯ç”±äºæŸäº›åŸå› éœ€è¦æ¨æµ‹æ‰§è¡Œçš„æ—¶é—´ Unit=mlocate.serviceï¼Œè¿™é‡Œå°±æ˜¯æŒ‡å®šäº†éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡æœåŠ¡ Persistent=trueï¼ŒæŒ‡å®šå¦‚æœç”±äºå…³æœºç­‰åŸå› åˆ°æ—¶äº†ä¸ºèƒ½æ‰§è¡Œä»»åŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨ä¼šç«‹å³è§¦å‘è¯¥ä»»åŠ¡ é‚£è¯¥å®šæ—¶å•å…ƒæŒ‡å®šäº† mlocate.service ä½œä¸ºè§¦å‘æ‰§è¡Œçš„ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯ /usr/lib/systemd/system/mlocate.","tags":["systemd","crontab"],"title":"SYSTEMDå®šæ—¶æœåŠ¡"},{"categories":["OpenTool"],"contents":"ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨Linuxæˆ–è€…ç±»Unixçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæƒ³é€šè¿‡æ–‡ä»¶åå…³é”®å­—æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡findå‘½ä»¤ã€‚é‚£æœ¬æ–‡å°†æ¨è2æ¬¾å¯ä»¥å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶çš„å·¥å…·ï¼Œæ€§èƒ½æ¯”findå‘½ä»¤æ›´å¥½ï¼Œå¯åœ¨æŸäº›åœºæ™¯ä¸‹æ›¿æ¢findçš„ä½¿ç”¨ã€‚\nmlocate å¤§éƒ¨åˆ†çš„Linuxå‘è¡Œç‰ˆçš„éƒ½æä¾›äº† mlocate è½¯ä»¶åŒ…ï¼Œè¯¥è½¯ä»¶åŒ…åŒ…å«äº†ä¸€ä¸ªlocateå‘½ä»¤ç”¨äºæŸ¥æ‰¾æ–‡ä»¶ï¼Œå’Œä¸€ä¸ªupdatedbå‘½ä»¤ç”¨äºæ›´æ–°æ–‡ä»¶ç´¢å¼•ä¾›locateä½¿ç”¨ã€‚\nå¯ç›´æ¥é€šè¿‡ç³»ç»Ÿçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ç›´æ¥å®‰è£…\n# CentOS/RHEL $ sudo dnf install mlocate # Debian/Ubuntu $ sudo apt install mlocate å®‰è£…å®Œæˆåï¼Œé¦–å…ˆéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ–‡ä»¶ç´¢å¼•\nsudo updatedb ç´¢å¼•æ–‡ä»¶å°†é»˜è®¤å­˜æ”¾åœ¨ /var/lib/mlocate/mlocatedb ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/updatedb.conf æ–‡ä»¶ï¼Œæ·»åŠ æŸäº›ä¸éœ€è¦ç´¢å¼•çš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚\n# Paths which are pruned from updatedb database PRUNEPATHS=\u0026#34;/tmp /var/tmp /var/cache /var/lock /var/run /var/spool /mnt /cdrom /usr/tmp /proc /media /sys /.snapshots /var/run/media\u0026#34; å®Œæˆç´¢å¼•ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ locate å‘½ä»¤è¿›è¡Œæ–‡ä»¶æŸ¥æ‰¾äº†ï¼Œä¾‹å¦‚\n$ locate mlocate /etc/systemd/system/timers.target.wants/mlocate.timer /usr/bin/rpmlocate /usr/lib/systemd/system/mlocate.service /usr/lib/systemd/system/mlocate.timer /usr/sbin/rcmlocate /usr/share/doc/packages/mlocate /usr/share/doc/packages/mlocate/AUTHORS /usr/share/doc/packages/mlocate/ChangeLog /usr/share/doc/packages/mlocate/NEWS /usr/share/doc/packages/mlocate/README /usr/share/licenses/mlocate /usr/share/licenses/mlocate/COPYING /usr/share/man/man5/mlocate.db.5.gz /var/lib/mlocate /var/lib/mlocate/mlocate.db /var/lib/mlocate/mlocate.db.9O5YsQ /var/lib/systemd/migrated/mlocate /var/lib/systemd/timers/stamp-mlocate.timer å¯ä»¥ä½¿ç”¨ -b é€‰é¡¹è¿›è¡Œç²¾ç¡®åŒ¹é…ï¼Œä¾‹å¦‚ä¸‹é¢ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœåŒºåˆ«\n$ locate -b \u0026#39;\\updatedb\u0026#39; /usr/bin/updatedb æ³¨æ„ä½¿ç”¨ -b æ—¶ï¼Œéœ€è¦åœ¨æœç´¢çš„å…³é”®è‡ªå‰ä½¿ç”¨ \\ ã€‚\n$ locate \u0026#39;updatedb\u0026#39; /etc/updatedb.conf /etc/apparmor.d/usr.bin.updatedb /usr/bin/updatedb /usr/share/augeas/lenses/dist/updatedb.aug /usr/share/man/man5/updatedb.conf.5.gz /usr/share/man/man8/updatedb.8.gz /usr/share/nvim/runtime/ftplugin/updatedb.vim /usr/share/nvim/runtime/syntax/updatedb.vim /usr/share/vim/vim80/ftplugin/updatedb.vim /usr/share/vim/vim80/syntax/updatedb.vim è¿˜å¯ä»¥ä½¿ç”¨ -r è¿›è¡ŒåŸºæœ¬çš„æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼åŒ¹é…æŸ¥æ‰¾ï¼Œå¯ä»¥æŸ¥çœ‹ locate --help æˆ–è€… man locate ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»‹ç»å¦ä¸€æ¬¾findçš„æ›¿ä»£å¹³ - fd ã€‚\nfd fdæ˜¯ä¸€æ¬¾ç”±David Peterå¼€å‘çš„å¼€æºå·¥å…·ï¼Œç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸­æŸ¥æ‰¾æ–‡ä»¶ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹å¯ä»¥æ›¿æ¢findå‘½ä»¤ã€‚\nfdå¯ç”¨äºå¤šä¸ªå¹³å°ï¼ŒåŒ…æ‹¬å¤§éƒ¨åˆ†çš„Linuxå‘è¡Œç‰ˆï¼ŒMacOSï¼ŒWindowsï¼Œå…·ä½“å®‰è£…å¯æŸ¥çœ‹ https://github.com/sharkdp/fd#installation ã€‚\nä¾‹å¦‚å¯ä»¥ä½¿ç”¨ HomeBrew/LinuxBrew è¿›è¡Œå®‰è£…\n$ brew install fd å®‰è£…å®Œæˆåï¼Œå°±å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¾‹å¦‚æŸ¥æ‰¾å½“å‰æ–‡ä»¶å¤¹ä¸‹ä»¥ png ä¸ºæ‰©å±•åçš„æ–‡ä»¶\n$ fd -e png go/src/github.com/Go-zh/tour/static/img/gopher.png go/src/github.com/Go-zh/tour/content/img/tree.png go/src/github.com/containous/yaegi/doc/images/yaegi.png ... æ³¨æ„ï¼Œfdå‘½ä»¤é»˜è®¤çš„æœç´¢è·¯å¾„æ˜¯å½“å‰ç›®å½•ï¼Œå¯ä»¥ä½¿ç”¨ --base-directory æˆ–è€… --search-path æ¥æŒ‡å®šæœç´¢è·¯å¾„ï¼Œä¾‹å¦‚æˆ‘ä»¬æŸ¥æ‰¾ /etc/ ä¸‹ï¼ŒåŒ¹é… docker çš„å¸¸è§„æ–‡ä»¶\n$ fd --base-directory /etc/ -t f \u0026#39;docker\u0026#39; audit/rules.d/docker.rules bash_completion.d/docker-compose.bash sysconfig/docker è¿˜å¯ä»¥ä½¿ç”¨ -x é€‰é¡¹å°†ç»“æœè¾“å‡ºç»™å…¶ä»–å‘½ä»¤è¿›è¡Œæ“ä½œï¼ˆç±»ä¼¼findå‘½ä»¤çš„\u0026ndash;execé€‰é¡¹ï¼‰ï¼Œä¾‹å¦‚\n$ fd -d 1 -e png -x convert {} {.}.jpg è¿™å°†æŸ¥æ‰¾å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰PNGæ–‡ä»¶ï¼Œå¹¶è½¬æ¢ä¸ºJPGæ–‡ä»¶ã€‚ä¸Šé¢çš„å‘½ä»¤ä¸­ä½¿ç”¨åˆ°äº†å ä½ç¬¦ {} å’Œ {.} ï¼Œçœ‹å¦‚ä¸‹ç¤ºä¾‹å±•ç¤ºå ä½ç¬¦æ‰€ä»£è¡¨çš„ç»“æœ\nâ¯ fd \u0026#39;recognition.db\u0026#39; -x echo {} Pictures/recognition.db Pictures/Photos/recognition.db â¯ fd \u0026#39;recognition.db\u0026#39; -x echo {.} Pictures/Photos/recognition Pictures/recognition â¯ fd \u0026#39;recognition.db\u0026#39; -x echo {/} recognition.db recognition.db â¯ fd \u0026#39;recognition.db\u0026#39; -x echo {//} Pictures Pictures/Photos â¯ fd \u0026#39;recognition.db\u0026#39; -x echo {/.} recognition recognition é€šè¿‡å ä½ç¬¦ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿çš„å¯¹æ–‡ä»¶è¿›è¡Œç›¸å…³æ“ä½œã€‚æ›´å¤šçš„fdå‘½ä»¤é€‰é¡¹ï¼Œå¯ä»¥æŸ¥çœ‹ fd --help ã€‚\nå¦‚æœæƒ³åœ¨Windowsä¸Šä½¿ç”¨fdï¼Œå¯ä»¥é€šè¿‡ Scoop åŒ…ç®¡ç†å™¨å®‰è£…ï¼Œæ‰“å¼€PowerShell\n-\u0026gt; scoop install fd æ€»ç»“ è¿™é‡Œä»‹ç»äº†ä¸¤æ¬¾åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­é€šè¿‡æ–‡ä»¶ååŒ¹é…å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶çš„å·¥å…·ï¼Œmlocateä½¿ç”¨äº†ç´¢å¼•æ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨å…¨å±€æŸ¥æ‰¾æ–‡ä»¶æ—¶çš„æ•ˆç‡å¾ˆé«˜ã€‚è€Œfdå·¥å…·æä¾›äº†å¾ˆå¤šçš„åŠŸèƒ½ï¼Œåœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹å¯ä»£æ›¿findå‘½ä»¤æ¥ä½¿ç”¨ï¼Œè€Œæ€§èƒ½ä¹Ÿé«˜äºfindå‘½ä»¤ã€‚è¡¥å……ï¼Œfdå·¥å…·çš„å¼€å‘è€…é™¤äº†è¿™ä¸ªå·¥å…·å¤–ï¼Œè¿˜å¼€å‘äº†å…¶ä»–å¾ˆå®ç”¨çš„å·¥å…·ï¼Œä¾‹å¦‚bat - ä¸€ä¸ªå¯ä»¥ä»£æ›¿catå‘½ä»¤çš„å·¥å…·ï¼Œå…¶ä»–æ”¯æŒå¾ˆå¤šç¼–ç¨‹è¯­è¨€çš„è¯­æ³•é«˜äº®çš„å½¢å¼æ¥è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œä¹Ÿæ¨èä½¿ç”¨ã€‚\n","date":"December 3, 2021","hero":"/zh/posts/opentool/find-files/find-file.png","permalink":"/zh/posts/opentool/find-files/","summary":"ä¼—æ‰€å‘¨çŸ¥ï¼Œåœ¨Linuxæˆ–è€…ç±»Unixçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œæƒ³é€šè¿‡æ–‡ä»¶åå…³é”®å­—æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡findå‘½ä»¤ã€‚é‚£æœ¬æ–‡å°†æ¨è2æ¬¾å¯ä»¥å¿«é€ŸæŸ¥æ‰¾æ–‡ä»¶çš„å·¥å…·ï¼Œæ€§èƒ½æ¯”findå‘½ä»¤æ›´å¥½ï¼Œå¯åœ¨æŸäº›åœºæ™¯ä¸‹æ›¿æ¢findçš„ä½¿ç”¨ã€‚\nmlocate å¤§éƒ¨åˆ†çš„Linuxå‘è¡Œç‰ˆçš„éƒ½æä¾›äº† mlocate è½¯ä»¶åŒ…ï¼Œè¯¥è½¯ä»¶åŒ…åŒ…å«äº†ä¸€ä¸ªlocateå‘½ä»¤ç”¨äºæŸ¥æ‰¾æ–‡ä»¶ï¼Œå’Œä¸€ä¸ªupdatedbå‘½ä»¤ç”¨äºæ›´æ–°æ–‡ä»¶ç´¢å¼•ä¾›locateä½¿ç”¨ã€‚\nå¯ç›´æ¥é€šè¿‡ç³»ç»Ÿçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ç›´æ¥å®‰è£…\n# CentOS/RHEL $ sudo dnf install mlocate # Debian/Ubuntu $ sudo apt install mlocate å®‰è£…å®Œæˆåï¼Œé¦–å…ˆéœ€è¦æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œæ–‡ä»¶ç´¢å¼•\nsudo updatedb ç´¢å¼•æ–‡ä»¶å°†é»˜è®¤å­˜æ”¾åœ¨ /var/lib/mlocate/mlocatedb ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹é…ç½®æ–‡ä»¶ /etc/updatedb.conf æ–‡ä»¶ï¼Œæ·»åŠ æŸäº›ä¸éœ€è¦ç´¢å¼•çš„æ–‡ä»¶å¤¹ï¼Œä¾‹å¦‚\n# Paths which are pruned from updatedb database PRUNEPATHS=\u0026#34;/tmp /var/tmp /var/cache /var/lock /var/run /var/spool /mnt /cdrom /usr/tmp /proc /media /sys /.snapshots /var/run/media\u0026#34; å®Œæˆç´¢å¼•ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨ locate å‘½ä»¤è¿›è¡Œæ–‡ä»¶æŸ¥æ‰¾äº†ï¼Œä¾‹å¦‚\n$ locate mlocate /etc/systemd/system/timers.target.wants/mlocate.timer /usr/bin/rpmlocate /usr/lib/systemd/system/mlocate.service /usr/lib/systemd/system/mlocate.timer /usr/sbin/rcmlocate /usr/share/doc/packages/mlocate /usr/share/doc/packages/mlocate/AUTHORS /usr/share/doc/packages/mlocate/ChangeLog /usr/share/doc/packages/mlocate/NEWS /usr/share/doc/packages/mlocate/README /usr/share/licenses/mlocate /usr/share/licenses/mlocate/COPYING /usr/share/man/man5/mlocate.db.5.gz /var/lib/mlocate /var/lib/mlocate/mlocate.","tags":["linux","find"],"title":"æ–‡ä»¶ç³»ç»ŸæŸ¥æ‰¾å·¥å…·"},{"categories":["DEVOPS"],"contents":"ä¹‹å‰æˆ‘ä»¬é€šè¿‡ä¸€ç¯‡æ–‡ç« å…¥é—¨äº†ä½¿ç”¨Terrafromä»¥å£°æ˜å¼é…ç½®æ–‡ä»¶ï¼ˆå¯ç‰ˆæœ¬åŒ–çš„ä»£ç ï¼‰æ¥åˆ›å»ºå’Œç®¡ç†åŸºç¡€è®¾æ–½èµ„æºã€‚\nåœ¨ä½¿ç”¨å‘½ä»¤terraform applyä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨terraform planæ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œè¾“å‡ºçš„æ‰§è¡Œè®¡åˆ’ä»¥ç±»ä¼¼â€œgit diffâ€çš„æ–‡æœ¬æ–¹å¼æè¿°ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä»¥å›¾å½¢å¯æ˜¯åŒ–çš„æ–¹å¼æ¥äº†è§£æ‰§è¡Œè®¡åˆ’ã€‚\nTerrafrom Graph é¦–å…ˆTerraform CLIå·¥å…·è‡ªå¸¦äº†ä¸€ä¸ªå­å‘½ä»¤ - graphï¼Œgraphå‘½ä»¤ç”¨äºç”Ÿäº§é…ç½®å’Œæ‰§è¡Œè®¡åˆ’çš„å›¾å½¢è¡¨ç¤ºï¼Œå…¶è¾“å‡ºæ˜¯DOTæ ¼å¼ï¼Œå¯ä»¥é€šè¿‡Graphvizè½¬åŒ–ä¸ºå›¾ç‰‡ï¼Œä¾‹å¦‚åœ¨Linuxç»ˆç«¯ä¸‹\nâ¯ terraform graph | dot -Tsvg \u0026gt; graph.svg å¯¹äºç®€å•çš„é¡¹ç›®ï¼ˆç®¡ç†çš„èµ„æºå¯¹è±¡æ¯”è¾ƒçš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå›¾å½¢äº†è§£èµ„æºå¯¹è±¡çš„å…³ç³»ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªé¡¹ç›®ç®¡ç†äº†å¤§é‡çš„èµ„æºå¯¹è±¡ï¼Œä½¿ç”¨graphç”Ÿæˆçš„å›¾å½¢ä¼šæ˜¾å¾—é”™ä¸­å¤æ‚ï¼Œè€Œä¸”å›¾å½¢æ–‡ä»¶ä¹Ÿæ¯”è¾ƒåºå¤§ã€‚\né‚£æ¥ä¸‹æˆ‘ä»¬å°†ä»‹ç»ä¸€æ¬¾å¼€æºçš„å¯è§†åŒ–å·¥å…·ã€‚\nRover Roveræ˜¯ä¸€æ¬¾å¼€æºçš„ï¼Œå¯äº¤äº’çš„Terraformé…ç½®å’Œæ‰§è¡Œè®¡åˆ’å¯è§†åŒ–å·¥å…·ï¼Œå…¶é€šè¿‡WebæœåŠ¡çš„æ–¹å¼ï¼Œæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹ç”Ÿæˆçš„å›¾å½¢ï¼Œå¹¶è¿›è¡Œä¸€äº›äº¤äº’æ“ä½œã€‚\nä½¿ç”¨Roveréå¸¸å®¹æ˜“ï¼Œå¯ä»¥ä»å…¶Githubé¡¹ç›®çš„Releaseä¸‹è½½ä¸ºå„å¹³å°ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå‘½ä»¤ï¼‰æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡Dockerå®¹å™¨çš„æ–¹å¼è¿è¡Œã€‚\nå¦‚æœä½¿ç”¨ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†ä¸‹è½½å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ rover_v0.2.2ï¼‰æ”¾åˆ°PATHè·¯å¾„ä¸‹ï¼Œä¾‹å¦‚ /usr/local/bin/roverï¼Œæ¥ä¸‹ä¾†åœ¨Terraformé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ\nâ¯ rover 2021/11/26 16:59:34 Starting Rover... 2021/11/26 16:59:34 Initializing Terraform... 2021/11/26 16:59:35 Generating plan... 2021/11/26 16:59:37 Parsing configuration... 2021/11/26 16:59:37 Generating resource overview... 2021/11/26 16:59:37 Generating resource map... 2021/11/26 16:59:37 Generating resource graph... 2021/11/26 16:59:37 Done generating assets. 2021/11/26 16:59:37 Rover is running on 0.0.0.0:9000 è¿è¡Œroverå‘½ä»¤ï¼Œå…¶å°†ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ\nè§£æç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ï¼Œå¹¶é€šè¿‡Terraform planç”Ÿæˆæ‰§è¡Œè®¡åˆ’æ–‡ä»¶ è§£æè®¡åˆ’å’Œé…ç½®æ–‡ä»¶ï¼Œç”Ÿæˆ3ç§å¯¹è±¡ï¼š èµ„æºæ¦‚è§ˆï¼ˆrsoï¼‰ï¼Œèµ„æºæ˜ å°„å›¾ï¼ˆmapï¼‰ï¼Œèµ„æºå›¾ï¼ˆgraphï¼‰ ä½¿ç”¨ä¸Šé¢çš„3ä¸­å¯¹è±¡ï¼Œå°†å…¶è½¬æ¢ä¸ºå¯äº¤äº’çš„é…ç½®å’ŒçŠ¶æ€è§†å›¾ï¼Œä»¥WebæœåŠ¡å™¨è¿è¡Œåœ¨æœ¬åœ°çš„ 9000 ç«¯å£ æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:9000/ æ¥æŸ¥çœ‹å¯è§†åŒ–çš„ç»“æœã€‚\næ•´ä¸ªé¡µé¢åŒ…å«4ä¸ªéƒ¨åˆ†\nLEGEND - è¯¥éƒ¨åˆ†æ˜¯å¯¹å›¾ä¾‹çš„ä¸€äº›è¯´æ˜\nGRAPH - è¿™éƒ¨åˆ†æ˜¯æ•´ä¸ªèµ„æºå…³ç³»å’ŒçŠ¶æ€çš„è§†å›¾ï¼Œå¯ä½¿ç”¨é¼ æ ‡è¿›è¡Œç¼©æ”¾ï¼Œæ‹–æ‹½ï¼Œä»¥åŠé€‰æ‹©æŸä¸€ä¸ªèµ„æº\nRESOURCES - èµ„æºæ–‡ä»¶çš„æ˜ å°„åˆ—è¡¨ï¼Œç°å®äº†èµ„æºåœ¨é…ç½®æ–‡ä»¶ä¸­çš„å®šä¹‰ä½ç½®ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨é¼ æ ‡è¿›è¡Œé€‰æ‹©\nDETAILS - è¯¦ç»†ä¿¡æ¯è§†å›¾ï¼Œå½“ä½¿ç”¨é¼ æ ‡é€‰æ‹©äº† GRAPH æˆ–è€… RESOURCES è§†å›¾ä¸­çš„èµ„æºå¯¹è±¡æ—¶ï¼Œè¿™é‡Œå°†ç°å®å…¶è¯¦ç»†çš„ä¿¡æ¯\né€šè¿‡ä¸ terraform graph ç”Ÿæˆçš„å›¾å½¢å¯¹æ¯”ï¼ŒRoverå±•ç¤ºäº†æ›´åŠ ä¸°å¯Œå’Œç¾è§‚çš„è§†å›¾ï¼Œè®©æˆ‘ä»¬èƒ½ä»¥å¯è§†åŒ–çš„æ–¹å¼å……åˆ†ç†è§£é¡¹ç›®æ‰€ç®¡ç†çš„èµ„æºã€‚\næ³¨æ„çš„é—®é¢˜ Roverè¿˜ä¸æ”¯æŒä½¿ç”¨äº†â€œremoteâ€ - Backendçš„é¡¹ç›®ï¼Œå› ä¸ºè¿˜æ²¡åŠæ³•å°†æ‰§è¡Œè®¡åˆ’ä¿å­˜åˆ°æœ¬åœ° ä»‹ç»è§†é¢‘ HashiCropçš„å·¥ç¨‹å¸ˆTu Nguyenï¼Œä¹Ÿå°±æ˜¯Roverçš„å¼€å‘è€…ï¼Œåœ¨ Youtube ä¸Šå‘å¸ƒäº†ä»–ä»‹ç»Roverçš„è§†é¢‘\nVideo by Tu Nguyen From Youtube\n","date":"November 26, 2021","hero":"/zh/posts/devops/tf-rover/tf-plan.png","permalink":"/zh/posts/devops/tf-rover/","summary":"ä¹‹å‰æˆ‘ä»¬é€šè¿‡ä¸€ç¯‡æ–‡ç« å…¥é—¨äº†ä½¿ç”¨Terrafromä»¥å£°æ˜å¼é…ç½®æ–‡ä»¶ï¼ˆå¯ç‰ˆæœ¬åŒ–çš„ä»£ç ï¼‰æ¥åˆ›å»ºå’Œç®¡ç†åŸºç¡€è®¾æ–½èµ„æºã€‚\nåœ¨ä½¿ç”¨å‘½ä»¤terraform applyä¹‹å‰ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨terraform planæ¥æŸ¥çœ‹æ‰§è¡Œè®¡åˆ’ï¼Œè¾“å‡ºçš„æ‰§è¡Œè®¡åˆ’ä»¥ç±»ä¼¼â€œgit diffâ€çš„æ–‡æœ¬æ–¹å¼æè¿°ã€‚è¿™é‡Œæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•ä»¥å›¾å½¢å¯æ˜¯åŒ–çš„æ–¹å¼æ¥äº†è§£æ‰§è¡Œè®¡åˆ’ã€‚\nTerrafrom Graph é¦–å…ˆTerraform CLIå·¥å…·è‡ªå¸¦äº†ä¸€ä¸ªå­å‘½ä»¤ - graphï¼Œgraphå‘½ä»¤ç”¨äºç”Ÿäº§é…ç½®å’Œæ‰§è¡Œè®¡åˆ’çš„å›¾å½¢è¡¨ç¤ºï¼Œå…¶è¾“å‡ºæ˜¯DOTæ ¼å¼ï¼Œå¯ä»¥é€šè¿‡Graphvizè½¬åŒ–ä¸ºå›¾ç‰‡ï¼Œä¾‹å¦‚åœ¨Linuxç»ˆç«¯ä¸‹\nâ¯ terraform graph | dot -Tsvg \u0026gt; graph.svg å¯¹äºç®€å•çš„é¡¹ç›®ï¼ˆç®¡ç†çš„èµ„æºå¯¹è±¡æ¯”è¾ƒçš„æƒ…å†µï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå›¾å½¢äº†è§£èµ„æºå¯¹è±¡çš„å…³ç³»ã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªé¡¹ç›®ç®¡ç†äº†å¤§é‡çš„èµ„æºå¯¹è±¡ï¼Œä½¿ç”¨graphç”Ÿæˆçš„å›¾å½¢ä¼šæ˜¾å¾—é”™ä¸­å¤æ‚ï¼Œè€Œä¸”å›¾å½¢æ–‡ä»¶ä¹Ÿæ¯”è¾ƒåºå¤§ã€‚\né‚£æ¥ä¸‹æˆ‘ä»¬å°†ä»‹ç»ä¸€æ¬¾å¼€æºçš„å¯è§†åŒ–å·¥å…·ã€‚\nRover Roveræ˜¯ä¸€æ¬¾å¼€æºçš„ï¼Œå¯äº¤äº’çš„Terraformé…ç½®å’Œæ‰§è¡Œè®¡åˆ’å¯è§†åŒ–å·¥å…·ï¼Œå…¶é€šè¿‡WebæœåŠ¡çš„æ–¹å¼ï¼Œæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨æŸ¥çœ‹ç”Ÿæˆçš„å›¾å½¢ï¼Œå¹¶è¿›è¡Œä¸€äº›äº¤äº’æ“ä½œã€‚\nä½¿ç”¨Roveréå¸¸å®¹æ˜“ï¼Œå¯ä»¥ä»å…¶Githubé¡¹ç›®çš„Releaseä¸‹è½½ä¸ºå„å¹³å°ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆå‘½ä»¤ï¼‰æ¥è¿è¡Œï¼Œä¹Ÿå¯ä»¥é€šè¿‡Dockerå®¹å™¨çš„æ–¹å¼è¿è¡Œã€‚\nå¦‚æœä½¿ç”¨ä¸‹è½½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°†ä¸‹è½½å¥½çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆä¾‹å¦‚ rover_v0.2.2ï¼‰æ”¾åˆ°PATHè·¯å¾„ä¸‹ï¼Œä¾‹å¦‚ /usr/local/bin/roverï¼Œæ¥ä¸‹ä¾†åœ¨Terraformé¡¹ç›®çš„æ–‡ä»¶å¤¹ä¸‹æ‰§è¡Œ\nâ¯ rover 2021/11/26 16:59:34 Starting Rover... 2021/11/26 16:59:34 Initializing Terraform... 2021/11/26 16:59:35 Generating plan... 2021/11/26 16:59:37 Parsing configuration... 2021/11/26 16:59:37 Generating resource overview... 2021/11/26 16:59:37 Generating resource map... 2021/11/26 16:59:37 Generating resource graph... 2021/11/26 16:59:37 Done generating assets. 2021/11/26 16:59:37 Rover is running on 0.","tags":["terrafrom"],"title":"TFæ‰§è¡Œè®¡åˆ’å¯è§†åŒ–"},{"categories":["DEVOPS"],"contents":"GitOpsçš„æ¦‚å¿µä»¥åŠæå‡ºäº†å‡ å¹´æ—¶é—´äº†ï¼Œä¼´éšç€DevOpsçš„å‘å±•ä¹Ÿæ¥è¶Šæµè¡Œã€‚ç®€å•åœ°è¯´ï¼ŒGitOpsæ˜¯ä¸€å¥—æ“ä½œå’Œç®¡ç†è½¯ä»¶ç³»ç»Ÿçš„åŸåˆ™ï¼Œå…¶æºè‡ªäºç°ä»£è½¯ä»¶è¿ç»´ï¼Œä¹Ÿæ ¹æ¤äºä¹‹å‰å­˜åœ¨å’Œå¹¿æ³›é‡‡ç”¨çš„æœ€ä½³å®è·µã€‚è™½ç„¶å…¶åå­—ä¸­åŒ…å«Gitï¼Œä½†å…¶æ‰€è¡¨ç¤ºçš„æ˜¯ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç›¸å…³ï¼Œè€Œä¸ä»…é™äºGitå·¥å…·ã€‚ä¹Ÿå¯ä»¥è¯´å…¶æ˜¯ä¸€ä¸ªè¿ç»´æ¡†æ¶ï¼Œå®ƒå°† DevOps æœ€ä½³å®è·µç”¨äºåº”ç”¨ç¨‹åºå¼€å‘ï¼Œä¾‹å¦‚ç‰ˆæœ¬æ§åˆ¶ã€åä½œã€åˆè§„æ€§å’Œ CI/CD å·¥å…·ï¼Œå¹¶å°†å®ƒä»¬åº”ç”¨äºåŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–ã€‚\nå»å¹´ï¼Œæ¥è‡ªAmazonå’ŒAzureï¼ŒCodefreshï¼ŒGithubï¼ŒRedhatï¼ŒWeaveworksç­‰å…·æœ‰äº‘åŸç”Ÿç»éªŒå…¬å¸çš„å·¥ç¨‹å¸ˆä»¬åœ¨äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰ä¸‹ç»„å»ºäº†ä¸€ä¸ªGitOpså·¥ä½œç»„ï¼Œå¹¶åˆ›å»ºäº†OpenGitOpsé¡¹ç›®ã€‚\nGitOpså·¥ä½œç»„åœ¨ä¸Šä¸ªæœˆï¼ˆ10/09ï¼‰å‘å¸ƒäº†OpenGitOpsåŸåˆ™å’Œæœ¯è¯­1.0ç‰ˆæœ¬ã€‚\nOpenGitOps 1.0 GitOpså·¥ä½œç»„çš„è”åˆä¸»å¸­ - Leonardo Murilloè¯´è¿‡ï¼Œâ€œå¾ˆå¤šäººè®¤ä¸ºä»–ä»¬åœ¨åšGitOpsï¼Œå› ä¸ºä»–ä»¬æ­£åœ¨ä½¿ç”¨gitï¼Œå¹¶ä¸”ä½¿ç”¨æ‹‰å–è¯·æ±‚ï¼ˆPull Requestï¼‰å’Œæ¨é€æ›´æ”¹ï¼ˆPush Changesï¼‰ã€‚è€Œæˆ‘ä»¬å¸Œæœ›ç¤¾åŒºå¼€å§‹çœ‹åˆ°GitOpsä¸ä»…ä»…æ˜¯ä½¿ç”¨gitçš„CI/CDæµæ°´çº¿ï¼Œå…¶è¿˜åŒ…å«å¾ˆå¤šâ€ã€‚\nå·¥ä½œç»„é¦–å…ˆå®šä¹‰äº†GitOpsçš„æ ¸å¿ƒåŸåˆ™å’Œç›¸å…³æœ¯è¯­ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼è‡ªç”±åœ°è§£é‡Šè¿™äº›åŸåˆ™ï¼Œå¹¶é€šè¿‡ç›¸å…³çš„DevOpså·¥å…·å®ç°æœ€ä½³å®è·µã€‚\nå‘å¸ƒçš„1.0ç‰ˆæœ¬ç”±ä¸¤ä¸ªç®€å•çš„åŸåˆ™å’Œæœ¯è¯­æ–‡æ¡£ç»„æˆï¼Œæ¯ä¸€ä¸ªåŸåˆ™éƒ½è®¨è®ºäº†ç³»ç»Ÿçš„éœ€æ±‚çŠ¶æ€ï¼ˆDesired Stateï¼‰ä»¥åŠå®ƒåº”è¯¥å¦‚ä½•è¿è¡Œã€‚\nGitOpsæ‰€ç®¡ç†çš„ç³»ç»Ÿçš„éœ€æ±‚çŠ¶æ€å¿…é¡»æ»¡è¶³\nå£°æ˜å¼çš„ï¼ˆDeclarativeï¼‰ - GitOpsç®¡ç†çš„ç³»ç»Ÿå¿…é¡»ä»¥å£°æ˜çš„æ–¹å¼è¡¨è¾¾å…¶æ‰€éœ€è¦çš„çŠ¶æ€ã€‚ ç‰ˆæœ¬åŒ–å’Œä¸å¯å˜ï¼ˆVersioned \u0026amp; Immutableï¼‰ - ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€å°†ä»¥ä¸å¯å˜ã€ç‰ˆæœ¬åŒ–çš„æ–¹å¼å­˜å‚¨ï¼Œä»¥åŠä¿ç•™å®Œæ•´çš„ç‰ˆæœ¬å†å²ä¿¡æ¯ã€‚ è‡ªåŠ¨æ‹‰å–ï¼ˆPulled Automaticallyï¼‰ - è½¯ä»¶ä»£ç†ä¼šè‡ªåŠ¨ä»æºä¸­æå–æ‰€éœ€çš„çŠ¶æ€å£°æ˜ã€‚ æŒç»­è°ƒèŠ‚ï¼ˆContinuously Reconciledï¼‰ - è½¯ä»¶ä»£ç†æŒç»­è§‚å¯Ÿç³»ç»ŸçŠ¶æ€å¹¶å°è¯•è¾¾åˆ°ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€ã€‚ è¿›ä¸€æ­¥è§£è¯» å£°æ˜å¼çš„çŠ¶æ€åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œå£°æ˜å¼çš„æè¿°ä¸åº”è¯¥åŒ…å«å¦‚ä½•è¾¾åˆ°éœ€æ±‚çŠ¶æ€çš„æ“ä½œï¼Œè€Œä»…ä»…æè¿°ç³»ç»Ÿæˆ–è€…åº”ç”¨æ‰€éœ€è¦çš„çŠ¶æ€ã€‚ä¾‹å¦‚å¯ä½¿ç”¨Terraformæ¥æè¿°å’Œç®¡ç†ä¸€ä¸ªåŸºç¡€è®¾æ–½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Kubernetesçš„åº”ç”¨éƒ¨ç½²æ–‡ä»¶ï¼ˆmainfestï¼‰æ¥ç®¡ç†éƒ¨ç½²çš„åº”ç”¨ã€‚\nç‰ˆæœ¬åŒ–å’Œä¸å¯å˜é€šå¸¸ç†è§£ä¸ºæ˜¯ç”¨â€œgitâ€ï¼Œå…¶å®ä¸ä»…é™äºæ­¤ï¼Œè¿™é‡Œæ›´åŠ å¼ºè°ƒçš„æ˜¯ä½¿ç”¨å…·ä½“çš„ç‰ˆæœ¬æ ‡ç­¾æ¥å®šä¹‰ç³»ç»Ÿçš„ä¸€ä¸ªç‰ˆæœ¬çŠ¶æ€ï¼Œè€Œä¸åº”è¯¥ä½¿ç”¨ä¾‹å¦‚â€œlatestâ€ä¹‹ç±»çš„æ ‡ç­¾ï¼Œå› ä¸ºå…¶ä¸èƒ½å›é€€åˆ°ä¹‹å‰æ‰€éœ€è¦çš„çŠ¶æ€ã€‚è€Œå…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œåªè¦æ»¡è¶³è¿™æ ·çš„ç‰ˆæœ¬æ ‡ç­¾åŠŸèƒ½ï¼Œä»¥åŠç¬¦åˆå›¢é˜Ÿçš„åä½œæ–¹å¼ï¼Œéƒ½å¯ç”¨äºGitOpsã€‚\nè‡ªåŠ¨æ‹‰å–æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç³»ç»Ÿå†…çš„ä»£ç†æŒç»­è§‚æµ‹ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå…¶éœ€è¦æ—¶æ—¶åˆ»åˆ»çŸ¥é“ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€å’Œå½“å‰çŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨è§¦å‘ç¡®åˆ‡çš„æ›´æ”¹æ—¶æ‰å»è·å–ç³»ç»Ÿå¾—åˆ°çŠ¶æ€ã€‚è¿™é‡Œçš„æ‹‰å–ï¼ˆPullï¼‰æ˜ç¡®åœ°è¡¨æ˜äº†å…¶äºCI/CDæµæ°´çº¿ç”±æ¡ä»¶æ¥è§¦å‘çš„ä¸åŒã€‚\nè€ŒæŒç»­è°ƒèŠ‚å°†ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†æ•´åˆï¼Œç³»ç»Ÿå†…çš„ä»£ç†å¿…é¡»æ—¶åˆ»äº†è§£ç®¡ç†çš„ç³»ç»Ÿçš„å®é™…çŠ¶æ€å’Œæ‰€éœ€çš„çŠ¶æ€ï¼Œå½“å‘ç°å®é™…çŠ¶æ€å’Œæ‰€éœ€çš„çŠ¶æ€ç”±åå·®æ—¶ï¼Œæˆ–è€…å‘ç°æ‰€éœ€çŠ¶æ€è¢«æ”¹å˜æ—¶ï¼ˆç‰ˆæœ¬æ”¹å˜ï¼‰ï¼Œå…¶åº”è¯¥å°½åŠ›æ—¶ç³»ç»ŸçŠ¶æ€è¾¾åˆ°æ‰€éœ€æ±‚çš„çŠ¶æ€ã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ã€‚\nå½“å›¢é˜Ÿéµå¾ªä»¥ä¸ŠåŸåˆ™æ¥ç®¡ç†å’Œç»´æŠ¤ç³»ç»Ÿå’Œåº”ç”¨æ—¶ï¼Œæ‰æ˜¯å¯¹GitOpsçš„çœŸæ­£å®è·µã€‚\nOpenGitOpså‘å±• OpenGitOps 1.0ä»…ä»…å®šä¹‰äº†éƒ¨åˆ†å®ç°GitOpsçš„åŸåˆ™ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦æ‰©å±•æ›´å¤šçš„å®šä¹‰ï¼Œä¾‹å¦‚å¦‚ä½•åœ¨GitOpsç¯å¢ƒä¸­å¤„ç†äº‹ä»¶ç®¡ç†ï¼Œå®‰å…¨ç®¡ç†ï¼Œå‡­è¯ç®¡ç†ç­‰ã€‚å¦‚æœæˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ç¯å¢ƒä»¥åŠæˆ‘ä»¬çš„åº”è¯¥å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆåœ¨GitOpsä¸­åº”è¯¥éµå¾ªæ€ä¹ˆæ ·çš„å¤„ç†åŸåˆ™ï¼Ÿ\næœŸå¾…CNCF GitOpså·¥ä½œç»„çš„è¿›ä¸€æ­¥å·¥ä½œã€‚\n","date":"November 25, 2021","hero":"/zh/posts/devops/open-gitops/open-gitops.png","permalink":"/zh/posts/devops/open-gitops/","summary":"GitOpsçš„æ¦‚å¿µä»¥åŠæå‡ºäº†å‡ å¹´æ—¶é—´äº†ï¼Œä¼´éšç€DevOpsçš„å‘å±•ä¹Ÿæ¥è¶Šæµè¡Œã€‚ç®€å•åœ°è¯´ï¼ŒGitOpsæ˜¯ä¸€å¥—æ“ä½œå’Œç®¡ç†è½¯ä»¶ç³»ç»Ÿçš„åŸåˆ™ï¼Œå…¶æºè‡ªäºç°ä»£è½¯ä»¶è¿ç»´ï¼Œä¹Ÿæ ¹æ¤äºä¹‹å‰å­˜åœ¨å’Œå¹¿æ³›é‡‡ç”¨çš„æœ€ä½³å®è·µã€‚è™½ç„¶å…¶åå­—ä¸­åŒ…å«Gitï¼Œä½†å…¶æ‰€è¡¨ç¤ºçš„æ˜¯ä¸ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿç›¸å…³ï¼Œè€Œä¸ä»…é™äºGitå·¥å…·ã€‚ä¹Ÿå¯ä»¥è¯´å…¶æ˜¯ä¸€ä¸ªè¿ç»´æ¡†æ¶ï¼Œå®ƒå°† DevOps æœ€ä½³å®è·µç”¨äºåº”ç”¨ç¨‹åºå¼€å‘ï¼Œä¾‹å¦‚ç‰ˆæœ¬æ§åˆ¶ã€åä½œã€åˆè§„æ€§å’Œ CI/CD å·¥å…·ï¼Œå¹¶å°†å®ƒä»¬åº”ç”¨äºåŸºç¡€è®¾æ–½è‡ªåŠ¨åŒ–ã€‚\nå»å¹´ï¼Œæ¥è‡ªAmazonå’ŒAzureï¼ŒCodefreshï¼ŒGithubï¼ŒRedhatï¼ŒWeaveworksç­‰å…·æœ‰äº‘åŸç”Ÿç»éªŒå…¬å¸çš„å·¥ç¨‹å¸ˆä»¬åœ¨äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼ˆCNCFï¼‰ä¸‹ç»„å»ºäº†ä¸€ä¸ªGitOpså·¥ä½œç»„ï¼Œå¹¶åˆ›å»ºäº†OpenGitOpsé¡¹ç›®ã€‚\nGitOpså·¥ä½œç»„åœ¨ä¸Šä¸ªæœˆï¼ˆ10/09ï¼‰å‘å¸ƒäº†OpenGitOpsåŸåˆ™å’Œæœ¯è¯­1.0ç‰ˆæœ¬ã€‚\nOpenGitOps 1.0 GitOpså·¥ä½œç»„çš„è”åˆä¸»å¸­ - Leonardo Murilloè¯´è¿‡ï¼Œâ€œå¾ˆå¤šäººè®¤ä¸ºä»–ä»¬åœ¨åšGitOpsï¼Œå› ä¸ºä»–ä»¬æ­£åœ¨ä½¿ç”¨gitï¼Œå¹¶ä¸”ä½¿ç”¨æ‹‰å–è¯·æ±‚ï¼ˆPull Requestï¼‰å’Œæ¨é€æ›´æ”¹ï¼ˆPush Changesï¼‰ã€‚è€Œæˆ‘ä»¬å¸Œæœ›ç¤¾åŒºå¼€å§‹çœ‹åˆ°GitOpsä¸ä»…ä»…æ˜¯ä½¿ç”¨gitçš„CI/CDæµæ°´çº¿ï¼Œå…¶è¿˜åŒ…å«å¾ˆå¤šâ€ã€‚\nå·¥ä½œç»„é¦–å…ˆå®šä¹‰äº†GitOpsçš„æ ¸å¿ƒåŸåˆ™å’Œç›¸å…³æœ¯è¯­ï¼Œè€Œæˆ‘ä»¬å¯ä»¥ç”¨è‡ªå·±çš„æ–¹å¼è‡ªç”±åœ°è§£é‡Šè¿™äº›åŸåˆ™ï¼Œå¹¶é€šè¿‡ç›¸å…³çš„DevOpså·¥å…·å®ç°æœ€ä½³å®è·µã€‚\nå‘å¸ƒçš„1.0ç‰ˆæœ¬ç”±ä¸¤ä¸ªç®€å•çš„åŸåˆ™å’Œæœ¯è¯­æ–‡æ¡£ç»„æˆï¼Œæ¯ä¸€ä¸ªåŸåˆ™éƒ½è®¨è®ºäº†ç³»ç»Ÿçš„éœ€æ±‚çŠ¶æ€ï¼ˆDesired Stateï¼‰ä»¥åŠå®ƒåº”è¯¥å¦‚ä½•è¿è¡Œã€‚\nGitOpsæ‰€ç®¡ç†çš„ç³»ç»Ÿçš„éœ€æ±‚çŠ¶æ€å¿…é¡»æ»¡è¶³\nå£°æ˜å¼çš„ï¼ˆDeclarativeï¼‰ - GitOpsç®¡ç†çš„ç³»ç»Ÿå¿…é¡»ä»¥å£°æ˜çš„æ–¹å¼è¡¨è¾¾å…¶æ‰€éœ€è¦çš„çŠ¶æ€ã€‚ ç‰ˆæœ¬åŒ–å’Œä¸å¯å˜ï¼ˆVersioned \u0026amp; Immutableï¼‰ - ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€å°†ä»¥ä¸å¯å˜ã€ç‰ˆæœ¬åŒ–çš„æ–¹å¼å­˜å‚¨ï¼Œä»¥åŠä¿ç•™å®Œæ•´çš„ç‰ˆæœ¬å†å²ä¿¡æ¯ã€‚ è‡ªåŠ¨æ‹‰å–ï¼ˆPulled Automaticallyï¼‰ - è½¯ä»¶ä»£ç†ä¼šè‡ªåŠ¨ä»æºä¸­æå–æ‰€éœ€çš„çŠ¶æ€å£°æ˜ã€‚ æŒç»­è°ƒèŠ‚ï¼ˆContinuously Reconciledï¼‰ - è½¯ä»¶ä»£ç†æŒç»­è§‚å¯Ÿç³»ç»ŸçŠ¶æ€å¹¶å°è¯•è¾¾åˆ°ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€ã€‚ è¿›ä¸€æ­¥è§£è¯» å£°æ˜å¼çš„çŠ¶æ€åº”è¯¥å¾ˆå¥½ç†è§£ï¼Œå£°æ˜å¼çš„æè¿°ä¸åº”è¯¥åŒ…å«å¦‚ä½•è¾¾åˆ°éœ€æ±‚çŠ¶æ€çš„æ“ä½œï¼Œè€Œä»…ä»…æè¿°ç³»ç»Ÿæˆ–è€…åº”ç”¨æ‰€éœ€è¦çš„çŠ¶æ€ã€‚ä¾‹å¦‚å¯ä½¿ç”¨Terraformæ¥æè¿°å’Œç®¡ç†ä¸€ä¸ªåŸºç¡€è®¾æ–½ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Kubernetesçš„åº”ç”¨éƒ¨ç½²æ–‡ä»¶ï¼ˆmainfestï¼‰æ¥ç®¡ç†éƒ¨ç½²çš„åº”ç”¨ã€‚\nç‰ˆæœ¬åŒ–å’Œä¸å¯å˜é€šå¸¸ç†è§£ä¸ºæ˜¯ç”¨â€œgitâ€ï¼Œå…¶å®ä¸ä»…é™äºæ­¤ï¼Œè¿™é‡Œæ›´åŠ å¼ºè°ƒçš„æ˜¯ä½¿ç”¨å…·ä½“çš„ç‰ˆæœ¬æ ‡ç­¾æ¥å®šä¹‰ç³»ç»Ÿçš„ä¸€ä¸ªç‰ˆæœ¬çŠ¶æ€ï¼Œè€Œä¸åº”è¯¥ä½¿ç”¨ä¾‹å¦‚â€œlatestâ€ä¹‹ç±»çš„æ ‡ç­¾ï¼Œå› ä¸ºå…¶ä¸èƒ½å›é€€åˆ°ä¹‹å‰æ‰€éœ€è¦çš„çŠ¶æ€ã€‚è€Œå…¶ä»–ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿï¼Œåªè¦æ»¡è¶³è¿™æ ·çš„ç‰ˆæœ¬æ ‡ç­¾åŠŸèƒ½ï¼Œä»¥åŠç¬¦åˆå›¢é˜Ÿçš„åä½œæ–¹å¼ï¼Œéƒ½å¯ç”¨äºGitOpsã€‚\nè‡ªåŠ¨æ‹‰å–æ„å‘³ç€æˆ‘ä»¬å¿…é¡»æœ‰ä¸€ä¸ªç³»ç»Ÿå†…çš„ä»£ç†æŒç»­è§‚æµ‹ç³»ç»Ÿçš„çŠ¶æ€ï¼Œå…¶éœ€è¦æ—¶æ—¶åˆ»åˆ»çŸ¥é“ç³»ç»Ÿæ‰€éœ€è¦çš„çŠ¶æ€å’Œå½“å‰çŠ¶æ€ï¼Œè€Œä¸æ˜¯åœ¨è§¦å‘ç¡®åˆ‡çš„æ›´æ”¹æ—¶æ‰å»è·å–ç³»ç»Ÿå¾—åˆ°çŠ¶æ€ã€‚è¿™é‡Œçš„æ‹‰å–ï¼ˆPullï¼‰æ˜ç¡®åœ°è¡¨æ˜äº†å…¶äºCI/CDæµæ°´çº¿ç”±æ¡ä»¶æ¥è§¦å‘çš„ä¸åŒã€‚\nè€ŒæŒç»­è°ƒèŠ‚å°†ä»¥ä¸Šä¸‰ä¸ªéƒ¨åˆ†æ•´åˆï¼Œç³»ç»Ÿå†…çš„ä»£ç†å¿…é¡»æ—¶åˆ»äº†è§£ç®¡ç†çš„ç³»ç»Ÿçš„å®é™…çŠ¶æ€å’Œæ‰€éœ€çš„çŠ¶æ€ï¼Œå½“å‘ç°å®é™…çŠ¶æ€å’Œæ‰€éœ€çš„çŠ¶æ€ç”±åå·®æ—¶ï¼Œæˆ–è€…å‘ç°æ‰€éœ€çŠ¶æ€è¢«æ”¹å˜æ—¶ï¼ˆç‰ˆæœ¬æ”¹å˜ï¼‰ï¼Œå…¶åº”è¯¥å°½åŠ›æ—¶ç³»ç»ŸçŠ¶æ€è¾¾åˆ°æ‰€éœ€æ±‚çš„çŠ¶æ€ã€‚è€Œè¿™ä¸€åˆ‡éƒ½æ˜¯ç”±ç³»ç»Ÿè‡ªåŠ¨å®Œæˆçš„ã€‚\nå½“å›¢é˜Ÿéµå¾ªä»¥ä¸ŠåŸåˆ™æ¥ç®¡ç†å’Œç»´æŠ¤ç³»ç»Ÿå’Œåº”ç”¨æ—¶ï¼Œæ‰æ˜¯å¯¹GitOpsçš„çœŸæ­£å®è·µã€‚\nOpenGitOpså‘å±• OpenGitOps 1.0ä»…ä»…å®šä¹‰äº†éƒ¨åˆ†å®ç°GitOpsçš„åŸåˆ™ï¼Œæ¥ä¸‹æ¥è¿˜éœ€è¦æ‰©å±•æ›´å¤šçš„å®šä¹‰ï¼Œä¾‹å¦‚å¦‚ä½•åœ¨GitOpsç¯å¢ƒä¸­å¤„ç†äº‹ä»¶ç®¡ç†ï¼Œå®‰å…¨ç®¡ç†ï¼Œå‡­è¯ç®¡ç†ç­‰ã€‚å¦‚æœæˆ‘ä»¬çš„åŸºç¡€è®¾æ–½ç¯å¢ƒä»¥åŠæˆ‘ä»¬çš„åº”è¯¥å‡ºç°æ•…éšœï¼Œé‚£ä¹ˆåœ¨GitOpsä¸­åº”è¯¥éµå¾ªæ€ä¹ˆæ ·çš„å¤„ç†åŸåˆ™ï¼Ÿ\næœŸå¾…CNCF GitOpså·¥ä½œç»„çš„è¿›ä¸€æ­¥å·¥ä½œã€‚","tags":["gitops","cncf"],"title":"è§£è¯»OPEN GITOPS 1.0"},{"categories":["DEVOPS"],"contents":"ä¹‹å‰æ–‡ç« æˆ‘ä»¬å°è¯•äº†åœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨Terraformæ¥åˆ›å»ºå’Œç®¡ç†AWS Lightsailèµ„æºï¼Œå¯¹äºç®¡ç†ä¸€äº›äº‘èµ„æºï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°å®‰è£…ç›¸åº”çš„CLIå·¥å…·å’Œé…ç½®è®¿é—®ç›¸åº”äº‘èµ„æºçš„å‡­æ®ï¼ˆä¾‹å¦‚AWS CLIï¼Œ AccessKeyIDç­‰ï¼‰ï¼ŒTerraformé€šè¿‡è°ƒç”¨æœ¬åœ°çš„CLIå·¥å…·æˆ–è€…äº‘APIæ¥ç®¡ç†äº‘èµ„æºçš„çŠ¶æ€ï¼Œå…¶é»˜è®¤ä½¿ç”¨çš„æ˜¯localç±»å‹çš„Backendï¼Œèµ„æºçš„çŠ¶æ€æ–‡ä»¶(.tfstate)ä¹Ÿæ˜¯ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶ç›®å½•ä¸­çš„ã€‚\nè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†å°è¯•ä½¿ç”¨remoteç±»å‹çš„Backendï¼Œå°†é¡¹ç›®è¿ç§»åˆ°Terraform Cloudå»æ‰§è¡Œï¼Œå¹¶ä¸”ç”±Terraform Cloudæ¥ç®¡ç†èµ„æºçŠ¶æ€ã€‚\nä»€ä¹ˆæ˜¯Terraform Cloud Terraform Cloud æ˜¯ä¸€ä¸ªç®¡ç†Terraformåœ¨ä¸€è‡´ä¸”å¯é çš„ç¯å¢ƒä¸­è¿è¡Œçš„SaaSåº”ç”¨ï¼Œä»è€Œå¯ä»¥æ›¿æ¢åœ¨æœ¬åœ°æœºå™¨æ˜¯æ‰§è¡ŒTerraformé¡¹ç›®ï¼Œå…¶å­˜å‚¨å…±äº«çš„çŠ¶æ€å’Œæœºå¯†æ•°æ®ï¼Œå¹¶å¯ä»¥è¿æ¥åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Git)ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨å›¢é˜Ÿä¸­å°†åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç è¿›è¡Œå·¥ä½œã€‚\nTerraformæ˜¯ä¸€ä¸ªå•†ä¸šåº”ç”¨ï¼Œå›¢é˜Ÿå’Œå•†ä¸šä½¿ç”¨å°†ä¼šæ”¶å–è´¹ç”¨å¹¶æä¾›äº†æ›´å¤šçš„é«˜çº§åŠŸèƒ½ã€‚ä½†å¯¹äºä¸ªäººç”¨æˆ·ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨åŸºæœ¬çš„åŠŸèƒ½ã€‚å…³äºè´¹ç”¨å’ŒåŠŸèƒ½è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ (https://www.hashicorp.com/products/terraform/pricing)ã€‚\né¦–å…ˆæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªTerraform Cloudçš„è´¦å·ï¼Œè®¿é—® https://app.terraform.io/public/signup/account ï¼Œæ ¹æ®æç¤ºæ³¨å†Œè´¦å·\næ³¨å†Œå®Œæˆåç¬¬ä¸€æ¬¡ç™»é™†Terraform Cloudï¼Œå…¶ä¼šè¯¢é—®å¦‚ä½•å¼€å§‹ä¸€ä¸ªé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© Start from scratchï¼Œä¹Ÿå°±æ˜¯å°†ä»ä¸€ä¸ªç©ºæ¨¡æ¿å¼€å§‹\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç»„ç»‡ï¼ˆOrganizationï¼‰ï¼Œä¾‹å¦‚è¿™é‡Œæˆ‘åˆ›å»ºä¸€ä¸ªåä¸º learn-terraform çš„ç»„ç»‡ï¼Œä¸€ä¸ªç»„ç»‡å°±ç±»ä¼¼è¦ç»™å‘½åç©ºé—´ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªå·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰ï¼Œè¿˜å¯ä»¥ç®¡ç†å…¶ä¸‹å·¥ä½œç©ºé—´å…±äº«çš„å˜é‡å’Œç¯å¢ƒå˜é‡ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°ç¯å¢ƒç™»å½•Terraform Cloudï¼Œå¹¶æ·»åŠ ç›¸åº”çš„é…ç½®æ¥é‡æ–°åˆå§‹åŒ–é¡¹ç›®ã€‚\né‡æ–°åˆå§‹é¡¹ç›® å®Œæˆäº†Terraform Cloudçš„è´¦å·æ³¨å†Œä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œ terraform login ï¼Œä¼šæ‰“å¼€æµè§ˆå™¨æ¥ç™»å½•è´¦å·å¾—åˆ°ä¸€ä¸ªTokenå€¼ï¼Œå°†å…¶å¤åˆ¶å¡«å…¥ç»ˆç«¯å®Œæˆç™»å½•\n\u0026gt; terrafrom login Terraform must now open a web browser to the tokens page for app.terraform.io. If a browser does not open this automatically, open the following URL to proceed: https://app.terraform.io/app/settings/tokens?source=terraform-login --------------------------------------------------------------------------------- Generate a token using your browser, and copy-paste it into this prompt. Terraform will store the token in plain text in the following file for use by subsequent commands: /home/mengz/.terraform.d/credentials.tfrc.json Token for app.terraform.io: Enter a value: æ¥ç€æˆ‘ä»¬ä¿®æ”¹é¡¹ç›®çš„é…ç½®æ–‡ä»¶ main.tf ï¼ŒåŠ å…¥ backend \u0026quot;remote\u0026quot;\nterraform { backend \u0026#34;remtoe\u0026#34; { organization = \u0026#34;learn-terraform\u0026#34; workspaces { name = \u0026#34;mylightsail\u0026#34; } } ... } æ‰§è¡Œ terraform init ï¼ŒTerraformå°†ä¸‹è½½remoteçš„æ’ä»¶ï¼Œè¿æ¥è‡³Terraform Cloud çš„ learn-terraform/mylightsail å·¥ä½œç©ºé—´ï¼Œå¹¶å°†æœ¬åœ°çš„çŠ¶æ€æ–‡ä»¶è¿ç§»åˆ°äº‘ç«¯\n$ terraform init Initializing the backend...Do you want to copy existing state to the new backend? Pre-existing state was found while migrating the previous \u0026#34;local\u0026#34; backend to the newly configured \u0026#34;remote\u0026#34; backend. No existing state was found in the newly configured \u0026#34;remote\u0026#34; backend. Do you want to copy this state to the new \u0026#34;remote\u0026#34; backend? Enter \u0026#34;yes\u0026#34; to copy and \u0026#34;no\u0026#34; to start with an empty state. Enter a value: yes Releasing state lock. This may take a few moments... Successfully configured the backend \u0026#34;remote\u0026#34;! Terraform will automaticallyuse this backend unless the backend configuration changes.... æµè§ˆå™¨è®¿é—®Terraform Cloud WebUIï¼Œè¿›å…¥ç›¸åº”çš„å·¥ä½œç©ºé—´å¯ä»¥æŸ¥çœ‹çŠ¶æ€ä¿¡æ¯ã€‚\nå®Œæˆä¹‹åå¯ä»¥å°†æœ¬åœ°çš„ .terraform/terraform.tfstate æ–‡ä»¶åˆ é™¤ã€‚æœ¬åœ°é¡¹ç›®å·²å°†Terraform Cloudä½œä¸ºè¿œç¨‹åç«¯ï¼ˆremote backendï¼‰ï¼Œå¹¶ä¸”å…³è”äº†å‘½ä»¤è¡Œ(CLI)é©±åŠ¨çš„æ–¹å¼ï¼Œå› æ­¤åç»­å¯ä»¥åœ¨æœ¬åœ°æ›´æ–°èµ„æºé…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨æœ¬åœ°è¿è¡Œ plan \u0026amp; apply å‘½ä»¤ï¼Œè¿™å°†ä¼šè§¦å‘åœ¨è¿œç«¯Cloudä¸Šæ‰§è¡Œå…·ä½“çš„çŠ¶æ€ç»´æŠ¤å·¥ä½œã€‚ä¸è¿‡è¦ä½¿ç”¨Terraform Cloudæ¥æ‰§è¡ŒçŠ¶æ€ç»´æŠ¤ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†AWSçš„è®¿é—®å‡­æ®é…ç½®åˆ°Terraform Cloudä¸Šã€‚\né…ç½®å·¥ä½œç©ºé—´çš„ç¯å¢ƒå˜é‡ ä½¿ç”¨Terraform Cloudæ¥ç»´æŠ¤äº‘èµ„æºï¼ˆä¾‹å¦‚AWSï¼‰ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ç›¸åº”çš„è®¿é—®å‡­æ®ã€‚è¿™é‡Œæˆ‘ä»¬éœ€è¦é…ç½®AWSçš„ AWS_ACCESS_KEY_ID å’Œ AWS_SECRET_ACCESS_KEY ä½œä¸ºé¡¹ç›®ç©ºé—´çš„ç¯å¢ƒå˜é‡ã€‚\nåœ¨å·¥ä½œç©ºé—´ç‚¹å‡» Variables æ ‡ç­¾é¡µï¼Œç‚¹å‡» + Add Varaible æŒ‰é’®\né€‰æ‹© Environment Variables ï¼Œç„¶åæ·»åŠ  AWS_ACCESS_KEY_ID å’Œ AWS_SECRET_ACCESS_KEY ä¸¤ä¸ªç¯å¢ƒå˜é‡ï¼Œå¹¶è®¾ç½®ç›¸åº”çš„å€¼ã€‚\nå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æœ¬åœ°æ§åˆ¶å°è¿è¡Œ terraform planï¼Œterraform apply å°†æ“ä½œå‘é€åˆ°Terraform Cloudç«¯å»è¿è¡Œï¼Œå½“ç„¶æˆ‘ä»¬è¿˜æ˜¯å¯ä»¥åœ¨æœ¬åœ°é¡¹ç›®æ‰§è¡Œ terraform show æ¥æŸ¥çœ‹å½“å‰çš„çŠ¶æ€ï¼ŒçŠ¶æ€å°†ä¼šç®¡ç†åœ¨äº‘ç«¯\n\u0026gt; terraform plan Running plan in the remote backend. Output will stream here. Pressing Ctrl-C will stop streaming the logs, but will not stop the plan running remotely. Preparing the remote plan... To view this run in a browser, visit: https://app.terraform.io/app/mengz-infra/my-lightsail/runs/run-LzwFBbihffEKmucd Waiting for the plan to start... Terraform v1.0.11 on linux_amd64 Configuring remote state backend... Initializing Terraform configuration... aws_lightsail_static_ip.outline-sig-ip: Refreshing state... [id=Outline-EIP] aws_lightsail_instance.outline-sig: Refreshing state... [id=Outline-Sig] aws_lightsail_instance_public_ports.outline-sig-public-ports: Refreshing state... [id=Outline-Sig-987241840] aws_lightsail_static_ip_attachment.outline-sig-ip-attache: Refreshing state... [id=Outline-EIP] No changes. Your infrastructure matches the configuration. Terraform has compared your real infrastructure against your configuration and found no differences, so no changes are needed. å¯ä»¥çœ‹åˆ°è®¡åˆ’æ˜¯åœ¨ remote backend è¿è¡Œçš„ã€‚\næœ¬ç‰ˆåŒ–ç®¡ç†é¡¹ç›® æœ€åï¼Œæˆ‘ä»¬å¯ä»¥å°†é¡¹ç›®çš„é…ç½®æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆä¾‹å¦‚ Gitlabï¼‰ï¼Œå¹¶é…ç½®å·¥ä½œç©ºé—´çš„ç‰ˆæœ¬æ§åˆ¶\nåœ¨Terraform Cloudå·¥ä½œç©ºé—´çš„è®¾ç½®é‡Œï¼ŒæŒ‰ç…§æç¤ºé…ç½®å…³è”ç›¸åº”çš„ç‰ˆæœ¬ç®¡ç†ä»£ç ä»“åº“ã€‚å®Œæˆä¹‹åï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°æäº¤æ›´æ–°çš„ä»£ç åï¼Œä¼šè‡ªåŠ¨è§¦å‘Terraform Cloudå»æ‰§è¡Œç»´æŠ¤æ–°çš„çŠ¶æ€ã€‚ä¸è¿‡è¿™å°†ä¸ä¼šå…è®¸åœ¨æœ¬åœ°ç»ˆç«¯æ‰§è¡Œ terraform apply\n\u0026gt; terraform apply â”‚ Error: Apply not allowed for workspaces with a VCS connection â”‚ A workspace that is connected to a VCS requires the VCS-driven workflow to ensure that the VCS remains the single source of truth. åªèƒ½é€šè¿‡æ›´æ–°ä»£ç ï¼Œç„¶åæäº¤åˆ°è¿œç¨‹ä»£ç ä»“åº“çš„æ–¹å¼æ¥è§¦å‘çŠ¶æ€ç»´æŠ¤ã€‚è¿™å°†æ›´åŠ ä¾¿äºä¸å›¢é˜Ÿå…±äº«åŸºç¡€è®¾æ–½ä»£ç ï¼Œä»¥åŠå…±åŒç»´æŠ¤åŸºç¡€è®¾æ–½çŠ¶æ€ï¼ŒåŒæ—¶ä¹Ÿæ›´åŠ è¶‹äºGitOpsçš„å·¥ä½œæ–¹å¼ã€‚\næ€»ç»“ æœ¬æ–‡åŸºäºä¸Šä¸€ç¯‡æ–‡ç«  - å°è¯•ä½¿ç”¨Terraformåœ¨æœ¬åœ°ç¯å¢ƒç®¡ç†AWS Lightsailèµ„æºï¼Œå»¶ç”³äº†å°†çŠ¶æ€ç®¡ç†çš„æ“ä½œè¿ç§»åˆ°ä»¥Terraform Cloudä½œä¸ºè¿œç¨‹åç«¯çš„å°è¯•ï¼Œé™¤äº†Terraform Cloudä¹‹åï¼Œè¿˜æœ‰å…¶ä»–ç±»å‹çš„Backendï¼Œå¯ä»¥å‚è€ƒ (https://www.terraform.io/docs/language/settings/backends/index.html)ã€‚\nè‡ªæ­¤ï¼Œæˆ‘ä»¬åˆæ¢äº†ä½¿ç”¨Terraformä½œä¸ºIaCå·¥å…·æ¥ç®¡ç†AWS Lightsailèµ„æºï¼Œå½“ä½œTerraformå­¦ä¹ çš„ä¸€ä¸ªå…¥é—¨ã€‚Hashicropå®˜æ–¹æä¾›äº†æ›´å¤šçš„å­¦ä¹ èµ„æºå’Œæ–‡æ¡£ï¼Œæƒ³æ·±å…¥å­¦ä¹ Terrformï¼Œå¹¶æŠ•å…¥åˆ°å®é™…å·¥ä½œä¸­ï¼Œè¿˜è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\n","date":"November 25, 2021","hero":"/zh/posts/devops/tf-cloud/tf-cloud.jpg","permalink":"/zh/posts/devops/tf-cloud/","summary":"ä¹‹å‰æ–‡ç« æˆ‘ä»¬å°è¯•äº†åœ¨æœ¬åœ°ç¯å¢ƒä½¿ç”¨Terraformæ¥åˆ›å»ºå’Œç®¡ç†AWS Lightsailèµ„æºï¼Œå¯¹äºç®¡ç†ä¸€äº›äº‘èµ„æºï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°å®‰è£…ç›¸åº”çš„CLIå·¥å…·å’Œé…ç½®è®¿é—®ç›¸åº”äº‘èµ„æºçš„å‡­æ®ï¼ˆä¾‹å¦‚AWS CLIï¼Œ AccessKeyIDç­‰ï¼‰ï¼ŒTerraformé€šè¿‡è°ƒç”¨æœ¬åœ°çš„CLIå·¥å…·æˆ–è€…äº‘APIæ¥ç®¡ç†äº‘èµ„æºçš„çŠ¶æ€ï¼Œå…¶é»˜è®¤ä½¿ç”¨çš„æ˜¯localç±»å‹çš„Backendï¼Œèµ„æºçš„çŠ¶æ€æ–‡ä»¶(.tfstate)ä¹Ÿæ˜¯ä¿å­˜åœ¨æœ¬åœ°æ–‡ä»¶ç›®å½•ä¸­çš„ã€‚\nè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°†å°è¯•ä½¿ç”¨remoteç±»å‹çš„Backendï¼Œå°†é¡¹ç›®è¿ç§»åˆ°Terraform Cloudå»æ‰§è¡Œï¼Œå¹¶ä¸”ç”±Terraform Cloudæ¥ç®¡ç†èµ„æºçŠ¶æ€ã€‚\nä»€ä¹ˆæ˜¯Terraform Cloud Terraform Cloud æ˜¯ä¸€ä¸ªç®¡ç†Terraformåœ¨ä¸€è‡´ä¸”å¯é çš„ç¯å¢ƒä¸­è¿è¡Œçš„SaaSåº”ç”¨ï¼Œä»è€Œå¯ä»¥æ›¿æ¢åœ¨æœ¬åœ°æœºå™¨æ˜¯æ‰§è¡ŒTerraformé¡¹ç›®ï¼Œå…¶å­˜å‚¨å…±äº«çš„çŠ¶æ€å’Œæœºå¯†æ•°æ®ï¼Œå¹¶å¯ä»¥è¿æ¥åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼ˆå¦‚ Git)ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥åœ¨å›¢é˜Ÿä¸­å°†åŸºç¡€è®¾æ–½ä½œä¸ºä»£ç è¿›è¡Œå·¥ä½œã€‚\nTerraformæ˜¯ä¸€ä¸ªå•†ä¸šåº”ç”¨ï¼Œå›¢é˜Ÿå’Œå•†ä¸šä½¿ç”¨å°†ä¼šæ”¶å–è´¹ç”¨å¹¶æä¾›äº†æ›´å¤šçš„é«˜çº§åŠŸèƒ½ã€‚ä½†å¯¹äºä¸ªäººç”¨æˆ·ï¼Œå¯ä»¥å…è´¹ä½¿ç”¨åŸºæœ¬çš„åŠŸèƒ½ã€‚å…³äºè´¹ç”¨å’ŒåŠŸèƒ½è¯¦æƒ…ï¼Œå¯ä»¥å‚è€ƒ (https://www.hashicorp.com/products/terraform/pricing)ã€‚\né¦–å…ˆæˆ‘ä»¬éœ€è¦æ³¨å†Œä¸€ä¸ªTerraform Cloudçš„è´¦å·ï¼Œè®¿é—® https://app.terraform.io/public/signup/account ï¼Œæ ¹æ®æç¤ºæ³¨å†Œè´¦å·\næ³¨å†Œå®Œæˆåç¬¬ä¸€æ¬¡ç™»é™†Terraform Cloudï¼Œå…¶ä¼šè¯¢é—®å¦‚ä½•å¼€å§‹ä¸€ä¸ªé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹© Start from scratchï¼Œä¹Ÿå°±æ˜¯å°†ä»ä¸€ä¸ªç©ºæ¨¡æ¿å¼€å§‹\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªç»„ç»‡ï¼ˆOrganizationï¼‰ï¼Œä¾‹å¦‚è¿™é‡Œæˆ‘åˆ›å»ºä¸€ä¸ªåä¸º learn-terraform çš„ç»„ç»‡ï¼Œä¸€ä¸ªç»„ç»‡å°±ç±»ä¼¼è¦ç»™å‘½åç©ºé—´ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ªå·¥ä½œç©ºé—´ï¼ˆWorkspaceï¼‰ï¼Œè¿˜å¯ä»¥ç®¡ç†å…¶ä¸‹å·¥ä½œç©ºé—´å…±äº«çš„å˜é‡å’Œç¯å¢ƒå˜é‡ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°ç¯å¢ƒç™»å½•Terraform Cloudï¼Œå¹¶æ·»åŠ ç›¸åº”çš„é…ç½®æ¥é‡æ–°åˆå§‹åŒ–é¡¹ç›®ã€‚\né‡æ–°åˆå§‹é¡¹ç›® å®Œæˆäº†Terraform Cloudçš„è´¦å·æ³¨å†Œä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨æœ¬åœ°ç»ˆç«¯è¿è¡Œ terraform login ï¼Œä¼šæ‰“å¼€æµè§ˆå™¨æ¥ç™»å½•è´¦å·å¾—åˆ°ä¸€ä¸ªTokenå€¼ï¼Œå°†å…¶å¤åˆ¶å¡«å…¥ç»ˆç«¯å®Œæˆç™»å½•\n\u0026gt; terrafrom login Terraform must now open a web browser to the tokens page for app.terraform.io. If a browser does not open this automatically, open the following URL to proceed: https://app.terraform.io/app/settings/tokens?source=terraform-login --------------------------------------------------------------------------------- Generate a token using your browser, and copy-paste it into this prompt.","tags":["terrafrom","cloud"],"title":"è¿ç§»æœ¬åœ°é¡¹ç›®åˆ°TF CLOUD"},{"categories":["DEVOPS"],"contents":"Terraformæ˜¯ä¸€ç§å¼€æºåŸºç¡€è®¾æ–½åŠä»£ç ï¼ˆIaCï¼‰çš„å·¥å…·ï¼Œå¯æä¾›ä¸€è‡´çš„CLIï¼ˆå‘½ä»¤è¡Œæ¥å£)å·¥ä½œæµæ¥ç®¡ç†æ•°ç™¾ä¸ªäº‘æœåŠ¡ï¼Œå°†äº‘APIç¼–ç ä¸ºå£°æ˜æ€§çš„é…ç½®æ–‡ä»¶è¿›è¡Œç®¡ç†ã€‚\næœ¬æ–‡åˆ›å»ºä¸€ä¸ªç®¡ç†AWS Lightsailå®ä¾‹çš„ä¾‹å­æ¥å…¥é—¨Terraformçš„ä½¿ç”¨ã€‚\nå®‰è£…Terraform CLI è¦ä½¿ç”¨Terramformï¼Œé¦–å…ˆè¦åœ¨æœ¬åœ°ç³»ç»Ÿå®‰è£…Terraformå‘½ä»¤è¡Œå·¥å…·ã€‚HashiCorpæä¾›äº†é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åˆ†å‘åŒ…ï¼Œå¯ä»¥é€šè¿‡(https://www.terraform.com/downolads.html) ç›´æ¥ä¸‹è½½ç›¸åº”å¹³å°çš„äºŒè¿›åˆ¶åŒ…ï¼Œè§£å‹åæ”¾åˆ°ç›¸åº”çš„æ‰§è¡Œè·¯å¾„ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›è½¯ä»¶åŒ…ç®¡ç†å·¥å…·å®‰è£…ï¼Œä¾‹å¦‚åœ¨Linux/OS Xä¸Šé€šè¿‡LinuxBrew/HomeBrewè¿›è¡Œå®‰è£…ï¼Œåœ¨Windowsä¸Šé€šè¿‡Chocolateyè¿›è¡Œå®‰è£…ã€‚\nè¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹åœ¨Linuxä¸Šæ˜¯ä½¿ç”¨LinuxBrewè¿›è¡Œå®‰è£…\n\u0026gt; brew install terraform å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹å…¶ç‰ˆæœ¬\nâ¯ terraform -version Terraform v1.0.11 on linux_amd64 ä½¿ç”¨-helpæŸ¥çœ‹å…¶å¯ç”¨å‘½ä»¤ï¼Œå®‰è£…æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Terraformæ¥åˆ›å»ºç›¸åº”çš„åŸºç¡€è®¾æ–½é¡¹ç›®äº†ã€‚\nAWSè´¦å·å‡†å¤‡ æœ¬æ–‡å°†é€šè¿‡åˆ›å»ºä¸€ä¸ªç®¡ç†AWS Lightsialå®ä¾‹çš„é¡¹ç›®æ¥å°è¯•Terraformï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªAWSè´¦å·ï¼Œä»¥åŠåœ¨æœ¬åœ°ç¯å¢ƒå®‰è£…å’Œé…ç½®å¥½AWS CLIå·¥å…·çš„è®¿é—®å‡­æ®ã€‚\nå®‰è£…å’Œé…ç½®AWS CLIï¼Œè¯·å‚è€ƒå…¶æ–‡æ¡£ (https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html) ã€‚ é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨æœ¬åœ°å‘½ä»¤è¡Œç»ˆç«¯è®¿é—®ç›¸åº”çš„AWSèµ„æºã€‚\nåˆ›å»ºå¹¶åˆå§‹åŒ–Terraformé¡¹ç›® Terraformåœ¨æœ¬åœ°é€šè¿‡æ–‡ä»¶å¤¹æ¥ç®¡ç†ä¸€ä¸ªåŸºç¡€è®¾æ–½é¡¹ç›®çš„å£°æ˜æ€§ä»£ç ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹\n\u0026gt; mkdir mylightsail \u0026gt; cd mylightsail/ è¿›å…¥æ–‡ä»¶å¤¹åï¼Œåˆ›å»ºä¸€ä¸ªä»¥ .tf ä½œä¸ºåç¼€çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ main.tf\n\u0026gt; touch main.tf ç„¶åä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå†™å…¥ä»¥ä¸‹ä»£ç å—\nterraform { required_providers { aws = { source = \u0026#34;hashicorp/aws\u0026#34; version = \u0026#34;~\u0026gt; 3.65\u0026#34; } } } # Configure the AWS Provider provider \u0026#34;aws\u0026#34; { region = \u0026#34;ap-southeast-1\u0026#34; } å…¶ä¸­ terraform/required_providers å—å®šä¹‰äº†è¯¥é¡¹ç›®éœ€è¦çš„ Providerï¼ŒTerraformæ˜¯é€šè¿‡ä¸åŒçš„Provideræ¥ç®¡ç†ç›¸åº”çš„åŸºç¡€è®¾æ–½èµ„æºçš„ï¼Œå¯åˆ° (https://registry.terraform.io) æ¥æŸ¥æ‰¾éœ€è¦çš„Providersï¼Œä¾‹å¦‚GCPï¼ŒAzureä»¥åŠé˜¿é‡Œäº‘ç­‰çš„Providersã€‚è¿™é‡Œå› ä¸ºæˆ‘ä»¬è¦ç®¡ç†çš„èµ„æºæ˜¯AWS Lightsailå®ä¾‹ï¼Œæ‰€ä»¥ä½¿ç”¨äº†Hashicorpå®˜æ–¹æä¾›çš„ hashicorp/aws ã€‚\nprovider \u0026quot;aws\u0026quot; éƒ¨åˆ†é…ç½®äº†è¯¥Providerçš„ä¸€äº›å¯é€‰é¡¹ï¼Œä¾‹å¦‚è¿™é‡Œé…ç½®äº†åŒºåŸŸä¸º ap-southeast-1 ï¼Œå› æ­¤è¯·ç¡®ä¿ä¸Šé¢é…ç½®çš„AWSè®¿é—®å‡­æ®èƒ½å¤Ÿæ“ä½œè¯¥åŒºåŸŸçš„èµ„æºã€‚\nä¹Ÿå°±æ˜¯è¿™é‡Œæˆ‘ä»¬å®šä¹‰äº†æˆ‘ä»¬éœ€è¦ä½¿ç”¨çš„ProvideråŠå…¶ç›¸åº”çš„é€‰é¡¹é…ç½®ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦ä½¿ç”¨ terraform init å‘½ä»¤æ¥åˆå§‹åŒ–é¡¹ç›®\n\u0026gt; terraform init Initializing provider plugins... ... Terraform has been successfully initialized! åˆå§‹åŒ–å°†ä¼šä» (https://registry.terraform.io/) ä¸‹è½½ç›¸åº”çš„Provideræ’ä»¶åˆ° .terramorm/providers/ ç›®å½•ï¼Œä¾›æ¥ä¸‹ä¾†çš„å‘½ä»¤ä½¿ç”¨ã€‚\nåŒæ—¶ï¼Œä¼šç”Ÿæˆä¸€ä¸ª .terraform.lock.hcl çš„æ–‡ä»¶æ¥è®°å½•ä½¿ç”¨çš„å…·ä½“Providerç‰ˆæœ¬ï¼Œå…¶åŠŸèƒ½ç±»ä¼¼äºNPMçš„package-lockæ–‡ä»¶ï¼Œå¯å°†å…¶æäº¤åˆ°ä»£ç ç‰ˆæœ¬ç®¡ç†ä»“åº“ï¼Œå…¶ä»–åä½œçš„æˆå‘˜å°±å¯ä»¥ä¿æŒä½¿ç”¨ç›¸åŒçš„æ’ä»¶ç‰ˆæœ¬ã€‚\nåˆ›å»ºåŸºç¡€è®¾æ–½èµ„æº å®Œæˆé¡¹ç›®çš„åˆå§‹åŒ–ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¼–å†™éœ€è¦åˆ›å»ºçš„èµ„æºå£°æ˜æ€§é…ç½®ï¼Œå¯ä»¥ç›´æ¥å°†ç›¸åº”çš„é…ç½®å†™å…¥ main.tf æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥å¦å¤–åˆ›å»ºæ–°çš„ä»¥ .tf ä½œä¸ºåç¼€çš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸º resources.tf çš„æ–‡ä»¶ï¼Œå¹¶å†™å…¥æˆ‘ä»¬éœ€è¦çš„èµ„æºçš„å®šä¹‰\n## LightSail Resources resource \u0026#34;aws_lightsail_static_ip\u0026#34; \u0026#34;Example-sig-ip\u0026#34; { name = \u0026#34;Example-EIP\u0026#34; } resource \u0026#34;aws_lightsail_instance\u0026#34; \u0026#34;Example-sig\u0026#34; { name = \u0026#34;Example-Sig\u0026#34; availability_zone = \u0026#34;ap-southeast-1c\u0026#34; blueprint_id = \u0026#34;ubuntu_20_04\u0026#34; bundle_id = \u0026#34;nano_2_0\u0026#34; key_pair_name = \u0026#34;LightsailDefaultKeyPair\u0026#34; tags = { Example = \u0026#34;\u0026#34; } } resource \u0026#34;aws_lightsail_static_ip_attachment\u0026#34; \u0026#34;Example-sig-ip-attache\u0026#34; { static_ip_name = aws_lightsail_static_ip.Example-sig-ip.id instance_name = aws_lightsail_instance.Example-sig.id } resource \u0026#34;aws_lightsail_instance_public_ports\u0026#34; \u0026#34;Example-sig-public-ports\u0026#34; { instance_name = aws_lightsail_instance.Example-sig.name port_info { protocol = \u0026#34;tcp\u0026#34; from_port = 0 to_port = 65535 cidrs = [ \u0026#34;0.0.0.0/0\u0026#34; ] } port_info { protocol = \u0026#34;udp\u0026#34; from_port = 0 to_port = 65535 cidrs = [ \u0026#34;0.0.0.0/0\u0026#34; ] } } å®šä¹‰èµ„æºçš„æ ¼å¼ä¸º resource \u0026quot;[provider_resource _type]\u0026quot; \u0026quot;resource_name\u0026quot;ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›¸åº”Provideræ”¯æŒçš„èµ„æºç±»å‹åç§°ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºè‡ªå·±å®šä¹‰çš„èµ„æºåç§°ï¼ˆå¯ç”¨äºå…¶ä»–èµ„æºå¼•ç”¨ï¼‰ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªLightsailçš„é™æ€IPèµ„æºï¼Œå…¶ä¸­å‚æ•° name æŒ‡å®šäº†AWSèµ„æºçš„åç§°ã€‚\nä¸Šé¢çš„å®šä¹‰ä¸­ï¼Œæˆ‘ä»¬å£°æ˜äº†ä»¥ä¸‹èµ„æº\nä¸€ä¸ªLightsailé™æ€IPåœ°å€ ä¸€ä¸ªLightsailè®¡ç®—å®ä¾‹ï¼Œå¹¶ç»‘å®šåä¸º LightsailDefaultKeyPair çš„SSHå¯†é’¥ é™æ€IPåœ°å€å’Œè®¡ç®—å®ä¾‹çš„ç»‘å®š å®ä¾‹çš„å¼€æ”¾çš„ç½‘ç»œç«¯å£ç»„ï¼ˆç±»ä¼¼äºAWS EC2å®ä¾‹çš„å®‰å…¨ç»„å®šä¹‰ï¼‰ ä¿å­˜æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ terraform fmt å‘½ä»¤æ¥æ ¼å¼åŒ–æ–‡ä»¶æ ¼å¼ï¼Œä»¥åŠ terraform validate æ¥æ£€æŸ¥æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ã€‚\nå®šä¹‰å¥½æˆ‘ä»¬æƒ³è¦çš„èµ„æºä¹‹åï¼Œæˆ‘ä»¬å…ˆé€šè¿‡å‘½ä»¤ terraform plan å‘½ä»¤æ¥æ‰§è¡Œè®¡åˆ’ï¼ŒæŸ¥çœ‹å…·ä½“çš„æ‰§è¡Œæ›´æ”¹ï¼ˆplanä¸ä¼šå®é™…æ“ä½œç›¸åº”çš„èµ„æºï¼‰\nâ¯ terraform plan Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols: + create Terraform will perform the following actions: # aws_lightsail_instance.Example-sig will be created + resource \u0026#34;aws_lightsail_instance\u0026#34; \u0026#34;Example-sig\u0026#34; { + arn = (known after apply) + availability_zone = \u0026#34;ap-southeast-1c\u0026#34; + blueprint_id = \u0026#34;ubuntu_20_04\u0026#34; + bundle_id = \u0026#34;nano_2_0\u0026#34; + cpu_count = (known after apply) + created_at = (known after apply) + id = (known after apply) + ipv6_address = (known after apply) + ipv6_addresses = (known after apply) + is_static_ip = (known after apply) + key_pair_name = \u0026#34;LightsailDefaultKeyPair\u0026#34; + name = \u0026#34;Example-Sig\u0026#34; + private_ip_address = (known after apply) + public_ip_address = (known after apply) + ram_size = (known after apply) + tags = { + \u0026#34;Example\u0026#34; = \u0026#34;\u0026#34; } + tags_all = { + \u0026#34;Example\u0026#34; = (known after apply) } + username = (known after apply) } # aws_lightsail_instance_public_ports.Example-sig-public-ports will be created + resource \u0026#34;aws_lightsail_instance_public_ports\u0026#34; \u0026#34;Example-sig-public-ports\u0026#34; { + id = (known after apply) + instance_name = \u0026#34;Example-Sig\u0026#34; + port_info { + cidrs = [ + \u0026#34;0.0.0.0/0\u0026#34;, ] + from_port = 0 + protocol = \u0026#34;tcp\u0026#34; + to_port = 65535 } + port_info { + cidrs = [ + \u0026#34;0.0.0.0/0\u0026#34;, ] + from_port = 0 + protocol = \u0026#34;udp\u0026#34; + to_port = 65535 } } # aws_lightsail_static_ip.Example-sig-ip will be created + resource \u0026#34;aws_lightsail_static_ip\u0026#34; \u0026#34;Example-sig-ip\u0026#34; { + arn = (known after apply) + id = (known after apply) + ip_address = (known after apply) + name = \u0026#34;Example-EIP\u0026#34; + support_code = (known after apply) } # aws_lightsail_static_ip_attachment.Example-sig-ip-attache will be created + resource \u0026#34;aws_lightsail_static_ip_attachment\u0026#34; \u0026#34;Example-sig-ip-attache\u0026#34; { + id = (known after apply) + instance_name = (known after apply) + ip_address = (known after apply) + static_ip_name = (known after apply) } Plan: 4 to add, 0 to change, 0 to destroy. +è¡¨ç¤ºå°†è¦å¢åŠ çš„èµ„æºï¼Œ(know after apply)çš„æ„æ€æ˜¯è¦åœ¨å…·ä½“åªæƒ³ï¼ˆapplyï¼‰ä¹‹åï¼ŒAWSæ ¹æ®å®šä¹‰åˆ›å»ºç›¸åº”èµ„æºä¹‹åæ‰ä¼šè¿”å›çš„å…·ä½“å€¼ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥ä½¿ç”¨ terraform apply æ¥å…·ä½“æ‰§è¡Œæ“ä½œäº†ï¼Œæ‰§è¡ŒæˆåŠŸä¹‹åï¼Œä¼šç”Ÿæˆ .terraform/terraform.state æ–‡ä»¶æ¥è®°å½•æ‰§è¡Œåçš„èµ„æºçŠ¶æ€ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤ terraform show å‘½ä»¤æ¥æŸ¥çœ‹\nâ¯ terraform show # aws_lightsail_instance.Example-sig: resource \u0026#34;aws_lightsail_instance\u0026#34; \u0026#34;Example-sig\u0026#34; { arn = \u0026#34;arn:aws:lightsail:ap-southeast-1:090767794770:Instance/21cb0ea5-e814-4307-8606-01348d98be15\u0026#34; availability_zone = \u0026#34;ap-southeast-1c\u0026#34; blueprint_id = \u0026#34;ubuntu_20_04\u0026#34; bundle_id = \u0026#34;nano_2_0\u0026#34; cpu_count = 1 created_at = \u0026#34;2021-11-08T05:49:05Z\u0026#34; id = \u0026#34;Example-Sig\u0026#34; ipv6_address = \u0026#34;2406:da18:8ae:4b02:1f2:4ff1:daa1:6a8c\u0026#34; ipv6_addresses = [ \u0026#34;2406:da18:8ae:4b02:1f2:4ff1:daa1:6a8c\u0026#34;, ] is_static_ip = true key_pair_name = \u0026#34;LightsailDefaultKeyPair\u0026#34; name = \u0026#34;Example-Sig\u0026#34; private_ip_address = \u0026#34;172.26.45.249\u0026#34; public_ip_address = \u0026#34;54.220.33.133\u0026#34; ram_size = 0.5 tags = { \u0026#34;Example\u0026#34; = \u0026#34;\u0026#34; } tags_all = { \u0026#34;Example\u0026#34; = \u0026#34;\u0026#34; } username = \u0026#34;ubuntu\u0026#34; } # aws_lightsail_instance_public_ports.Example-sig-public-ports: resource \u0026#34;aws_lightsail_instance_public_ports\u0026#34; \u0026#34;Example-sig-public-ports\u0026#34; { id = \u0026#34;Example-Sig-987241840\u0026#34; instance_name = \u0026#34;Example-Sig\u0026#34; port_info { cidrs = [ \u0026#34;0.0.0.0/0\u0026#34;, ] from_port = 0 protocol = \u0026#34;tcp\u0026#34; to_port = 65535 } port_info { cidrs = [ \u0026#34;0.0.0.0/0\u0026#34;, ] from_port = 0 protocol = \u0026#34;udp\u0026#34; to_port = 65535 } } # aws_lightsail_static_ip.Example-sig-ip: resource \u0026#34;aws_lightsail_static_ip\u0026#34; \u0026#34;Example-sig-ip\u0026#34; { arn = \u0026#34;arn:aws:lightsail:ap-southeast-1:090767794770:StaticIp/3f0298e0-efeb-4429-9574-156fef12a48f\u0026#34; id = \u0026#34;Example-EIP\u0026#34; ip_address = \u0026#34;54.220.33.133\u0026#34; name = \u0026#34;Example-EIP\u0026#34; support_code = \u0026#34;313963776615/54.220.33.133\u0026#34; } # aws_lightsail_static_ip_attachment.Example-sig-ip-attache: resource \u0026#34;aws_lightsail_static_ip_attachment\u0026#34; \u0026#34;exmaple-sig-ip-attache\u0026#34; { id = \u0026#34;Example-EIP\u0026#34; instance_name = \u0026#34;Example-Sig\u0026#34; ip_address = \u0026#34;54.220.33.133\u0026#34; static_ip_name = \u0026#34;Example-EIP\u0026#34; } ä¹‹åæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ›´æ–°èµ„æºå®šä¹‰æ–‡ä»¶ï¼Œç„¶åæ‰§è¡Œ plan \u0026amp; apply æ¥æ›´æ–°äº‘ä¸Šçš„èµ„æºäº†ï¼Œå¦‚æœèµ„æºä¸éœ€è¦äº†ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ terraform destroy ä¸€æ¡å‘½ä»¤æ¥é”€æ¯æ‰€æœ‰èµ„æºã€‚\næ€»ç»“ æœ¬æ–‡ä»¥ç®¡ç†ç®€å•çš„AWS Lightsailèµ„æºä¸ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨Terraformæ¥ç®¡ç†äº‘ä¸Šçš„èµ„æºã€‚é€šè¿‡ä¸€å£°æ˜æ€§çš„ä»£ç æ¥å®šä¹‰æˆ‘ä»¬éœ€è¦çš„èµ„æºï¼ŒåŒæ—¶èµ„æºå®šä¹‰ä»£ç å¯ä»¥é€šè¿‡ç‰ˆæœ¬ç®¡ç†å·¥å…·è¿›è¡Œç‰ˆæœ¬åŒ–ç®¡ç†ï¼Œè¿›ä¸€æ­¥å®ç°IaCçš„å·¥ä½œæ–¹å¼ã€‚\nè¿™ä¹ˆæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯Terraformçš„æœ¬åœ°æ‰§è¡Œæ¨¡å¼ï¼Œé™¤äº†åœ¨æœ¬åœ°æ‰§è¡Œä¹‹å¤–ï¼ŒTerraformè¿˜æä¾›äº†æ‰§è¡Œåç«¯ï¼ˆBackendï¼‰çš„åŠŸèƒ½ï¼Œå°±å¯ä»¥å°†æ‰§è¡Œæ”¾åˆ°äº‘ä¸Šçš„ä¸€äº›æ‰§è¡Œç¯å¢ƒï¼Œèµ„æºçŠ¶æ€çš„ç®¡ç†ä¹Ÿå°†ä¼šç»´æŠ¤åœ¨Backendç«¯ï¼Œæ–¹ä¾¿å®ç°CI/CD Pipelineï¼Œä»¥åŠGitOpsçš„æ–¹å¼ã€‚å…¶ä¸­Hashicorpçš„Terraform Cloudå°±æ˜¯ä¸€ä¸ªBackendã€‚ä¸‹ä¸€ç¯‡æ–‡ç« å°†ç¤ºä¾‹å°†è¯¥é¡¹ç›®æ”¾åˆ°Terraform Cloudä¸Šå»æ‰§è¡Œã€‚\n","date":"November 23, 2021","hero":"/zh/posts/devops/tf-aws-lightsail/tf-aws.jpg","permalink":"/zh/posts/devops/tf-aws-lightsail/","summary":"Terraformæ˜¯ä¸€ç§å¼€æºåŸºç¡€è®¾æ–½åŠä»£ç ï¼ˆIaCï¼‰çš„å·¥å…·ï¼Œå¯æä¾›ä¸€è‡´çš„CLIï¼ˆå‘½ä»¤è¡Œæ¥å£)å·¥ä½œæµæ¥ç®¡ç†æ•°ç™¾ä¸ªäº‘æœåŠ¡ï¼Œå°†äº‘APIç¼–ç ä¸ºå£°æ˜æ€§çš„é…ç½®æ–‡ä»¶è¿›è¡Œç®¡ç†ã€‚\næœ¬æ–‡åˆ›å»ºä¸€ä¸ªç®¡ç†AWS Lightsailå®ä¾‹çš„ä¾‹å­æ¥å…¥é—¨Terraformçš„ä½¿ç”¨ã€‚\nå®‰è£…Terraform CLI è¦ä½¿ç”¨Terramformï¼Œé¦–å…ˆè¦åœ¨æœ¬åœ°ç³»ç»Ÿå®‰è£…Terraformå‘½ä»¤è¡Œå·¥å…·ã€‚HashiCorpæä¾›äº†é¢„ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶åˆ†å‘åŒ…ï¼Œå¯ä»¥é€šè¿‡(https://www.terraform.com/downolads.html) ç›´æ¥ä¸‹è½½ç›¸åº”å¹³å°çš„äºŒè¿›åˆ¶åŒ…ï¼Œè§£å‹åæ”¾åˆ°ç›¸åº”çš„æ‰§è¡Œè·¯å¾„ã€‚ä¹Ÿå¯ä»¥é€šè¿‡ä¸€äº›è½¯ä»¶åŒ…ç®¡ç†å·¥å…·å®‰è£…ï¼Œä¾‹å¦‚åœ¨Linux/OS Xä¸Šé€šè¿‡LinuxBrew/HomeBrewè¿›è¡Œå®‰è£…ï¼Œåœ¨Windowsä¸Šé€šè¿‡Chocolateyè¿›è¡Œå®‰è£…ã€‚\nè¿™é‡Œæˆ‘ä»¬ç¤ºä¾‹åœ¨Linuxä¸Šæ˜¯ä½¿ç”¨LinuxBrewè¿›è¡Œå®‰è£…\n\u0026gt; brew install terraform å®‰è£…å®Œæˆåï¼Œå¯ä»¥æŸ¥çœ‹å…¶ç‰ˆæœ¬\nâ¯ terraform -version Terraform v1.0.11 on linux_amd64 ä½¿ç”¨-helpæŸ¥çœ‹å…¶å¯ç”¨å‘½ä»¤ï¼Œå®‰è£…æˆåŠŸåï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨Terraformæ¥åˆ›å»ºç›¸åº”çš„åŸºç¡€è®¾æ–½é¡¹ç›®äº†ã€‚\nAWSè´¦å·å‡†å¤‡ æœ¬æ–‡å°†é€šè¿‡åˆ›å»ºä¸€ä¸ªç®¡ç†AWS Lightsialå®ä¾‹çš„é¡¹ç›®æ¥å°è¯•Terraformï¼Œå› æ­¤éœ€è¦ä¸€ä¸ªAWSè´¦å·ï¼Œä»¥åŠåœ¨æœ¬åœ°ç¯å¢ƒå®‰è£…å’Œé…ç½®å¥½AWS CLIå·¥å…·çš„è®¿é—®å‡­æ®ã€‚\nå®‰è£…å’Œé…ç½®AWS CLIï¼Œè¯·å‚è€ƒå…¶æ–‡æ¡£ (https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html) ã€‚ é…ç½®å®Œæˆä¹‹åï¼Œå¯ä»¥åœ¨æœ¬åœ°å‘½ä»¤è¡Œç»ˆç«¯è®¿é—®ç›¸åº”çš„AWSèµ„æºã€‚\nåˆ›å»ºå¹¶åˆå§‹åŒ–Terraformé¡¹ç›® Terraformåœ¨æœ¬åœ°é€šè¿‡æ–‡ä»¶å¤¹æ¥ç®¡ç†ä¸€ä¸ªåŸºç¡€è®¾æ–½é¡¹ç›®çš„å£°æ˜æ€§ä»£ç ï¼Œä¾‹å¦‚æˆ‘ä»¬åœ¨æœ¬åœ°åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹\n\u0026gt; mkdir mylightsail \u0026gt; cd mylightsail/ è¿›å…¥æ–‡ä»¶å¤¹åï¼Œåˆ›å»ºä¸€ä¸ªä»¥ .tf ä½œä¸ºåç¼€çš„æ–‡ä»¶ï¼Œä¾‹å¦‚ main.tf\n\u0026gt; touch main.tf ç„¶åä½¿ç”¨ç¼–è¾‘å™¨æ‰“å¼€æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå†™å…¥ä»¥ä¸‹ä»£ç å—\nterraform { required_providers { aws = { source = \u0026#34;hashicorp/aws\u0026#34; version = \u0026#34;~\u0026gt; 3.65\u0026#34; } } } # Configure the AWS Provider provider \u0026#34;aws\u0026#34; { region = \u0026#34;ap-southeast-1\u0026#34; } å…¶ä¸­ terraform/required_providers å—å®šä¹‰äº†è¯¥é¡¹ç›®éœ€è¦çš„ Providerï¼ŒTerraformæ˜¯é€šè¿‡ä¸åŒçš„Provideræ¥ç®¡ç†ç›¸åº”çš„åŸºç¡€è®¾æ–½èµ„æºçš„ï¼Œå¯åˆ° (https://registry.","tags":["terraform","aws"],"title":"TFç®¡ç†AWS LIGHTSAILå®ä¾‹"},{"categories":["Windows"],"contents":"ç°åœ¨Windows ï¼ˆ10ï¼‰æ˜¯è¶Šä¾†è¶Šå‘Linuxé è¿‘äº†ï¼Œå¯¹äºå¼€å‘è€…å¼€è¯´ï¼Œç‰¹åˆ«æ˜¯åœ¨Windowsä¸Šçš„Linuxå­ç³»ç»Ÿéå¸¸å¥½ç”¨ã€‚\nWSL2ï¼ˆWindows Subsystem for Linux ï¼‰æ˜¯Windows 10ä¸Šçš„ä¸€ä¸ªå·¥å…·ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨Windowsä¸Šç›´æ¥è¿è¡ŒLinuxç¯å¢ƒï¼Œä½¿å¾—åœ¨Windowsç³»ç»Ÿä¸Šè¿›è¡ŒLinuxçš„åŸç”Ÿä½“éªŒã€‚\nå¯¹äºWSL2ï¼Œå…¶åº•å±‚é€šè¿‡å¾®è½¯çš„å†…ç½®è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆHyper-Vï¼‰å®ç°Linuxçš„ç¯å¢ƒã€‚æœ¬æ–‡å°†ä¸€æ­¥æ­¥çŸ¥é“å¦‚ä½•åœ¨Windows 10ä¸Šå¯ç”¨WSL2ï¼Œå¹¶å®‰è£…ä¸€ä¸ªUbuntu 20.04åˆ†å‘ç‰ˆæœ¬çš„Linuxã€‚\nå‰ææ¡ä»¶ æƒ³è¦åœ¨Windows 10ä¸Šå¯ç”¨WLS2ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nWindows 10 ç‰ˆæœ¬ 1903 Build 19362ï¼Œæˆ–é«˜äºè¯¥ç‰ˆæœ¬ å¦‚æœæ˜¯ARM64çš„ç³»ç»Ÿï¼Œåˆ™éœ€è¦ç‰ˆæœ¬2004 Build 19041ï¼Œæˆ–é«˜äºè¯¥ç‰ˆæœ¬ æ­¥éª¤ä¸€ã€€- ä¸ºWSLå¯ç”¨WindowsæœåŠ¡ æƒ³è¦åœ¨Windows 10ä¸Šè¿è¡ŒWSLï¼Œé¦–å…ˆéœ€è¦å¯ç”¨Windowsä¸Šçš„ä¸€äº›æœåŠ¡ï¼Œè¿™äº›æœåŠ¡é»˜è®¤æ˜¯å…³é—­çš„ã€‚\nå¼€å§‹èœå•ï¼Œæœç´¢ PowerShellï¼Œå³é”® PowerShellï¼Œé€‰æ‹©ä½¿ç”¨ç®¡ç†å‘˜è¿è¡Œã€‚\nåœ¨æ‰“å¼€çš„ PowerShell ç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nPS C:\\Windows\\system32\u0026gt; dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart [dism.exe]æ˜¯Windowsçš„éƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†å·¥å…·ï¼Œä¸Šé¢çš„å‘½ä»¤å¼€å¯äº†WSLçš„åŠŸèƒ½ã€‚\nä»¥ä¸Šå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œç»§ç»­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å¼€å¯Hyper-Vçš„åŠŸèƒ½\nPS C:\\Windows\\system32\u0026gt; dism.exe /online /enable-feature /featurename:VirutalMachinePlatform /all /norestart å®Œæˆä»¥ä¸Šæ“ä½œä¹‹åï¼Œéœ€è¦é‡å¯Windowsæ“ä½œç³»ç»Ÿï¼Œé‡å¯ä¹‹åå†æ¬¡ç™»é™†ç³»ç»Ÿã€‚\næ¥ä¸‹æ¥éœ€è¦ä»å¾®è½¯ä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„Linuxå†…æ ¸å‡çº§åŒ…å¹¶å®‰è£…ï¼Œä¸‹è½½å®‰è£…åŒ… wsl_update_x64.msiï¼Œä¸‹è½½å®Œæˆåç›´æ¥å®‰è£…ã€‚\nå®Œæˆä¹‹åï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥è®¾ç½®wslä½¿ç”¨çš„é»˜è®¤ç‰ˆæœ¬\nPS C:\\Windows\\system32\u0026gt; wsl --set-default-version 2 è¿™é‡Œæˆ‘ä»¬å°†é»˜è®¤è®¾ç½®ä¸º wsl 2 ã€‚\nä¸Šè¿°æ­¥éª¤å°±å®Œæˆäº†WSL2çš„å¯ç”¨ï¼Œæ¥ä¸‹æ¥å°†ä½¿ç”¨WSL2å®‰è£…åŸºäºLinuxçš„å‘è¡Œç‰ˆæœ¬ï¼ˆUbuntu 20.04ï¼‰ã€‚\næ­¥éª¤äºŒã€€- ä½¿ç”¨WSLå®‰è£…Ubuntu 20.04 åœ¨å¼€å¯WSLåŠŸèƒ½ä¹‹åï¼Œå®‰è£…ä¸€ä¸ªLinuxçš„åˆ†å‘ç‰ˆå¾ˆç®€å•ï¼Œåªéœ€è¦æ‰“å¼€Windowsåº”ç”¨å•†åº—ï¼ˆMicrosoft Storeï¼‰ï¼Œè¿™é‡Œæˆ‘ä»¬å°†å®‰è£…Ubuntu 20.04åˆ†å‘ç‰ˆã€‚\næ‰“å¼€åº”ç”¨å•†åº—ä¹‹åï¼Œç›´æ¥åœ¨åº”ç”¨å•†åº—ä¸­æœç´¢ Linux ï¼Œå°†çœ‹æœ‰å¾ˆå¤šåˆ†å‘ç‰ˆæœ¬çš„é€‰é¡¹ï¼Œè¿™é‡Œé€‰æ‹© Ubuntu 20.04ï¼Œç‚¹å‡» è·å– å°†åº”ç”¨åŠ å…¥è´¦å·ï¼Œç„¶ååœ¨ç‚¹å‡» å®‰è£… æŒ‰é’®è¿›è¡Œå®‰è£…ã€‚\nå®‰è£…å®Œæˆä¹‹åï¼Œå°±å¯ä»¥ç‚¹å‡» å¯åŠ¨ è¿è¡ŒUbuntuå­ç³»ç»Ÿï¼Œç¬¬ä¸€æ¬¡è¿è¡Œéœ€è¦ä¸€äº›æ—¶é—´æ¥è¿›è¡Œåˆå§‹åŒ–é…ç½®ï¼Œç„¶åä¼šæç¤ºè¾“å…¥Linuxç³»ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ã€‚\nè¿™é‡Œçš„ç”¨æˆ·åå’Œç§˜å¯†ä¸éœ€è¦ä¸Windowsç³»ç»Ÿçš„ç”¨æˆ·åå’Œå¯†ç ä¸€è‡´ï¼Œä½†å¯ä»¥é€šè¿‡sudoæ¥è·å–ç®¡ç†æƒé™ã€‚\nå½“å®Œæˆåˆå§‹åŒ–ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥Linuxå­ç³»ç»Ÿäº†ï¼Œå½“ç„¶æ˜¯ä»¥ç»ˆç«¯çš„æ–¹å¼ã€‚\næ­¥éª¤ä¸‰ - å®‰è£…Wdindowsç»ˆç«¯åº”ç”¨ï¼ˆWindows Terminalï¼‰ å®‰è£…çš„Ubuntuå­ç³»ç»Ÿæä¾›äº†ä¸€ä¸ªé»˜è®¤çš„ç»ˆç«¯ï¼Œä¸è¿‡å¾®è½¯å¼€æºäº†ä¸€ä¸ªWindowsä¸Šçš„ç»ˆç«¯å·¥å…· - Windows Terminalï¼Œè¯¥å·¥å…·æ”¯æŒå¾ˆå¤šè‡ªå®šä¹‰é…ç½®ï¼ŒåŒæ—¶æ”¯æŒWindowsçš„Powershellï¼Œä¹Ÿæ”¯æŒLinuxå­ç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥å®‰è£…ä½¿ç”¨ã€‚\nç›´æ¥åœ¨åº”ç”¨å•†åº—æœç´¢ Terminal ï¼Œé€‰æ‹© Windows Terminal è¿›è¡Œå®‰è£…ï¼Œå®‰è£…å®Œæˆä¹‹åå¯é€šè¿‡å¼€å§‹èœå•å¯åŠ¨\nWindows Terminalé»˜è®¤æ˜¯æ‰“å¼€Powershellçš„ï¼Œä¸è¿‡å…¶æ”¯æŒå¤šæ ‡ç­¾ï¼Œç‚¹å‡»æ ‡é¢˜æ ä¸Š + æœåŠ¡æ—è¾¹çš„ä¸‹æ‹‰æŒ‰é’®ï¼Œé€‰æ‹©Ubuntu-20.04ï¼Œæ–°æ ‡ç­¾å°±ä¼šæ‰“å¼€Ubuntuçš„è¿™ä¸ªå­ç³»ç»Ÿç»ˆç«¯\nWindows Termialæ”¯æŒå¾ˆå¤šè‡ªå®šä¹‰é…ç½®ï¼Œå…·ä½“è¯·å‚è€ƒå…¶æ–‡æ¡£ã€‚\næ€»ç»“ ç°åœ¨æˆ‘ä»¬åœ¨Windows 10ä¸Šå®‰è£…äº†ä¸€ä¸ªå…¨åŠŸèƒ½çš„Linuxç¯å¢ƒï¼Œå¯ä»¥ä½¿ç”¨è¯¥ç¯å¢ƒè¿›è¡Œä¸€äº›Linxuçš„ç³»ç»Ÿå®éªŒï¼Œä»¥åŠè¿›è¡ŒLinxuåº”ç”¨çš„å¼€å‘ï¼ˆé…åˆVSCodeçš„wslæ’ä»¶æ›´åŠ æ–¹ä¾¿ï¼‰ã€‚é™¤äº†Ubuntuåˆ†å‘ç‰ˆï¼Œå¾®è½¯åº”ç”¨å•†åº—é‡Œè¿˜æä¾›äº†å…¶ä»–æ”¯æŒçš„åˆ†å‘ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬Debianï¼ŒopenSUSEï¼ŒKaliç­‰ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©å®‰è£…å¤šä¸ªç¯å¢ƒã€‚\n","date":"June 8, 2021","hero":"/zh/posts/windows/windows10-wsl2/windows10-wsl2.jpg","permalink":"/zh/posts/windows/windows10-wsl2/","summary":"ç°åœ¨Windows ï¼ˆ10ï¼‰æ˜¯è¶Šä¾†è¶Šå‘Linuxé è¿‘äº†ï¼Œå¯¹äºå¼€å‘è€…å¼€è¯´ï¼Œç‰¹åˆ«æ˜¯åœ¨Windowsä¸Šçš„Linuxå­ç³»ç»Ÿéå¸¸å¥½ç”¨ã€‚\nWSL2ï¼ˆWindows Subsystem for Linux ï¼‰æ˜¯Windows 10ä¸Šçš„ä¸€ä¸ªå·¥å…·ï¼Œå…è®¸å¼€å‘äººå‘˜åœ¨Windowsä¸Šç›´æ¥è¿è¡ŒLinuxç¯å¢ƒï¼Œä½¿å¾—åœ¨Windowsç³»ç»Ÿä¸Šè¿›è¡ŒLinuxçš„åŸç”Ÿä½“éªŒã€‚\nå¯¹äºWSL2ï¼Œå…¶åº•å±‚é€šè¿‡å¾®è½¯çš„å†…ç½®è™šæ‹ŸåŒ–æŠ€æœ¯ï¼ˆHyper-Vï¼‰å®ç°Linuxçš„ç¯å¢ƒã€‚æœ¬æ–‡å°†ä¸€æ­¥æ­¥çŸ¥é“å¦‚ä½•åœ¨Windows 10ä¸Šå¯ç”¨WSL2ï¼Œå¹¶å®‰è£…ä¸€ä¸ªUbuntu 20.04åˆ†å‘ç‰ˆæœ¬çš„Linuxã€‚\nå‰ææ¡ä»¶ æƒ³è¦åœ¨Windows 10ä¸Šå¯ç”¨WLS2ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š\nWindows 10 ç‰ˆæœ¬ 1903 Build 19362ï¼Œæˆ–é«˜äºè¯¥ç‰ˆæœ¬ å¦‚æœæ˜¯ARM64çš„ç³»ç»Ÿï¼Œåˆ™éœ€è¦ç‰ˆæœ¬2004 Build 19041ï¼Œæˆ–é«˜äºè¯¥ç‰ˆæœ¬ æ­¥éª¤ä¸€ã€€- ä¸ºWSLå¯ç”¨WindowsæœåŠ¡ æƒ³è¦åœ¨Windows 10ä¸Šè¿è¡ŒWSLï¼Œé¦–å…ˆéœ€è¦å¯ç”¨Windowsä¸Šçš„ä¸€äº›æœåŠ¡ï¼Œè¿™äº›æœåŠ¡é»˜è®¤æ˜¯å…³é—­çš„ã€‚\nå¼€å§‹èœå•ï¼Œæœç´¢ PowerShellï¼Œå³é”® PowerShellï¼Œé€‰æ‹©ä½¿ç”¨ç®¡ç†å‘˜è¿è¡Œã€‚\nåœ¨æ‰“å¼€çš„ PowerShell ç»ˆç«¯ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\nPS C:\\Windows\\system32\u0026gt; dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart [dism.exe]æ˜¯Windowsçš„éƒ¨ç½²æ˜ åƒæœåŠ¡å’Œç®¡ç†å·¥å…·ï¼Œä¸Šé¢çš„å‘½ä»¤å¼€å¯äº†WSLçš„åŠŸèƒ½ã€‚\nä»¥ä¸Šå‘½ä»¤æ‰§è¡ŒæˆåŠŸä¹‹åï¼Œç»§ç»­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥å¼€å¯Hyper-Vçš„åŠŸèƒ½\nPS C:\\Windows\\system32\u0026gt; dism.exe /online /enable-feature /featurename:VirutalMachinePlatform /all /norestart å®Œæˆä»¥ä¸Šæ“ä½œä¹‹åï¼Œéœ€è¦é‡å¯Windowsæ“ä½œç³»ç»Ÿï¼Œé‡å¯ä¹‹åå†æ¬¡ç™»é™†ç³»ç»Ÿã€‚\næ¥ä¸‹æ¥éœ€è¦ä»å¾®è½¯ä¸‹è½½ä¸€ä¸ªæœ€æ–°çš„Linuxå†…æ ¸å‡çº§åŒ…å¹¶å®‰è£…ï¼Œä¸‹è½½å®‰è£…åŒ… wsl_update_x64.msiï¼Œä¸‹è½½å®Œæˆåç›´æ¥å®‰è£…ã€‚\nå®Œæˆä¹‹åï¼Œä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œ PowerShellï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤æ¥è®¾ç½®wslä½¿ç”¨çš„é»˜è®¤ç‰ˆæœ¬\nPS C:\\Windows\\system32\u0026gt; wsl --set-default-version 2 è¿™é‡Œæˆ‘ä»¬å°†é»˜è®¤è®¾ç½®ä¸º wsl 2 ã€‚\nä¸Šè¿°æ­¥éª¤å°±å®Œæˆäº†WSL2çš„å¯ç”¨ï¼Œæ¥ä¸‹æ¥å°†ä½¿ç”¨WSL2å®‰è£…åŸºäºLinuxçš„å‘è¡Œç‰ˆæœ¬ï¼ˆUbuntu 20.04ï¼‰ã€‚\næ­¥éª¤äºŒã€€- ä½¿ç”¨WSLå®‰è£…Ubuntu 20.","tags":["wsl"],"title":"Windows10ä¸Šå®‰è£…WSL2"},{"categories":["Windows"],"contents":"å¦‚ä»Šè™šæ‹ŸåŒ–å·²ç»éå¸¸æµè¡Œï¼Œå½“æˆ‘ä»¬ä½¿ç”¨Linuxæ¡Œé¢ç¯å¢ƒæ—¶ï¼Œå¯ä»¥é€šè¿‡å®‰è£…libvirtå’ŒQEMUç›´æ¥ä½¿ç”¨åŸºäºå†…æ ¸çš„è™šæ‹ŸåŒ–ï¼ˆKVMï¼‰æ¥åˆ›å»ºè™šæ‹Ÿæœºå¹¶å®‰è£…å…¶ä»–ç±»å‹çš„æ“ä½œç³»ç»Ÿã€‚åœ¨åŸºäºLinuxçš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡oVirtæˆ–è€…PVEç­‰åŸºäºKVMçš„è™šæ‹ŸåŒ–æ–¹æ¡ˆæ¥å®ç°è™šæ‹Ÿæœºç¯å¢ƒã€‚\nå½“æˆ‘ä»¬æƒ³é€šè¿‡å®˜æ–¹isoç³»ç»Ÿé•œåƒå®‰è£…æ¯”è¾ƒæ–°çš„Windowsï¼ˆä¾‹å¦‚Windows 10ï¼ŒWindows Server 2019ç­‰ï¼‰ï¼Œåœ¨è¿›å…¥åˆ°é€‰æ‹©å®‰è£…ç£ç›˜ï¼Œä¼šå‘ç°æ‰¾ä¸åˆ°åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nè¿™æ˜¯å› ä¸ºåœ¨å®˜æ–¹çš„isoé•œåƒä¸­çš„WidnowsæœªåŒ…å«é’ˆå¯¹KVMçš„virtio-winé©±åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åŸºäºWindowsçš„isoé•œåƒï¼ŒåŠ è½½virtio-winçš„ç›¸åº”é©±åŠ¨ä¹‹åï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªåŒ…å«äº†virtio-winé©±åŠ¨çš„isoé•œåƒæ–‡ä»¶ã€‚\nå…³äºvirtio-winçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ https://www.linux-kvm.org/page/WindowsGuestDrivers/Download_Drivers ã€‚\nå‰ææ¡ä»¶ ä¸ºäº†åˆ›å»ºä¸€ä¸ªåŠ è½½virtio-winé©±åŠ¨ä¹‹åçš„isoé•œåƒæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡†å¤‡ï¼š\nå…·æœ‰ç®¡ç†å‘˜æƒé™çš„Windows 10å·¥ä½œç³»ç»Ÿå¹¶å®‰è£…Windows ADK Windows 10çš„å®‰è£…isoæ–‡ä»¶ï¼ˆè¿™é‡Œä»¥Windows 10ä½œä¸ºä¾‹å­ï¼‰ virtio-winé©±åŠ¨çš„isoæ–‡ä»¶ (https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.196-1/virtio-win-0.1.196.iso) UltraISOå·¥å…· å‡†å¤‡å·¥ä½œ åˆ›å»ºå·¥ä½œç›®å½• å‡è®¾åœ¨ä½ çš„Windows 10ç³»ç»Ÿä¸Šæœ‰Dç›˜ï¼Œé‚£æˆ‘ä»¬åœ¨Dç›˜åˆ›å»ºç›¸åº”çš„å·¥ä½œç›®å½•ï¼Œä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€PowerShellï¼Œå¹¶æ‰§è¡Œ\nPS D:\\\u0026gt; mkdir D:\\mnt\\windows_temp,D:\\mnt\\boot,D:\\mnt\\install,D:\\virtio-win æå–Windowså®‰è£…æ–‡ä»¶ ä½¿ç”¨UltraISOå·¥å…·æ‰“å¼€windows 10çš„isoæ–‡ä»¶ï¼Œå¹¶å°†æ‰€æœ‰æ–‡ä»¶æå–åˆ°ç›®å½• *D:\\mnt\\windows_temp* ä¸‹\nç„¶åç»™Windowsçš„é•œåƒæ–‡ä»¶æˆæƒè¯»å†™\nPS D:\\\u0026gt; attrib -r C:\\mnt\\windows_temp\\sources\\*.wim /s æå–virtioé©±åŠ¨æ–‡ä»¶ ä½¿ç”¨UltraISOæ‰“å¼€ä¸‹è½½çš„virtio-winçš„isoæ–‡ä»¶ï¼ŒåŒæ ·æå–åˆ°ç›®å½• *D:\\virtio-win* ä¸‹ï¼Œç„¶åæŸ¥çœ‹æœ‰å“ªäº›w10ï¼ˆé’ˆå¯¹windowns10ï¼‰çš„é©±åŠ¨\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ 0.1.196 ç‰ˆæœ¬ä¸­ï¼ŒåŒ…å«äº†ä»¥ä¸‹w10ï¼ˆ64ä½ï¼‰çš„é©±åŠ¨ï¼Œä¸ºäº†æ–¹ä¾¿åé¢ä¸€æ¡å‘½ä»¤åŠ è½½æ‰€æœ‰é©±åŠ¨ï¼Œæˆ‘ä»¬æŠŠè¿™äº›é©±åŠ¨é‡æ–°æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹\nPS D:\\\u0026gt; cd virtio-win\\ PS D:\\virtio-win\\\u0026gt; mkdir w10 PS D:\\virtio-win\\\u0026gt; cp -r .\\Balloon\\w10\\amd64\\ .\\w10\\Balloon PS D:\\virtio-win\\\u0026gt; cp -r .\\NetKVM\\w10\\amd64\\ .\\w10\\NetKVM PS D:\\virtio-win\\\u0026gt; cp -r .\\pvpanic\\w10\\amd64\\ .\\w10\\pvpanic PS D:\\virtio-win\\\u0026gt; cp -r .\\qemufwcfg\\w10\\amd64\\ .\\w10\\qemufwcfg PS D:\\virtio-win\\\u0026gt; cp -r .\\qemupciserial\\w10\\amd64\\ .\\w10\\qemupciserial PS D:\\virtio-win\\\u0026gt; cp -r .\\qxldod\\w10\\amd64\\ .\\w10\\qxldod PS D:\\virtio-win\\\u0026gt; cp -r .\\sriov\\w10\\amd64\\ .\\w10\\sriov PS D:\\virtio-win\\\u0026gt; cp -r .\\viofs\\w10\\amd64\\ .\\w10\\viofs PS D:\\virtio-win\\\u0026gt; cp -r .\\viogpudo\\w10\\amd64\\ .\\w10\\viogpudo PS D:\\virtio-win\\\u0026gt; cp -r .\\vioinput\\w10\\amd64\\ .\\w10\\vioinput PS D:\\virtio-win\\\u0026gt; cp -r .\\viorng\\w10\\amd64\\ .\\w10\\viorng PS D:\\virtio-win\\\u0026gt; cp -r .\\vioscsi\\w10\\amd64\\ .\\w10\\vioscsi PS D:\\virtio-win\\\u0026gt; cp -r .\\vioserial\\w10\\amd64\\ .\\w10\\vioserial PS D:\\virtio-win\\\u0026gt; cp -r .\\viostor\\w10\\amd64\\ .\\w10\\viostor å¦‚æœåˆ›å»ºçš„æ˜¯å…¶ä»–ç‰ˆæœ¬çš„Windowsç³»ç»Ÿï¼Œä¾‹å¦‚Windows Server 2019ï¼Œåˆ™æå–å¯¹åº”ç›®å½•ï¼ˆ2k19/ï¼‰ä¸‹çš„é©±åŠ¨ã€‚\nåŠ è½½virtioé©±åŠ¨ éœ€è¦åŠ è½½virtioé©±åŠ¨åˆ°Windowsé•œåƒæ–‡ä»¶ boot.wim å’Œ install.wim ã€‚\nåŠ è½½é©±åŠ¨åˆ°boot.wim æŒ‚è½½æå–å‡ºæ¥çš„ D:\\mnt\\windows_temp\\sources\\boot.wim æ–‡ä»¶åˆ°ç›®å½• *D:\\mnt\\boot* :\nå…ˆè·å–é•œåƒæ–‡ä»¶çš„ç´¢å¼•\nPS D:\\\u0026gt; Get-WindowsImage -ImagePath D:\\mnt\\windows_temp\\sources\\boot.wim ImageIndex : 1 ImageName : Microsoft Windows PE (x64) ImageDescription : Microsoft Windows PE (x64) ImageSize : 1,657,563,910 bytes ImageIndex : 2 ImageName : Microsoft Windows Setup (x64) ImageDescription : Microsoft Windows Setup (x64) ImageSize : 1,809,575,703 bytes ç„¶åæŒ‚è½½ç´¢å¼•2\nPS D:\\\u0026gt; Mount-WindowsImage -Path D:\\mnt\\boot\\ -ImagePath D:\\mnt\\windows_temp\\sources\\boot.wim -Index 2 Path : D:\\mnt\\boot\\ Online : False RestartNeeded : False æ¥ä¸‹æ¥å°±æ˜¯åŠ è½½æˆ‘ä»¬ä¹‹å‰æå–å‡ºæ¥çš„é©±åŠ¨\nPS D:\\\u0026gt; Add-WindowsDriver -Path D:\\mnt\\boot\\ -Driver D:\\virtio-win\\w10\\ -Recurse å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹é©±åŠ¨æ˜¯å¦å·²ç»åŠ è½½è¿›å»\nPS D:\\\u0026gt; Get-WindowsDriver -Path D:\\mnt\\boot\\ ç¡®å®šåŠ è½½æˆåŠŸåï¼Œå¸è½½é•œåƒæŒ‚è½½å¹¶ä¿å­˜\nPS D:\\\u0026gt; Dismount-WindowsImage -Path D:\\mnt\\boot\\ -Save åŠ è½½é©±åŠ¨åˆ°install.wim åŒæ ·ï¼Œé¦–å…ˆæŸ¥çœ‹ install.wim é•œåƒçš„ç´¢å¼•ï¼ˆä¸åŒç´¢å¼•æŒ‡å®šäº†åŒä¸€isoæ–‡ä»¶é‡Œçš„ç‰ˆæœ¬ï¼‰\nPS D:\\\u0026gt; Get-WindowsImage -ImagePath D:\\mnt\\windows_temp\\sources\\install.wim ImageIndex : 1 ImageName : Windows 10 æ•™è‚²ç‰ˆ ImageDescription : Windows 10 æ•™è‚²ç‰ˆ ImageSize : 15,543,804,395 bytes ImageIndex : 2 ImageName : Windows 10 ä¼ä¸šç‰ˆ ImageDescription : Windows 10 ä¼ä¸šç‰ˆ ImageSize : 15,543,958,390 bytes ImageIndex : 3 ImageName : Windows 10 ä¸“ä¸šç‰ˆ ImageDescription : Windows 10 ä¸“ä¸šç‰ˆ ImageSize : 15,540,672,790 bytes ImageIndex : 4 ImageName : Windows 10 ä¸“ä¸šæ•™è‚²ç‰ˆ ImageDescription : Windows 10 ä¸“ä¸šæ•™è‚²ç‰ˆ ImageSize : 15,543,742,813 bytes ImageIndex : 5 ImageName : Windows 10 ä¸“ä¸šå·¥ä½œç«™ç‰ˆ ImageDescription : Windows 10 ä¸“ä¸šå·¥ä½œç«™ç‰ˆ ImageSize : 15,543,773,604 bytes æŒ‚è½½æƒ³è¦åŠ è½½é©±åŠ¨çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ä¸“ä¸šç‰ˆ\nPS D:\\\u0026gt; Mount-WindowsImage -Path D:\\mnt\\install\\ -ImagePath D:\\mnt\\windows_temp\\sources\\install.wim -Index 3 Path : D:\\mnt\\install\\ Online : False RestartNeeded ï¼šFalse ç„¶ååŠ è½½é©±åŠ¨\nPS D:\\\u0026gt; Add-WindowsDriver -Path D:\\mnt\\install\\ -Driver D:\\virtio-win\\w10\\ -Recurse å¸è½½ä¿å­˜\nPS D:\\\u0026gt; Dismount-WindowsImage -Path D:\\mnt\\install\\ -Save åŒç†ï¼Œå¯ä»¥ç»§ç»­æŒ‚è½½å…¶ä»–ç´¢å¼•ï¼ˆç‰ˆæœ¬ï¼‰ï¼Œæ‰§è¡Œä»¥ä¸Šæ“ä½œï¼ŒåŠ è½½é©±åŠ¨ï¼Œç„¶åä¿å­˜ã€‚\nåˆ›å»ºæ–°çš„isoé•œåƒæ–‡ä»¶ è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨Windows ADKå¸¦çš„ oscdimg å·¥å…·æ¥åˆ›å»ºISOæ–‡ä»¶ï¼Œå®‰è£…å®ŒWindows ADKå·¥å…·ä¹‹åï¼Œè¿›å…¥ç›®å½• *C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Deployment Tools\\amd64\\Oscdimg*\nPS D:\\\u0026gt; cd \u0026#39;C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Deployment Tools\\amd64\\Oscdimg\u0026#39; PS C:\\Program Files (x86)\\Windows Kits\\10\\Assessment and Deployment Kit\\Deployment Tools\\amd64\\Oscdimg\u0026gt; .\\oscdimg.exe -lcn_windows_10_virtio -m -u2 -bD:\\mnt\\windows_temp\\boot\\etfsboot.com D:\\mnt\\windows_temp\\ D:\\ISOFiles\\cn_windows_10_virtio_x64.iso åªæƒ³å¦‚ä¸Šå‘½ä»¤åï¼Œå°±ä¼šåœ¨ç›®å½• *D:\\ISOFiles* ç›®å½•ä¸‹åˆ›å»ºå‡ºä¸€ä¸ªåä¸º cn_windows_10_virtio_x64.iso çš„æ–‡ä»¶ã€‚\næœ€åå°è¯•ä½¿ç”¨æ–°åˆ›å»ºçš„isoæ–‡ä»¶æ¥å®‰è£…è™šæ‹Ÿæœºç³»ç»Ÿï¼Œåœ¨é€‰æ‹©é€‰æ‹©ç£ç›˜é©±åŠ¨å™¨æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜äº†\næ¥ä¸‹æ¥å°±å¯ä»¥æ­£å¸¸å®‰è£…äº†ã€‚\næ€»ç»“ æœ¬æ–‡ä»¥Windows 10çš„isoæ–‡ä»¶ä½œä¸ºç¤ºä¾‹ï¼Œæ¼”ç¤ºäº†å¦‚ä½•å°†virtio-winé©±åŠ¨åŠ è½½è¿›å»ï¼Œå¹¶ä¸”åˆ›å»ºæ–°çš„isoæ–‡ä»¶ï¼Œä½¿å¾—åœ¨åŸºäºKVMçš„è™šæ‹Ÿç¯å¢ƒä¹Ÿå¯ä»¥é¡ºåˆ©åŠ è½½è™šæ‹Ÿæœºç£ç›˜è¿›è¡ŒWindowsçš„å®‰è£…ã€‚å½“ç„¶æŸäº›è™šæ‹Ÿå‚å®¶ä¹Ÿä¼šç›´æ¥æä¾›ç›¸åº”çš„ç­¾åé©±åŠ¨ï¼Œåœ¨å®‰è£…è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡å¤šå¢åŠ ä¸€ä¸ªè™šæ‹ŸCDé©±åŠ¨å™¨æ¥åŠ è½½ç›¸åº”çš„é©±åŠ¨ã€‚\n","date":"June 8, 2021","hero":"/zh/posts/windows/windows10-virtio-image/window10-virtio.jpg","permalink":"/zh/posts/windows/windows10-virtio-image/","summary":"å¦‚ä»Šè™šæ‹ŸåŒ–å·²ç»éå¸¸æµè¡Œï¼Œå½“æˆ‘ä»¬ä½¿ç”¨Linuxæ¡Œé¢ç¯å¢ƒæ—¶ï¼Œå¯ä»¥é€šè¿‡å®‰è£…libvirtå’ŒQEMUç›´æ¥ä½¿ç”¨åŸºäºå†…æ ¸çš„è™šæ‹ŸåŒ–ï¼ˆKVMï¼‰æ¥åˆ›å»ºè™šæ‹Ÿæœºå¹¶å®‰è£…å…¶ä»–ç±»å‹çš„æ“ä½œç³»ç»Ÿã€‚åœ¨åŸºäºLinuxçš„æœåŠ¡å™¨ä¸Šï¼Œä¹Ÿå¯ä»¥é€šè¿‡oVirtæˆ–è€…PVEç­‰åŸºäºKVMçš„è™šæ‹ŸåŒ–æ–¹æ¡ˆæ¥å®ç°è™šæ‹Ÿæœºç¯å¢ƒã€‚\nå½“æˆ‘ä»¬æƒ³é€šè¿‡å®˜æ–¹isoç³»ç»Ÿé•œåƒå®‰è£…æ¯”è¾ƒæ–°çš„Windowsï¼ˆä¾‹å¦‚Windows 10ï¼ŒWindows Server 2019ç­‰ï¼‰ï¼Œåœ¨è¿›å…¥åˆ°é€‰æ‹©å®‰è£…ç£ç›˜ï¼Œä¼šå‘ç°æ‰¾ä¸åˆ°åˆ›å»ºçš„è™šæ‹Ÿç£ç›˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nè¿™æ˜¯å› ä¸ºåœ¨å®˜æ–¹çš„isoé•œåƒä¸­çš„WidnowsæœªåŒ…å«é’ˆå¯¹KVMçš„virtio-winé©±åŠ¨ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åŸºäºWindowsçš„isoé•œåƒï¼ŒåŠ è½½virtio-winçš„ç›¸åº”é©±åŠ¨ä¹‹åï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ªåŒ…å«äº†virtio-winé©±åŠ¨çš„isoé•œåƒæ–‡ä»¶ã€‚\nå…³äºvirtio-winçš„æ›´å¤šä¿¡æ¯ï¼Œå¯ä»¥å‚è€ƒ https://www.linux-kvm.org/page/WindowsGuestDrivers/Download_Drivers ã€‚\nå‰ææ¡ä»¶ ä¸ºäº†åˆ›å»ºä¸€ä¸ªåŠ è½½virtio-winé©±åŠ¨ä¹‹åçš„isoé•œåƒæ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦ä»¥ä¸‹å‡†å¤‡ï¼š\nå…·æœ‰ç®¡ç†å‘˜æƒé™çš„Windows 10å·¥ä½œç³»ç»Ÿå¹¶å®‰è£…Windows ADK Windows 10çš„å®‰è£…isoæ–‡ä»¶ï¼ˆè¿™é‡Œä»¥Windows 10ä½œä¸ºä¾‹å­ï¼‰ virtio-winé©±åŠ¨çš„isoæ–‡ä»¶ (https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.196-1/virtio-win-0.1.196.iso) UltraISOå·¥å…· å‡†å¤‡å·¥ä½œ åˆ›å»ºå·¥ä½œç›®å½• å‡è®¾åœ¨ä½ çš„Windows 10ç³»ç»Ÿä¸Šæœ‰Dç›˜ï¼Œé‚£æˆ‘ä»¬åœ¨Dç›˜åˆ›å»ºç›¸åº”çš„å·¥ä½œç›®å½•ï¼Œä»¥ç®¡ç†å‘˜æƒé™æ‰“å¼€PowerShellï¼Œå¹¶æ‰§è¡Œ\nPS D:\\\u0026gt; mkdir D:\\mnt\\windows_temp,D:\\mnt\\boot,D:\\mnt\\install,D:\\virtio-win æå–Windowså®‰è£…æ–‡ä»¶ ä½¿ç”¨UltraISOå·¥å…·æ‰“å¼€windows 10çš„isoæ–‡ä»¶ï¼Œå¹¶å°†æ‰€æœ‰æ–‡ä»¶æå–åˆ°ç›®å½• *D:\\mnt\\windows_temp* ä¸‹\nç„¶åç»™Windowsçš„é•œåƒæ–‡ä»¶æˆæƒè¯»å†™\nPS D:\\\u0026gt; attrib -r C:\\mnt\\windows_temp\\sources\\*.wim /s æå–virtioé©±åŠ¨æ–‡ä»¶ ä½¿ç”¨UltraISOæ‰“å¼€ä¸‹è½½çš„virtio-winçš„isoæ–‡ä»¶ï¼ŒåŒæ ·æå–åˆ°ç›®å½• *D:\\virtio-win* ä¸‹ï¼Œç„¶åæŸ¥çœ‹æœ‰å“ªäº›w10ï¼ˆé’ˆå¯¹windowns10ï¼‰çš„é©±åŠ¨\næˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ 0.1.196 ç‰ˆæœ¬ä¸­ï¼ŒåŒ…å«äº†ä»¥ä¸‹w10ï¼ˆ64ä½ï¼‰çš„é©±åŠ¨ï¼Œä¸ºäº†æ–¹ä¾¿åé¢ä¸€æ¡å‘½ä»¤åŠ è½½æ‰€æœ‰é©±åŠ¨ï¼Œæˆ‘ä»¬æŠŠè¿™äº›é©±åŠ¨é‡æ–°æ”¾åˆ°ä¸€ä¸ªç›®å½•ä¸‹\nPS D:\\\u0026gt; cd virtio-win\\ PS D:\\virtio-win\\\u0026gt; mkdir w10 PS D:\\virtio-win\\\u0026gt; cp -r .\\Balloon\\w10\\amd64\\ .\\w10\\Balloon PS D:\\virtio-win\\\u0026gt; cp -r .\\NetKVM\\w10\\amd64\\ .\\w10\\NetKVM PS D:\\virtio-win\\\u0026gt; cp -r .","tags":["virtualization"],"title":"åŠ è½½virtioé©±åŠ¨çš„Windows10å®‰è£…é•œåƒ"},{"categories":["Container"],"contents":"åœ¨æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆWindows, Mac or Linuxï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨Dockerå®¹å™¨çš„æ–¹å¼ï¼Œè·‘ä¸€ä¸ªMQTTçš„Brokerèµ·æ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„åº”ç”¨å¼€å‘è°ƒè¯•MQTTç›¸å…³çš„åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥Emqxä½œä¸ºMQTTçš„Brokeræ¥åšç¤ºä¾‹ã€‚\nç¯å¢ƒå‡†å¤‡ é¦–å…ˆéœ€è¦åœ¨æˆ‘ä»¬æœ¬åœ°çš„Workstationä¸Šå®‰è£…Dockerç¯å¢ƒ:\nWindows - å¦‚æœæ˜¯Windows 10ï¼Œæ¨èä½¿ç”¨Docker Desktopæˆ–è€…WSL2ï¼Œå¦‚æœæ˜¯10ä¸€ä¸‹ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨Docker Toolboxï¼Œæˆ–è€…åœ¨Windowsä¸Šè·‘ä¸€ä¸ªLinuxè™šæ‹Ÿæœºï¼Œç›´æ¥åœ¨è™šæ‹Ÿæœºé‡Œå®‰è£…Docker Mac - ä½¿ç”¨Docker Desktop Linux - ç›´æ¥å®‰è£…Dockerå¼•æ“ å¦‚æœé€‰æ‹©ä½¿ç”¨Docker Desktopï¼Œå¯ä»¥å‚è€ƒ Windowsä¸Šçš„Docker Desktop ã€‚\nDockerè¿è¡Œemqxå®¹å™¨ Emqxçš„å¼€å‘è€…å·²ç»æ„å»ºäº†å¯ç”¨çš„å®¹å™¨æ˜ åƒï¼Œæ”¾åœ¨Docker Hubä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¸éœ€è¦è‡ªå·±æ„å»ºæ˜ åƒï¼Œè€Œæ˜¯ç›´æ¥ä»Docker Hubä¸Šæ‹‰å–\n$ docker image pull emqx/emqx:v4.0.5 å¦‚æœæ˜¯åœ¨Windowsä¸Šä½¿ç”¨Docker Desktopï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤æ˜¯åœ¨PowerShellé‡Œæ‰§è¡Œã€‚\nä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ç›´æ¥å¯åŠ¨ä¸€ä¸ªemqxçš„å®¹å™¨\n$ docker image container run --name dev_emqx -d -p 18083:18083 -p 1883:1883 emqx/emqx:v4.0.5 å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è¿è¡Œæƒ…å†µ\n$ docker container ls docker container ls CONTAINER ID NAMES IMAGE CREATED ago STATUS PORTS COMMAND 7c93940c07a3 dev_emqx emqx/emqx:v4.0.5 39 minutes ago ago Up 39 minutes 4369/tcp, 5369/tcp, 6369/tcp, 8080/tcp, 8083-8084/tcp, 8883/tcp, 0.0.0.0:1883-\u0026gt;1883/tcp, 0.0.0.0:18083-\u0026gt;18083/tcp, 11883/tcp \u0026#34;/usr/bin/docker-entâ€¦\u0026#34; æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ˜ å°„äº†ä¸¤ä¸ªç«¯å£åˆ°æˆ‘ä»¬çš„ä¸»æœºä¸Š\n1883 : mqttç«¯å£ï¼Œç”¨æˆ·mqttå®¢æˆ·ç«¯è¿æ¥ 18083 : emqxçš„Webç®¡ç†ç•Œé¢ç«¯å£ï¼Œå¯ä»¥è®¿é—® http://localhost:18083/ ï¼Œé»˜è®¤çš„ç”¨æˆ·å adminï¼Œå¯†ç  public è¿™æ ·å°±è¿è¡Œäº†ä¸€ä¸ªå•èŠ‚ç‚¹çš„MQTT Brokerï¼Œä¸‹é¢æˆ‘ä»¬ä½¿ç”¨[MQTT.js](https://www.npmjs.com/package/mqtt]çš„å‘½ä»¤è¡Œå®¢æˆ·ç«¯å°è¯•è¿æ¥ï¼Œè®¢é˜…/å‘å¸ƒæ¶ˆæ¯ã€‚\nå®¢æˆ·ç«¯è¿æ¥ é¦–å…ˆä½¿ç”¨npmå®‰è£…MQTT.jsï¼Œå½“ç„¶å¦‚æœæ²¡æœ‰Nodeç¯å¢ƒï¼Œä¹Ÿå¯ä»¥é€‰æ‹©å…¶ä»–å®¢æˆ·ç«¯\n$ npm install mqtt -g è¿æ¥ä¸€ä¸ªå®¢æˆ·ç«¯è®¢é˜…ä¸€ä¸ªä¸»é¢˜ï¼ˆtopic/helloï¼‰\n$ mqtt sub -h localhsot -p 1883 -t \u0026#39;topic/hello\u0026#39; -v ç„¶åæ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯å‘ä¸»é¢˜å‘å¸ƒæ¶ˆæ¯\n$ mqtt pub -h localhsot -p 1883 -t \u0026#39;topic/hello\u0026#39; -m \u0026#34;{\\\u0026#34;message\\\u0026#34;:\\\u0026#34;Hello\\\u0026#34;,\\\u0026#34;timestamp\\\u0026#34;:\\\u0026#34;$(date +\u0026#39;%s\u0026#39;)\\\u0026#34;}\u0026#34; æŸ¥çœ‹å¦ä¸€ä¸ªè®¢é˜…çš„ç»ˆç«¯ï¼Œä¼šæ”¶åˆ°è¯¥æ¶ˆæ¯\nâ””â¯ mqtt sub -h localhost -p 1883 -t \u0026#39;topic/hello\u0026#39; -v topic/hello {\u0026#34;message\u0026#34;:\u0026#34;Hello\u0026#34;,\u0026#34;timestamp\u0026#34;:\u0026#34;1585189813\u0026#34;} æˆ‘ä»¬åœ¨è®¢é˜…çš„æ—¶å€™ï¼Œä½¿ç”¨äº†-vé€‰é¡¹ï¼Œæ‰€ä»¥æ¶ˆæ¯ä¼šæ‰“å°å‡ºä¸»é¢˜ä¿¡æ¯ã€‚\nMQTTå®¢æˆ·ç«¯ Java client MQTTFx - ä¸€ä¸ªJavaç¼–å†™çš„MQTTå›¾åƒç•Œé¢å®¢æˆ·ç«¯ MQTTX - è·¨å¹³å°MQTTæ¡Œé¢å®¢æˆ·ç«¯å·¥å…· ","date":"March 10, 2021","hero":"/zh/posts/container-tech/docker-mqtt-broker/docker-mqtt.webp","permalink":"/zh/posts/container-tech/docker-mqtt-broker/","summary":"åœ¨æˆ‘ä»¬çš„æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆWindows, Mac or Linuxï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“åœ°ä½¿ç”¨Dockerå®¹å™¨çš„æ–¹å¼ï¼Œè·‘ä¸€ä¸ªMQTTçš„Brokerèµ·æ¥ï¼Œæ–¹ä¾¿æˆ‘ä»¬çš„åº”ç”¨å¼€å‘è°ƒè¯•MQTTç›¸å…³çš„åŠŸèƒ½ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥Emqxä½œä¸ºMQTTçš„Brokeræ¥åšç¤ºä¾‹ã€‚\nç¯å¢ƒå‡†å¤‡ é¦–å…ˆéœ€è¦åœ¨æˆ‘ä»¬æœ¬åœ°çš„Workstationä¸Šå®‰è£…Dockerç¯å¢ƒ:\nWindows - å¦‚æœæ˜¯Windows 10ï¼Œæ¨èä½¿ç”¨Docker Desktopæˆ–è€…WSL2ï¼Œå¦‚æœæ˜¯10ä¸€ä¸‹ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨Docker Toolboxï¼Œæˆ–è€…åœ¨Windowsä¸Šè·‘ä¸€ä¸ªLinuxè™šæ‹Ÿæœºï¼Œç›´æ¥åœ¨è™šæ‹Ÿæœºé‡Œå®‰è£…Docker Mac - ä½¿ç”¨Docker Desktop Linux - ç›´æ¥å®‰è£…Dockerå¼•æ“ å¦‚æœé€‰æ‹©ä½¿ç”¨Docker Desktopï¼Œå¯ä»¥å‚è€ƒ Windowsä¸Šçš„Docker Desktop ã€‚\nDockerè¿è¡Œemqxå®¹å™¨ Emqxçš„å¼€å‘è€…å·²ç»æ„å»ºäº†å¯ç”¨çš„å®¹å™¨æ˜ åƒï¼Œæ”¾åœ¨Docker Hubä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œä¸éœ€è¦è‡ªå·±æ„å»ºæ˜ åƒï¼Œè€Œæ˜¯ç›´æ¥ä»Docker Hubä¸Šæ‹‰å–\n$ docker image pull emqx/emqx:v4.0.5 å¦‚æœæ˜¯åœ¨Windowsä¸Šä½¿ç”¨Docker Desktopï¼Œåˆ™ä¸Šé¢çš„å‘½ä»¤æ˜¯åœ¨PowerShellé‡Œæ‰§è¡Œã€‚\nä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ç›´æ¥å¯åŠ¨ä¸€ä¸ªemqxçš„å®¹å™¨\n$ docker image container run --name dev_emqx -d -p 18083:18083 -p 1883:1883 emqx/emqx:v4.0.5 å¯åŠ¨æˆåŠŸåï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹è¿è¡Œæƒ…å†µ\n$ docker container ls docker container ls CONTAINER ID NAMES IMAGE CREATED ago STATUS PORTS COMMAND 7c93940c07a3 dev_emqx emqx/emqx:v4.0.5 39 minutes ago ago Up 39 minutes 4369/tcp, 5369/tcp, 6369/tcp, 8080/tcp, 8083-8084/tcp, 8883/tcp, 0.","tags":["docker","mqtt"],"title":"æœ¬åœ°ç¯å¢ƒè¿è¡ŒMQTTå®¹å™¨"},{"categories":["DEVOPS"],"contents":"å‰è¨€ åŒ†åŒ†å¿™å¿™ç»“æŸäº†2020å¹´ï¼Œæƒ³ç€è¿˜æ˜¯è¦åœ¨2021å¹´çš„ç¬¬ä¸€ä¸ªæœˆè¦å†™ä¸€ç¯‡æ–‡ç« ã€‚åœ¨çœ‹äº†[Gitlab]æ¨é€çš„æ–‡ç« ä¹‹åï¼Œè‡ªå·±ä¹Ÿæ¯”è¾ƒè®¤åŒåœ¨DevOpså®è·µä¸­å¦‚æœä½¿ç”¨ä¸€ä¸ªä¸€ä½“åŒ–çš„CI/CDå¹³å°æˆ–è€…å·¥å…·æ‰€èƒ½å¸¦æ¥çš„å¥½å¤„ã€‚\nä¸è¿‡æ¯ä¸ªç»„ç»‡æˆ–è€…å›¢é˜Ÿæœ‰è‡ªèº«çš„ä¸€äº›è€ƒé‡å’Œå®é™…æƒ…å†µï¼Œå°±æ¯”å¦‚çš„å½“å‰æˆ‘åœ¨å·¥ä½œä¸­ä¹Ÿä½¿ç”¨äº†å¤šä¸ªå·¥å…·æ¥å®ç°æ•´ä¸ªCI/CDæµç¨‹ï¼Œä¼¼ä¹æ˜¯åˆ†ç¦»äº†CIå’ŒCDçš„è¿‡ç¨‹ï¼Œå› ä¸ºå…¬å¸æ›´åŠ è€ƒé‡äº†åšäº¤ä»˜çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§è€ƒé‡ï¼Œå¹¶æ²¡æœ‰åšåˆ°å®Œå…¨çš„æŒç»­å‘å¸ƒã€‚\næ‰€ä»¥è¿™ç¯‡æ–‡ç« ä»…ä»…æ˜¯æ¢è®¨ä¸€äº›ä¸€ä½“åŒ–CI/CDå¹³å°å¯ä»¥å¸¦æ¥çš„ä¼˜åŠ¿ã€‚\nCI/CD æŒç»­ç»§æ‰¿å’Œäº¤ä»˜ï¼ˆCI/CDï¼‰æ”¹å˜äº†æˆ‘ä»¬æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶åº”ç”¨çš„æ–¹å¼ã€‚CI/CDå·¥å…·è‡ªåŠ¨åŒ–è¿™äº›æµç¨‹ï¼Œå‡å°‘é”™è¯¯ç‡ï¼Œå¹¶ä¸”ä¼˜åŒ–äº†æ•´ä¸ªå·¥ä½œæµã€‚ä»£ç åœ¨æ•´ä¸ªå¼€å‘é˜¶æ®µä¸­è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå·²ç¡®ä¿åœ¨é”™è¯¯åˆ°è¾¾ç”Ÿäº§ä¹‹å‰å°±å°†å…¶æ•è·å¹¶ä¿®å¤ã€‚\nCI/CDå·¥å…·çš„ä½¿ç”¨å°†æŒç»­å¢åŠ å¹¶æ”¹å–„è½¯ä»¶å¼€å‘çš„æ–¹å¼ï¼Œåº”çš„éƒ¨ç½²ä¹Ÿä¸å†éœ€è¦æ˜¯æ¯å¹´ä¸€æ¬¡ï¼Œæ¯ä¸ªå­£åº¦ä¸€æ¬¡ï¼Œç”šè‡³æ¯ä¸ªæœˆä¸€æ¬¡ã€‚é€šè¿‡CI/CDï¼Œå¼€å‘è¿ç»´å›¢é˜Ÿå¯ä»¥ä¸€å¤©å†…éƒ¨ç½²å¤šæ¬¡ã€‚\n10ä¸ªCI/CDçš„ä¼˜ç‚¹ ä¸Šé¢è¯´äº†ä»€ä¹ˆæ˜¯CI/CDï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å…¶æœ‰å“ªäº›ä¼˜ç‚¹ã€‚\n1. æ›´å°‘çš„äº¤æ¥\nåœ¨å¼€å‘ç®¡é“ä¸­æ›´å¤šçš„äº¤æ¥ï¼Œé‚£å°†å¸¦æ¥æ›´å¤šçš„æ•…éšœç‚¹å’Œæ›´å¤šçš„å¤æ‚æ€§ã€‚\n2. å¢åŠ å¼€å‘é€Ÿåº¦\né€šè¿‡CI/CDï¼Œå¼€å‘çš„æ‰€æœ‰é˜¶æ®µéƒ½æ›´å¿«ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­æ›´å¿«çš„è¿­ä»£é€Ÿåº¦ä½¿æ¯ä¸ªå›¢é˜Ÿçš„å·¥ä½œæ•ˆç‡æ›´é«˜ï¼Œå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥æ›´æœ‰ä¿¡å¿ƒåœ°è½¬ç§»åˆ°å…¶ä»–é¡¹ç›®ã€‚\n3. æ›´å¤šçš„éƒ¨ç½²\næ¯ä¸¤å‘¨æˆ–æ›´é•¿æ—¶é—´å‘ç”Ÿä¸€æ¬¡çš„å‘å¸ƒï¼Œç°åœ¨å¯ä»¥æ¯å¤©æ¨é€å¤šæ¬¡ã€‚\n4. æ›´å¿«çš„æµ‹è¯•\nå¼€å‘å·¥ä½œæµç¨‹ä¸­ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„éƒ¨åˆ†è¢«ç§»é™¤ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä»äº‹å…¶ä»–é«˜ä»·å€¼çš„é¡¹ç›®ã€‚è‡ªåŠ¨åŒ–æµ‹è¯•è®©å›¢é˜Ÿå¯ä»¥æ›´å¿«é€Ÿåœ°è·å¾—åé¦ˆï¼Œå¹¶å°½æ—©å¤±è´¥ï¼Œè€Œä¸æ˜¯åœ¨ç”Ÿäº§ä¸­äº§ç”Ÿè¿™äº›é”™è¯¯ï¼Œæˆ–è€…æ›´ç³Ÿç³•åœ°å°†é”™è¯¯å¸¦åˆ°æœ€ç»ˆçš„å‘å¸ƒç‰ˆæœ¬ä¸­ã€‚\n5. æ›´å°‘çš„ä»£ç ç¼ºé™·\né€šè¿‡å¼€å‘æµç¨‹ä¸­å¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåœ¨ä»£ç ç¼ºé™·å‘ç”Ÿæ—¶å°±èƒ½åŠæ—¶æ•è·ï¼Œå¹¶é¿å…ä»£ç åˆå¹¶å…¥ä¸»åˆ†æ”¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ•´ä½“ä¸Šçš„å…·æœ‰æ›´é«˜çš„ä»£ç è´¨é‡ï¼Œå¹¶ä¸”æ¯ä¸ªå‘å¸ƒç‰ˆæœ¬éƒ½èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚\n6. å¢å¼ºåˆè§„æ€§\nåˆè§„æ€§ä»»åŠ¡å¯ä»¥çº³å…¥å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘å‘å¸ƒä¸åˆè§„åº”ç”¨çš„é£é™©ã€‚è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥ä½¿å¾—æ›´å®¹æ˜“å®Œæˆå®¡æ ¸ï¼Œå¹¶å¯ä»¥é˜²æ­¢é«˜ä»£ä»·çš„é”™è¯¯ã€‚\n7. æ›´å¤šçš„åˆ›æ–°æ—¶é—´\nèŠ±è´¹åœ¨é›†æˆç»´æŠ¤çš„æ—¶é—´è¶Šå°‘ï¼ŒITæ”¯å‡ºä¸å˜ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æ›´å¤šçš„æ—¶é—´æŠ•å…¥åˆ°å…¶ä»–åœ°æ–¹ã€‚\n8. æ›´å¼€å¿ƒçš„å¼€å‘è€… å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´æœ‰è‡ªä¿¡åœ°å·¥ä½œå’Œå¿«é€Ÿåœ°ä¿®å¤ç¼ºé™·ï¼Œè€Œä¸æ˜¯ç­‰ä¸Šå‡ ä¸ªæ˜ŸæœŸæ¥äº†è§£é”™è¯¯å‘ç”Ÿåœ¨å“ªé‡Œã€‚\n9. å‡å°‘ç®¡ç†è´¹ç”¨\nç»„ç»‡ä¸­å¼€å‘äººå‘˜çš„æ—¶é—´æ˜¯æœ‰é™çš„ï¼Œå¼€å‘æ—¶é—´æ˜¯å¯è®¡è´¹æ—¶é—´çš„å¾ˆå¤šå€ï¼Œè€Œæ‰‹åŠ¨æµ‹è¯•å’Œéƒ¨ç½²ä»£ç å¯èƒ½ä¼šç ´åæ•´ä¸ªITé¢„ç®—ã€‚è‡ªåŠ¨åŒ–çš„å·¥ä½œæµç¨‹å‡å°‘äº†æ‰‹åŠ¨ä»»åŠ¡ï¼Œå¯ä»¥ä½¿é¢„ç®—æ›´åŠ æœ‰æ•ˆã€‚\n. æµç¨‹ä¸€è‡´æ€§\nå¼€å‘æµç¨‹ä¸­å…·æœ‰æ›´é«˜çš„è‡ªåŠ¨åŒ–ç¨‹åº¦æ„å‘³ç€æ²¡äººä¼šå¿˜è®°è¯¥è¿‡ç¨‹ä¸­æ‰§è¡Œçš„æ­¥éª¤ï¼Œä¹Ÿä½¿å¾—æ„å»ºæ›´åŠ ä¸€è‡´ã€‚è¿™æ ·æ›´å®¹æ˜“åŸ¹è®­æ–°çš„å¼€å‘äººå‘˜ï¼Œç»„ç»‡ä¹Ÿå¯ä»¥æ›´åŠ å®¹æ˜“æ§åˆ¶å¦‚ä½•æ„å»ºï¼Œä»¥åŠä½•æ—¶è¿›è¡Œå‘å¸ƒã€‚\nä¸€ä½“å¼CI/CDä¼˜åŠ¿ ä¸Šé¢æ¦‚è¿°äº†CI/CDå¯ä»¥å¸¦æ¥çš„å¥½å¤„ï¼Œç„¶è€Œåœ¨å®é™…çš„å®è·µä¸­ï¼Œå¦‚ä½•çœŸæ­£åœ°è¡¡é‡ç”Ÿäº§åŠ›é€Ÿåº¦ï¼Œéœ€è¦è¯„ä¼°æ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‚¹ç‚¹æ»´æ»´ã€‚\næ— ç¼åœ°æŒç»­é›†æˆå’Œäº¤ä»˜åº”å…·æœ‰ä½¿åº”ç”¨ç¨‹åºä¸ºéƒ¨ç½²åšå¥½å‡†å¤‡æ‰€éœ€çš„ä¸€åˆ‡ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå¾ˆå¤šä½¿ç”¨CI/CDçš„ç»„ç»‡ç”±äºä½¿ç”¨çš„å·¥å…·è€Œé™·å…¥äº†æ— æ³•è¾¾åˆ°æœ€ä½³å·¥ä½œæµç¨‹çš„å›°å¢ƒã€‚\nä¸€ä¸ªå¯ä»¥åœ¨æ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸæä¾›å¯è§æ€§çš„åº”ç”¨ç¨‹åºæ˜¯ç¡®ä¿å’Œä¼˜åŒ–æ¯ä¸ªå¼€å‘é˜¶æ®µçš„æœ€ä½³æ–¹æ³•ï¼Œå½“ä¸€åˆ‡éƒ½åœ¨ä¸€ä¸ªå±‹æªä¸‹æ—¶ï¼Œå°±å®¹æ˜“å‘ç°æµç¨‹çš„ç“¶é¢ˆï¼Œä»¥åŠè¯„ä¼°å½±å“å¼€å‘é€Ÿåº¦çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚\nåœ¨å•ä¸ªDevOpså¹³å°ä¸‹çš„æ¯ä¸ªæ­¥éª¤éƒ½æä¾›äº†ä¸€æ¡ä¿¡æ¯ï¼Œå¯å°±æ˜¯å¦å‡†å¤‡å¥½åˆå¹¶ä»£ç åšå‡ºæ˜æ™ºçš„å†³å®šã€‚å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›æ­¥éª¤å¯ä»¥åœ¨æ²¡æœ‰ä¸€ä½“å¼CI/CDçš„è§£å†³æ–¹æ¡ˆçš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œä½†æ˜¯åŠŸèƒ½å…¨é¢çš„å·¥å…·å¯ä»¥åˆ›å»ºå•ä¸€çš„äº‹å®æ¥æºï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œå¯ä»¥æ›´å¿«åœ°ç›‘è§†æ¯ä¸ªæ­¥éª¤ï¼Œå¹¶å‡å°‘é—æ¼é”™è¯¯çš„å¯èƒ½æ€§ã€‚\nä¸€ä½“å¼CI/CDå¹³å°å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š\næ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å¯è§æ€§ æ‰€æœ‰å¼€å‘é˜¶æ®µçš„å•ä¸€çœŸå®æ¥æº æ— éœ€ç™»é™†å¤šä¸ªåº”ç”¨ç¨‹åº åœ¨ä¸€ä¸ªç•Œé¢ä¸Šå¯¼èˆªæ›´ç®€å• åªéœ€è¦å®‰è£…ï¼Œç»´æŠ¤ï¼Œæ‰©å±•ï¼Œå¤‡ä»½ä¸€ä¸ªåº”ç”¨ç¨‹åº æ›´å®¹æ˜“çš„æˆæƒç®¡ç† é™ä½è¿è¥è´¹ç”¨ å› æ­¤ï¼Œæ¨èåœ¨ç»„ç»‡æˆ–å›¢é˜Ÿä¸­æ„å»ºå•ä¸€çš„CI/CDå¹³å°æ¥åŠ é€Ÿåº”ç”¨åˆ›æ–°ï¼Œä¾‹å¦‚é€‰æ‹©ä½¿ç”¨ Gitlabï¼ŒGithubï¼Œä»¥åŠå„å¤§å…¬æœ‰äº‘æä¾›å•†å‘è¡Œçš„DevOpså¹³å°åŠå·¥å…·æ¥ä¼˜åŒ–æ•´ä¸ªCI/CDæµæ°´çº¿ã€‚\n","date":"January 25, 2021","hero":"/zh/posts/devops/single-application-cicd/single-application-cicd.png","permalink":"/zh/posts/devops/single-application-cicd/","summary":"å‰è¨€ åŒ†åŒ†å¿™å¿™ç»“æŸäº†2020å¹´ï¼Œæƒ³ç€è¿˜æ˜¯è¦åœ¨2021å¹´çš„ç¬¬ä¸€ä¸ªæœˆè¦å†™ä¸€ç¯‡æ–‡ç« ã€‚åœ¨çœ‹äº†[Gitlab]æ¨é€çš„æ–‡ç« ä¹‹åï¼Œè‡ªå·±ä¹Ÿæ¯”è¾ƒè®¤åŒåœ¨DevOpså®è·µä¸­å¦‚æœä½¿ç”¨ä¸€ä¸ªä¸€ä½“åŒ–çš„CI/CDå¹³å°æˆ–è€…å·¥å…·æ‰€èƒ½å¸¦æ¥çš„å¥½å¤„ã€‚\nä¸è¿‡æ¯ä¸ªç»„ç»‡æˆ–è€…å›¢é˜Ÿæœ‰è‡ªèº«çš„ä¸€äº›è€ƒé‡å’Œå®é™…æƒ…å†µï¼Œå°±æ¯”å¦‚çš„å½“å‰æˆ‘åœ¨å·¥ä½œä¸­ä¹Ÿä½¿ç”¨äº†å¤šä¸ªå·¥å…·æ¥å®ç°æ•´ä¸ªCI/CDæµç¨‹ï¼Œä¼¼ä¹æ˜¯åˆ†ç¦»äº†CIå’ŒCDçš„è¿‡ç¨‹ï¼Œå› ä¸ºå…¬å¸æ›´åŠ è€ƒé‡äº†åšäº¤ä»˜çš„ç¨³å®šæ€§å’Œå®‰å…¨æ€§è€ƒé‡ï¼Œå¹¶æ²¡æœ‰åšåˆ°å®Œå…¨çš„æŒç»­å‘å¸ƒã€‚\næ‰€ä»¥è¿™ç¯‡æ–‡ç« ä»…ä»…æ˜¯æ¢è®¨ä¸€äº›ä¸€ä½“åŒ–CI/CDå¹³å°å¯ä»¥å¸¦æ¥çš„ä¼˜åŠ¿ã€‚\nCI/CD æŒç»­ç»§æ‰¿å’Œäº¤ä»˜ï¼ˆCI/CDï¼‰æ”¹å˜äº†æˆ‘ä»¬æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²è½¯ä»¶åº”ç”¨çš„æ–¹å¼ã€‚CI/CDå·¥å…·è‡ªåŠ¨åŒ–è¿™äº›æµç¨‹ï¼Œå‡å°‘é”™è¯¯ç‡ï¼Œå¹¶ä¸”ä¼˜åŒ–äº†æ•´ä¸ªå·¥ä½œæµã€‚ä»£ç åœ¨æ•´ä¸ªå¼€å‘é˜¶æ®µä¸­è¿›è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œå·²ç¡®ä¿åœ¨é”™è¯¯åˆ°è¾¾ç”Ÿäº§ä¹‹å‰å°±å°†å…¶æ•è·å¹¶ä¿®å¤ã€‚\nCI/CDå·¥å…·çš„ä½¿ç”¨å°†æŒç»­å¢åŠ å¹¶æ”¹å–„è½¯ä»¶å¼€å‘çš„æ–¹å¼ï¼Œåº”çš„éƒ¨ç½²ä¹Ÿä¸å†éœ€è¦æ˜¯æ¯å¹´ä¸€æ¬¡ï¼Œæ¯ä¸ªå­£åº¦ä¸€æ¬¡ï¼Œç”šè‡³æ¯ä¸ªæœˆä¸€æ¬¡ã€‚é€šè¿‡CI/CDï¼Œå¼€å‘è¿ç»´å›¢é˜Ÿå¯ä»¥ä¸€å¤©å†…éƒ¨ç½²å¤šæ¬¡ã€‚\n10ä¸ªCI/CDçš„ä¼˜ç‚¹ ä¸Šé¢è¯´äº†ä»€ä¹ˆæ˜¯CI/CDï¼Œé‚£æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å…¶æœ‰å“ªäº›ä¼˜ç‚¹ã€‚\n1. æ›´å°‘çš„äº¤æ¥\nåœ¨å¼€å‘ç®¡é“ä¸­æ›´å¤šçš„äº¤æ¥ï¼Œé‚£å°†å¸¦æ¥æ›´å¤šçš„æ•…éšœç‚¹å’Œæ›´å¤šçš„å¤æ‚æ€§ã€‚\n2. å¢åŠ å¼€å‘é€Ÿåº¦\né€šè¿‡CI/CDï¼Œå¼€å‘çš„æ‰€æœ‰é˜¶æ®µéƒ½æ›´å¿«ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­æ›´å¿«çš„è¿­ä»£é€Ÿåº¦ä½¿æ¯ä¸ªå›¢é˜Ÿçš„å·¥ä½œæ•ˆç‡æ›´é«˜ï¼Œå¼€å‘äººå‘˜ä¹Ÿå¯ä»¥æ›´æœ‰ä¿¡å¿ƒåœ°è½¬ç§»åˆ°å…¶ä»–é¡¹ç›®ã€‚\n3. æ›´å¤šçš„éƒ¨ç½²\næ¯ä¸¤å‘¨æˆ–æ›´é•¿æ—¶é—´å‘ç”Ÿä¸€æ¬¡çš„å‘å¸ƒï¼Œç°åœ¨å¯ä»¥æ¯å¤©æ¨é€å¤šæ¬¡ã€‚\n4. æ›´å¿«çš„æµ‹è¯•\nå¼€å‘å·¥ä½œæµç¨‹ä¸­ä¸€ä¸ªæ¯”è¾ƒè€—æ—¶çš„éƒ¨åˆ†è¢«ç§»é™¤ï¼Œå¼€å‘äººå‘˜å¯ä»¥ä»äº‹å…¶ä»–é«˜ä»·å€¼çš„é¡¹ç›®ã€‚è‡ªåŠ¨åŒ–æµ‹è¯•è®©å›¢é˜Ÿå¯ä»¥æ›´å¿«é€Ÿåœ°è·å¾—åé¦ˆï¼Œå¹¶å°½æ—©å¤±è´¥ï¼Œè€Œä¸æ˜¯åœ¨ç”Ÿäº§ä¸­äº§ç”Ÿè¿™äº›é”™è¯¯ï¼Œæˆ–è€…æ›´ç³Ÿç³•åœ°å°†é”™è¯¯å¸¦åˆ°æœ€ç»ˆçš„å‘å¸ƒç‰ˆæœ¬ä¸­ã€‚\n5. æ›´å°‘çš„ä»£ç ç¼ºé™·\né€šè¿‡å¼€å‘æµç¨‹ä¸­å¼•å…¥è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œåœ¨ä»£ç ç¼ºé™·å‘ç”Ÿæ—¶å°±èƒ½åŠæ—¶æ•è·ï¼Œå¹¶é¿å…ä»£ç åˆå¹¶å…¥ä¸»åˆ†æ”¯ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ•´ä½“ä¸Šçš„å…·æœ‰æ›´é«˜çš„ä»£ç è´¨é‡ï¼Œå¹¶ä¸”æ¯ä¸ªå‘å¸ƒç‰ˆæœ¬éƒ½èƒ½æŒ‰é¢„æœŸå·¥ä½œã€‚\n6. å¢å¼ºåˆè§„æ€§\nåˆè§„æ€§ä»»åŠ¡å¯ä»¥çº³å…¥å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼Œå‡å°‘å‘å¸ƒä¸åˆè§„åº”ç”¨çš„é£é™©ã€‚è‡ªåŠ¨åŒ–åˆè§„æ£€æŸ¥ä½¿å¾—æ›´å®¹æ˜“å®Œæˆå®¡æ ¸ï¼Œå¹¶å¯ä»¥é˜²æ­¢é«˜ä»£ä»·çš„é”™è¯¯ã€‚\n7. æ›´å¤šçš„åˆ›æ–°æ—¶é—´\nèŠ±è´¹åœ¨é›†æˆç»´æŠ¤çš„æ—¶é—´è¶Šå°‘ï¼ŒITæ”¯å‡ºä¸å˜ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥æ›´å¤šçš„æ—¶é—´æŠ•å…¥åˆ°å…¶ä»–åœ°æ–¹ã€‚\n8. æ›´å¼€å¿ƒçš„å¼€å‘è€… å¼€å‘äººå‘˜èƒ½å¤Ÿæ›´æœ‰è‡ªä¿¡åœ°å·¥ä½œå’Œå¿«é€Ÿåœ°ä¿®å¤ç¼ºé™·ï¼Œè€Œä¸æ˜¯ç­‰ä¸Šå‡ ä¸ªæ˜ŸæœŸæ¥äº†è§£é”™è¯¯å‘ç”Ÿåœ¨å“ªé‡Œã€‚\n9. å‡å°‘ç®¡ç†è´¹ç”¨\nç»„ç»‡ä¸­å¼€å‘äººå‘˜çš„æ—¶é—´æ˜¯æœ‰é™çš„ï¼Œå¼€å‘æ—¶é—´æ˜¯å¯è®¡è´¹æ—¶é—´çš„å¾ˆå¤šå€ï¼Œè€Œæ‰‹åŠ¨æµ‹è¯•å’Œéƒ¨ç½²ä»£ç å¯èƒ½ä¼šç ´åæ•´ä¸ªITé¢„ç®—ã€‚è‡ªåŠ¨åŒ–çš„å·¥ä½œæµç¨‹å‡å°‘äº†æ‰‹åŠ¨ä»»åŠ¡ï¼Œå¯ä»¥ä½¿é¢„ç®—æ›´åŠ æœ‰æ•ˆã€‚\n. æµç¨‹ä¸€è‡´æ€§\nå¼€å‘æµç¨‹ä¸­å…·æœ‰æ›´é«˜çš„è‡ªåŠ¨åŒ–ç¨‹åº¦æ„å‘³ç€æ²¡äººä¼šå¿˜è®°è¯¥è¿‡ç¨‹ä¸­æ‰§è¡Œçš„æ­¥éª¤ï¼Œä¹Ÿä½¿å¾—æ„å»ºæ›´åŠ ä¸€è‡´ã€‚è¿™æ ·æ›´å®¹æ˜“åŸ¹è®­æ–°çš„å¼€å‘äººå‘˜ï¼Œç»„ç»‡ä¹Ÿå¯ä»¥æ›´åŠ å®¹æ˜“æ§åˆ¶å¦‚ä½•æ„å»ºï¼Œä»¥åŠä½•æ—¶è¿›è¡Œå‘å¸ƒã€‚\nä¸€ä½“å¼CI/CDä¼˜åŠ¿ ä¸Šé¢æ¦‚è¿°äº†CI/CDå¯ä»¥å¸¦æ¥çš„å¥½å¤„ï¼Œç„¶è€Œåœ¨å®é™…çš„å®è·µä¸­ï¼Œå¦‚ä½•çœŸæ­£åœ°è¡¡é‡ç”Ÿäº§åŠ›é€Ÿåº¦ï¼Œéœ€è¦è¯„ä¼°æ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯ç‚¹ç‚¹æ»´æ»´ã€‚\næ— ç¼åœ°æŒç»­é›†æˆå’Œäº¤ä»˜åº”å…·æœ‰ä½¿åº”ç”¨ç¨‹åºä¸ºéƒ¨ç½²åšå¥½å‡†å¤‡æ‰€éœ€çš„ä¸€åˆ‡ï¼Œä¸å¹¸çš„æ˜¯ï¼Œå¾ˆå¤šä½¿ç”¨CI/CDçš„ç»„ç»‡ç”±äºä½¿ç”¨çš„å·¥å…·è€Œé™·å…¥äº†æ— æ³•è¾¾åˆ°æœ€ä½³å·¥ä½œæµç¨‹çš„å›°å¢ƒã€‚\nä¸€ä¸ªå¯ä»¥åœ¨æ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸæä¾›å¯è§æ€§çš„åº”ç”¨ç¨‹åºæ˜¯ç¡®ä¿å’Œä¼˜åŒ–æ¯ä¸ªå¼€å‘é˜¶æ®µçš„æœ€ä½³æ–¹æ³•ï¼Œå½“ä¸€åˆ‡éƒ½åœ¨ä¸€ä¸ªå±‹æªä¸‹æ—¶ï¼Œå°±å®¹æ˜“å‘ç°æµç¨‹çš„ç“¶é¢ˆï¼Œä»¥åŠè¯„ä¼°å½±å“å¼€å‘é€Ÿåº¦çš„æ¯ä¸€ä¸ªå…ƒç´ ã€‚\nåœ¨å•ä¸ªDevOpså¹³å°ä¸‹çš„æ¯ä¸ªæ­¥éª¤éƒ½æä¾›äº†ä¸€æ¡ä¿¡æ¯ï¼Œå¯å°±æ˜¯å¦å‡†å¤‡å¥½åˆå¹¶ä»£ç åšå‡ºæ˜æ™ºçš„å†³å®šã€‚å½“ç„¶ï¼Œæ‰€æœ‰è¿™äº›æ­¥éª¤å¯ä»¥åœ¨æ²¡æœ‰ä¸€ä½“å¼CI/CDçš„è§£å†³æ–¹æ¡ˆçš„æƒ…å†µä¸‹æ‰§è¡Œï¼Œä½†æ˜¯åŠŸèƒ½å…¨é¢çš„å·¥å…·å¯ä»¥åˆ›å»ºå•ä¸€çš„äº‹å®æ¥æºï¼Œåœ¨æ­¤æƒ…å†µä¸‹ï¼Œå¯ä»¥æ›´å¿«åœ°ç›‘è§†æ¯ä¸ªæ­¥éª¤ï¼Œå¹¶å‡å°‘é—æ¼é”™è¯¯çš„å¯èƒ½æ€§ã€‚\nä¸€ä½“å¼CI/CDå¹³å°å¸¦æ¥ä»¥ä¸‹å¥½å¤„ï¼š\næ•´ä¸ªè½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸçš„å¯è§æ€§ æ‰€æœ‰å¼€å‘é˜¶æ®µçš„å•ä¸€çœŸå®æ¥æº æ— éœ€ç™»é™†å¤šä¸ªåº”ç”¨ç¨‹åº åœ¨ä¸€ä¸ªç•Œé¢ä¸Šå¯¼èˆªæ›´ç®€å• åªéœ€è¦å®‰è£…ï¼Œç»´æŠ¤ï¼Œæ‰©å±•ï¼Œå¤‡ä»½ä¸€ä¸ªåº”ç”¨ç¨‹åº æ›´å®¹æ˜“çš„æˆæƒç®¡ç† é™ä½è¿è¥è´¹ç”¨ å› æ­¤ï¼Œæ¨èåœ¨ç»„ç»‡æˆ–å›¢é˜Ÿä¸­æ„å»ºå•ä¸€çš„CI/CDå¹³å°æ¥åŠ é€Ÿåº”ç”¨åˆ›æ–°ï¼Œä¾‹å¦‚é€‰æ‹©ä½¿ç”¨ Gitlabï¼ŒGithubï¼Œä»¥åŠå„å¤§å…¬æœ‰äº‘æä¾›å•†å‘è¡Œçš„DevOpså¹³å°åŠå·¥å…·æ¥ä¼˜åŒ–æ•´ä¸ªCI/CDæµæ°´çº¿ã€‚","tags":["gitlab","cicd"],"title":"ä¸€ä½“åŒ–CI/CDå¹³å°"},{"categories":["Kubernetes"],"contents":"æˆ‘ä»¬éƒ½çŸ¥é“åˆ†å¸ƒå¼ç³»ç»Ÿéå¸¸éš¾ä»¥ç®¡ç†ï¼Œå¾ˆå¤§çš„ä¸€ä¸ªåŸå› æ˜¯è¦æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ˜¯éœ€è¦æ‰€æœ‰çš„éƒ¨ä»¶ï¼ˆæœåŠ¡ï¼‰éƒ½æ­£å¸¸å·¥ä½œã€‚å¦‚æœä¸€ä¸ªå°çš„éƒ¨ä»¶ä¸å¯ç”¨ï¼Œç³»ç»Ÿåº”è¯¥å¯ä»¥æ£€æµ‹åˆ°ï¼Œç»•è¿‡è¯¥éƒ¨ä»¶ï¼Œç„¶åä¿®å¤å®ƒï¼Œè€Œä¸”è¿™æ ·çš„è¡Œä¸ºåº”è¯¥å¯ä»¥è‡ªåŠ¨è¿›è¡Œã€‚\nå¥åº·æ£€æŸ¥å°±æ˜¯ä¸€ä¸ªç®€å•æ–¹æ³•ï¼Œä½¿ç³»ç»Ÿå¯ä»¥çŸ¥é“åº”ç”¨ï¼ˆæœåŠ¡ï¼‰çš„ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚å¦‚æœä¸€ä¸ªå®ä¾‹èƒ½æ­£å¸¸å·¥ä½œï¼Œé‚£å…¶ä»–æœåŠ¡ä¸åº”è¯¥è®¿é—®å®ƒæˆ–è€…å‘å®ƒå‘é€è¯·æ±‚ï¼Œè¯·æ±‚åº”è¯¥å‘é€åˆ°å¥åº·çš„å®ä¾‹ã€‚è€Œç³»ç»Ÿåº”è¯¥æ¢å¤åº”ç”¨çš„ç›‘æ§çŠ¶æ€ã€‚\nå½“æˆ‘ä»¬ä½¿ç”¨ Kubernetes æ¥è¿è¡Œå’Œç®¡ç†æˆ‘ä»¬çš„åº”ç”¨ï¼ˆæœåŠ¡ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å½“ä¸€ä¸ªPodé‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½å¯åŠ¨åï¼Œå°±å‘è¯¥Podå‘é€ç›¸åº”çš„æµé‡ï¼Œå¹¶ä¸”å½“å®¹å™¨å´©æºƒçš„æ—¶å€™é‡å¯å®¹å™¨ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¡Œä¸ºä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸è¿‡k8sè¿˜æä¾›äº†å¯¹å®¹å™¨çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„éƒ¨ç½²æ›´åŠ å¥å£®ã€‚\nåœ¨æ¼”ç¤ºå¦‚ä½•å…·ä½“é…ç½®K8Sçš„å¥åº·æ£€æŸ¥ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆå¥åº·æ¢æµ‹æ¨¡å¼ï¼ˆHealth Probe Patternï¼‰?\nå¥åº·æ¢æµ‹æ¨¡å¼ å½“æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå…³é”®ä»»åŠ¡ï¼Œé«˜å¯ç”¨çš„åº”ç”¨æ—¶ï¼Œå¼¹æ€§æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æœ€é‡è¦æ–¹é¢ä¹‹ä¸€ã€‚å½“ä¸€ä¸ªåº”ç”¨èƒ½å¿«é€Ÿä»å¤±è´¥ä¸­æ¢å¤ï¼Œé‚£ä¸ªè¿™ä¸ªåº”ç”¨å°±æ˜¯å…·æœ‰å¼¹æ€§çš„ã€‚\nä¸ºäº†ä¿è¯åŸºäºk8séƒ¨ç½²çš„åº”ç”¨æ˜¯é«˜å¯ç”¨çš„ï¼Œåœ¨è®¾è®¡é›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éµä»ç‰¹å®šçš„è®¾è®¡æ¨¡å¼ã€‚è€Œå¥åº·æ¢æµ‹å°±æ˜¯å…¶ä¸­çš„ä¸€ç§æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†åº”ç”¨å¦‚ä½•å‘ç³»ç»Ÿï¼ˆk8sï¼‰æŠ¥å‘Šå®ƒè‡ªå·±çš„å¥åº·çŠ¶æ€ã€‚\nè¿™é‡Œæ‰€è°“çš„å¥åº·çŠ¶æ€ä¸ä»…ä»…æ˜¯Podæ˜¯å¦å¯åŠ¨åŠè¿è¡Œï¼Œè¿˜åº”åŒ…æ‹¬å…¶æ˜¯å¦å¯ä»¥æ­£å¸¸å¤„ç†è¯·æ±‚å¹¶å“åº”ï¼Œè¿™æ ·k8så°±å¯ä»¥æ›´åŠ åˆç†åœ°è¿›è¡Œæµé‡è·¯ç”±ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚\nKubernetesçš„å¥åº·æ¢æµ‹ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œk8sé€šè¿‡å„ç§æ§åˆ¶å™¨å¯¹è±¡ï¼ˆDeployment, StatefulSetsç­‰ï¼‰æ¥ç›‘æ§Podçš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªæ§åˆ¶å™¨æ£€æµ‹åˆ°Podç”±äºæŸäº›åŸå› å´©æºƒï¼Œå®ƒå°±ä¼šå°è¯•é‡æ–°å¯åŠ¨Podï¼Œæˆ–è€…æŠŠPodè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿›è¡Œå¯åŠ¨ã€‚ç„¶è€Œï¼ŒPodæ˜¯å¯ä»¥æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€çš„ï¼Œä¾‹å¦‚ä¸€ä¸ªä½¿ç”¨Nginxä½œä¸ºwebæœåŠ¡å™¨çš„åº”ç”¨ï¼Œé€šè¿‡Deploymentéƒ¨ç½²åˆ°é›†ç¾¤é‡Œå¹¶æ­£å¸¸å¯åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™æ£€æµ‹åˆ°Podçš„çš„çŠ¶æ€æ˜¯è¿è¡Œç€çš„ï¼Œä½†æ˜¯å¯èƒ½ç”±äºæŸäº›åŸå› å¯¼è‡´è®¿é—®webæœåŠ¡æ—¶ç¡®è¿”å›500ï¼ˆå†…éƒ¨æœåŠ¡é”™è¯¯ï¼‰ï¼Œå¯¹è¯·æ±‚è€…æ¥è¯´è¯¥æœåŠ¡æ˜¯ä¸å¯ç”¨çš„çŠ¶æ€ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œk8sçš„kubeletç»§ç»­åœ°æ¢æµ‹å®¹å™¨çš„è¿›ç¨‹ï¼Œå½“æ¢æµ‹åˆ°è¿›ç¨‹é€€å‡ºï¼Œå®ƒä¼šé‡å¯å®¹å™¨çš„Podï¼Œæœ‰äº›æƒ…å†µä¸‹é‡å¯å¯ä»¥è®©å®¹å™¨æ¢å¤æ­£å¸¸ã€‚ä½†åƒä¸Šé¢çš„ä¾‹å­ï¼Œå®¹å™¨çš„è¿›è¡Œæ­£å¸¸è¿è¡Œï¼Œè€Œåº”ç”¨å´è¿”å›500é”™è¯¯ï¼Œå¹¶ä¸èƒ½æ­£ç¡®åœ°æ¢æµ‹åˆ°åº”ç”¨çš„å¥åº·çŠ¶æ€ã€‚\nå› æ­¤ï¼Œk8sæä¾›äº†ä¸¤ä¸ªç±»å‹çš„æ¢æµ‹ï¼š å­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰ï¼Œå°±ç»ªæ¢æµ‹ï¼ˆReadiness Probeï¼‰ã€‚\nå­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰ å¾ˆå¤šåº”ç”¨åœ¨é•¿æ—¶é—´è¿è¡Œï¼Œæˆ–è€…é‡åˆ°æŸç§é”™è¯¯è¿›å…¥æ­»é”çŠ¶æ€ï¼Œé™¤éé‡å¯ï¼Œå¦åˆ™æ— æ³•æ¢å¤ã€‚å› æ­¤k8sæä¾›å­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰æ¥å‘ç°å¹¶æ¢å¤è¿™ç§çŠ¶æ€ï¼Œå½“ç„¶å­˜æ´»æ¢æµ‹æ£€æŸ¥åˆ°é”™è¯¯æ—¶ï¼Œkubeletå°†å¯¹Podé‡‡å–é‡å¯æ“ä½œæ¥æ¢å¤åº”ç”¨\nå°±ç»ªæ¢æµ‹ï¼ˆReadiness Probeï¼‰ æœ‰æ—¶åº”ç”¨ä¼šæš‚æ—¶æ€§çš„ä¸èƒ½å¯¹å¤–æä¾›ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚åœ¨è´Ÿè½½æ¯”è¾ƒå¤§çš„æ˜¯å¶ï¼Œæˆ–è€…åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å¯èƒ½éœ€è¦åŠ è½½å¤§é‡æ•°æ®æˆ–åšä¸€äº›åˆå§‹åŒ–çš„åŠ¨ä½œï¼Œéœ€è¦ä¸€å®šæ—¶é—´æ¥å‡†å¤‡å¯¹å¤–æä¾›æœåŠ¡ã€‚\nè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ¢æµ‹åˆ°åº”ç”¨å®ä¾‹ä¸å¯ç”¨æ—¶ï¼Œä¸åº”è¯¥æ€æ­»åº”ç”¨é‡å¯ï¼Œè€Œæ˜¯åº”è¯¥åˆ†é…æµé‡ï¼Œä¸å¾€è¯¥å®ä¾‹å‘é€è¯·æ±‚ï¼ˆé€šè¿‡é…ç½®æœåŠ¡è´Ÿè½½ï¼‰ã€‚\nå› æ­¤ï¼Œk8sæä¾›äº†å°±ç»ªæ¢æµ‹æ¥å‘ç°å¹¶å¤„ç†è¿™ç§æƒ…å†µï¼Œå‘ç°Podé‡Œçš„å®¹å™¨ä¸ºå°±ç»ªæ—¶ï¼Œä¼šè®¾ç½®åº”ç”¨çš„service(k8sèµ„æºå¯¹è¡Œ)ç§»é™¤è¯¥å®ä¾‹çš„Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰ï¼Œä½¿å¾—æµé‡ç„¶è¿‡è¯¥ä¸å¯ç”¨çš„æœåŠ¡å®ä¾‹ï¼Œç­‰å¾…æ¢æµ‹èµ·å°±ç»ªåï¼Œå†å°†å…¶ç«¯ç‚¹æ·»åŠ å›ç›¸åº”çš„æœåŠ¡ã€‚å½“ç„¶å¦‚æœåº”ç”¨æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œåˆ™ä¼šç­‰å¾…å°±ç»ªæ¢æµ‹æˆåŠŸåæ‰ä¼šå°†å…¶æ·»åŠ åˆ°æœåŠ¡ç«¯ç‚¹ã€‚\nKubernetesæ¢æµ‹æ–¹æ³• é‚£ç³»ç»Ÿå¦‚ä½•æ¥æ¢æµ‹å®¹å™¨çš„å¥åº·çŠ¶æ€å‘¢ï¼Ÿk8sæ”¯æŒé…ç½®ä¸‰ç§æ¢æµ‹æ–¹æ³•ï¼š æ‰§è¡Œå‘½ä»¤ï¼ŒTCPï¼ŒHTTP ã€‚\nä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥åº”ç”¨åˆ°å­˜æ´»å’Œå°±ç»ªæ¢æµ‹ã€‚\næ‰§è¡Œå‘½ä»¤ é€šè¿‡åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤æ¥åˆ¤æ–­å®¹å™¨çš„çŠ¶æ€ï¼Œå¦‚æœå‘½ä»¤è¿”å›å€¼ä¸º 0ï¼Œåˆ™è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·çš„ï¼›å¦‚æœè¿”å›å€¼ä¸ºé 0ï¼Œåˆ™è®¤ä¸ºå®¹å™¨æ˜¯ä¸å¥åº·çš„ã€‚\nè¿™ç§æ–¹å¼ä¸€èˆ¬åœ¨å®¹å™¨è¿è¡Œçš„åº”ç”¨æ²¡æœ‰æä¾›HTTPçš„æœåŠ¡ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•TCPç«¯å£å¯åŠ¨æ¥æä¾›æœåŠ¡çš„æƒ…å†µï¼Œè€Œå¯ä»¥é€šè¿‡è¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥ç¡®å®šåº”ç”¨æ˜¯å¦å¥åº·ã€‚\nä¸‹é¢æ˜¯é…ç½®ä¸€ä¸ªPodä½¿ç”¨å‘½ä»¤\napiVersion: v1 kind: Pod metadata: name: app spec: containers: - image: example/app:v1 name: app livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 5 ä¸Šé¢çš„ç¤ºä¾‹å°±ä½¿ç”¨å‘½ä»¤ cat /tmp/healthy æ¥è¿›è¡Œå­˜è´§æ¢æµ‹ï¼Œå¦‚æœå®¹å™¨é‡Œä¸å­˜åœ¨ /tmp/healthy æ–‡ä»¶ï¼Œåˆ™å‘½ä»¤è¿”å›é0å€¼ï¼Œk8såˆ™è®¤ä¸ºå®¹å™¨ä¸å¥åº·ï¼Œè¿™é‡Œä½¿ç”¨äº†å­˜æ´»æ¢æµ‹ï¼Œå› æ­¤ä¼šé‡å¯è¯¥Podã€‚\nTCP é‚£TCPæ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡å°è¯•å‘å®¹å™¨ç›‘å¬çš„ç«¯å£å»ºç«‹TCPè¿æ¥æ¥ç¡®å®šå…¶æ˜¯å¦å¥åº·ï¼Œå¦‚æœèƒ½æˆåŠŸå»ºç«‹è¿æ¥ï¼Œåˆ™è®¤ä¸ºå¥åº·ï¼Œå¦åˆ™ä¸å¥åº·ã€‚\napiVersion: v1 kind: Pod metadata: name: app spec: containers: - image: example/app:v1 name: app ports: - containerPort: 3000 protocol: TCP livenessProbe: tcpSocket: port: 3000 initialDelaySeconds: 15 periodSeconds: 20 ä¸Šé¢ç¤ºä¾‹äº†é€šè¿‡é…ç½®TCPæ–¹å¼çš„å­˜æ´»æ¢æµ‹ï¼Œk8sä¼šé€šè¿‡æ£€æŸ¥Podç«¯å£3000æ¥ç¡®è®¤å®¹å™¨æ˜¯å¦å¥åº·ï¼Œä¸Šé¢çš„é…ç½®ä¸­æœ‰ä¸¤ä¸ªå‚æ•°ï¼š\ninitialDelaySeconds - Podå¯åŠ¨æ—¶ç­‰å¾…å¤šå°‘æ—¶é—´ï¼ˆ15ç§’ï¼‰åå¼€å§‹è¿›è¡Œæ£€æŸ¥ï¼Œè¯¥å‚æ•°ç”¨äºåº”ç”¨éœ€è¦ä¸€å®šæ—¶é—´å¯åŠ¨çš„æƒ…å†µï¼Œé¿å…ä¸€å¼€å§‹å°±æ£€æŸ¥å¤±è´¥è€Œå¯¼è‡´Podé‡å¯ periodSeconds - è¿›è¡Œç«¯å£æ£€æŸ¥çš„å‘¨æœŸæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯åœ¨Podè¿è¡Œæ—¶ï¼Œæ¯20ç§’è¿›è¡Œä¸€æ¬¡æ£€æŸ¥ HTTP å¦‚æœåº”ç”¨æ˜¯ä¸€ä¸ªHTTPæœåŠ¡ï¼ˆæˆ–è€…å®ç°äº†ä¸€ä¸ªHTTPæœåŠ¡çš„APIæ¥æŠ¥å‘Šå¥åº·çŠ¶æ€ï¼‰ï¼Œåˆ™å¯ä»¥é€šè¿‡é…ç½®HTTPçš„æ–¹å¼æ¥è¿›è¡Œæ¢æµ‹\napiVersion: v1 kind: Pod metadata: name: app spec: containers: - image: exmaple/app:v1 name: app ports: - containerPort: 8080 protocol: TCP livenessProbe: httpGet: path: / port: 3000 initialDelaySeconds: 5 periodSeconds: 20 HTTPæ–¹å¼é€šè¿‡å‘å®¹å™¨çš„ç«¯å£å’ŒæŒ‡å®šè·¯å¾„å‘é€httpè¯·æ±‚ï¼Œå¦‚æœè¯·æ±‚çš„è¿”å›å€¼æ˜¯ 200 - 300 ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºæ˜¯æˆåŠŸçš„ï¼Œå¦‚æœè¿”å›å€¼ä¸ºå…¶ä»–å€¼ï¼Œä¾‹å¦‚500ï¼Œåˆ™è®¤ä¸ºæ˜¯å¤±è´¥çš„ã€‚\nå¥åº·æ¢æµ‹è¿˜å¯ä»¥é…ç½®æ›´å¤šå‚æ•°æ¥åšåˆ¤å®šï¼Œè¯¦ç»†ä¿¡æ¯å¯å‚è€ƒ Kubernetesæ–‡æ¡£ ã€‚\næ€»ç»“ åœ¨äº‘åŸç”Ÿåº”ç”¨ä¹‹å‰ï¼Œä¸»è¦é€šè¿‡åº”ç”¨æ—¥å¿—æ¥ç›‘æ§å’Œåˆ†æåº”ç”¨çš„å¥åº·çŠ¶æ€ï¼Œç„¶è€Œå½“åº”ç”¨ä¸å¯ç”¨æ—¶æ²¡æœ‰ä»€ä¹ˆæ–¹æ³•æ¥è‡ªåŠ¨æ¢å¤åº”ç”¨ã€‚å½“ç„¶æ—¥å¿—ä¾ç„¶éå¸¸æœ‰ç”¨çš„ï¼Œåº”æ¬¡ä¹Ÿéœ€è¦æ—¥å¿—èšåˆç³»ç»Ÿæ¥æ”¶é›†æ‰€æœ‰åº”ç”¨çš„æ—¥å¿—è¿›è¡Œè§‚æµ‹å’Œåˆ†æåº”ç”¨ç¨‹åºè¡Œä¸ºã€‚\nå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä»¥åŠåŸºäºå®¹å™¨çš„å¾®æœåŠ¡æ¶æ„äº‘åŸç”Ÿåº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦æ›´åŠ å¿«é€Ÿåœ°å°†åº”ç”¨ä»å¤±è´¥ä¸­æ¢å¤ï¼Œä¿è¯ç³»ç»Ÿçš„å¥å£®æ€§ã€‚å› æ­¤åœ¨è¿›è¡Œåº”ç”¨è®¾è®¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬åº”è¯¥è€ƒè™‘åˆé€‚çš„å¥åº·æ¢æµ‹æ¨¡å¼ï¼Œåœ¨é€šè¿‡Kubernetesè¿›è¡Œåº”ç”¨ç¼–æ’çš„æ—¶å€™ï¼Œä¹Ÿè¦å°½å¯èƒ½åœ°å¯¹å®¹å™¨è¿›è¡Œå¥åº·çŠ¶æ€çš„æ¢æµ‹ï¼Œæ˜¯çš„k8såœ¨å‘ç°åº”ç”¨å®ä¾‹ä¸å¯ç”¨çš„æ—¶å€™ï¼Œé‡‡å–ä¿è¯ç³»ç»Ÿé«˜å¯ç”¨çš„æ“ä½œã€‚\nå‚è€ƒï¼š\né…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨ Kubernetes best practices: Setting up health checks with readiness and liveness probes ","date":"December 8, 2020","hero":"/zh/posts/k8s/health-checks/kubernetes-health-checks.png","permalink":"/zh/posts/k8s/health-checks/","summary":"æˆ‘ä»¬éƒ½çŸ¥é“åˆ†å¸ƒå¼ç³»ç»Ÿéå¸¸éš¾ä»¥ç®¡ç†ï¼Œå¾ˆå¤§çš„ä¸€ä¸ªåŸå› æ˜¯è¦æ˜¯æ•´ä¸ªç³»ç»Ÿçš„å¯ç”¨æ€§ï¼Œæ˜¯éœ€è¦æ‰€æœ‰çš„éƒ¨ä»¶ï¼ˆæœåŠ¡ï¼‰éƒ½æ­£å¸¸å·¥ä½œã€‚å¦‚æœä¸€ä¸ªå°çš„éƒ¨ä»¶ä¸å¯ç”¨ï¼Œç³»ç»Ÿåº”è¯¥å¯ä»¥æ£€æµ‹åˆ°ï¼Œç»•è¿‡è¯¥éƒ¨ä»¶ï¼Œç„¶åä¿®å¤å®ƒï¼Œè€Œä¸”è¿™æ ·çš„è¡Œä¸ºåº”è¯¥å¯ä»¥è‡ªåŠ¨è¿›è¡Œã€‚\nå¥åº·æ£€æŸ¥å°±æ˜¯ä¸€ä¸ªç®€å•æ–¹æ³•ï¼Œä½¿ç³»ç»Ÿå¯ä»¥çŸ¥é“åº”ç”¨ï¼ˆæœåŠ¡ï¼‰çš„ä¸€ä¸ªå®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚å¦‚æœä¸€ä¸ªå®ä¾‹èƒ½æ­£å¸¸å·¥ä½œï¼Œé‚£å…¶ä»–æœåŠ¡ä¸åº”è¯¥è®¿é—®å®ƒæˆ–è€…å‘å®ƒå‘é€è¯·æ±‚ï¼Œè¯·æ±‚åº”è¯¥å‘é€åˆ°å¥åº·çš„å®ä¾‹ã€‚è€Œç³»ç»Ÿåº”è¯¥æ¢å¤åº”ç”¨çš„ç›‘æ§çŠ¶æ€ã€‚\nå½“æˆ‘ä»¬ä½¿ç”¨ Kubernetes æ¥è¿è¡Œå’Œç®¡ç†æˆ‘ä»¬çš„åº”ç”¨ï¼ˆæœåŠ¡ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å½“ä¸€ä¸ªPodé‡Œçš„æ‰€æœ‰å®¹å™¨éƒ½å¯åŠ¨åï¼Œå°±å‘è¯¥Podå‘é€ç›¸åº”çš„æµé‡ï¼Œå¹¶ä¸”å½“å®¹å™¨å´©æºƒçš„æ—¶å€™é‡å¯å®¹å™¨ã€‚åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¡Œä¸ºä¹Ÿæ˜¯å¯ä»¥æ¥å—çš„ï¼Œä¸è¿‡k8sè¿˜æä¾›äº†å¯¹å®¹å™¨çš„å¥åº·æ£€æŸ¥æœºåˆ¶ï¼Œå¯ä»¥è®©æˆ‘ä»¬çš„éƒ¨ç½²æ›´åŠ å¥å£®ã€‚\nåœ¨æ¼”ç¤ºå¦‚ä½•å…·ä½“é…ç½®K8Sçš„å¥åº·æ£€æŸ¥ä¹‹å‰ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ä»€ä¹ˆå¥åº·æ¢æµ‹æ¨¡å¼ï¼ˆHealth Probe Patternï¼‰?\nå¥åº·æ¢æµ‹æ¨¡å¼ å½“æˆ‘ä»¬è®¾è®¡ä¸€ä¸ªå…³é”®ä»»åŠ¡ï¼Œé«˜å¯ç”¨çš„åº”ç”¨æ—¶ï¼Œå¼¹æ€§æ˜¯æˆ‘ä»¬éœ€è¦è€ƒè™‘çš„æœ€é‡è¦æ–¹é¢ä¹‹ä¸€ã€‚å½“ä¸€ä¸ªåº”ç”¨èƒ½å¿«é€Ÿä»å¤±è´¥ä¸­æ¢å¤ï¼Œé‚£ä¸ªè¿™ä¸ªåº”ç”¨å°±æ˜¯å…·æœ‰å¼¹æ€§çš„ã€‚\nä¸ºäº†ä¿è¯åŸºäºk8séƒ¨ç½²çš„åº”ç”¨æ˜¯é«˜å¯ç”¨çš„ï¼Œåœ¨è®¾è®¡é›†ç¾¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éµä»ç‰¹å®šçš„è®¾è®¡æ¨¡å¼ã€‚è€Œå¥åº·æ¢æµ‹å°±æ˜¯å…¶ä¸­çš„ä¸€ç§æ¨¡å¼ï¼Œå®ƒå®šä¹‰äº†åº”ç”¨å¦‚ä½•å‘ç³»ç»Ÿï¼ˆk8sï¼‰æŠ¥å‘Šå®ƒè‡ªå·±çš„å¥åº·çŠ¶æ€ã€‚\nè¿™é‡Œæ‰€è°“çš„å¥åº·çŠ¶æ€ä¸ä»…ä»…æ˜¯Podæ˜¯å¦å¯åŠ¨åŠè¿è¡Œï¼Œè¿˜åº”åŒ…æ‹¬å…¶æ˜¯å¦å¯ä»¥æ­£å¸¸å¤„ç†è¯·æ±‚å¹¶å“åº”ï¼Œè¿™æ ·k8så°±å¯ä»¥æ›´åŠ åˆç†åœ°è¿›è¡Œæµé‡è·¯ç”±ä»¥åŠè´Ÿè½½å‡è¡¡ã€‚\nKubernetesçš„å¥åº·æ¢æµ‹ æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œk8sé€šè¿‡å„ç§æ§åˆ¶å™¨å¯¹è±¡ï¼ˆDeployment, StatefulSetsç­‰ï¼‰æ¥ç›‘æ§Podçš„çŠ¶æ€ï¼Œå¦‚æœä¸€ä¸ªæ§åˆ¶å™¨æ£€æµ‹åˆ°Podç”±äºæŸäº›åŸå› å´©æºƒï¼Œå®ƒå°±ä¼šå°è¯•é‡æ–°å¯åŠ¨Podï¼Œæˆ–è€…æŠŠPodè°ƒåº¦åˆ°å…¶ä»–èŠ‚ç‚¹ä¸Šè¿›è¡Œå¯åŠ¨ã€‚ç„¶è€Œï¼ŒPodæ˜¯å¯ä»¥æŠ¥å‘Šè‡ªå·±çš„çŠ¶æ€çš„ï¼Œä¾‹å¦‚ä¸€ä¸ªä½¿ç”¨Nginxä½œä¸ºwebæœåŠ¡å™¨çš„åº”ç”¨ï¼Œé€šè¿‡Deploymentéƒ¨ç½²åˆ°é›†ç¾¤é‡Œå¹¶æ­£å¸¸å¯åŠ¨ï¼Œè¿™ä¸ªæ—¶å€™æ£€æµ‹åˆ°Podçš„çš„çŠ¶æ€æ˜¯è¿è¡Œç€çš„ï¼Œä½†æ˜¯å¯èƒ½ç”±äºæŸäº›åŸå› å¯¼è‡´è®¿é—®webæœåŠ¡æ—¶ç¡®è¿”å›500ï¼ˆå†…éƒ¨æœåŠ¡é”™è¯¯ï¼‰ï¼Œå¯¹è¯·æ±‚è€…æ¥è¯´è¯¥æœåŠ¡æ˜¯ä¸å¯ç”¨çš„çŠ¶æ€ã€‚\né»˜è®¤æƒ…å†µä¸‹ï¼Œk8sçš„kubeletç»§ç»­åœ°æ¢æµ‹å®¹å™¨çš„è¿›ç¨‹ï¼Œå½“æ¢æµ‹åˆ°è¿›ç¨‹é€€å‡ºï¼Œå®ƒä¼šé‡å¯å®¹å™¨çš„Podï¼Œæœ‰äº›æƒ…å†µä¸‹é‡å¯å¯ä»¥è®©å®¹å™¨æ¢å¤æ­£å¸¸ã€‚ä½†åƒä¸Šé¢çš„ä¾‹å­ï¼Œå®¹å™¨çš„è¿›è¡Œæ­£å¸¸è¿è¡Œï¼Œè€Œåº”ç”¨å´è¿”å›500é”™è¯¯ï¼Œå¹¶ä¸èƒ½æ­£ç¡®åœ°æ¢æµ‹åˆ°åº”ç”¨çš„å¥åº·çŠ¶æ€ã€‚\nå› æ­¤ï¼Œk8sæä¾›äº†ä¸¤ä¸ªç±»å‹çš„æ¢æµ‹ï¼š å­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰ï¼Œå°±ç»ªæ¢æµ‹ï¼ˆReadiness Probeï¼‰ã€‚\nå­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰ å¾ˆå¤šåº”ç”¨åœ¨é•¿æ—¶é—´è¿è¡Œï¼Œæˆ–è€…é‡åˆ°æŸç§é”™è¯¯è¿›å…¥æ­»é”çŠ¶æ€ï¼Œé™¤éé‡å¯ï¼Œå¦åˆ™æ— æ³•æ¢å¤ã€‚å› æ­¤k8sæä¾›å­˜æ´»æ¢æµ‹ï¼ˆLiveness Probeï¼‰æ¥å‘ç°å¹¶æ¢å¤è¿™ç§çŠ¶æ€ï¼Œå½“ç„¶å­˜æ´»æ¢æµ‹æ£€æŸ¥åˆ°é”™è¯¯æ—¶ï¼Œkubeletå°†å¯¹Podé‡‡å–é‡å¯æ“ä½œæ¥æ¢å¤åº”ç”¨\nå°±ç»ªæ¢æµ‹ï¼ˆReadiness Probeï¼‰ æœ‰æ—¶åº”ç”¨ä¼šæš‚æ—¶æ€§çš„ä¸èƒ½å¯¹å¤–æä¾›ç½‘ç»œæœåŠ¡ï¼Œä¾‹å¦‚åœ¨è´Ÿè½½æ¯”è¾ƒå¤§çš„æ˜¯å¶ï¼Œæˆ–è€…åœ¨åº”ç”¨å¯åŠ¨çš„æ—¶å€™å¯èƒ½éœ€è¦åŠ è½½å¤§é‡æ•°æ®æˆ–åšä¸€äº›åˆå§‹åŒ–çš„åŠ¨ä½œï¼Œéœ€è¦ä¸€å®šæ—¶é—´æ¥å‡†å¤‡å¯¹å¤–æä¾›æœåŠ¡ã€‚\nè¿™æ ·çš„æƒ…å†µä¸‹ï¼Œç³»ç»Ÿæ¢æµ‹åˆ°åº”ç”¨å®ä¾‹ä¸å¯ç”¨æ—¶ï¼Œä¸åº”è¯¥æ€æ­»åº”ç”¨é‡å¯ï¼Œè€Œæ˜¯åº”è¯¥åˆ†é…æµé‡ï¼Œä¸å¾€è¯¥å®ä¾‹å‘é€è¯·æ±‚ï¼ˆé€šè¿‡é…ç½®æœåŠ¡è´Ÿè½½ï¼‰ã€‚\nå› æ­¤ï¼Œk8sæä¾›äº†å°±ç»ªæ¢æµ‹æ¥å‘ç°å¹¶å¤„ç†è¿™ç§æƒ…å†µï¼Œå‘ç°Podé‡Œçš„å®¹å™¨ä¸ºå°±ç»ªæ—¶ï¼Œä¼šè®¾ç½®åº”ç”¨çš„service(k8sèµ„æºå¯¹è¡Œ)ç§»é™¤è¯¥å®ä¾‹çš„Endpointï¼ˆæœåŠ¡ç«¯ç‚¹ï¼‰ï¼Œä½¿å¾—æµé‡ç„¶è¿‡è¯¥ä¸å¯ç”¨çš„æœåŠ¡å®ä¾‹ï¼Œç­‰å¾…æ¢æµ‹èµ·å°±ç»ªåï¼Œå†å°†å…¶ç«¯ç‚¹æ·»åŠ å›ç›¸åº”çš„æœåŠ¡ã€‚å½“ç„¶å¦‚æœåº”ç”¨æ˜¯ç¬¬ä¸€æ¬¡å¯åŠ¨ï¼Œåˆ™ä¼šç­‰å¾…å°±ç»ªæ¢æµ‹æˆåŠŸåæ‰ä¼šå°†å…¶æ·»åŠ åˆ°æœåŠ¡ç«¯ç‚¹ã€‚\nKubernetesæ¢æµ‹æ–¹æ³• é‚£ç³»ç»Ÿå¦‚ä½•æ¥æ¢æµ‹å®¹å™¨çš„å¥åº·çŠ¶æ€å‘¢ï¼Ÿk8sæ”¯æŒé…ç½®ä¸‰ç§æ¢æµ‹æ–¹æ³•ï¼š æ‰§è¡Œå‘½ä»¤ï¼ŒTCPï¼ŒHTTP ã€‚\nä¸‰ç§æ–¹æ³•éƒ½å¯ä»¥åº”ç”¨åˆ°å­˜æ´»å’Œå°±ç»ªæ¢æµ‹ã€‚\næ‰§è¡Œå‘½ä»¤ é€šè¿‡åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤æ¥åˆ¤æ–­å®¹å™¨çš„çŠ¶æ€ï¼Œå¦‚æœå‘½ä»¤è¿”å›å€¼ä¸º 0ï¼Œåˆ™è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·çš„ï¼›å¦‚æœè¿”å›å€¼ä¸ºé 0ï¼Œåˆ™è®¤ä¸ºå®¹å™¨æ˜¯ä¸å¥åº·çš„ã€‚\nè¿™ç§æ–¹å¼ä¸€èˆ¬åœ¨å®¹å™¨è¿è¡Œçš„åº”ç”¨æ²¡æœ‰æä¾›HTTPçš„æœåŠ¡ï¼Œä¹Ÿæ²¡æœ‰ä»»ä½•TCPç«¯å£å¯åŠ¨æ¥æä¾›æœåŠ¡çš„æƒ…å†µï¼Œè€Œå¯ä»¥é€šè¿‡è¿è¡Œä¸€ä¸ªå‘½ä»¤æ¥ç¡®å®šåº”ç”¨æ˜¯å¦å¥åº·ã€‚\nä¸‹é¢æ˜¯é…ç½®ä¸€ä¸ªPodä½¿ç”¨å‘½ä»¤\napiVersion: v1 kind: Pod metadata: name: app spec: containers: - image: example/app:v1 name: app livenessProbe: exec: command: - cat - /tmp/healthy initialDelaySeconds: 5 ä¸Šé¢çš„ç¤ºä¾‹å°±ä½¿ç”¨å‘½ä»¤ cat /tmp/healthy æ¥è¿›è¡Œå­˜è´§æ¢æµ‹ï¼Œå¦‚æœå®¹å™¨é‡Œä¸å­˜åœ¨ /tmp/healthy æ–‡ä»¶ï¼Œåˆ™å‘½ä»¤è¿”å›é0å€¼ï¼Œk8såˆ™è®¤ä¸ºå®¹å™¨ä¸å¥åº·ï¼Œè¿™é‡Œä½¿ç”¨äº†å­˜æ´»æ¢æµ‹ï¼Œå› æ­¤ä¼šé‡å¯è¯¥Podã€‚\nTCP é‚£TCPæ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡å°è¯•å‘å®¹å™¨ç›‘å¬çš„ç«¯å£å»ºç«‹TCPè¿æ¥æ¥ç¡®å®šå…¶æ˜¯å¦å¥åº·ï¼Œå¦‚æœèƒ½æˆåŠŸå»ºç«‹è¿æ¥ï¼Œåˆ™è®¤ä¸ºå¥åº·ï¼Œå¦åˆ™ä¸å¥åº·ã€‚","tags":["kubernetes","kubectl"],"title":"K8Så¥åº·æ£€æŸ¥æœ€ä½³å®è·µ"},{"categories":["Linux"],"contents":"ä»€ä¹ˆæ˜¯ WireGuard ï¼Ÿ å…¶å®˜æ–¹å®£ç§°æ˜¯å¿«é€Ÿã€ç°ä»£ä»¥åŠå®‰å…¨çš„VPNéš§é“ï¼ˆFast, Modern, Secure VPN Tunnelï¼‰ã€‚\nWireGuardä½¿ç”¨äº†æœ€å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ï¼Œç›¸æ¯” IPSec æ›´ç®€å•æ›´ç²¾ç®€ï¼Œè€Œä¸”æ‹¥æœ‰å‡ ä¹è¶…è¶Š OpenVPN çš„æ€§èƒ½ã€‚å…¶æœ€åˆæ˜¯é’ˆå¯¹Linuxå†…æ ¸å‘å¸ƒçš„ï¼Œä½†æ˜¯ç°åœ¨å·²ç»è·¨å¹³å°ï¼ˆWindows, MacOS, BSD, Android, iOSç­‰ï¼‰å¯éƒ¨ç½²ã€‚\næ¥ä¸‹æ¥è¿™ç¯‡How Toç³»åˆ—æ–‡ç« ï¼Œå°±æ¥ä¸€æ­¥æ­¥åœ¨Ubuntu (Linux)ä¸Šå®‰è£…å’Œé…ç½®WireGuard VPNï¼Œå…¶ä¸­ä¸€å°äº‘ä¸»æœºè¿è¡ŒUbuntu-20.04ç”¨ä½œVPNæœåŠ¡å™¨ï¼Œå¦ä¸€å°æœ¬åœ°çš„linuxæ¡Œé¢ç¯å¢ƒä½œä¸ºVPNå®¢æˆ·ç«¯ã€‚\næœåŠ¡å™¨ç«¯å®‰è£…WireGuard è¿™é‡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿä¸ºUbuntu 20.04çš„äº‘ä¸»æœºï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¹¶é…ç½®ä¸€å°äº‘ä¸»æœºï¼Œå¯ä»¥é€‰æ‹© [DigitalOcean]ï¼ˆhttps://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04ï¼‰ã€‚\nè¿™é‡Œæˆ‘ä»¬æˆ‘ä»¬å·²ç»é…ç½®å¥½ä¸€å°Ubuntu 20.04çš„äº‘ä¸»æœºï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡SSHè®¿é—®ã€‚é¦–å…ˆå¯¹ç³»ç»Ÿè¿›è¡Œå®‰å…¨æ›´æ–°\n$ sudo apt update $ sudo apt upgrade æ¥ä¸‹æ¥ç›´æ¥ä½¿ç”¨APTå®‰è£…WireGuardè½¯ä»¶åŒ…\n$ sudo apt install wireguard ä¼šåŒæ—¶å®‰è£… wireguard-tools è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…¶å·¥å…·è¿›è¡Œç›¸å…³çš„é…ç½®ã€‚\né…ç½®WireGuardæœåŠ¡ç«¯ è¿›å…¥rootæƒé™è¿›è¡Œæ“ä½œï¼Œä¸ºæœåŠ¡ç«¯ç”Ÿäº§ç§æœ‰/å…¬å…±å¯†é’¥å¯¹\n$ sudo -i \\# cd /etc/wireguard/ \\# umask 077 \\# wg genkey | tee privatekey | wg pubkey \u0026gt; publickey æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œæˆ‘ä»¬ä¼šåœ¨ç›®å½• /etc/wireguard/ ä¸‹ç”Ÿäº§ä¸¤ä¸ªå¯†é’¥æ–‡ä»¶ privatekey å’Œ publickey ã€‚\næ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ¥å£é…ç½®æ–‡ä»¶ï¼Œå‘½åä¸º wg0.confï¼Œç¼–è¾‘å¹¶æ·»åŠ å¦‚ä¸‹å†…å®¹\n[Interface] ## VPN server private IP address ## Address = 192.168.6.1/24 ## VPN server port ## ListenPort = 4114 ## VPN server\u0026#39;s private key i.e. /etc/wireguard/privatekey ## PrivateKey = xxxxxxxxxxxxxxxxxxxxxxxxxxxx å…¶ä¸­ Address æŒ‡å®šè¯¥ç½‘ç»œæ¥å£çš„IPåœ°å€ï¼Œå¯è‡ªå·±è®¾å®šä¸€ä¸ªå­ç½‘çš„åœ°å€ï¼ŒListenPort æŒ‡å®šWGçš„UDPç›‘å¬ç«¯å£ï¼ˆå®¢æˆ·ç«¯å°†éœ€è¦é…ç½®è¯¥ç«¯å£è¿›è¡Œè¿æ¥ï¼‰ï¼ŒPrivateKey å°±æ˜¯ä¸Šé¢ç”Ÿæˆçš„ç§æœ‰å¯†é’¥çš„å†…å®¹ã€‚\nå¦‚æœä½ çš„ç³»ç»Ÿå¼€å¯äº†UFWé˜²ç«å¢™ï¼Œè®°ä½è¦é…ç½®ufwå…è®¸ä»¥ä¸Šç«¯å£ï¼ˆ4114ï¼‰ï¼Œä¾‹å¦‚\n$ sudo ufw status Status: active $ sudo ufw allow 4114/udp æˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯äº‘ä¸»æœºï¼Œåˆ™éœ€è¦åœ¨äº‘æ§åˆ¶å°é…ç½®ç›¸åº”çš„å®‰å…¨ç»„/é˜²ç«å¢™å¼€æ”¾ 4114/udp ç«¯å£çš„è®¿é—®ã€‚\næ¥ä¸‹æ¥ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨WireGuardæœåŠ¡\n$ sudo systemctl enable wg-quick@wg0 $ sudo systemctl start wg-quick@wg0 $ sudo systemcl status wg-quick@wg0 æœ€åä¸€ä¸ªå‘½ä»¤æ˜¯æŸ¥çœ‹wgæœåŠ¡çš„è¿è¡ŒçŠ¶æ€çš„ï¼Œä¾‹å¦‚è¿”å›å¦‚ä¸‹\nâ— wg-quick@wg0.service - WireGuard via wg-quick(8) for wg0 Loaded: loaded (/lib/systemd/system/wg-quick@.service; enabled; vendor preset: enabled) Active: active (exited) since Thu 2020-12-03 06:48:02 UTC; 5s ago Docs: man:wg-quick(8) man:wg(8) https://www.wireguard.com/ https://www.wireguard.com/quickstart/ https://git.zx2c4.com/wireguard-tools/about/src/man/wg-quick.8 https://git.zx2c4.com/wireguard-tools/about/src/man/wg.8 Process: 3606 ExecStart=/usr/bin/wg-quick up wg0 (code=exited, status=0/SUCCESS) Main PID: 3606 (code=exited, status=0/SUCCESS) Tasks: 0 (limit: 682) Memory: 800.0K CGroup: /system.slice/system-wg\\x2dquick.slice/wg-quick@wg0.service è€Œä¸”ç³»ç»Ÿé‡Œå¢åŠ äº†ä¸€ä¸ªè™šæ‹Ÿçš„ç½‘ç»œæ¥å£\n3: wg0: \u0026lt;POINTOPOINT,NOARP,UP,LOWER_UP\u0026gt; mtu 1380 qdisc noqueue state UNKNOWN group default qlen 1000 link/none inet 192.168.40.1/24 scope global wg0 valid_lft forever preferred_lft forever è¿˜å¯ä»¥é€šè¿‡wgå‘½ä»¤æ˜¾ç¤ºæ¥å£ä¿¡æ¯\n$ sudo wg interface: wg0 public key: rQYpYVpgPYdYYVrlgF52S/M8vrht+rkqSmn5ayVAG0I= private key: (hidden) listening port: 4114 é…ç½®å®¢æˆ·ç«¯è¿æ¥WG å®ŒæˆæœåŠ¡å™¨æ–­çš„é…ç½®ï¼Œå¹¶æˆåŠŸå¯åŠ¨ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦é…ç½®æœ¬åœ°å®¢æˆ·ç«¯æ¥è¿æ¥è¯¥VPNï¼Œæˆ‘æœ¬åœ°ä½¿ç”¨çš„æ˜¯ [openSUSE] æ¡Œé¢ç¯å¢ƒï¼Œé¦–å…ˆéœ€è¦å®‰è£… wireguard-toolsï¼Œå…¶ä»– Linux ç³»ç»Ÿä¹Ÿæ˜¯ç±»ä¼¼çš„\nâ¯ sudo zypper in wireguard-tools æ­£åœ¨åŠ è½½è½¯ä»¶æºæ•°æ®... æ­£åœ¨è¯»å–å·²å®‰è£…çš„è½¯ä»¶åŒ…... æ­£åœ¨è§£å†³è½¯ä»¶åŒ…ä¾èµ–å…³ç³»... å°†å®‰è£…ä»¥ä¸‹ 1 ä¸ªæ–°è½¯ä»¶åŒ…ï¼š wireguard-tools 1 ä¸ªè½¯ä»¶åŒ…å°†æ–°è£…. æ€»ä¸‹è½½å¤§å°ï¼š72.4 KiBã€‚å·²ç¼“å­˜ï¼š0 Bã€‚ æ“ä½œå®Œæˆåï¼Œå°†ä½¿ç”¨é¢å¤–çš„ 140.7 KiBã€‚ ç»§ç»­å—ï¼Ÿ [y/n/v/...? æ˜¾ç¤ºå…¨éƒ¨é€‰é¡¹] (y): y ä¸€æ ·åœ°éœ€è¦åˆ›å»ºç§æœ‰/å…¬å…±å¯†é’¥å¯¹\n$ sudo -i \\# cd /etc/wireguard/ \\# umask 077 \\# wg genkey | tee privatekey | wg pubkey \u0026gt; publickey åˆ›å»º /etc/wireguard/wg0.conf æ–‡ä»¶ï¼Œé…ç½®å¦‚ä¸‹\n[Interface] ## This Desktop/client\u0026#39;s private key ## PrivateKey = \u0026lt;client private key\u0026gt; ## Client ip address ## Address = 192.168.40.10/24 [Peer] ## public key ## PublicKey = \u0026lt;Server public key\u0026gt; ## set ACL ## AllowedIPs = 192.168.40.0/24 ## Your Ubuntu 20.04 LTS server\u0026#39;s public IPv4/IPv6 address and port ## Endpoint = 35.220.179.202:4114 ## Key connection alive ## PersistentKeepalive = 15 æ³¨æ„éœ€è¦åˆ†åˆ«é…ç½®æ¥å£ï¼ˆä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯è‡ªå·±ï¼‰çš„ç§æœ‰å¯†é’¥ï¼Œè¿˜è¦é…ç½®è¿æ¥æœåŠ¡ç«¯ï¼ˆpeerï¼‰çš„å…¬å…±å¯†é’¥ï¼Œè¿˜æœ‰è¿æ¥æœåŠ¡ç«¯çš„IPå’Œç«¯å£ä¿¡æ¯ã€‚\nå¯åŠ¨è¿æ¥\nâ¯ sudo systemctl start wg-quick@wg0.service â¯ sudo wg interface: wg0 public key: 1abmCvigQqhXYLOkvjrU864dOyJHN9bf6Ya0GP4tXzs= private key: (hidden) listening port: 54147 peer: rQYpYVpgPYdYYVrlgF52S/M8vrht+rkqSmn5ayVAG0I= endpoint: 35.220.179.202:4114 allowed ips: 192.168.40.0/24 latest handshake: 4 seconds ago transfer: 92 B received, 180 B sent persistent keepalive: every 15 seconds è¿™ä¸ªæ—¶å€™è¿˜ä¸èƒ½é€šè¿‡VPNç›´æ¥è®¿é—®æœåŠ¡å™¨ç«¯ï¼Œæƒ³è¦å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯ä»¥é€šè¿‡VPNçš„ç§æœ‰ç½‘ç»œäº’ç›¸è®¿é—®ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦åˆ°æœåŠ¡ç«¯æ·»åŠ [Peer]çš„é…ç½®ï¼ŒæœåŠ¡ç«¯å‘æ–‡ä»¶ /etc/wireguard/wg0.conf æ·»åŠ ä»¥ä¸‹å†…å®¹\n[Peer] PublicKey = +pztufezkYV8ujhJI2N2Q5SW5yuuTXzHmytrGdJjziE= AllowedIPs = 192.168.40.10/32 é‡å¯æœåŠ¡å™¨ï¼Œå®¢æˆ·ç«¯æœåŠ¡\n$ sudo systemctl restart wg-quick@wg0 è¿™ä¸ªæ—¶å€™å°±å»ºç«‹äº†ä¸€ä¸ªP-to-Pçš„VPNç½‘ç»œï¼Œå¯ä»¥ä½¿ç”¨ç§æœ‰IPäº’ç›¸è®¿é—®\nâ¯ ping 192.168.40.1 PING 192.168.40.1 (192.168.40.1) 56(84) bytes of data. 64 bytes from 192.168.40.1: icmp_seq=2 ttl=64 time=51.8 ms 64 bytes from 192.168.40.1: icmp_seq=3 ttl=64 time=55.0 ms 64 bytes from 192.168.40.1: icmp_seq=4 ttl=64 time=58.6 ms ... å®¢æˆ·ç«¯è¿˜ä¸èƒ½é€šè¿‡VPNç½‘ç»œè®¿é—®äº’è”ç½‘ï¼Œè¦æƒ³æ‰€æœ‰VPNçš„å®¢æˆ·ç«¯éƒ½å¯ä»¥é€šè¿‡è¯¥æœåŠ¡å™¨æ¥è®¿é—®äº’è”ç½‘ï¼Œè¿˜éœ€è¦åœ¨æœåŠ¡å™¨ä¸Šé…ç½®ç›¸åº”çš„NATï¼ŒIPè½¬å‘è§„åˆ™ã€‚\næ€»ç»“ è¿™é‡Œä»…ä»…é€šè¿‡ç¤ºä¾‹ï¼Œåœ¨Linuxä¸Šä½¿ç”¨ WireGuard åˆ›å»ºäº†ä¸€ä¸ªç«¯åˆ°ç«¯ï¼ˆå®¢æˆ·ç«¯/æœåŠ¡å™¨ï¼‰VPNç½‘ç»œï¼Œè®©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡VPNç§æœ‰IPåœ°å€äº’ç›¸è®¿é—®ã€‚æƒ³äº†è§£æ›´å¤šå…³äºWireGuardçš„ä¿¡æ¯ï¼Œè¯·è®¿é—®å…¶å®˜ç½‘ https://www.wireguard.com/ ã€‚\n","date":"December 3, 2020","hero":"/zh/posts/linux/wireguard-vpn/linux-wireguard.png","permalink":"/zh/posts/linux/wireguard-vpn/","summary":"ä»€ä¹ˆæ˜¯ WireGuard ï¼Ÿ å…¶å®˜æ–¹å®£ç§°æ˜¯å¿«é€Ÿã€ç°ä»£ä»¥åŠå®‰å…¨çš„VPNéš§é“ï¼ˆFast, Modern, Secure VPN Tunnelï¼‰ã€‚\nWireGuardä½¿ç”¨äº†æœ€å…ˆè¿›çš„åŠ å¯†æŠ€æœ¯ï¼Œç›¸æ¯” IPSec æ›´ç®€å•æ›´ç²¾ç®€ï¼Œè€Œä¸”æ‹¥æœ‰å‡ ä¹è¶…è¶Š OpenVPN çš„æ€§èƒ½ã€‚å…¶æœ€åˆæ˜¯é’ˆå¯¹Linuxå†…æ ¸å‘å¸ƒçš„ï¼Œä½†æ˜¯ç°åœ¨å·²ç»è·¨å¹³å°ï¼ˆWindows, MacOS, BSD, Android, iOSç­‰ï¼‰å¯éƒ¨ç½²ã€‚\næ¥ä¸‹æ¥è¿™ç¯‡How Toç³»åˆ—æ–‡ç« ï¼Œå°±æ¥ä¸€æ­¥æ­¥åœ¨Ubuntu (Linux)ä¸Šå®‰è£…å’Œé…ç½®WireGuard VPNï¼Œå…¶ä¸­ä¸€å°äº‘ä¸»æœºè¿è¡ŒUbuntu-20.04ç”¨ä½œVPNæœåŠ¡å™¨ï¼Œå¦ä¸€å°æœ¬åœ°çš„linuxæ¡Œé¢ç¯å¢ƒä½œä¸ºVPNå®¢æˆ·ç«¯ã€‚\næœåŠ¡å™¨ç«¯å®‰è£…WireGuard è¿™é‡Œæˆ‘ä»¬çš„æœåŠ¡å™¨ä½¿ç”¨çš„æ˜¯æ“ä½œç³»ç»Ÿä¸ºUbuntu 20.04çš„äº‘ä¸»æœºï¼Œå¯¹äºå¦‚ä½•åˆ›å»ºå¹¶é…ç½®ä¸€å°äº‘ä¸»æœºï¼Œå¯ä»¥é€‰æ‹© [DigitalOcean]ï¼ˆhttps://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04ï¼‰ã€‚\nè¿™é‡Œæˆ‘ä»¬æˆ‘ä»¬å·²ç»é…ç½®å¥½ä¸€å°Ubuntu 20.04çš„äº‘ä¸»æœºï¼Œå¹¶ä¸”å¯ä»¥é€šè¿‡SSHè®¿é—®ã€‚é¦–å…ˆå¯¹ç³»ç»Ÿè¿›è¡Œå®‰å…¨æ›´æ–°\n$ sudo apt update $ sudo apt upgrade æ¥ä¸‹æ¥ç›´æ¥ä½¿ç”¨APTå®‰è£…WireGuardè½¯ä»¶åŒ…\n$ sudo apt install wireguard ä¼šåŒæ—¶å®‰è£… wireguard-tools è½¯ä»¶åŒ…ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å…¶å·¥å…·è¿›è¡Œç›¸å…³çš„é…ç½®ã€‚\né…ç½®WireGuardæœåŠ¡ç«¯ è¿›å…¥rootæƒé™è¿›è¡Œæ“ä½œï¼Œä¸ºæœåŠ¡ç«¯ç”Ÿäº§ç§æœ‰/å…¬å…±å¯†é’¥å¯¹\n$ sudo -i \\# cd /etc/wireguard/ \\# umask 077 \\# wg genkey | tee privatekey | wg pubkey \u0026gt; publickey æ‰§è¡Œå®Œä¸Šè¿°å‘½ä»¤åï¼Œæˆ‘ä»¬ä¼šåœ¨ç›®å½• /etc/wireguard/ ä¸‹ç”Ÿäº§ä¸¤ä¸ªå¯†é’¥æ–‡ä»¶ privatekey å’Œ publickey ã€‚","tags":["wireguard","vpn"],"title":"åœ¨LINUXä¸Šé…ç½®WIREGUARD"},{"categories":["Linux"],"contents":"åœ¨Linuxç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ip , netstat æˆ–è€… [ethtool] å‘½ä»¤æ˜¾ç¤ºç½‘ç»œæ¥å£ä¸¢å¼ƒæ•°æ®åŒ…çš„ç»Ÿè®¡ä¿¡æ¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨æ¯ä¸ªå‘½ä»¤ã€‚\nä½¿ç”¨netstatæŒ‰æ¥å£æ˜¾ç¤ºæ•°æ®åŒ… å…¶å® netstat å‘½ä»¤å·²ç»è¿‡æ—¶ï¼Œå¯ä½¿ç”¨å‘½ä»¤ ip å’Œ ss æ¥ä»£æ›¿ã€‚ä½†æ˜¯ netstat ä¾ç„¶åœ¨ä¸€äº›æ—§çš„Linuxåˆ†å‘ç‰ˆæœ¬ä¸Šå¯ç”¨ï¼Œå› æ­¤åœ¨ ip/ss ä¸å¯ç”¨çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨netstatï¼Œå…¶è¯­æ³•å¦‚ä¸‹\nnetstat -i netstat --interfaces ä¾‹å¦‚\n~$ netstat -i Kernel Interface table Iface MTU Met RX-OK RX-ERR RX-DRP RX-OVR TX-OK TX-ERR TX-DRP TX-OVR Flg docker0 1500 0 188180 0 0 0 151852 0 0 0 BMRU eth0 1500 0 472368 0 0 0 375351 0 0 0 BMRU lo 65536 0 51687 0 0 0 51687 0 0 0 LRU vethc8f46ea 1500 0 136984 0 0 0 79587 0 0 0 BMRU å¦‚æœæƒ³æ˜¾ç¤ºæ¯ç§åè®®çš„æ¦‚è¦ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œ\nnetstat -s netstat --statistics ä¾‹å¦‚\n$ netstat -s Ip: 527622 total packets received 19 with invalid addresses 329762 forwarded 0 incoming packets discarded 191137 incoming packets delivered 568337 requests sent out Icmp: 8 ICMP messages received 8 input ICMP message failed. ICMP input histogram: destination unreachable: 7 timeout in transit: 1 5 ICMP messages sent 0 ICMP messages failed ICMP output histogram: destination unreachable: 5 IcmpMsg: InType3: 7 InType11: 1 OutType3: 5 Tcp: 2509 active connections openings 26 passive connection openings 748 failed connection attempts 14 connection resets received 4 connections established 182968 segments received 241886 segments send out 72 segments retransmited 279 bad segments received. 1844 resets sent InCsumErrors: 279 Udp: 8067 packets received 5 packets to unknown port received. 0 packet receive errors 11440 packets sent åªæ˜¾ç¤ºtcpçš„ä¿¡æ¯\nnetstat -s -t netstat --statistics --tcp åªæ˜¾ç¤ºudpçš„ä¿¡æ¯\nnetstat -s -u netstat --statistics --udp ä½¿ç”¨ipå‘½ä»¤æ˜¾ç¤ºç½‘ç»œæ¥å£æ•°æ®åŒ…ä¿¡æ¯ å¦‚æœè¦æ˜¾ç¤ºæ‰€æœ‰æ¥å£çš„ç»Ÿè®¡ä¿¡æ¯ï¼Œå‘½ä»¤å¦‚ä¸‹\nip -s link å¦‚æœè¦æ˜¾ç¤ºæŸä¸€ä¸ªæ¥å£çš„ï¼Œåˆ™åˆ¶å®šæ¥å£å\nip -s link show {interface} ä¾‹å¦‚\n$ ip -s link show eth0 2: eth0: \u0026lt;BROADCAST,MULTICAST,UP,LOWER_UP\u0026gt; mtu 1500 qdisc pfifo_fast state UP mode DEFAULT group default qlen 1000 link/ether 00:16:3e:02:c8:e3 brd ff:ff:ff:ff:ff:ff RX: bytes packets errors dropped overrun mcast 377786943 473945 0 0 0 0 TX: bytes packets errors dropped carrier collsns 266024587 377467 0 0 0 0 RXæŒ‡ç¤ºäº†æ¥æ”¶çš„æ•°æ®åŒ…ï¼ŒTXæŒ‡ç¤ºäº†å‘é€çš„æ•°æ®åŒ…ã€‚\nä½¿ç”¨ethtoolå‘½ä»¤æŸ¥è¯¢æŒ‡å®šç½‘ç»œæ¥å£çš„ä¿¡æ¯ å¯ä»¥ä½¿ç”¨ -S æˆ–è€… \u0026ndash;statistics é€‰é¡¹æ¥æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯ï¼Œè¯­æ³•å¦‚ä¸‹\nethtool -S {device} ä¾‹å¦‚\nâ¯ ethtool -S wlan1 NIC statistics: rx_packets: 487703 rx_bytes: 207474712 rx_duplicates: 180 rx_fragments: 487682 rx_dropped: 19952 tx_packets: 141579 tx_bytes: 34804215 tx_filtered: 0 tx_retry_failed: 0 tx_retries: 19541 sta_state: 4 txrate: 400000000 rxrate: 360000000 signal: 201 channel: 0 noise: 18446744073709551615 ch_time: 18446744073709551615 ch_time_busy: 18446744073709551615 ch_time_ext_busy: 18446744073709551615 ch_time_rx: 18446744073709551615 ch_time_tx: 18446744073709551615 è¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨catæˆ–è€…columnå‘½ä»¤æ¥æŸ¥è¯¢ /proc/net/dev æ–‡ä»¶ï¼Œä¾‹å¦‚\nâ¯ column -t /proc/net/dev Inter-| Receive | Transmit face |bytes packets errs drop fifo frame compressed multicast|bytes packets errs drop fifo colls carrier compressed lo: 230352757 1201722 0 0 0 0 0 0 230352757 1201722 0 0 0 0 0 0 eth0: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 wlan1: 1346770664 2865963 0 14 0 0 0 0 282983658 1154942 0 0 0 0 0 0 br-13cb4d22d1c8: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 br-44561b4ee062: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 br-70b0dad49865: 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 docker0: 6824830 44848 0 0 0 0 0 0 133304965 47104 0 0 0 0 0 0 vetheb8b528: 2360070 13321 0 0 0 0 0 0 60431688 18817 0 0 0 0 0 0 vetha4dc663: 461283 2464 0 0 0 0 0 0 2981558 2302 0 0 0 0 0 0 è¡¥å……ï¼šå¦‚ä½•è¯Šæ–­æ•°æ®åŒ…ä¸¢å¼ƒçš„åŸå›  å‘ç°ç½‘ç»œæ•°æ®æœ‰è¢«ä¸¢å¼ƒçš„è¯·ï¼Œæƒ³æ‰¾å‡ºåŸå› ï¼Œè¿™é‡Œä»‹ç»ä¸€ä¸ªå·¥å…· dropwathã€‚\né¦–å…ˆä½¿ç”¨éœ€è¦è‡ªå·±ç¼–è¯‘å®‰è£…è¯¥å·¥å…·ï¼Œä¸‹é¢ç¤ºä¾‹åœ¨Ubuntuä¸Šç¼–è¯‘å®‰è£…ï¼š\nsudo apt-get install libpcap-dev libnl-3-dev libnl-genl-3-dev binutils-dev libreadline6-dev autoconf libtool pkg-config build-essential git clone https://github.com/nhorman/dropwatch.git cd dropwatch ./autogen.sh ./configure make make install ç„¶åå¯ä»¥è¿è¡Œdropwatchè¿›è¡Œç›‘æ§\n$ dropwatch -l kas Initializing kallsyms db dropwatch\u0026gt; help Command Syntax: exit - Quit dropwatch help - Display this message set: alertlimit \u0026lt;number\u0026gt; - capture only this many alert packets alertmode \u0026lt;mode\u0026gt; - set mode to \u0026#34;summary\u0026#34; or \u0026#34;packet\u0026#34; trunc \u0026lt;len\u0026gt; - truncate packets to this length. Only applicable when \u0026#34;alertmode\u0026#34; is set to \u0026#34;packet\u0026#34; queue \u0026lt;len\u0026gt; - queue up to this many packets in the kernel. Only applicable when \u0026#34;alertmode\u0026#34; is set to \u0026#34;packet\u0026#34; sw \u0026lt;true | false\u0026gt; - monitor software drops hw \u0026lt;true | false\u0026gt; - monitor hardware drops start - start capture stop - stop capture show - show existing configuration stats - show statistics dropwatch\u0026gt; è¿˜å¯ä»¥é€šè¿‡ tcpdump è¿›è¡Œç½‘ç»œæŠ“åŒ…ï¼Œç„¶åä½¿ç”¨ wireshark æ¥è¿›è¡Œåˆ†æã€‚\n","date":"December 2, 2020","hero":"/zh/posts/linux/network-packets/linux-network.jpg","permalink":"/zh/posts/linux/network-packets/","summary":"åœ¨Linuxç³»ç»Ÿä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ ip , netstat æˆ–è€… [ethtool] å‘½ä»¤æ˜¾ç¤ºç½‘ç»œæ¥å£ä¸¢å¼ƒæ•°æ®åŒ…çš„ç»Ÿè®¡ä¿¡æ¯ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•ä½¿ç”¨æ¯ä¸ªå‘½ä»¤ã€‚\nä½¿ç”¨netstatæŒ‰æ¥å£æ˜¾ç¤ºæ•°æ®åŒ… å…¶å® netstat å‘½ä»¤å·²ç»è¿‡æ—¶ï¼Œå¯ä½¿ç”¨å‘½ä»¤ ip å’Œ ss æ¥ä»£æ›¿ã€‚ä½†æ˜¯ netstat ä¾ç„¶åœ¨ä¸€äº›æ—§çš„Linuxåˆ†å‘ç‰ˆæœ¬ä¸Šå¯ç”¨ï¼Œå› æ­¤åœ¨ ip/ss ä¸å¯ç”¨çš„æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨netstatï¼Œå…¶è¯­æ³•å¦‚ä¸‹\nnetstat -i netstat --interfaces ä¾‹å¦‚\n~$ netstat -i Kernel Interface table Iface MTU Met RX-OK RX-ERR RX-DRP RX-OVR TX-OK TX-ERR TX-DRP TX-OVR Flg docker0 1500 0 188180 0 0 0 151852 0 0 0 BMRU eth0 1500 0 472368 0 0 0 375351 0 0 0 BMRU lo 65536 0 51687 0 0 0 51687 0 0 0 LRU vethc8f46ea 1500 0 136984 0 0 0 79587 0 0 0 BMRU å¦‚æœæƒ³æ˜¾ç¤ºæ¯ç§åè®®çš„æ¦‚è¦ç»Ÿè®¡ä¿¡æ¯ï¼Œå¯ä»¥æ‰§è¡Œ","tags":["network","linux"],"title":"LINUXä¸Šç»Ÿè®¡ç½‘ç»œæ¥å£æ•°æ®åŒ…"},{"categories":["Container"],"contents":"åœ¨è¿›è¡Œåº”ç”¨å®¹å™¨åŒ–çš„å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æ¥åˆ›å»ºå®¹å™¨é•œåƒï¼Œè€Œä½¿ç”¨Dockerfileæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚ è€Œä¸”åœ¨å®ç°CI/CD Pipelineçš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨Dockerfileæ¥æ„å»ºåº”ç”¨å®¹å™¨ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚\næœ¬æ–‡ä¸å…·ä½“ä»‹ç»Dockerfileçš„æŒ‡ä»¤å’Œå†™æ³•ï¼Œä»…ä»…æ˜¯åœ¨å®è·µä¸­ç§¯ç´¯çš„ä¸€äº›å†™å¥½ä¸€ä¸ªDockerfileçš„å°æç¤ºï¼Œä½“ç°åœ¨ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nå‡å°‘æ„å»ºæ—¶é—´ å‡å°é•œåƒå¤§å° é•œåƒå¯ç»´æŠ¤æ€§ é‡å¤æ„å»ºä¸€è‡´æ€§ å®‰å…¨æ€§ å‡å°æ„å»ºæ—¶é—´ é¦–å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªDockerfile\nFROM ubuntu:18.04 COPY . /app RUN apt-get update RUN apt-get -y install ssh vim openjdk-8-jdk CMD [â€œjavaâ€,â€-jarâ€,â€/app/target/app.jarâ€] è¦å‡å°æ„å»ºçš„æ—¶é—´ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä¾‹å¦‚Dockeræ„å»ºçš„ç¼“å­˜ç‰¹æ€§ï¼Œå°½é‡ä¿ç•™ä¸ç»å¸¸æ”¹å˜çš„å±‚ï¼Œè€Œåœ¨Dockerfileçš„æŒ‡ä»¤ä¸­ï¼Œ COPYå’ŒRUNéƒ½ä¼šäº§ç”Ÿæ–°çš„å±‚ï¼Œè€Œä¸”ç¼“å­˜çš„æœ‰æ•ˆæ˜¯ä¸å‘½ä»¤çš„é¡ºåºæœ‰å…³ç³»çš„ã€‚\nåœ¨ä¸Šé¢çš„Dockerfileä¸­ï¼ŒCOPY . /appåœ¨RUN apt-get ...ä¹‹å‰ï¼Œè€ŒCOPYæ˜¯ç»å¸¸æ”¹å˜çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æ¯æ¬¡æ„å»ºéƒ½ä¼šåˆ°å¯¼è‡´RUN apt-get ...ç¼“å­˜å¤±æ•ˆã€‚\nTip-1 : åˆç†åˆ©ç”¨ç¼“å­˜ï¼Œè€Œæ‰§è¡Œå‘½ä»¤çš„é¡ºåºæ˜¯ä¼šå½±å“ç¼“å­˜çš„å¯ç”¨æ€§çš„ã€‚\nè¦å‡å°æ„å»ºæ—¶é—´ï¼Œå¦ä¸€æ–¹é¢æ˜¯åº”è¯¥ä»…ä»…COPYéœ€è¦çš„ä¸œè¥¿ï¼Œå¯¹äºä¸Šé¢è¿™ä¸ªDockerfileçš„ç›®çš„ï¼Œåº”è¯¥ä»…ä»…éœ€è¦COPY Javaåº”ç”¨çš„jaræ–‡ä»¶ã€‚\nTip-2 : æ„å»ºè¿‡ç¨‹ä¸­ä»…ä»…COPYéœ€è¦çš„ä¸œè¥¿ã€‚\nä¸Šé¢çš„Dockerfileå¯¹apt-getå‘½ä»¤åˆ†åˆ«ä½¿ç”¨äº†ä¸¤ä¸ªRUNæŒ‡ä»¤ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªä¸åŒçš„å±‚ã€‚\nTip-3 : å°½é‡åˆå¹¶æœ€ç»ˆé•œåƒçš„å±‚æ•°ã€‚\nè¿˜æœ‰å¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬æœ€ç»ˆæ˜¯æƒ³è¦ä¸€ä¸ªJREç¯å¢ƒæ¥è¿è¡ŒJavaåº”ç”¨ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©ä¸€ä¸ªjreçš„é•œåƒæ¥ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™æ ·ä¸ç”¨èŠ±æ—¶é—´å†å»å®‰è£…jdkã€‚\nTip-4 : é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ\nè¿™æ ·æˆ‘ä»¬å¯ä»¥æŠŠDockerfileå†™æˆï¼š\nFROM ubuntu:18.04 RUN apt-get update \\ \u0026amp;\u0026amp; apt-get y install ssh vim openjdk-8-jdk COPY target/app.jar /app CMD [â€œjavaâ€,â€-jarâ€,â€/app/app.jarâ€] å‡å°é•œåƒå¤§å° è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬å¦‚ä½•å°½é‡å‡å°æœ€ç»ˆåº”ç”¨é•œåƒçš„å¤§å°ï¼Œæ¥åŠ é€Ÿæˆ‘ä»¬çš„CIæ„å»ºï¼Œä»¥åŠå‡å°é•œåƒåœ¨ç½‘ç»œä¸Šä¼ è¾“çš„æ•ˆç‡ã€‚\nåœ¨ä¸Šä¾‹ä¸­ï¼Œssh, vimåº”è¯¥éƒ½æ˜¯ä¸å¿…è¦çš„è½¯ä»¶åŒ…ï¼Œå®ƒä»¬ä¼šå’±ç”¨é•œåƒçš„ç©ºé—´ã€‚\nTip-5 : ç§»é™¤ä¸å¿…è¦çš„è½¯ä»¶åŒ…å®‰è£…ï¼ˆåŒ…æ‹¬ä¸€äº›debugå·¥å…·ï¼‰ã€‚\nå…¶æ¬¡ï¼Œç±»ä¼¼apt-getä¹‹ç±»çš„ç³»ç»ŸåŒ…ç®¡ç†å·¥å…·ä¼šäº§ç”Ÿç¼“å­˜æ•°æ®ï¼Œæˆ‘ä»¬ä¹Ÿåº”è¯¥æ¸…é™¤ã€‚\nTip-6 : åœ¨ä½¿ç”¨ç³»ç»ŸåŒ…ç®¡ç†å·¥å…·å®‰è£…è½¯ä»¶åŒ…åæ¸…ç†ç¼“å­˜æ•°æ®ã€‚\nå¦å¤–æˆ‘ä»¬åº”è¯¥ä½¿ç”¨Dockeræä¾›çš„å¤šé˜¶æ®µæ„å»ºç‰¹æ€§æ¥å‡å°æœ€ç»ˆçš„é•œåƒå¤§å°ï¼Œæˆ‘ä»¬åœ¨åé¢ä»‹ç»ã€‚\næˆ‘ä»¬è¿›ä¸€æ­¥æ”¹è¿›Dockerfileï¼š\nFROM ubuntu:18.04 RUN apt-get update \\ \u0026amp;\u0026amp; apt-get y install â€“no-install-recommends openjdk-8-jdk \\ \u0026amp;\u0026amp; rm -rf /var/lib/apt/lists/* COPY target/app.jar /app CMD [â€œjavaâ€,â€-jarâ€,â€/app/app.jarâ€] é•œåƒçš„å¯ç»´æŠ¤æ€§ æˆ‘ä»¬çœ‹çœ‹ä¸Šé¢çš„Dockerfileï¼Œä½¿ç”¨äº†ä¸€ä¸ªubuntuçš„é•œåƒæ¥å®‰è£…jdkåŒ…ï¼Œè€Œåœ¨å®‰è£…jdkåŒ…çš„ä¸åŒæ—¶é—´ç‚¹ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸åŒçš„ç‰ˆæœ¬ï¼Œè¿™æ ·å°±å¯¼è‡´äº†é•œåƒçš„ä¸æ˜“ç»´æŠ¤ã€‚\nTip-7 : å°½å¯èƒ½ä½¿ç”¨åº”ç”¨ï¼ˆè¯­è¨€ï¼‰è¿è¡Œæ—¶çš„å®˜æ–¹åŸºç¡€é•œåƒï¼Œå¹¶æŒ‡å®šTagç‰ˆæœ¬\nä¸€èˆ¬æ¥è¯´ï¼Œå®˜æ–¹ä¼šç»´æŠ¤ä¸€äº›å˜ç§é•œåƒæ¥æä¾›å¤šæ ·æ€§ï¼Œä¾‹å¦‚åŸºäº alpineçš„ï¼Œè¿˜æœ‰ -slim ç²¾ç®€ç‰ˆæœ¬çš„ï¼Œå…¶æ¬¡å¯¹äºåƒJavaåº”ç”¨ï¼Œæœ€ç»ˆæˆ‘ä»¬éœ€è¦çš„åº”è¯¥åªæ˜¯JREï¼Œå› æ­¤åº”è¯¥é€‰æ‹©jreçš„é•œåƒï¼Œè¿™æ ·æ—¢ä¿è¯äº†å¯ç»´æŠ¤æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥å‡å°é•œåƒçš„å¤§å°ã€‚\nFROM openjdk:8-jre-alpine COPY target/app.jar /app CMD [â€œjavaâ€,â€-jarâ€,â€/app/app.jarâ€] é‡å¤æ„å»ºä¸€è‡´æ€§ æˆ‘ä»¬åº”è¯¥ä¿éšœæˆ‘ä»¬çš„é•œåƒæ„å»ºåœ¨ä»»ä½•æ—¶å€™ï¼Œä»¥åŠä»»ä½•æ„å»ºæœåŠ¡å™¨ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œä½†æ˜¯æˆ‘ä»¬çœ‹ä¸Šé¢çš„Dockerfileï¼Œæ˜¯å°†jaræ–‡ä»¶COPYåˆ°å®¹å™¨ä¸­ï¼Œä½†æ˜¯è¿™ä¸ªjaræ–‡ä»¶æ˜¯åœ¨ä»€ä¹ˆç¯å¢ƒæ„å»ºçš„å‘¢ï¼Ÿ\nTip-8 : åœ¨ä¸€è‡´çš„ç¯å¢ƒä¸­ä»æºä»£ç æ„å»º\nåŒæ ·ï¼ŒDockerçš„å¤šé˜¶æ®µæ„å»ºæä¾›äº†æœ€å¥½çš„è§£å†³æ–¹æ¡ˆï¼Œå°†æºç ç¼–è¯‘æ„å»ºæ”¾åˆ°æ„å»ºé˜¶æ®µï¼Œå°†æœ€ç»ˆç”Ÿæˆçš„è½¯ä»¶åŒ…COPYæ”¾åˆ°è¿è¡Œæ˜¯é˜¶æ®µã€‚\nTip-9 : ä½¿ç”¨å¤šé˜¶æ®µæ„å»º\nFROM maven:3.6-jdk-11 AS builder WORKDIR /app COPY pom.xml . RUN mvn -e -B dependency:resolve COPY src ./src RUN mvn -e -B package FROM openjdk:11-jre-slim COPY â€“from=builder /app/target/app.jar / CMD [â€œjavaâ€,â€-jarâ€,â€/app.jarâ€] ä¾‹å¦‚ä¸Šé¢çš„Dockerfileï¼Œæˆ‘ä»¬ä½¿ç”¨äº†mavençš„é•œåƒæ¥æ„å»ºä»£ç ï¼Œä½¿ç”¨openjdk:jreçš„é•œåƒæ¥è¿è¡Œã€‚\nå®‰å…¨æ€§ æœ€åæˆ‘ä»¬æ¥çœ‹çœ‹å®‰å…¨æ€§ï¼Œå¦‚ä½•ä½¿æˆ‘ä»¬çš„åº”ç”¨å®¹å™¨æ›´åŠ å®‰å…¨ã€‚é¦–å…ˆï¼Œå®¹å™¨é‡ŒåŒ…å«çš„è½¯ä»¶åŒ…è¶Šå°‘ï¼Œé‚£å¯èƒ½çš„æ¼æ´å°±ä¼šè¶Šå°‘ï¼Œæ‰€ä»¥è¿™ä¹Ÿæ˜¯ Tip-5 æ‰€å¼ºè°ƒçš„ã€‚\nTip-10 : ä½¿ç”¨érootç”¨æˆ·è¿è¡Œå®¹å™¨åº”ç”¨è¿›ç¨‹\nå…¶æ¬¡ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨érootç”¨æˆ·æ¥è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ï¼Œé»˜è®¤æƒ…å†µä¸‹å®¹å™¨éƒ½æ˜¯ä½¿ç”¨rootç”¨æˆ·æ¥æ‰§è¡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ–¹æ³•æ¥ä½¿ç”¨érootç”¨æˆ·æ¥è¿è¡Œã€‚\nä½¿ç”¨USERæŒ‡ä»¤ï¼Œè®°å¾—åœ¨ä½¿ç”¨USERæŒ‡ä»¤å‰åˆ›å»ºç›¸åº”çš„ç”¨æˆ· åœ¨CMDæˆ–è€…ENTRYPOINTä¸­ä½¿ç”¨su-exec , gosuç­‰å·¥å…·æ¥å¯åŠ¨åº”ç”¨ æˆ‘æ¨èä½¿ç”¨ç¬¬äºŒç§æ–¹æ³•ï¼Œå› ä¸ºç¬¬ä¸€ç§æ–¹å¼ï¼Œåœ¨å¯åŠ¨å®¹å™¨åè¿›å…¥å®¹å™¨ä¼šé»˜è®¤ä½¿ç”¨érootç”¨æˆ·ï¼Œè¿™æ ·ä¸ä¾¿äºå®‰è£…æŸäº›è°ƒè¯•å·¥å…·æ¥æ‰§è¡Œè°ƒè¯•ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡é…ç½®sudoï¼‰ã€‚\nè€Œç¬¬äºŒç§æ–¹å¼éœ€è¦å®‰è£…su-execç­‰å·¥å…·ï¼Œæˆ‘å»ºè®®è‡ªå·±åŸºäºå®˜æ–¹çš„åŸºç¡€é•œåƒç»´æŠ¤ä¸€äº›è‡ªå·±çš„è¿è¡Œæ—¶åŸºç¡€é•œåƒï¼Œè¿™æ ·é¿å…åœ¨æ¯æ¬¡æ„å»ºåº”ç”¨é•œåƒçš„æ—¶å€™éƒ½è¿›è¡Œä¸€æ¬¡å®‰è£…ã€‚\nFROM gradle:6.4-jdk11 as builder WORKDIR /code COPY . . RUN gradle assemble FROM mengzyou/openjdk:11-jre-alpine ENV APP_HOME=\u0026#34;/opt/app\u0026#34; \\ APP_USER=\u0026#34;appuser\u0026#34; \\ JAR_OPTS=\u0026#34;--spring.profiles.active=prod\u0026#34; RUN addgroup ${APP_USER} \u0026amp;\u0026amp; \\ adduser -D -h ${APP_HOME} -S -G ${APP_USER} ${APP_USER} COPY --from=builder --chown=${APP_USER}:${APP_USER} /code/build/libs/*.jar ${APP_HOME}/app.jar EXPOSE 8080/tcp WORKDIR ${APP_HOME} CMD su-exec app java ${JAVA_OPTS} -jar ${APP_HOME}/app.jar ${JAR_OPTS} # CMD [â€œsu-execâ€,â€appuserâ€,â€sh -câ€,â€java -jar /opt/app/app.jar\u0026#34;] åœ¨æ¥ä¸€ä¸ªgolangçš„ç¤ºä¾‹\nFROM golang:1.14-alpine AS builder RUN apk add --no-cache git \u0026amp;\u0026amp; \\ mkdir -p $GOPATH/src/app \\ WORKDIR $GOPATH/src/app COPY . $GOPATH/src/app RUN go mod tidy \\ \u0026amp;\u0026amp; go build -o /go/bin/app FROM mengzyou/alpine:3.12 ENV APP_HOME=/opt/app \\ APP_USER=appuser RUN addgroup ${APP_USER} \u0026amp;\u0026amp; \\ adduser -D -h ${APP_HOME} -S -G ${APP_USER} ${APP_USER} COPY --from=builder --chown=${APP_USER}:${APP_USER} /go/bin/app ${APP_HOME}/ EXPOSE 8080/tcp WORKDIR ${APP_HOME} CMD su-exec ${APP_USER} ${APP_HOME}/app æ€»ç»“ è¿™é‡Œä»…ä»…æ˜¯åœ¨Dockerfileå®è·µä¸­çš„ä¸€äº›æç¤ºï¼Œè¦å†™å¥½Dockerfileï¼Œè¿˜æœ‰å¾ˆå¤šæ–¹é¢éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼Œå¯å‚è€ƒDockerå®˜æ–¹çš„Best practices for writing Dockerfilesã€‚\n","date":"July 15, 2020","hero":"/zh/posts/container-tech/dockerfile-best/docker-bp.jpg","permalink":"/zh/posts/container-tech/dockerfile-best/","summary":"åœ¨è¿›è¡Œåº”ç”¨å®¹å™¨åŒ–çš„å®è·µä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šç§æ–¹å¼æ¥åˆ›å»ºå®¹å™¨é•œåƒï¼Œè€Œä½¿ç”¨Dockerfileæ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ–¹å¼ã€‚ è€Œä¸”åœ¨å®ç°CI/CD Pipelineçš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨Dockerfileæ¥æ„å»ºåº”ç”¨å®¹å™¨ä¹Ÿæ˜¯å¿…é¡»çš„ã€‚\næœ¬æ–‡ä¸å…·ä½“ä»‹ç»Dockerfileçš„æŒ‡ä»¤å’Œå†™æ³•ï¼Œä»…ä»…æ˜¯åœ¨å®è·µä¸­ç§¯ç´¯çš„ä¸€äº›å†™å¥½ä¸€ä¸ªDockerfileçš„å°æç¤ºï¼Œä½“ç°åœ¨ä¸€ä¸‹å‡ ä¸ªæ–¹é¢ï¼š\nå‡å°‘æ„å»ºæ—¶é—´ å‡å°é•œåƒå¤§å° é•œåƒå¯ç»´æŠ¤æ€§ é‡å¤æ„å»ºä¸€è‡´æ€§ å®‰å…¨æ€§ å‡å°æ„å»ºæ—¶é—´ é¦–å…ˆæ¥çœ‹çœ‹ä¸‹é¢è¿™ä¸ªDockerfile\nFROM ubuntu:18.04 COPY . /app RUN apt-get update RUN apt-get -y install ssh vim openjdk-8-jdk CMD [â€œjavaâ€,â€-jarâ€,â€/app/target/app.jarâ€] è¦å‡å°æ„å»ºçš„æ—¶é—´ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä¾‹å¦‚Dockeræ„å»ºçš„ç¼“å­˜ç‰¹æ€§ï¼Œå°½é‡ä¿ç•™ä¸ç»å¸¸æ”¹å˜çš„å±‚ï¼Œè€Œåœ¨Dockerfileçš„æŒ‡ä»¤ä¸­ï¼Œ COPYå’ŒRUNéƒ½ä¼šäº§ç”Ÿæ–°çš„å±‚ï¼Œè€Œä¸”ç¼“å­˜çš„æœ‰æ•ˆæ˜¯ä¸å‘½ä»¤çš„é¡ºåºæœ‰å…³ç³»çš„ã€‚\nåœ¨ä¸Šé¢çš„Dockerfileä¸­ï¼ŒCOPY . /appåœ¨RUN apt-get ...ä¹‹å‰ï¼Œè€ŒCOPYæ˜¯ç»å¸¸æ”¹å˜çš„éƒ¨åˆ†ï¼Œæ‰€ä»¥æ¯æ¬¡æ„å»ºéƒ½ä¼šåˆ°å¯¼è‡´RUN apt-get ...ç¼“å­˜å¤±æ•ˆã€‚\nTip-1 : åˆç†åˆ©ç”¨ç¼“å­˜ï¼Œè€Œæ‰§è¡Œå‘½ä»¤çš„é¡ºåºæ˜¯ä¼šå½±å“ç¼“å­˜çš„å¯ç”¨æ€§çš„ã€‚\nè¦å‡å°æ„å»ºæ—¶é—´ï¼Œå¦ä¸€æ–¹é¢æ˜¯åº”è¯¥ä»…ä»…COPYéœ€è¦çš„ä¸œè¥¿ï¼Œå¯¹äºä¸Šé¢è¿™ä¸ªDockerfileçš„ç›®çš„ï¼Œåº”è¯¥ä»…ä»…éœ€è¦COPY Javaåº”ç”¨çš„jaræ–‡ä»¶ã€‚\nTip-2 : æ„å»ºè¿‡ç¨‹ä¸­ä»…ä»…COPYéœ€è¦çš„ä¸œè¥¿ã€‚\nä¸Šé¢çš„Dockerfileå¯¹apt-getå‘½ä»¤åˆ†åˆ«ä½¿ç”¨äº†ä¸¤ä¸ªRUNæŒ‡ä»¤ï¼Œä¼šç”Ÿæˆä¸¤ä¸ªä¸åŒçš„å±‚ã€‚\nTip-3 : å°½é‡åˆå¹¶æœ€ç»ˆé•œåƒçš„å±‚æ•°ã€‚\nè¿˜æœ‰å¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œæˆ‘ä»¬æœ€ç»ˆæ˜¯æƒ³è¦ä¸€ä¸ªJREç¯å¢ƒæ¥è¿è¡ŒJavaåº”ç”¨ï¼Œå› æ­¤å¯ä»¥é€‰æ‹©ä¸€ä¸ªjreçš„é•œåƒæ¥ä½œä¸ºåŸºç¡€é•œåƒï¼Œè¿™æ ·ä¸ç”¨èŠ±æ—¶é—´å†å»å®‰è£…jdkã€‚\nTip-4 : é€‰æ‹©åˆé€‚çš„åŸºç¡€é•œåƒ\nè¿™æ ·æˆ‘ä»¬å¯ä»¥æŠŠDockerfileå†™æˆï¼š\nFROM ubuntu:18.04 RUN apt-get update \\ \u0026amp;\u0026amp; apt-get y install ssh vim openjdk-8-jdk COPY target/app.jar /app CMD [â€œjavaâ€,â€-jarâ€,â€/app/app.","tags":["docker"],"title":"DOCKERFILEæ„å»ºæœ€ä½³å®è·µ"},{"categories":null,"contents":"è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å¸–å­ï¼Œæ—¨åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š\nä¸åŒçš„å¸–å­ä½œè€…ã€‚ ç›®å½• é™ä»·å†…å®¹æ¸²æŸ“ã€‚ æ•°å­¦æ¸²æŸ“ã€‚ è¡¨æƒ…ç¬¦å·æ¸²æŸ“ã€‚ Markdownè¯­æ³•æ¸²æŸ“ æ ‡é¢˜ The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nMarkdown Syntax Rendering Headings The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo. Aque venitatiusda cum, voluptionse latur sitiae dolessi aut parist aut dollo enim qui voluptate ma dolestendit peritin re plis aut quas inctum laceat est volestemque commosa as cus endigna tectur, offic to cor sequas etum rerum idem sintibus eiur? Quianimin porecus evelectur, cum que nis nust voloribus ratem aut omnimi, sitatur? Quiatem. Nam, omnis sum am facea corem alique molestrunt et eos evelece arcillit ut aut eos eos nus, sin conecerem erum fuga. Ri oditatquam, ad quibus unda veliamenimin cusam et facea ipsamus es exerum sitate dolores editium rerore eost, temped molorro ratiae volorro te reribus dolorer sperchicium faceata tiustia prat.\nItatur? Quiatae cullecum rem ent aut odis in re eossequodi nonsequ idebis ne sapicia is sinveli squiatum, core et que aut hariosam ex eat.\nBlockquotes The blockquote element represents content that is quoted from another source, optionally with a citation which must be within a footer or cite element, and optionally with in-line changes such as annotations and abbreviations.\nBlockquote without attribution Tiam, ad mint andaepu dandae nostion secatur sequo quae. Note that you can use Markdown syntax within a blockquote.\nBlockquote with attribution Don\u0026rsquo;t communicate by sharing memory, share memory by communicating.\nâ€” Rob Pike1\nTables Tables aren\u0026rsquo;t part of the core Markdown spec, but Hugo supports supports them out-of-the-box.\nName Age Bob 27 Alice 23 Inline Markdown within tables InlineÂ MarkdownÂ InÂ Table italics bold strikethroughÂ code Code Blocks Code block with backticks html \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block indented with four spaces \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026quot;en\u0026quot;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026quot;UTF-8\u0026quot;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; Code block with Hugo\u0026rsquo;s internal highlight shortcode \u0026lt;!DOCTYPE html\u0026gt; \u0026lt;html lang=\u0026#34;en\u0026#34;\u0026gt; \u0026lt;head\u0026gt; \u0026lt;meta charset=\u0026#34;UTF-8\u0026#34;\u0026gt; \u0026lt;title\u0026gt;Example HTML5 Document\u0026lt;/title\u0026gt; \u0026lt;/head\u0026gt; \u0026lt;body\u0026gt; \u0026lt;p\u0026gt;Test\u0026lt;/p\u0026gt; \u0026lt;/body\u0026gt; \u0026lt;/html\u0026gt; List Types Ordered List First item Second item Third item Unordered List List item Another item And another item Nested list Fruit Apple Orange Banana Dairy Milk Cheese Other Elements â€” abbr, sub, sup, kbd, mark GIF is a bitmap image format.\nH2O\nXn + Yn = Zn\nPress CTRL+ALT+Delete to end the session.\nMost salamanders are nocturnal, and hunt for insects, worms, and other small creatures.\nMath Rendering Block math: $$ \\varphi = 1+\\frac{1} {1+\\frac{1} {1+\\frac{1} {1+\\cdots} } } $$\nEmoji Rendering ğŸ™ˆ ğŸ™ˆ ğŸ™‰ ğŸ™‰ ğŸ™Š ğŸ™Š\nThe above quote is excerpted from Rob Pike\u0026rsquo;s talk during Gopherfest, November 18, 2015.\u0026#160;\u0026#x21a9;\u0026#xfe0e;\n","date":"June 8, 2020","hero":"/zh/posts/markdown-sample/hero.svg","permalink":"/zh/posts/markdown-sample/","summary":"è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å¸–å­ï¼Œæ—¨åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š\nä¸åŒçš„å¸–å­ä½œè€…ã€‚ ç›®å½• é™ä»·å†…å®¹æ¸²æŸ“ã€‚ æ•°å­¦æ¸²æŸ“ã€‚ è¡¨æƒ…ç¬¦å·æ¸²æŸ“ã€‚ Markdownè¯­æ³•æ¸²æŸ“ æ ‡é¢˜ The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nMarkdown Syntax Rendering Headings The following HTML \u0026lt;h1\u0026gt;â€”\u0026lt;h6\u0026gt; elements represent six levels of section headings. \u0026lt;h1\u0026gt; is the highest section level while \u0026lt;h6\u0026gt; is the lowest.\nH1 H2 H3 H4 H5 H6 Paragraph Xerum, quo qui aut unt expliquam qui dolut labo.","tags":null,"title":"Markdownç¤ºä¾‹"},{"categories":null,"contents":"è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å¸–å­ï¼Œæ—¨åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š\né»˜è®¤è‹±é›„å½¢è±¡ã€‚ ä¸åŒçš„çŸ­ä»£ç ã€‚ å‘Šè­¦ è¯¥ä¸»é¢˜å¯ç”¨ä»¥ä¸‹å‘Šè­¦ã€‚\nè¿™æ˜¯ type=\u0026quot;success\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;danger\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;warning\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;info\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;dark\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;primary\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;secondary\u0026quot; çš„å‘Šè­¦ã€‚ å›¾åƒ æ²¡æœ‰ä»»ä½•å±æ€§çš„ç¤ºä¾‹å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}}\nè®¾ç½®é«˜å®½å±æ€§çš„ç¤ºä¾‹å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;400\u0026rdquo; width=\u0026ldquo;600\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}} è®¾ç½®é«˜å®½å±æ€§ä¸­é—´å¯¹é½çš„å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;400\u0026rdquo; width=\u0026ldquo;600\u0026rdquo; align=\u0026ldquo;center\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}} å¸¦æœ‰floatå±æ€§çš„å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;200\u0026rdquo; width=\u0026ldquo;500\u0026rdquo; float=\u0026ldquo;right\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}}\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Cras egestas lectus sed leo ultricies ultricies. Praesent tellus risus, eleifend vel efficitur ac, venenatis sit amet sem. Ut ut egestas erat. Fusce ut leo turpis. Morbi consectetur sed lacus vitae vehicula. Cras gravida turpis id eleifend volutpat. Suspendisse nec ipsum eu erat finibus dictum. Morbi volutpat nulla purus, vel maximus ex molestie id. Nullam posuere est urna, at fringilla eros venenatis quis.\nFusce vulputate dolor augue, ut porta sapien fringilla nec. Vivamus commodo erat felis, a sodales lectus finibus nec. In a pulvinar orci. Maecenas suscipit eget lorem non pretium. Nulla aliquam a augue nec blandit. Curabitur ac urna iaculis, ornare ligula nec, placerat nulla. Maecenas aliquam nisi vitae tempus vulputate.\nåˆ†åˆ— æ­¤ä¸»é¢˜æ”¯æŒæ ¹æ®éœ€è¦å°†é¡µé¢æ‹†åˆ†ä¸ºä»»æ„æ•°é‡çš„åˆ—ã€‚\nä¸¤åˆ— {{\u0026lt;split 6 6\u0026gt;}} -\u0026ndash; {{\u0026lt; /split \u0026gt;}}\nå·¦è¾¹åˆ— Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras egestas lectus sed leo ultricies ultricies. å³è¾¹åˆ— Fusce ut leo turpis. Morbi consectetur sed lacus vitae vehicula. Cras gravida turpis id eleifend volutpat. ä¸‰åˆ— {{\u0026lt; split 4 4 4 \u0026gt;}} \u0026mdash; \u0026mdash; {{\u0026lt; /split \u0026gt;}}\nå·¦è¾¹åˆ— Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras egestas lectus sed leo ultricies ultricies. ä¸­é—´åˆ— Aenean dignissim dictum ex. Donec a nunc vel nibh placerat interdum. å³è¾¹åˆ— Fusce ut leo turpis. Morbi consectetur sed lacus vitae vehicula. Cras gravida turpis id eleifend volutpat. å‚ç›´ç©ºé—´ ä¸¤è¡Œä¹‹é—´çš„å‚ç›´ç©ºé—´ã€‚\n{{\u0026lt; vs 4\u0026gt;}}\nç¬¬ä¸€è¡Œã€‚ è¿™æ˜¯ç¬¬äºŒè¡Œã€‚ä¸ä¸Šä¸€è¡Œå°†æœ‰4remçš„å‚ç›´ç©ºé—´ã€‚\nè§†é¢‘ {{\u0026lt; video src=\u0026quot;/videos/sample.mp4\u0026quot; \u0026gt;}}\nVideo by Rahul Sharma from Pexels.\nMermaid è¿™é‡Œæ˜¯ä¸€äº›ä½¿ç”¨mermaidçŸ­ä»£ç çš„ç¤ºä¾‹ã€‚\nå›¾å½¢:\n\\{\\{\u0026lt; mermaid align=\u0026#34;left\u0026#34; \u0026gt;}} graph LR; A[Hard edge] --\u0026gt;|Link text| B(Round edge) B --\u0026gt; C{Decision} C --\u0026gt;|One| D[Result one] C --\u0026gt;|Two| E[Result two] \\{\\{\u0026lt; /mermaid \u0026gt;}} graph LR; A[Hard edge] --\u003e|Link text| B(Round edge) B --\u003e C{Decision} C --\u003e|One| D[Result one] C --\u003e|Two| E[Result two] åºåˆ—å›¾:\n\\{\\{\u0026lt; mermaid \u0026gt;}} sequenceDiagram participant Alice participant Bob Alice-\u0026gt;\u0026gt;John: Hello John, how are you? loop Healthcheck John-\u0026gt;\u0026gt;John: Fight against hypochondria end Note right of John: Rational thoughts \u0026lt;br/\u0026gt;prevail! John--\u0026gt;\u0026gt;Alice: Great! John-\u0026gt;\u0026gt;Bob: How about you? Bob--\u0026gt;\u0026gt;John: Jolly good! \\{\\{\u0026lt; /mermaid \u0026gt;}} sequenceDiagram participant Alice participant Bob Alice-\u003e\u003eJohn: Hello John, how are you? loop Healthcheck John-\u003e\u003eJohn: Fight against hypochondria end Note right of John: Rational thoughts prevail! John--\u003e\u003eAlice: Great! John-\u003e\u003eBob: How about you? Bob--\u003e\u003eJohn: Jolly good! ç”˜ç‰¹å›¾:\n\\{\\{\u0026lt; mermaid \u0026gt;}} gantt dateFormat YYYY-MM-DD title Adding GANTT diagram to mermaid excludes weekdays 2014-01-10 section A section Completed task :done, des1, 2014-01-06,2014-01-08 Active task :active, des2, 2014-01-09, 3d Future task : des3, after des2, 5d Future task2 : des4, after des3, 5d \\{\\{\u0026lt; /mermaid \u0026gt;}} gantt dateFormat YYYY-MM-DD title Adding GANTT diagram to mermaid excludes weekdays 2014-01-10 section A section Completed task :done, des1, 2014-01-06,2014-01-08 Active task :active, des2, 2014-01-09, 3d Future task : des3, after des2, 5d Future task2 : des4, after des3, 5d ç±»å›¾:\n\\{\\{\u0026lt; mermaid \u0026gt;}} classDiagram Class01 \u0026lt;|-- AveryLongClass : Cool Class03 *-- Class04 Class05 o-- Class06 Class07 .. Class08 Class09 --\u0026gt; C2 : Where am i? Class09 --* C3 Class09 --|\u0026gt; Class07 Class07 : equals() Class07 : Object[] elementData Class01 : size() Class01 : int chimp Class01 : int gorilla Class08 \u0026lt;--\u0026gt; C2: Cool label \\{\\{\u0026lt; /mermaid \u0026gt;}} classDiagram Class01 \u003c|-- AveryLongClass : Cool Class03 *-- Class04 Class05 o-- Class06 Class07 .. Class08 Class09 --\u003e C2 : Where am i? Class09 --* C3 Class09 --|\u003e Class07 Class07 : equals() Class07 : Object[] elementData Class01 : size() Class01 : int chimp Class01 : int gorilla Class08 \u003c--\u003e C2: Cool label Gitå›¾:\n\\{\\{\u0026lt; mermaid background=\u0026#34;black\u0026#34; align=\u0026#34;right\u0026#34; \u0026gt;}} gitGraph: options { \u0026#34;nodeSpacing\u0026#34;: 150, \u0026#34;nodeRadius\u0026#34;: 10 } end commit branch newbranch checkout newbranch commit commit checkout master commit commit merge newbranch \\{\\{\u0026lt; /mermaid \u0026gt;}} gitGraph: options { \"nodeSpacing\": 150, \"nodeRadius\": 10 } end commit branch newbranch checkout newbranch commit commit checkout master commit commit merge newbranch ERå›¾:\n\\{\\{\u0026lt; mermaid \u0026gt;}} erDiagram CUSTOMER ||--o{ ORDER : places ORDER ||--|{ LINE-ITEM : contains CUSTOMER }|..|{ DELIVERY-ADDRESS : uses \\{\\{\u0026lt; /mermaid \u0026gt;}} erDiagram CUSTOMER ||--o{ ORDER : places ORDER ||--|{ LINE-ITEM : contains CUSTOMER }|..|{ DELIVERY-ADDRESS : uses Gist {{\u0026lt; gist hossainemruz 4ad86c9b6378677e14eff12713e75e44 \u0026gt;}}\n","date":"June 8, 2020","hero":"/images/default-hero.jpg","permalink":"/zh/posts/shortcodes/","summary":"è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å¸–å­ï¼Œæ—¨åœ¨æµ‹è¯•ä»¥ä¸‹å†…å®¹ï¼š\né»˜è®¤è‹±é›„å½¢è±¡ã€‚ ä¸åŒçš„çŸ­ä»£ç ã€‚ å‘Šè­¦ è¯¥ä¸»é¢˜å¯ç”¨ä»¥ä¸‹å‘Šè­¦ã€‚\nè¿™æ˜¯ type=\u0026quot;success\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;danger\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;warning\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;info\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;dark\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;primary\u0026quot; çš„å‘Šè­¦ã€‚ è¿™æ˜¯ type=\u0026quot;secondary\u0026quot; çš„å‘Šè­¦ã€‚ å›¾åƒ æ²¡æœ‰ä»»ä½•å±æ€§çš„ç¤ºä¾‹å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}}\nè®¾ç½®é«˜å®½å±æ€§çš„ç¤ºä¾‹å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;400\u0026rdquo; width=\u0026ldquo;600\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}} è®¾ç½®é«˜å®½å±æ€§ä¸­é—´å¯¹é½çš„å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;400\u0026rdquo; width=\u0026ldquo;600\u0026rdquo; align=\u0026ldquo;center\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}} å¸¦æœ‰floatå±æ€§çš„å›¾åƒ {{\u0026lt; img src=\u0026quot;/posts/shortcodes/boat.jpg\u0026quot; height=\u0026ldquo;200\u0026rdquo; width=\u0026ldquo;500\u0026rdquo; float=\u0026ldquo;right\u0026rdquo; title=\u0026ldquo;æµ·ä¸Šçš„ä¸€è‰˜èˆ¹\u0026rdquo; \u0026gt;}}\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Cras egestas lectus sed leo ultricies ultricies.","tags":null,"title":"çŸ­ä»£ç ç¤ºä¾‹"},{"categories":["Container"],"contents":"åœ¨æœ¬ç³»åˆ—çš„Dockerå…¥é—¨ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•åœ¨Ubuntuï¼ˆLinuxï¼‰ä¸Šå®‰è£…Dockerå¼•æ“æ¥è¿›è¡Œå®¹å™¨åŒ–å¼•ç”¨çš„å¼€å‘ã€‚\næœ¬ç¯‡æˆ‘ä»¬ä»‹ç»å¦‚ä½•åœ¨Windowsç³»ç»Ÿä¸Šå®‰è£…å’Œä½¿ç”¨Dockerï¼Œè¿™é‡Œä¸»è¦ä»‹ç»åœ¨Windows 10ä¸Šå®‰è£…å’Œä½¿ç”¨Docker Desktopï¼Œå¯¹äºWindows 10ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨Docker Toolboxï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼\nå®‰è£…Docker Desktop Docker Desktopã€€- The fastest way to containerize applications on your desktopï¼Œã€€è¿™æ˜¯Dockerå®˜æ–¹çš„å®šä¹‰ï¼ŒDocker Desktopä¸ºWindowså’ŒMacæä¾›äº†ä¸€ä¸ªæ¡Œé¢åŒ–çš„å®¹å™¨å¼€å‘ç¯å¢ƒï¼Œåœ¨Windows 10ä¸Šï¼ŒDocker Desktopä½¿ç”¨äº†Windowsçš„Hyper-Vè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå› æ­¤ä½ éœ€è¦ä¸€å°æ‰“å¼€äº†ç¡¬ä»¶è™šåŒ–åŒ–çš„ç”µè„‘å¹¶ä¸”å®‰è£…çš„æ˜¯Windows 10ä¸“ä¸šç‰ˆä»¥ä¸Šçš„ç³»ç»Ÿï¼Œè¿˜éœ€è¦æ‰“å¼€Hyper-VåŠŸèƒ½ï¼Œå¦‚ä½•åœ¨Windows 10ä¸Šæ‰“å¼€Hyper-Vï¼Œå‚è€ƒè¿™é‡Œï¼\nè¡¥å……ã€€ï¼šã€€Docker Desktopæ”¯æŒWindows 10 64ä½: ä¸“ä¸šç‰ˆï¼Œä¼ä¸šç‰ˆï¼Œæ•™è‚²ç‰ˆ (Build 15063 æˆ–ä»¥ä¸Š).\né¦–å…ˆåœ¨æ»¡è¶³æ¡ä»¶çš„Windowsç³»ç»Ÿä¸Šä¸‹è½½Docker Desktopçš„å®‰è£…åŒ… - https://hub.docker.com/editions/community/docker-ce-desktop-windowsã€€ï¼å®‰è£…è¿‡ç¨‹æ˜¯ç®€å•çš„ï¼Œç›´æ¥åŒå‡»ä¸‹è½½çš„å®‰è£…ï¼Œæ›´å…·æç¤ºå®‰è£…å°±å¥½äº†ï¼Œä¸€å¼€å§‹æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨Linuxå®¹å™¨ï¼ˆä¹‹åå¯ä»¥å…¶ä»–æ¢åˆ°ä½¿ç”¨Windowså®¹å™¨çš„æ–¹å¼ï¼Œä¼šå•ç‹¬å†™ä¸€ç¯‡æ¥ä»‹ç»ä½¿ç”¨Windowså®¹å™¨ï¼‰ï¼å®‰è£…è¿‡ç¨‹ä¸­å®‰è£…ç¨‹åºä¼šæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œå®‰è£…ç¨‹åºä¼šæŠ¥é”™å¹¶ç»“æŸå®‰è£…ï¼\nå®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€ å¼€å§‹ èœå•ï¼Œç„¶åé€‰æ‹© Docker Desktop å¯åŠ¨ï¼\næŸ¥çœ‹çŠ¶æ€æ ä¸Šçš„Dockerå›¾æ ‡ï¼Œä¸€å¼€å§‹ä¼šæ˜¾ç¤º starting è£…ï¼Œç­‰åˆ°æ˜¾ç¤ºDocker Desktop is runningï¼Œå°±å¯ä»¥é€šè¿‡ç»ˆç«¯ï¼ˆä¾‹å¦‚ PowerSheelï¼‰æ¥ä½¿ç”¨Dockerçš„ç›¸å…³å‘½ä»¤äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨Windows 10çš„PowerShellä½œä¸ºç»ˆç«¯æ¥è¿›è¡Œæ“ä½œï¼\næ„å»ºå’Œè¿è¡Œå®¹å™¨ æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•Nodeåº”ç”¨æ¥ç¤ºä¾‹å¦‚ä½•åœ¨Windowsä¸Šæ„å»ºå®¹å™¨é•œåƒå’Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†ä»£ç åº“ä¸‹è½½åˆ°æˆ‘ä»¬çš„ç¯å¢ƒä¸­ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨Gitæ¥å…‹éš†ä»£ç åº“æˆ–è€…ç›´æ¥ä¸‹è½½ä»£ç åŒ…ï¼\nåœ¨Windowsä¸Šï¼Œå¯ä»¥ä½¿ç”¨Git for Windowsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Windows 10çš„WSLå®‰è£…ä¸€ä¸ªUbuntuå­ç³»ç»Ÿï¼Œç„¶ååœ¨Ubuntuå­ç³»ç»Ÿç»ˆç«¯é‡Œå®‰è£…Gitï¼Œå¹¶ç›´æ¥ä½¿ç”¨Gitå…‹éš†ä»£ç ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯åœ¨Ubuntuå­ç³»ç»Ÿç»ˆç«¯é‡Œå…‹éš†ä»£ç åº“åˆ°æœ¬åœ°ç›®å½•ï¼\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠä»£ç å…‹éš†åˆ°äº†D:\\gitrepos\\hellonode\\ç›®å½•ï¼Œç„¶ååˆ‡æ¢åˆ°PowerShellç»ˆç«¯ï¼Œè¿›å…¥è¯¥ç›®å½•.ã€€ç”¨ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€hellonode\\Dockerfileï¼ˆæ¨èæ—¶å€™ç”¨VS Codeï¼Œå†…å®¹å¦‚ä¸‹\nFROM node:12.2-alpine MAINTAINER Mengz You \u0026lt;mengz.you@outlook.com\u0026gt; WORKDIR /app COPY package*.json ./ RUN npm install COPY . . EXPOSE 3000 CMD [\u0026#34;npm\u0026#34;,\u0026#34;start\u0026#34;] æ„å»ºé•œåƒ ä½¿ç”¨è¿™ä¸ªç®€å•çš„Dockerfileï¼Œç”¨äºæ„å»ºç¤ºä¾‹çš„Nodeåº”ç”¨ï¼Œåœ¨Powershellä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤\ndocker image build -t hellnode:local . docker image ls å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†ä¼šçœ‹åˆ°æ„å»ºçš„å®¹å™¨é•œåƒ\nè¿è¡Œå®¹å™¨ æ¥ç€æˆ‘ä»¬ä½¿ç”¨æ„å»ºå¥½çš„é•œåƒæ¥å¯åŠ¨ä¸€ä¸ªåº”ç”¨å®¹å™¨ï¼Œåœ¨Powershellä¸­æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤\ndocker container run --name hellonode -d -p 3000:3000 hellonode:local docker container ls è¿™æ ·æˆ‘ä»¬å°±å¯åŠ¨äº†ä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨docker contianer lsæŸ¥çœ‹å½“å‰çš„å®¹å™¨çŠ¶æ€ï¼ŒåŒæ—¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨Docker Desktopçš„Dashboardæ¥å›¾å½¢åŒ–æŸ¥çœ‹å®¹å™¨çŠ¶æ€å¹¶è¿›è¡Œä¸€äº›æ“ä½œï¼Œè¦æ‰“å¼€Dashboardï¼Œç‚¹å‡»çŠ¶æ€æ çš„Docker Desktopå›¾æ ‡ï¼Œé€‰æ‹©Dashboardæ‰“å¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\nåœ¨Dashboardä¸Šï¼Œæˆ‘ä»¬å¯ä»¥UIæ“ä½œçš„æ–¹å¼æŸ¥çœ‹å®¹å™¨ç›¸å…³çš„ä¿¡æ¯ï¼Œä¾‹å¦‚æŸ¥çœ‹å®¹å™¨çš„æ—¥å¿—ï¼Œåœæ­¢ï¼å¯åŠ¨ï¼é‡å¯å®¹å™¨ï¼Œè¿˜å¯ä»¥è¿›å…¥å®¹å™¨CLIç­‰æ“ä½œï¼\nåœ¨è¿è¡Œå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨-p 3000:3000æŒ‡å®šäº†å°†å®¹å™¨åº”ç”¨çš„3000ç«¯å£æ˜ å°„åˆ°äº†æœ¬åœ°çš„3000ç«¯å£ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥è®¿é—®æœ¬åœ°3000ç«¯å£æ¥è®¿é—®åº”ç”¨\nä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸‹å‘½ä»¤åœæ­¢å’Œåˆ é™¤æ‰å®¹å™¨\ndocker container stop hellonode docker contianer rm hellonode æ¨é€é•œåƒåˆ°Docker Hub å¦‚ä½•ä½ éœ€è¦å°†æ„å»ºçš„é•œåƒæ¨é€åˆ°Docker Hubï¼Œé¦–å…ˆéœ€è¦ç™»å½•ä½ çš„Docker Hubå¸å·ï¼Œç‚¹å‡»çŠ¶æ€æ çš„Docker Desktopå›¾æ ‡ï¼Œé€‰æ‹©Sign in/Create Docker ID..ï¼Œæ‰“å¼€ç™»å½•çª—å£è¿›è¡Œç™»å½•\nç„¶åæˆ‘ä»¬åœ¨PowerShellé‡Œæ‰§è¡Œ\ndocker image tag hellonode:local mengzyou/hellonode:v1.0 docker image push mengzyou/hellonode:v1.0 è¿™æ ·å°±ä¼šå°†é•œåƒæ¨é€åˆ°Docker Hubä¸Šä½ çš„ä»“åº“ä¸­äº†ï¼\næ€»ç»“ è¿™é‡Œæ˜¯ç®€å•ä»‹ç»äº†ä¸‹å¦‚ä½•åœ¨Windows 10ä¸Šä½¿ç”¨Docker Desktopæ¥è¿›è¡Œå®¹å™¨è¯åº”ç”¨çš„å¼€å‘ï¼ŒDocker Desktopä¸ºWindowsç”¨æˆ·æä¾›äº†å¾ˆå¥½çš„Dockerå®¹å™¨åŒ–å·¥å…·ï¼Œé™¤äº†å¯ä»¥ä½¿ç”¨Dockerå¼•æ“ä¹‹å¤–ï¼ŒDocker Desktopè¿˜æä¾›äº†KubenetesåŠŸèƒ½ï¼Œå¯ä»¥åœ¨Windowsä¸Šè¿è¡Œä¸€ä¸ªå•æœºçš„K8Sç¯å¢ƒï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼\nè™½ç„¶Docker Desktopä¸ºWindowsæä¾›äº†ä¸€ä¸ªå¯è§†åŒ–çš„ç®¡ç†å·¥å…·ï¼Œä¸è¿‡æˆ‘è¿˜æ˜¯æ¨èç›´æ¥åœ¨Linuxæ¡Œé¢ä¸Šç›´æ¥ä½¿ç”¨Dockerå¼•æ“ï¼Œåœ¨Linuxç¯å¢ƒä¸­ï¼Œå¦‚æœä½ ä¹Ÿæƒ³è¦ä¸€ä¸ªUIçš„ç®¡ç†å·¥å…·ï¼Œæˆ‘æ¨èä½¿ç”¨Portainer - ä¸€ä¸ªåŸºäºWebçš„å®¹å™¨ç®¡ç†å·¥å…·ï¼\n","date":"March 18, 2020","hero":"/zh/posts/container-tech/docker-desktop-windows/docker-desktop-windows.jpg","permalink":"/zh/posts/container-tech/docker-desktop-windows/","summary":"åœ¨æœ¬ç³»åˆ—çš„Dockerå…¥é—¨ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•åœ¨Ubuntuï¼ˆLinuxï¼‰ä¸Šå®‰è£…Dockerå¼•æ“æ¥è¿›è¡Œå®¹å™¨åŒ–å¼•ç”¨çš„å¼€å‘ã€‚\næœ¬ç¯‡æˆ‘ä»¬ä»‹ç»å¦‚ä½•åœ¨Windowsç³»ç»Ÿä¸Šå®‰è£…å’Œä½¿ç”¨Dockerï¼Œè¿™é‡Œä¸»è¦ä»‹ç»åœ¨Windows 10ä¸Šå®‰è£…å’Œä½¿ç”¨Docker Desktopï¼Œå¯¹äºWindows 10ä»¥ä¸‹çš„ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨Docker Toolboxï¼Œè¿™é‡Œå°±ä¸åšä»‹ç»äº†ï¼\nå®‰è£…Docker Desktop Docker Desktopã€€- The fastest way to containerize applications on your desktopï¼Œã€€è¿™æ˜¯Dockerå®˜æ–¹çš„å®šä¹‰ï¼ŒDocker Desktopä¸ºWindowså’ŒMacæä¾›äº†ä¸€ä¸ªæ¡Œé¢åŒ–çš„å®¹å™¨å¼€å‘ç¯å¢ƒï¼Œåœ¨Windows 10ä¸Šï¼ŒDocker Desktopä½¿ç”¨äº†Windowsçš„Hyper-Vè™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå› æ­¤ä½ éœ€è¦ä¸€å°æ‰“å¼€äº†ç¡¬ä»¶è™šåŒ–åŒ–çš„ç”µè„‘å¹¶ä¸”å®‰è£…çš„æ˜¯Windows 10ä¸“ä¸šç‰ˆä»¥ä¸Šçš„ç³»ç»Ÿï¼Œè¿˜éœ€è¦æ‰“å¼€Hyper-VåŠŸèƒ½ï¼Œå¦‚ä½•åœ¨Windows 10ä¸Šæ‰“å¼€Hyper-Vï¼Œå‚è€ƒè¿™é‡Œï¼\nè¡¥å……ã€€ï¼šã€€Docker Desktopæ”¯æŒWindows 10 64ä½: ä¸“ä¸šç‰ˆï¼Œä¼ä¸šç‰ˆï¼Œæ•™è‚²ç‰ˆ (Build 15063 æˆ–ä»¥ä¸Š).\né¦–å…ˆåœ¨æ»¡è¶³æ¡ä»¶çš„Windowsç³»ç»Ÿä¸Šä¸‹è½½Docker Desktopçš„å®‰è£…åŒ… - https://hub.docker.com/editions/community/docker-ce-desktop-windowsã€€ï¼å®‰è£…è¿‡ç¨‹æ˜¯ç®€å•çš„ï¼Œç›´æ¥åŒå‡»ä¸‹è½½çš„å®‰è£…ï¼Œæ›´å…·æç¤ºå®‰è£…å°±å¥½äº†ï¼Œä¸€å¼€å§‹æˆ‘ä»¬é€‰æ‹©ä½¿ç”¨Linuxå®¹å™¨ï¼ˆä¹‹åå¯ä»¥å…¶ä»–æ¢åˆ°ä½¿ç”¨Windowså®¹å™¨çš„æ–¹å¼ï¼Œä¼šå•ç‹¬å†™ä¸€ç¯‡æ¥ä»‹ç»ä½¿ç”¨Windowså®¹å™¨ï¼‰ï¼å®‰è£…è¿‡ç¨‹ä¸­å®‰è£…ç¨‹åºä¼šæ£€æŸ¥ç³»ç»Ÿæ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœä¸æ»¡è¶³ï¼Œå®‰è£…ç¨‹åºä¼šæŠ¥é”™å¹¶ç»“æŸå®‰è£…ï¼\nå®‰è£…å®Œæˆä¹‹åï¼Œæ‰“å¼€ å¼€å§‹ èœå•ï¼Œç„¶åé€‰æ‹© Docker Desktop å¯åŠ¨ï¼\næŸ¥çœ‹çŠ¶æ€æ ä¸Šçš„Dockerå›¾æ ‡ï¼Œä¸€å¼€å§‹ä¼šæ˜¾ç¤º starting è£…ï¼Œç­‰åˆ°æ˜¾ç¤ºDocker Desktop is runningï¼Œå°±å¯ä»¥é€šè¿‡ç»ˆç«¯ï¼ˆä¾‹å¦‚ PowerSheelï¼‰æ¥ä½¿ç”¨Dockerçš„ç›¸å…³å‘½ä»¤äº†ï¼Œä¸‹é¢æˆ‘ä»¬å°†ä½¿ç”¨Windows 10çš„PowerShellä½œä¸ºç»ˆç«¯æ¥è¿›è¡Œæ“ä½œï¼\næ„å»ºå’Œè¿è¡Œå®¹å™¨ æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•Nodeåº”ç”¨æ¥ç¤ºä¾‹å¦‚ä½•åœ¨Windowsä¸Šæ„å»ºå®¹å™¨é•œåƒå’Œå¯åŠ¨ä¸€ä¸ªå®¹å™¨ï¼é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†ä»£ç åº“ä¸‹è½½åˆ°æˆ‘ä»¬çš„ç¯å¢ƒä¸­ï¼Œè¿™é‡Œå¯ä»¥ä½¿ç”¨Gitæ¥å…‹éš†ä»£ç åº“æˆ–è€…ç›´æ¥ä¸‹è½½ä»£ç åŒ…ï¼\nåœ¨Windowsä¸Šï¼Œå¯ä»¥ä½¿ç”¨Git for Windowsï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Windows 10çš„WSLå®‰è£…ä¸€ä¸ªUbuntuå­ç³»ç»Ÿï¼Œç„¶ååœ¨Ubuntuå­ç³»ç»Ÿç»ˆç«¯é‡Œå®‰è£…Gitï¼Œå¹¶ç›´æ¥ä½¿ç”¨Gitå…‹éš†ä»£ç ï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨çš„æ˜¯åœ¨Ubuntuå­ç³»ç»Ÿç»ˆç«¯é‡Œå…‹éš†ä»£ç åº“åˆ°æœ¬åœ°ç›®å½•ï¼\nå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŠŠä»£ç å…‹éš†åˆ°äº†D:\\gitrepos\\hellonode\\ç›®å½•ï¼Œç„¶ååˆ‡æ¢åˆ°PowerShellç»ˆç«¯ï¼Œè¿›å…¥è¯¥ç›®å½•.ã€€ç”¨ä½ å–œæ¬¢çš„æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€hellonode\\Dockerfileï¼ˆæ¨èæ—¶å€™ç”¨VS Codeï¼Œå†…å®¹å¦‚ä¸‹\nFROM node:12.2-alpine MAINTAINER Mengz You \u0026lt;mengz.you@outlook.com\u0026gt; WORKDIR /app COPY package*.","tags":["docker","windows"],"title":"WINDOWSä¸Šçš„DOCKER DESKTOP"},{"categories":["DEVOPS"],"contents":"è¿™ç¯‡æ–‡ç« ä»¥ä¸€ä¸ªç®€å•çš„Nodejsåº”ç”¨ä¸ºä¾‹ï¼Œç¤ºä¾‹å¦‚ä½•ä½¿ç”¨Github Actionsæ¥è‡ªåŠ¨æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼\nä»€ä¹ˆæ˜¯Github Actions é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯Github Actionsï¼Ÿã€€Github Actionsæ˜¯Githubå®˜æ–¹æä¾›çš„ä¸€ä¸ªä¸Githubé›†æˆåœ¨ä¸€èµ·çš„CI/CDå·¥å…·ï¼Œä½¿ç”¨Github Actionså¯ä»¥éå¸¸å®¹æ˜“åœ°è‡ªåŠ¨åŒ–ä½ çš„æ‰€æœ‰è½¯ä»¶å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­å‘å¸ƒï¼ˆCDï¼‰ï¼\nä¸è¿‡è¦ä½¿ç”¨Github Actionsï¼Œä½ éœ€è¦å°†ä½ çš„é¡¹ç›®ä»£ç åº“æ”¾åœ¨Githubä¸Šï¼Œç„¶åä¸ºä»£ç åº“é…ç½®ç›¸åº”çš„å·¥ä½œæµï¼ˆWorkflowsï¼‰ï¼ã€€Actions Runner ä½¿ç”¨Github Actionsæ¥æ‰§è¡Œå·¥ä½œæµä»»åŠ¡ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¯å¢ƒï¼ŒActions Runnerå°±æ˜¯æä¾›è¿™æ ·çš„ç¯å¢ƒï¼ŒGithub Actionsæ”¯æŒä¸¤ç§ç±»å‹çš„Runner:\nGithub-Hosted Runner : ç”±Githubå®˜æ–¹æä¾›å’Œç»´æŠ¤çš„RunneræœåŠ¡å™¨ï¼Œä¸éœ€è¦ç”¨æˆ·è‡ªå·±ç»´æŠ¤å’Œæ›´æ–°ï¼Œæœ‰æ”¯æŒLinnuxï¼ŒWindowsï¼ŒmacOSç¯å¢ƒçš„æ„å»º Self-Hosted Runner : ç”¨æˆ·è‡ªå·±ä½¿ç”¨æœ¬åœ°æœºå™¨ï¼Œäº‘æœåŠ¡å™¨å®‰è£…Actionsåº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç¡¬ä»¶ï¼Œè½¯ä»¶ç­‰éœ€æ±‚ Actions åœ¨Github Actionsä¸­æœ‰ä¸€ä¸ªActionçš„æ¦‚å¿µï¼ŒActionsæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼Œä½ å¯ä»¥ç»„åˆè¿™äº›ä»»åŠ¡æˆä¸ºè¦å®Œæˆä¸€ä¸ªå·¥ä½œçš„æ­¥éª¤.ã€€åœ¨å·¥ä½œæ­¥éª¤ä¸­ï¼Œä½ å¯ä»¥è‡ªå·±å†™æ‰§è¡Œå‘½ä»¤ç»„æˆActionï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Githubç¤¾åŒºæä¾›çš„é’ˆå¯¹ä¸€ä¸ªå†™å…¬å…±ä»»åŠ¡çš„Actionsï¼Œå¯ä»¥åˆ°Githubå¸‚åœºæŸ¥æ‰¾ç¤¾åŒºæˆ–è€…å…¶ä»–å¼€å‘äººå‘˜ç¼–å†™çš„Actionsï¼ã€€ä¾‹å¦‚ä¸€ä¸ªæœ€å¸¸ç”¨çš„Action - checkoutï¼Œå¯ç”¨æ¥æ£€å‡ºä»£ç åº“ï¼š\n- uses: actions/checkout@v2 é™¤äº†ä»¥ä¸Šæ¦‚å¿µä¹‹å¤–ï¼ŒGithub Actionsè¿˜æœ‰å…¶ä»–æ¦‚å¿µéœ€è¦äº†è§£ï¼Œå…·ä½“å¯å‚è€ƒã€€(https://help.github.com/en/actions/getting-started-with-github-actions/overview)\nNodejsåº”ç”¨ç¤ºä¾‹ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é‚£ä¸ªç®€å•çš„nodejsåº”ç”¨æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Github Actionsåˆ›å»ºCI/CDçš„æµç¨‹ï¼\né¦–å…ˆï¼Œä½ çš„é¡¹ç›®ä»£ç åº“éœ€è¦æ”¾åœ¨Githubä¸Šï¼Œä¾‹å¦‚ã€€https://github/mengzyou/hellonode/ ï¼Œè®¿é—®ä½ çš„ä»£ç åº“ä¸»é¡µï¼Œç„¶åç‚¹å‡» Actions è¿›å…¥Actionsé¡µé¢ï¼\næ ¹æ®ä½ çš„ä»£ç åº“çš„è¯­è¨€ç±»å‹ï¼ŒGithubæ¨èäº†ä¸€äº›Workflowçš„æ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨Nodejsçš„æ¨¡æ¿ã€€ç›´æ¥ç‚¹å‡» Set up this workflow æ¥åº”ç”¨è¿™ä¸ªæ¨¡æ¿ï¼Œç„¶åGithubä¼šç›´æ¥æ‰“æ¥Webç¼–è¾‘å™¨æ¥ç¼–è¾‘è¿™ä¸ªæ¨¡æ¿æ–‡ä»¶\nä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ éœ€è¦çš„Actionsï¼Œå®Œæˆä¹‹åå¯ä»¥ç‚¹å‡»ã€€Start commit æŒ‰é’®æ¥æäº¤Workflowæ–‡ä»¶ï¼ŒGithubä¼šè‡ªåŠ¨ä¸ºä»£ç åº“åˆ›å»ºç›®å½•ã€€.github/workflows/ï¼Œä»¥åŠæŠŠè¯¥æ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ã€€.github/workflows/nodejs.yml .ã€€æäº¤ä¹‹åï¼ŒGithub Actionså°±ä¼šæ ¹æ®Workflowçš„å†…å®¹å¼€å§‹è¿è¡Œç›¸åº”çš„å·¥ä½œï¼\nåˆ›å»ºä¸€ä¸ªæ‰§è¡Œæµ‹è¯•CIå·¥ä½œæµ å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘æœ¬åœ°ä»£ç åº“ï¼Œæ·»åŠ ç›®å½•ã€€.github/workflows/ï½€ï¼Œä»¥åŠåˆ›å»ºç›¸åº”çš„Workflowsé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªã€€.github/workflows/nodejs.yml`ã€€name: Node.js CI on: push: branches: - master jobs: build: runs-on: ubuntu-latest container: node:12.16-alpine steps: - name: Checkout repository code uses: actions/checkout@v2 - name: Cache node modules uses: actions/cache@v1 env: cache-name: cache-node-modules with: path: ./node_modules key: ${{ runner.os }}-build-${{ env.cache-name }}-${{ hashFiles(\u0026#39;**/package-lock.json\u0026#39;) }} restore-keys: | ${{ runner.os }}-build-${{ env.cache-name }}- ${{ runner.os }}-build- ${{ runner.os }}- - name: Install Dependencies run: npm install - name: Test run: npm test env: CI: true æˆ‘ä»¬å°±å®šä¹‰äº†ä¸€ä¸ªWorkflowï¼Œå¹¶å‘½åä¸º Node.js CIï¼Œå°†åœ¨masteråˆ†æ”¯å‘ç”Ÿpushæ—¶æ‰§è¡Œï¼å¹¶ä¸”å®šä¹‰äº†ä¸€ä¸ªåä¸ºã€€build çš„å·¥ä½œï¼ˆjobï¼‰ï¼Œè¯¥å·¥ä½œå°†ä½¿ç”¨Github-Hosted Runnerï¼ˆubuntu-latestï¼ŒGithub-Hosted Runnerä¼šè™šæ‹ŸåŒ–ä¸€ä¸ªç›¸åº”çš„æ“ä½œç³»ç»Ÿç¯å¢ƒï¼‰ï¼Œæˆ‘ä»¬ä¹Ÿä¼šä½¿ç”¨å®¹å™¨æ¥æ‰§è¡Œç›¸åº”çš„æ­¥éª¤ï¼Œè¿™é‡Œä½¿ç”¨äº†Dockerå®¹å™¨é•œåƒnode:12.16-alpine.ã€€setpså®šä¹‰å°†è¦æ‰§è¡Œçš„æ²¡æœ‰ä¸ªæ­¥éª¤ï¼Œå¯ä»¥ç»™æ¯ä¸ªæ­¥éª¤å‘½åï¼Œä¹Ÿå¯ä»¥ç›´æ¥è°ƒç”¨ç›¸åº”çš„Actionsï¼Œæˆ–è€…ç›´æ¥ä½¿ç”¨ã€€ï¼run æ¥æ‰§è¡Œå‘½ä»¤ï¼ã€€ä¸Šé¢çš„æ­¥éª¤ä¸­ï¼Œæœ‰ä½¿ç”¨ã€€actions/checkout@v2 æ¥æ‹‰å»ä»£ç åº“ï¼Œä¹Ÿæœ‰ä½¿ç”¨ã€€actions/cache@v1 æ¥åˆ›å»ºä½¿ç”¨ç¼“å­˜ï¼ˆä½¿ç”¨ç¼“å­˜å¯åŠ é€Ÿå·¥ä½œæµçš„æ‰§è¡Œï¼‰ï¼Œç„¶åä½¿ç”¨ç›´æ¥è¡Œå‘½ä»¤ã€€npm install å’Œã€€npm testã€€çš„æ­¥éª¤ï¼ã€€å½“æˆ‘ä»¬ç¼–å†™å¥½ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªæäº¤ï¼Œç„¶åPushåˆ°Githubä¸Šmasteråˆ†æ”¯ï¼Œå°±ä¼šå‡ºå‘ä¸€æ¬¡å®šä¹‰çš„CIæµç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º\næˆ‘ä»¬å¯ä»¥é€šè¿‡Githubä»£ç åº“çš„Actionsé¡µé¢æŸ¥çœ‹Workflowæ‰§è¡Œçš„çŠ¶æ€å’Œç»“æœï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹æ‰§è¡Œçš„æ—¥å¿—ï¼\nåœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬çš„å·¥ä½œæµé‡Œåªæœ‰ä¸€ä¸ªJobï¼Œå°±æ˜¯æµ‹è¯•ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ›´å¤šçš„Jobæ¥åªæƒ³å…¶ä»–ä»»åŠ¡ï¼ä¾‹å¦‚æ‰“åŒ…æˆ‘ä»¬çš„åº”ç”¨ï¼Œéƒ¨ç½²æˆ‘ä»¬çš„åº”ç”¨ï¼\nä¸‹é¢æˆ‘ä»¬å°±æ·»åŠ æ›´å¤šå·¥ä½œæ¥å®Œæˆæˆ‘ä»¬çš„æ•´ä¸ªCI/CDå·¥ä½œæµï¼\næ·»åŠ ä¸€ä¸ªå·¥ä½œæ‰“åŒ…åº”ç”¨çš„Dockeré•œåƒ æˆ‘ä»¬ç¼–è¾‘ã€€.github/workflows/nodejs.yml æ–‡ä»¶ï¼Œæ·»åŠ ä»¥ä¸‹å†…å®¹ã€€package: runs-on: ubuntu-latest needs: build steps: - name: Checkout repository code uses: actions/checkout@v2 - name: Build \u0026amp; Push container image uses: mr-smithers-excellent/docker-build-push@v2 with: image: mengzyou/hellonode tag: latest registry: docker.io username: ${{ secrets.DOCKERHUB_USERNAME }} password: ${{ secrets.DOCKERHUB_TOKEN }} æˆ‘ä»¬æ·»åŠ ä¸¤ä¸€ä¸ªjob - packageï¼Œè¿™ä¸ªjobå°†è¿è¡Œåœ¨Github-Hosted Runnerï¼ˆubuntu-latestï¼‰ä¸Šï¼Œneeds è¡¨ç¤ºè¯¥jobéœ€è¦ buildã€€jobæˆåŠŸæ‰§è¡Œå®Œæˆä¹‹åæ‰æ‰§è¡Œï¼\nåŒ…æ‹¬äº†ä¸¤ä¸ªæ­¥éª¤ï¼Œæ‹‰å–ä»£ç åº“ï¼Œç„¶åæ˜¯ä½¿ç”¨ mr-smithers-excellent/docker-build-push@v2 Actionæ¥æ‰§è¡Œå®¹å™¨é•œåƒçš„æ„å»ºå’Œæ¨é€ï¼ã€€è¿™ä¸ªActionä¸­ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨åˆ°äº†Github Actionsçš„Secretsï¼ŒSecretså¯ä»¥é…ç½®ä¸€äº›æ•æ„Ÿçš„å˜é‡ï¼Œåˆ°Githubä»£ç åº“è®¾ç½®çš„Secretsè¿›è¡Œé…ç½®\nè¿™é‡Œæˆ‘ä»¬é…ç½®äº†æ¨é€Dockeré•œåƒåˆ°Dokcer Hubéœ€è¦çš„ç”¨æˆ·åå’Œè®¿é—®å‡­è¯. å¯¹äºDocker Hubï¼Œæ¨èä½¿ç”¨Docker Hub Access Tokenä½œä¸ºè®¿é—®å¯†ç ï¼\næˆ‘ä»¬å°†Workflowæäº¤åˆ°masteråˆ†æ”¯åï¼Œåœ¨åœ°ä¸€ä¸ªbuildå·¥ä½œä¹‹åï¼Œå°±å‘è§¦å‘è¿™ä¸ªjobï¼Œæ‰“åŒ…é•œåƒå¹¶æ¨é€åˆ°Docker Hub.ã€€æ·»åŠ ä¸€ä¸ªå·¥ä½œæ¥è‡ªåŠ¨éƒ¨ç½² æ¥ä¸‹æ¥ï¼Œä¸ºäº†å®Œæˆæ•´ä¸ªCI/CDçš„æ¼”ç¤ºï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€ä¸ªjobï¼Œåä¸ºã€€deployï¼ã€€å¯¹äºè¿™ä¸ªjobçš„æ‰§è¡Œï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªSelf-Hostedçš„Runnerï¼\nè®¿é—®ä»£ç åº“çš„Githubç•Œé¢ï¼Œç‚¹å‡»Settingsï¼Œç„¶åç‚¹å‡»å·¦ä¾§è¾¹æ çš„Actionsï¼Œå†ç‚¹å‡»`Add runnerï½€æŒ‰é’®\næŒ‰ç…§å¼¹å‡ºæ¥çš„æŒ‡å¯¼ï¼Œåœ¨éœ€è¦éƒ¨ç½²åº”ç”¨çš„æœåŠ¡å™¨ä¸Šå®‰è£… action-runnerï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯åœ¨ä¸€ä¸ªLinuxä¸Šå®‰è£…ï¼ŒæˆåŠŸå¯åŠ¨runneråº”ç”¨ä¹‹åï¼Œä¼šè¿æ¥GithubæœåŠ¡ï¼Œåœ¨Gihubçš„Self-hosted runnersä¸‹èƒ½çœ‹åˆ°æ·»åŠ çš„runnerçš„çŠ¶æ€ï¼Œè¿™æ ·æ·»åŠ çš„ä¸€ä¸ªSelf-hosted runnerä¼šå…·æœ‰æ ‡ç­¾[\u0026lsquo;self-hosted\u0026rsquo;,\u0026rsquo;linux\u0026rsquo;,\u0026lsquo;x86\u0026rsquo;]ï¼Œè¿™äº›æ ‡ç­¾å°†ä¼šç”¨äºjobé€‰æ‹©åˆé€‚runneræ¥æ‰§è¡Œï¼\næ·»åŠ äº†Self-hostedã€€Runnerä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Workflowé‡Œæ·»åŠ ç›¸åº”çš„jobäº†ã€€deploy: runs-on: [self-hosted,linux] needs: package env: CONTAINER_IMAGE: mengzyou/hellonode CONTAINER_NAME: webapps_hellonode steps: - name: Docker pull image run: docker image pull $CONTAINER_IMAGE - name: Docker stop container run: docker container stop $CONTAINER_NAME - name: Docker remove container if: always() run: docker container rm -f $CONTAINER_NAME - name: Docker run container if: always() run: docker container run --name $CONTAINER_NAME -d -p 8000:3000 $CONTAINER_IMAGE - name: Prune images if: always() run: docker image prune -f # remove the dangling images è¿™é‡Œï¼Œæˆ‘ä»¬å°† runs-onã€€è®¾ç½®ä¸ºã€€[self-hosted,linux]ã€€æ¥é€‰æ‹©è¿è¡Œçš„RunneræœåŠ¡å™¨ï¼Œç„¶åè¯¥jobéœ€è¦ã€€package job æˆåŠŸå®Œæˆä¹‹åæ‰ä¼šæ‰§è¡Œï¼ã€€æˆ‘ä»¬è¿˜é…ç½®äº†ä¸¤ä¸ªJobï¼ˆï¼job.envï¼‰èŒƒå›´å†…çš„å˜é‡æ¥ä½¿ç”¨æˆ‘ä»¬çš„å®¹å™¨é•œåƒå’Œåå­—ï¼ç„¶ååŒ…å«äº†ä»¥ä¸‹æ‰§è¡Œæ­¥éª¤ï¼šã€€ä»Docker Hubæ‹‰å–ä¸Šä¸€ä¸ªJobæ„å»ºå‡ºæ¥çš„å®¹å™¨é•œåƒ åœæ­¢è¿è¡Œçš„å®¹å™¨ åˆ é™¤ä¹‹å‰çš„åº”ç”¨å®¹å™¨ ä½¿ç”¨æ–°çš„é•œåƒè¿è¡Œä¸€ä¸ªæ–°çš„åº”ç”¨å®¹å™¨ æ¸…ç†æ—§çš„å®¹å™¨é•œåƒ æäº¤ä»£ç ï¼ŒPushåˆ°masteråˆ†æ”¯ï¼Œè¿™æ ·ä¸€ä¸ªåŒ…å«ï¼“ä¸ªJobsçš„Workflowå°±ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œå¦‚æœåœ¨ä»»ä½•ä¸€ä¸ªJobä¸­åªæƒ³é”™è¯¯ï¼Œéƒ½ä¼šåœæ­¢åç»­çš„Jobsï¼Œå¹¶ä¸”ç»™å‡ºåé¦ˆï¼\næ€»ç»“ ä¸Šé¢é€šè¿‡ä¸ºä¸€ä¸ªç®€å•çš„nodejsåº”ç”¨æ·»åŠ äº†Github Actionsæ¥å®Œæˆäº†ä¸€ä¸ªæ„å»ºï¼Œæ‰“åŒ…ï¼Œéƒ¨ç½²çš„CI/CDæµç¨‹ï¼é€šè¿‡ä½¿ç”¨Github Actionsï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ä¸ºæˆ‘ä»¬æ”¾åœ¨Githubä¸Šçš„é¡¹åˆ›å»ºCI/CDæµç¨‹ï¼Œç®¡ç†è½¯ä»¶å¼€å‘çš„ç”Ÿå‘½å‘¨æœŸï¼ˆSDLCï¼‰ï¼ã€€Gihhub Actionsç±»ä¼¼äºGitlabçš„Gitlab-CIï¼Œä»¥åŠï¼»Jinkensï¼½(https://jenkins.io/zh/)ï¼Œè¿˜æœ‰å¾ˆå¤šç¬¬ä¸‰æ–¹çš„CI/CDæœåŠ¡ï¼\nGithub Actionsæ˜¯GithubåŸç”Ÿæ”¯æŒçš„ï¼Œå› æ­¤å¯¹äºä»£ç åº“ç®¡ç†åœ¨Githubä¸Šçš„ç»„ç»‡å’Œç”¨æˆ·ï¼Œæ›´å®¹æ˜“ä½¿ç”¨ï¼\nå‚è€ƒ\nhttps://help.github.com/en/actions ","date":"March 5, 2020","hero":"/zh/posts/devops/github-actions/github-actions.png","permalink":"/zh/posts/devops/github-actions/","summary":"è¿™ç¯‡æ–‡ç« ä»¥ä¸€ä¸ªç®€å•çš„Nodejsåº”ç”¨ä¸ºä¾‹ï¼Œç¤ºä¾‹å¦‚ä½•ä½¿ç”¨Github Actionsæ¥è‡ªåŠ¨æ„å»ºï¼Œæµ‹è¯•å’Œéƒ¨ç½²ä¸€ä¸ªåº”ç”¨ï¼\nä»€ä¹ˆæ˜¯Github Actions é¦–å…ˆç®€å•ä»‹ç»ä¸‹ä»€ä¹ˆæ˜¯Github Actionsï¼Ÿã€€Github Actionsæ˜¯Githubå®˜æ–¹æä¾›çš„ä¸€ä¸ªä¸Githubé›†æˆåœ¨ä¸€èµ·çš„CI/CDå·¥å…·ï¼Œä½¿ç”¨Github Actionså¯ä»¥éå¸¸å®¹æ˜“åœ°è‡ªåŠ¨åŒ–ä½ çš„æ‰€æœ‰è½¯ä»¶å·¥ä½œæµç¨‹ï¼ŒåŒ…æ‹¬æŒç»­é›†æˆï¼ˆCIï¼‰å’ŒæŒç»­å‘å¸ƒï¼ˆCDï¼‰ï¼\nä¸è¿‡è¦ä½¿ç”¨Github Actionsï¼Œä½ éœ€è¦å°†ä½ çš„é¡¹ç›®ä»£ç åº“æ”¾åœ¨Githubä¸Šï¼Œç„¶åä¸ºä»£ç åº“é…ç½®ç›¸åº”çš„å·¥ä½œæµï¼ˆWorkflowsï¼‰ï¼ã€€Actions Runner ä½¿ç”¨Github Actionsæ¥æ‰§è¡Œå·¥ä½œæµä»»åŠ¡ï¼Œè¿˜éœ€è¦ä¸€ä¸ªå¯æ‰§è¡Œçš„ç¯å¢ƒï¼ŒActions Runnerå°±æ˜¯æä¾›è¿™æ ·çš„ç¯å¢ƒï¼ŒGithub Actionsæ”¯æŒä¸¤ç§ç±»å‹çš„Runner:\nGithub-Hosted Runner : ç”±Githubå®˜æ–¹æä¾›å’Œç»´æŠ¤çš„RunneræœåŠ¡å™¨ï¼Œä¸éœ€è¦ç”¨æˆ·è‡ªå·±ç»´æŠ¤å’Œæ›´æ–°ï¼Œæœ‰æ”¯æŒLinnuxï¼ŒWindowsï¼ŒmacOSç¯å¢ƒçš„æ„å»º Self-Hosted Runner : ç”¨æˆ·è‡ªå·±ä½¿ç”¨æœ¬åœ°æœºå™¨ï¼Œäº‘æœåŠ¡å™¨å®‰è£…Actionsåº”ç”¨ï¼Œç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ç¡¬ä»¶ï¼Œè½¯ä»¶ç­‰éœ€æ±‚ Actions åœ¨Github Actionsä¸­æœ‰ä¸€ä¸ªActionçš„æ¦‚å¿µï¼ŒActionsæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„ä»»åŠ¡ï¼Œä½ å¯ä»¥ç»„åˆè¿™äº›ä»»åŠ¡æˆä¸ºè¦å®Œæˆä¸€ä¸ªå·¥ä½œçš„æ­¥éª¤.ã€€åœ¨å·¥ä½œæ­¥éª¤ä¸­ï¼Œä½ å¯ä»¥è‡ªå·±å†™æ‰§è¡Œå‘½ä»¤ç»„æˆActionï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨Githubç¤¾åŒºæä¾›çš„é’ˆå¯¹ä¸€ä¸ªå†™å…¬å…±ä»»åŠ¡çš„Actionsï¼Œå¯ä»¥åˆ°Githubå¸‚åœºæŸ¥æ‰¾ç¤¾åŒºæˆ–è€…å…¶ä»–å¼€å‘äººå‘˜ç¼–å†™çš„Actionsï¼ã€€ä¾‹å¦‚ä¸€ä¸ªæœ€å¸¸ç”¨çš„Action - checkoutï¼Œå¯ç”¨æ¥æ£€å‡ºä»£ç åº“ï¼š\n- uses: actions/checkout@v2 é™¤äº†ä»¥ä¸Šæ¦‚å¿µä¹‹å¤–ï¼ŒGithub Actionsè¿˜æœ‰å…¶ä»–æ¦‚å¿µéœ€è¦äº†è§£ï¼Œå…·ä½“å¯å‚è€ƒã€€(https://help.github.com/en/actions/getting-started-with-github-actions/overview)\nNodejsåº”ç”¨ç¤ºä¾‹ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±é‚£ä¸ªç®€å•çš„nodejsåº”ç”¨æ¥çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Github Actionsåˆ›å»ºCI/CDçš„æµç¨‹ï¼\né¦–å…ˆï¼Œä½ çš„é¡¹ç›®ä»£ç åº“éœ€è¦æ”¾åœ¨Githubä¸Šï¼Œä¾‹å¦‚ã€€https://github/mengzyou/hellonode/ ï¼Œè®¿é—®ä½ çš„ä»£ç åº“ä¸»é¡µï¼Œç„¶åç‚¹å‡» Actions è¿›å…¥Actionsé¡µé¢ï¼\næ ¹æ®ä½ çš„ä»£ç åº“çš„è¯­è¨€ç±»å‹ï¼ŒGithubæ¨èäº†ä¸€äº›Workflowçš„æ¨¡æ¿ï¼Œè¿™é‡Œæˆ‘ä»¬å°†ä½¿ç”¨Nodejsçš„æ¨¡æ¿ã€€ç›´æ¥ç‚¹å‡» Set up this workflow æ¥åº”ç”¨è¿™ä¸ªæ¨¡æ¿ï¼Œç„¶åGithubä¼šç›´æ¥æ‰“æ¥Webç¼–è¾‘å™¨æ¥ç¼–è¾‘è¿™ä¸ªæ¨¡æ¿æ–‡ä»¶\nä½ å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥ä¿®æ”¹ï¼Œæ·»åŠ éœ€è¦çš„Actionsï¼Œå®Œæˆä¹‹åå¯ä»¥ç‚¹å‡»ã€€Start commit æŒ‰é’®æ¥æäº¤Workflowæ–‡ä»¶ï¼ŒGithubä¼šè‡ªåŠ¨ä¸ºä»£ç åº“åˆ›å»ºç›®å½•ã€€.github/workflows/ï¼Œä»¥åŠæŠŠè¯¥æ–‡ä»¶æ”¾åœ¨è¯¥ç›®å½•ä¸‹ï¼Œä¾‹å¦‚ã€€.github/workflows/nodejs.yml .ã€€æäº¤ä¹‹åï¼ŒGithub Actionså°±ä¼šæ ¹æ®Workflowçš„å†…å®¹å¼€å§‹è¿è¡Œç›¸åº”çš„å·¥ä½œï¼\nåˆ›å»ºä¸€ä¸ªæ‰§è¡Œæµ‹è¯•CIå·¥ä½œæµ å…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥ç¼–è¾‘æœ¬åœ°ä»£ç åº“ï¼Œæ·»åŠ ç›®å½•ã€€.github/workflows/ï½€ï¼Œä»¥åŠåˆ›å»ºç›¸åº”çš„Workflowsé…ç½®æ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªã€€.github/workflows/nodejs.yml`ã€€name: Node.js CI on: push: branches: - master jobs: build: runs-on: ubuntu-latest container: node:12.","tags":["github","cicd"],"title":"GITHUB ACTIONSå·¥ä½œæµ"},{"categories":["Container"],"contents":"ä»Šå¤©å€ŸåŠ©Githubç”¨æˆ·huançš„ç›’è£…å¾®ä¿¡é¡¹ç›®ï¼Œåœ¨æˆ‘çš„openSUSE Leapç³»ç»Ÿä¸Šä½¿ç”¨DockeræˆåŠŸåœ°è¿è¡Œå°è£…çš„Windowsä¸Šçš„å¾®ä¿¡å®¢æˆ·ç«¯ã€‚\nå®‰è£…Docker åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Dockerå¼•æ“æ˜¯å¾ˆå®¹å™¨çš„ï¼Œè¯·å‚è€ƒDockerå…¥é—¨ï¼Œå¦‚æœä½ ä¹Ÿä½¿ç”¨çš„æ˜¯openSUSE Leapï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…Dockerå¼•æ“:\n$ sudo zypper ref $ sudo zypper in docker å¯åŠ¨å¾®ä¿¡å®¢æˆ·ç«¯ æ³¨æ„ï¼š åœ¨å¯åŠ¨ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®ä¸»æœºç³»ç»Ÿçš„XæœåŠ¡çš„è®¿é—®æ§åˆ¶ï¼Œä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ç¦ç”¨ä¸»æœºä¸ŠXæœåŠ¡çš„è®¿é—®æ§åˆ¶ï¼Œå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯é“¾æ¥æœåŠ¡ï¼š\n$ xhost + å…³äº[xhost]çš„æ›´å¤šä¿¡æ¯ï¼Œå¯å‚è€ƒ(https://www.computerhope.com/unix/xhost.htm)ã€‚\nhuan/docker-wechatæä¾›äº†ä¸€ä¸ªå¯åŠ¨è„šæœ¬dochat.shæ¥æ‰§è¡Œå®¹å™¨é•œåƒçš„ä¸‹è½½ï¼Œä»¥åŠå¯åŠ¨ï¼Œå¯ç›´æ¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\n$ curl -sL https://raw.githubusercontent.com/huan/docker-wechat/master/dochat.sh | bash å½“ç„¶ä¹Ÿå¯ä»¥å…‹éš†Gitä»£ç åº“ï¼Œç„¶åæ‰§è¡Œdochat.shè„šæœ¬ã€‚\næˆåŠŸå¯åŠ¨åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½¿ç”¨æ‰‹æœºæ‰«æç™»å½•ã€‚\nä½¿ç”¨Docker Composeå¯åŠ¨ dochat.shæ˜¯ç›´æ¥ä½¿ç”¨äº†docker runå‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä¸€ä¸ªcomposeæ–‡ä»¶æ¥ä½¿ç”¨docker-composeç®¡ç†åº”ç”¨å®¹å™¨ã€‚ä¾‹å¦‚æˆ‘åœ¨ç›®å½• ~/dockerapp/ ä¸‹åˆ›å»ºäº†ä¸€ä¸ª dochat.yml æ–‡ä»¶ã€‚\nversion: \u0026#39;2.4\u0026#39; services: dochat: image: zixia/wechat container_name: dockerapps_dochat network_mode: bridge devices: - \u0026#34;/dev/video0:/dev/video0\u0026#34; - \u0026#34;/dev/snd:/dev/snd\u0026#34; volumes: - \u0026#34;/etc/localtime:/etc/localtime:ro\u0026#34; - \u0026#34;$HOME/.dochat/appdata:/home/user/.wine/drive_c/user/Application Data/\u0026#34; - \u0026#34;$HOME/.dochat/wechatfiles:/home/user/WeChat Files/\u0026#34; - \u0026#34;/tmp/.X11-unix:/tmp/.X11-unix\u0026#34; environment: - \u0026#34;DISPLAY=unix$DISPLAY\u0026#34; - \u0026#34;XMODIFIERS=@im=fcitx\u0026#34; - \u0026#34;GTK_IM_MODULE=fcitx\u0026#34; - \u0026#34;QT_IM_MODULE=fcitx\u0026#34; - \u0026#34;AUDIO_GID=492\u0026#34; - \u0026#34;VIDEO_GID=484\u0026#34; - \u0026#34;GID=100\u0026#34; - \u0026#34;UID=1000\u0026#34; - \u0026#34;DOCHAT_DEBUG=true\u0026#34; ipc: host privileged: true é¦–æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨å‘½ä»¤docker-compose -f ~/dockerapp/dochat.yml up -dï¼Œåœ¨å…³é—­åº”ç”¨ä¹‹åï¼Œå†æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨docker-compose -f ~/dockerapp/dochat.yml startã€‚\nä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªæ¡Œé¢å¿«æ·æ–¹å¼ï¼Œç¼–å†™ä¸€ä¸ªDesktopæ–‡ä»¶æ”¾åœ¨æ¡Œé¢æ–‡ä»¶å¤¹ä¸‹ ~/desktop/dochat.desktop :\n[Desktop Entry] Categories=Network;Utility;Chat; Comment[en_US]=Docker run windows wechat client on Linux. Comment=Docker run windows wechat client on Linux. Exec=/usr/local/bin/docker-compose -f /home/mengz/dockerapp/dochat.yml start GenericName[en_US]= GenericName= Icon=/home/mengz/dockerapp/dochat.png MimeType= Name=Docker WeChat Path= StartupNotify=true Terminal=false TerminalOptions= Type=Application X-DBUS-ServiceName= X-DBUS-StartupType= X-KDE-SubstituteUID=false X-KDE-Username= è¿™æ ·åœ¨æ¡Œé¢åŒå‡»å¿«æ·æ–¹å¼å°±å¯ä»¥å¯åŠ¨å¾®ä¿¡äº†ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ£’ï¼\nè¡¥å…… å¦‚æœä¸æƒ³ä½¿ç”¨Dockeræ¥è¿è¡Œå°è£…çš„Windowsç‰ˆæœ¬çš„å¾®ä¿¡æ¡Œé¢å®¢æˆ·ç«¯ï¼Œè¿™é‡Œä¹Ÿå¯ä»¥æ¨èä½ ä½¿ç”¨ä¸€ä¸ªç”¨Electronicå°è£…çš„Webç‰ˆæœ¬å¾®ä¿¡å®¢æˆ·ç«¯geeeeeeeeek/electronic-wechatã€‚\n","date":"February 25, 2020","hero":"/zh/posts/container-tech/docker-wechat/docker-wechat.png","permalink":"/zh/posts/container-tech/docker-wechat/","summary":"ä»Šå¤©å€ŸåŠ©Githubç”¨æˆ·huançš„ç›’è£…å¾®ä¿¡é¡¹ç›®ï¼Œåœ¨æˆ‘çš„openSUSE Leapç³»ç»Ÿä¸Šä½¿ç”¨DockeræˆåŠŸåœ°è¿è¡Œå°è£…çš„Windowsä¸Šçš„å¾®ä¿¡å®¢æˆ·ç«¯ã€‚\nå®‰è£…Docker åœ¨Linuxç³»ç»Ÿä¸Šå®‰è£…Dockerå¼•æ“æ˜¯å¾ˆå®¹å™¨çš„ï¼Œè¯·å‚è€ƒDockerå…¥é—¨ï¼Œå¦‚æœä½ ä¹Ÿä½¿ç”¨çš„æ˜¯openSUSE Leapï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤å®‰è£…Dockerå¼•æ“:\n$ sudo zypper ref $ sudo zypper in docker å¯åŠ¨å¾®ä¿¡å®¢æˆ·ç«¯ æ³¨æ„ï¼š åœ¨å¯åŠ¨ä¹‹å‰ï¼Œéœ€è¦è®¾ç½®ä¸»æœºç³»ç»Ÿçš„XæœåŠ¡çš„è®¿é—®æ§åˆ¶ï¼Œä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤ç¦ç”¨ä¸»æœºä¸ŠXæœåŠ¡çš„è®¿é—®æ§åˆ¶ï¼Œå…è®¸æ‰€æœ‰å®¢æˆ·ç«¯é“¾æ¥æœåŠ¡ï¼š\n$ xhost + å…³äº[xhost]çš„æ›´å¤šä¿¡æ¯ï¼Œå¯å‚è€ƒ(https://www.computerhope.com/unix/xhost.htm)ã€‚\nhuan/docker-wechatæä¾›äº†ä¸€ä¸ªå¯åŠ¨è„šæœ¬dochat.shæ¥æ‰§è¡Œå®¹å™¨é•œåƒçš„ä¸‹è½½ï¼Œä»¥åŠå¯åŠ¨ï¼Œå¯ç›´æ¥æ‰§è¡Œå¦‚ä¸‹æ“ä½œï¼š\n$ curl -sL https://raw.githubusercontent.com/huan/docker-wechat/master/dochat.sh | bash å½“ç„¶ä¹Ÿå¯ä»¥å…‹éš†Gitä»£ç åº“ï¼Œç„¶åæ‰§è¡Œdochat.shè„šæœ¬ã€‚\næˆåŠŸå¯åŠ¨åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œä½¿ç”¨æ‰‹æœºæ‰«æç™»å½•ã€‚\nä½¿ç”¨Docker Composeå¯åŠ¨ dochat.shæ˜¯ç›´æ¥ä½¿ç”¨äº†docker runå‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œä¹Ÿå¯ä»¥ç¼–å†™ä¸€ä¸ªcomposeæ–‡ä»¶æ¥ä½¿ç”¨docker-composeç®¡ç†åº”ç”¨å®¹å™¨ã€‚ä¾‹å¦‚æˆ‘åœ¨ç›®å½• ~/dockerapp/ ä¸‹åˆ›å»ºäº†ä¸€ä¸ª dochat.yml æ–‡ä»¶ã€‚\nversion: \u0026#39;2.4\u0026#39; services: dochat: image: zixia/wechat container_name: dockerapps_dochat network_mode: bridge devices: - \u0026#34;/dev/video0:/dev/video0\u0026#34; - \u0026#34;/dev/snd:/dev/snd\u0026#34; volumes: - \u0026#34;/etc/localtime:/etc/localtime:ro\u0026#34; - \u0026#34;$HOME/.dochat/appdata:/home/user/.wine/drive_c/user/Application Data/\u0026#34; - \u0026#34;$HOME/.dochat/wechatfiles:/home/user/WeChat Files/\u0026#34; - \u0026#34;/tmp/.X11-unix:/tmp/.X11-unix\u0026#34; environment: - \u0026#34;DISPLAY=unix$DISPLAY\u0026#34; - \u0026#34;XMODIFIERS=@im=fcitx\u0026#34; - \u0026#34;GTK_IM_MODULE=fcitx\u0026#34; - \u0026#34;QT_IM_MODULE=fcitx\u0026#34; - \u0026#34;AUDIO_GID=492\u0026#34; - \u0026#34;VIDEO_GID=484\u0026#34; - \u0026#34;GID=100\u0026#34; - \u0026#34;UID=1000\u0026#34; - \u0026#34;DOCHAT_DEBUG=true\u0026#34; ipc: host privileged: true é¦–æ¬¡å¯åŠ¨æ—¶ä½¿ç”¨å‘½ä»¤docker-compose -f ~/dockerapp/dochat.","tags":["docker","wechat","opensuse"],"title":"DOCKERè¿è¡Œå¾®ä¿¡æ¡Œé¢å®¢æˆ·ç«¯"},{"categories":["Container"],"contents":"è¿™æ˜¯Dockerå¿«é€Ÿå¼€å§‹ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œåœ¨å¯¹æˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œå®¹å™¨åŒ–ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ç¬¬ä¸€ç¯‡å®‰è£…å¥½Dockerç¯å¢ƒã€‚\nä»‹ç» æˆ‘ä»¬åœ¨å¼€å‘ä¸»æœºï¼ˆå¼€å‘ç¯å¢ƒï¼‰ä¸Šå®‰è£…å¥½Dockerä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å‘å¼€å®¹å™¨åŒ–åº”ç”¨ï¼Œé€šå¸¸æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š\nä¸ºåº”ç”¨çš„æ¯ä¸ªç»„ä»¶åˆ›å»ºDockeré•œåƒï¼Œç„¶åé€šè¿‡é•œåƒè¿è¡Œå®¹å™¨å¹¶æµ‹è¯•ï¼ ç¼–å†™ docker stack æ–‡ä»¶æˆ–è€…Kubernetesçš„ YMALã€€æ–‡ä»¶ï¼Œå°†å®¹å™¨å’Œæ”¯æŒçš„åŸºç¡€è®¾æ–½é›†è£…åˆ°ä¸€ä¸ªå®Œæ•´åº”ç”¨ç¨‹åº. æµ‹è¯•ï¼Œåˆ†äº«å’Œéƒ¨ç½²ä½ çš„æ•´ä¸ªå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼ åœ¨è¿™ä¸ªå¿«é€Ÿçš„æ•™ç¨‹é‡Œï¼Œæˆ‘ä»¬å°†ä¸“æ³¨åœ¨ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼šåˆ›å»ºå®¹å™¨å°†åŸºäºçš„é•œåƒï¼\nå‡†å¤‡Dockerfile æˆ‘ä»¬å°†ä½¿ç”¨Dockerçš„ä¸€ä¸ªåŸ¹è®­é¡¹ç›®ç¤ºä¾‹docker-training/node-bulletin-boardï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤\nä»Githubå…‹éš†ç¤ºä¾‹ä»£ç ï¼ˆé¦–å…ˆä½ éœ€è¦åœ¨ç¯å¢ƒä¸­å®‰è£…å¥½Gitï¼‰ $ git clone -b v1 https://github.com/docker-training/node-bulletin-board $ cd node-bulletin-board/bulletin-board-app/ è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å…¬å‘Šæ¿åº”ç”¨ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨node.jsç¼–å†™ï¼ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å®¹å™¨åŒ–è¯¥åº”ç”¨ï¼\nåœ¨ä»£ç ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†å¦‚ä½•ä¸ºä¸€ä¸ªå®¹å™¨å°è£…ä¸€ä¸ªç§æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠåŒ…å«ä¸€äº›æè¿°å¦‚ä½•è¿è¡Œå®¹å™¨çš„å…ƒæ•°æ®ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ FROM node:8.9.4-alpine WORKDIR /usr/src/app COPY package.json . RUN npm install COPY . . CMD [ \u0026#34;npm\u0026#34;, \u0026#34;start\u0026#34; ] ä¸ºåº”ç”¨ç¼–å†™Dockerfileæ˜¯å®¹å™¨åŒ–åº”ç”¨çš„ç¬¬ä¸€æ­¥ï¼Œä½ å¯ä»¥è®¤ä¸ºDockerfileé‡Œçš„å‘½ä»¤æ˜¯æ„å»ºé•œåƒçš„ä¸€æ­¥æ­¥æŒ‡ä»¤\né¦–å…ˆä»ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŸºç¡€é•œåƒå¼€å§‹ï¼ŒFROM node:8.9.4-alpineï¼Œè¯¥åŸºç¡€é•œåƒæ˜¯ä¸€ä¸ªå®˜æ–¹çš„é•œåƒï¼Œåœ¨å¼€å§‹æ„å»ºæ—¶ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰è¯¥é•œåƒï¼Œå°†ä¼šDocker Hubè‡ªåŠ¨æ‹‰å–è¯¥é•œåƒï¼ ç„¶åé€šè¿‡WORKDIRæŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ï¼Œä¹‹åçš„æ“ä½œéƒ½å°†åŸºäºè¯¥å·¥ä½œç›®å½•ï¼ é€šè¿‡COPYæŒ‡ä»¤ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„package.jsonæ–‡ä»¶æ‹·è´åˆ°å®¹å™¨çš„å½“å‰ç›®å½•ä¸‹ï¼ˆ/usr/src/app/ï¼‰ï¼Œä¹Ÿå°±æ˜¯/usr/src/app/package.jsonï¼ã€€RUNæŒ‡ä»¤æ˜¯æ‰§è¡Œç›¸å…³çš„å‘½ä»¤ï¼Œç¤ºä¾‹ä¸­åœ¨/usr/src/app/ç›®å½•ä¸‹æ‰§è¡Œnpm installå‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†æ ¹æ®package.jsonæ–‡ä»¶å®‰è£…åº”ç”¨ç›¸å…³çš„ä¾èµ–åŒ…ï¼ æ¥ç€å°†å‰©ä½™çš„ä»£ç ä»ä¸»æœºæ‹·è´åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ æœ€åçš„CMDå‘½ä»¤é…ç½®äº†é•œåƒçš„å…ƒæ•°æ®ï¼Œæè¿°ä½¿ç”¨è¯¥é•œåƒè¿è¡Œå®¹å™¨æ—¶ï¼Œå¦‚ä½•å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œå¯åŠ¨å®¹å™¨æ—¶å°†è¿è¡Œnpm start. ä»¥ä¸Šåªæ˜¯ä¸€ä¸ªç®€å•çš„Dockerfileç¤ºä¾‹ï¼Œæ›´å¤šçš„æŒ‡ä»¤è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£.\næ„å»ºå’Œæµ‹è¯•é•œåƒ ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†æºä»£ç å’ŒDockerfileï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ„å»ºåº”ç”¨çš„é•œåƒäº†ï¼\né¦–å…ˆç¡®ä¿å½“å‰ç›®å½•æ˜¯ node-bulletin-board/bulletin-board-app/ã€€ï¼Œé€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤æ„å»ºé•œåƒ $ docker image build -t bulletinboard:1.0 . ä½ å°†çœ‹åˆ°DockeræŒ‰ç…§Dockerfileé‡Œçš„æŒ‡ä»¤è¿›è¡Œæ„å»ºï¼Œå½“æ„å»ºæˆåŠŸåï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åˆ°æ„å»ºå‡ºæ¥çš„é•œåƒ\n$ docker image ls bulletinboard 1.0 866d1f004027 About a minutes ago 82.3MB æˆ‘ä»¬é€šè¿‡-té€‰é¡¹æŒ‡æ˜äº†é•œåƒçš„åå­—å’Œæ ‡ç­¾ï¼Œå‘½ä»¤çš„æœ€æœ‰ä¸€ä¸ª.æ„æ€æ˜¯æ„å»ºçš„ä¸Šä¸‹æ–‡æ˜¯å½“å‰ç›®å½•ï¼Œå°†åœ¨å½“å‰ç›®å½•é‡Œå¯»æ‰¾Dockerfileï¼\nåŸºäºé•œåƒå¯åŠ¨ä¸€ä¸ªå®¹å™¨ docker container run --name bb --publish 8000:8080 --detach bulletinboard:1.0 è¯¥å‘½ä»¤å°†åŸºäºé•œåƒbulletinboard:1.0å¯åŠ¨ä¸€ä¸ªå®¹å™¨å®ä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨å¦‚ä¸‹çš„ä¸€äº›å‘½ä»¤é€‰é¡¹\n\u0026ndash;name : å°†å®¹å™¨å‘½åä¸ºbbï¼Œå¦‚æœä¸æŒ‡å®šï¼ŒDockerå°†è‡ªåŠ¨ä¸ºå®¹å™¨å‘½å. \u0026ndash;publish : å°†å®¹å™¨çš„é‡Œçš„ç«¯å£8080æ˜ å°„åˆ°ä¸»æœºä¸Šçš„8000æ¬¾å£ï¼Œä¹Ÿå°±æ˜¯å‘å¾€ä¸»æœº8000æ¬¾å£çš„æµé‡å°†ä¼šè½¬å‘åˆ°å®¹å™¨çš„8080ç«¯å£ï¼ \u0026ndash;detach : Dockerå°†å®¹å™¨è¿è¡Œåœ¨åå°ï¼ ç”±äºæ„å»ºé•œåƒçš„æ—¶å€™é€šè¿‡CMDæŒ‡å®šäº†å®¹å™¨å¯åŠ¨çš„å‘½ä»¤npm startï¼Œå› æ­¤å®¹å™¨åœ¨å¯åŠ¨æ—¶å€™å°†è‡ªåŠ¨é€šè¿‡è¯¥å‘½ä»¤æ¥å¯åŠ¨åº”ç”¨è¿›ç¨‹ï¼\nè®¿é—®åº”ç”¨ ç”±äºå®¹å™¨å¯åŠ¨æ—¶ï¼Œåˆ¶å®šäº†å°†æœåŠ¡ç«¯å£æ˜ å°„åˆ°äº†ä¸»æœºçš„8000ç«¯å£ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—® http://localhost:8000/ è®¿é—®åº”ç”¨ï¼\nå½“éªŒè¯åº”ç”¨è¿è¡Œæ­£å¸¸ï¼Œå¯å°†å®¹å™¨åœ¨ä¸»æœºç¯å¢ƒä¸­åˆ é™¤æ‰ $ docker container rm --force bb æ€»ç»“ æœ¬æ–‡é€šè¿‡ä¸€ä¸ªç®€å•çš„node.jsåº”ç”¨ï¼Œç¤ºä¾‹äº†å¦‚ä½•é€šè¿‡Dockerfileæ¥å®¹å™¨åŒ–åº”ç”¨ç¨‹åºï¼Œä¹Ÿå°±æ˜¯å°†åº”ç”¨çš„ä¾èµ–ï¼Œå¯åªæƒ³ä»£ç å°è£…åˆ°å®¹å™¨é•œåƒï¼Œå†é€šè¿‡é•œåƒåœ¨å¼€å‘ç¯å¢ƒä¸Šè¿è¡Œåº”ç”¨å®¹å™¨ï¼ã€€è¿™æ˜¯å®¹å™¨è¯åº”ç”¨çš„åœ°ä¸€ä¸ªé˜¶æ®µï¼Œåœ¨æ„æ¶äº†åº”ç”¨çš„å®¹å™¨ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å°†é•œåƒåˆ†å‘åˆ°å…¶ä»–è¿è¡Œç¯å¢ƒï¼ˆæµ‹è¯•ç¯å¢ƒï¼Œç”Ÿäº§ç¯å¢ƒï¼‰è¿›è¡Œåº”ç”¨çš„éƒ¨ç½²äº†ï¼å½“ç„¶å¯¹äºå¤æ‚çš„åº”ç”¨ï¼Œå¯èƒ½ç”±å¾ˆå¤šçš„æœåŠ¡ç»„ä»¶æ„æˆï¼Œé‚£æ¯ä¸€å„æœåŠ¡éƒ½å°†ä¼šè¢«æ„å»ºæˆç›¸åº”çš„é•œåƒï¼Œéƒ¨ç½²çš„æ—¶å€™å°±ä¼šè¿è¡Œå¾ˆå¤šçš„å®¹å™¨æ¥ç»„æˆæ•´ä¸ªåº”ç”¨ç¨‹åºï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å®¹å™¨çš„ç¼–æ’å·¥å…·ï¼ˆOrchestratorï¼‰æ¥è‡ªåŠ¨ç®¡ç†å’Œéƒ¨ç½²ç›¸åº”çš„å®¹å™¨æœåŠ¡ï¼\n","date":"February 13, 2020","hero":"/zh/posts/container-tech/docker-container-app/docker-banner.png","permalink":"/zh/posts/container-tech/docker-container-app/","summary":"è¿™æ˜¯Dockerå¿«é€Ÿå¼€å§‹ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œåœ¨å¯¹æˆ‘ä»¬çš„åº”ç”¨è¿›è¡Œå®¹å™¨åŒ–ä¹‹å‰ï¼Œè¯·å…ˆé˜…è¯»ç¬¬ä¸€ç¯‡å®‰è£…å¥½Dockerç¯å¢ƒã€‚\nä»‹ç» æˆ‘ä»¬åœ¨å¼€å‘ä¸»æœºï¼ˆå¼€å‘ç¯å¢ƒï¼‰ä¸Šå®‰è£…å¥½Dockerä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹å‘å¼€å®¹å™¨åŒ–åº”ç”¨ï¼Œé€šå¸¸æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š\nä¸ºåº”ç”¨çš„æ¯ä¸ªç»„ä»¶åˆ›å»ºDockeré•œåƒï¼Œç„¶åé€šè¿‡é•œåƒè¿è¡Œå®¹å™¨å¹¶æµ‹è¯•ï¼ ç¼–å†™ docker stack æ–‡ä»¶æˆ–è€…Kubernetesçš„ YMALã€€æ–‡ä»¶ï¼Œå°†å®¹å™¨å’Œæ”¯æŒçš„åŸºç¡€è®¾æ–½é›†è£…åˆ°ä¸€ä¸ªå®Œæ•´åº”ç”¨ç¨‹åº. æµ‹è¯•ï¼Œåˆ†äº«å’Œéƒ¨ç½²ä½ çš„æ•´ä¸ªå®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼ åœ¨è¿™ä¸ªå¿«é€Ÿçš„æ•™ç¨‹é‡Œï¼Œæˆ‘ä»¬å°†ä¸“æ³¨åœ¨ç¬¬ä¸€ä¸ªæ­¥éª¤ï¼šåˆ›å»ºå®¹å™¨å°†åŸºäºçš„é•œåƒï¼\nå‡†å¤‡Dockerfile æˆ‘ä»¬å°†ä½¿ç”¨Dockerçš„ä¸€ä¸ªåŸ¹è®­é¡¹ç›®ç¤ºä¾‹docker-training/node-bulletin-boardï¼ŒæŒ‰ç…§å¦‚ä¸‹æ­¥éª¤\nä»Githubå…‹éš†ç¤ºä¾‹ä»£ç ï¼ˆé¦–å…ˆä½ éœ€è¦åœ¨ç¯å¢ƒä¸­å®‰è£…å¥½Gitï¼‰ $ git clone -b v1 https://github.com/docker-training/node-bulletin-board $ cd node-bulletin-board/bulletin-board-app/ è¿™æ˜¯ä¸€ä¸ªç®€å•çš„å…¬å‘Šæ¿åº”ç”¨ç¤ºä¾‹ä»£ç ï¼Œä½¿ç”¨node.jsç¼–å†™ï¼ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦å®¹å™¨åŒ–è¯¥åº”ç”¨ï¼\nåœ¨ä»£ç ç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªDockerfileæ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶æè¿°äº†å¦‚ä½•ä¸ºä¸€ä¸ªå®¹å™¨å°è£…ä¸€ä¸ªç§æœ‰æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥åŠåŒ…å«ä¸€äº›æè¿°å¦‚ä½•è¿è¡Œå®¹å™¨çš„å…ƒæ•°æ®ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ FROM node:8.9.4-alpine WORKDIR /usr/src/app COPY package.json . RUN npm install COPY . . CMD [ \u0026#34;npm\u0026#34;, \u0026#34;start\u0026#34; ] ä¸ºåº”ç”¨ç¼–å†™Dockerfileæ˜¯å®¹å™¨åŒ–åº”ç”¨çš„ç¬¬ä¸€æ­¥ï¼Œä½ å¯ä»¥è®¤ä¸ºDockerfileé‡Œçš„å‘½ä»¤æ˜¯æ„å»ºé•œåƒçš„ä¸€æ­¥æ­¥æŒ‡ä»¤\né¦–å…ˆä»ä¸€ä¸ªå·²ç»å­˜åœ¨çš„åŸºç¡€é•œåƒå¼€å§‹ï¼ŒFROM node:8.9.4-alpineï¼Œè¯¥åŸºç¡€é•œåƒæ˜¯ä¸€ä¸ªå®˜æ–¹çš„é•œåƒï¼Œåœ¨å¼€å§‹æ„å»ºæ—¶ï¼Œå¦‚æœæœ¬åœ°æ²¡æœ‰è¯¥é•œåƒï¼Œå°†ä¼šDocker Hubè‡ªåŠ¨æ‹‰å–è¯¥é•œåƒï¼ ç„¶åé€šè¿‡WORKDIRæŒ‡ä»¤è®¾ç½®å·¥ä½œç›®å½•ï¼Œä¹‹åçš„æ“ä½œéƒ½å°†åŸºäºè¯¥å·¥ä½œç›®å½•ï¼ é€šè¿‡COPYæŒ‡ä»¤ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„package.jsonæ–‡ä»¶æ‹·è´åˆ°å®¹å™¨çš„å½“å‰ç›®å½•ä¸‹ï¼ˆ/usr/src/app/ï¼‰ï¼Œä¹Ÿå°±æ˜¯/usr/src/app/package.jsonï¼ã€€RUNæŒ‡ä»¤æ˜¯æ‰§è¡Œç›¸å…³çš„å‘½ä»¤ï¼Œç¤ºä¾‹ä¸­åœ¨/usr/src/app/ç›®å½•ä¸‹æ‰§è¡Œnpm installå‘½ä»¤ï¼Œè¯¥å‘½ä»¤å°†æ ¹æ®package.jsonæ–‡ä»¶å®‰è£…åº”ç”¨ç›¸å…³çš„ä¾èµ–åŒ…ï¼ æ¥ç€å°†å‰©ä½™çš„ä»£ç ä»ä¸»æœºæ‹·è´åˆ°é•œåƒçš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼ æœ€åçš„CMDå‘½ä»¤é…ç½®äº†é•œåƒçš„å…ƒæ•°æ®ï¼Œæè¿°ä½¿ç”¨è¯¥é•œåƒè¿è¡Œå®¹å™¨æ—¶ï¼Œå¦‚ä½•å¯åŠ¨åº”ç”¨ç¨‹åºï¼Œè¿™é‡Œå¯åŠ¨å®¹å™¨æ—¶å°†è¿è¡Œnpm start. ä»¥ä¸Šåªæ˜¯ä¸€ä¸ªç®€å•çš„Dockerfileç¤ºä¾‹ï¼Œæ›´å¤šçš„æŒ‡ä»¤è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£.\næ„å»ºå’Œæµ‹è¯•é•œåƒ ç°åœ¨æˆ‘ä»¬æ‹¥æœ‰äº†æºä»£ç å’ŒDockerfileï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹æ„å»ºåº”ç”¨çš„é•œåƒäº†ï¼\né¦–å…ˆç¡®ä¿å½“å‰ç›®å½•æ˜¯ node-bulletin-board/bulletin-board-app/ã€€ï¼Œé€šè¿‡å¦‚ä¸‹çš„å‘½ä»¤æ„å»ºé•œåƒ $ docker image build -t bulletinboard:1.0 . ä½ å°†çœ‹åˆ°DockeræŒ‰ç…§Dockerfileé‡Œçš„æŒ‡ä»¤è¿›è¡Œæ„å»ºï¼Œå½“æ„å»ºæˆåŠŸåï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹åˆ°æ„å»ºå‡ºæ¥çš„é•œåƒ\n$ docker image ls bulletinboard 1.","tags":["docker"],"title":"DOCKERæ„å»ºå®¹å™¨åŒ–åº”ç”¨"},{"categories":["Container"],"contents":"Docker Dockeræ˜¯ä¸€ä¸ªä¸ºå¼€å‘è€…å’Œè¿ç»´å·¥ç¨‹å¸ˆï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰ä»¥å®¹å™¨çš„æ–¹å¼æ„å»ºï¼Œåˆ†äº«å’Œè¿è¡Œåº”ç”¨çš„å¹³å°ã€‚ä½¿ç”¨å®¹å™¨è¿›è¡Œåº”ç”¨éƒ¨ç½²çš„æ–¹å¼ï¼Œæˆ‘ä»¬æˆä¸ºå®¹å™¨åŒ–ã€‚\nå®¹å™¨åŒ–åº”ç”¨å…·æœ‰ä¸€ä¸‹ç‰¹æ€§ï¼Œä½¿å¾—å®¹å™¨åŒ–æ—¥ç›Šæµè¡Œï¼š\nçµæ´»ï¼šã€€å†å¤æ‚çš„åº”ç”¨éƒ½å¯ä»¥è¿›è¡Œå®¹å™¨åŒ–ï¼ è½»é‡ï¼šã€€å®¹å™¨ä½¿ç”¨ä½¿ç”¨å’Œå…±äº«ä¸»æœºçš„å†…æ ¸ï¼Œåœ¨ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨æ¯”è™šæ‹Ÿæœºæ›´åŠ é«˜æ•ˆï¼ å¯ç§»æ¤ï¼šã€€å®¹å™¨å¯ä»¥æœ¬åœ°æ„å»ºï¼Œéƒ¨ç½²åˆ°äº‘ä¸Šï¼Œè¿è¡Œåœ¨ä»»ä½•åœ°æ–¹ï¼ æ¾è€¦åˆï¼šã€€å®¹å™¨æ˜¯é«˜åº¦è‡ªå°è£…çš„ï¼Œå¯ä»¥åœ¨ä¸å½±å“å…¶ä»–å®¹å™¨çš„æƒ…å†µä¸‹æ›¿æ¢å’Œå‡çº§å®¹å™¨ï¼ å¯æ‰©å±•ï¼šã€€å¯ä»¥åœ¨æ•´ä¸ªæ•°æ®ä¸­å¿ƒé‡Œå¢åŠ å’Œè‡ªåŠ¨åˆ†å‘å®¹å™¨å‰¯æœ¬ï¼ å®‰å…¨ï¼šã€€å®¹å™¨çº¦æŸå’Œéš”ç¦»åº”ç”¨è¿›ç¨‹ï¼Œè€Œæ— éœ€ç”¨æˆ·è¿›è¡Œä»»ä½•é…ç½®ï¼ é•œåƒå’Œå®¹å™¨ å…¶å®ï¼Œå®¹å™¨å°±æ˜¯è¿è¡Œçš„è¿›ç¨‹ï¼Œé™„å¸¦ä¸€äº›å°è£…çš„ç‰¹æ€§ï¼Œä½¿å…¶ä¸ä¸»æœºä¸Šå’Œå…¶ä»–å®¹å™¨çš„è¿›ç¨‹éš”ç¦»ï¼æ¯ä¸ªå®¹å™¨éƒ½åªè®¿é—®å®ƒè‡ªå·±ç§æœ‰çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯å®¹å™¨éš”ç¦»å¾ˆé‡è¦çš„ä¸€æ–¹é¢ï¼è€ŒDockeré•œåƒå°±æä¾›äº†è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ªé•œåƒåŒ…å«è¿è¡Œè¯¥åº”ç”¨æ‰€æœ‰éœ€æ±‚ - ä»£ç æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿è¡Œæ—¶ï¼Œä¾èµ–åº“ï¼Œä»¥åŠå…¶ä»–éœ€è¦çš„æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼\né€šè¿‡ä¸è™šæ‹Ÿæœºå¯¹æ¯”ï¼Œè™šæ‹Ÿæœºï¼ˆVMï¼‰é€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæœºç®¡ç†ï¼ˆHypervisorï¼‰è¿è¡Œäº†å®Œæ•´çš„æ“ä½œç³»ç»Ÿæ¥è®¿é—®ä¸»æœºèµ„æºï¼é€šå¸¸è™šæ‹Ÿæœºä¼šäº§ç”Ÿå¤§é‡çš„å¼€é”€ï¼Œè¶…è¿‡äº†åº”ç”¨æœ¬èº«æ‰€éœ€è¦çš„å¼€é”€ï¼\nå®¹å™¨ç¼–æ’ å®¹å™¨åŒ–è¿‡ç¨‹çš„å¯ç§»æ¤æ€§å’Œå¯é‡å¤æ€§æ„å‘³ç€æˆ‘ä»¬æœ‰æœºä¼šè·¨äº‘å’Œæ•°æ®ä¸­å¿ƒç§»åŠ¨å’Œæ‰©å±•å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå®¹å™¨æœ‰æ•ˆåœ°ä¿è¯åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæœ‰æ•ˆåœ°åˆ©ç”¨æ‰€æœ‰è¿™äº›ç¯å¢ƒï¼å½“æˆ‘ä»¬æ‰©å±•æˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å·¥å…·æ¥å¸®åŠ©è‡ªåŠ¨ç»´æŠ¤è¿™äº›åº”ç”¨ï¼Œåœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œå¯ä»¥è‡ªåŠ¨æ›¿æ¢å¤±è´¥çš„å®¹å™¨ï¼Œç®¡ç†æ»šåŠ¨å‡çº§ï¼Œä»¥åŠé‡æ–°é…ç½®ï¼ã€€å®¹å™¨ç¼–æ’å™¨ï¼ˆOrchestratorï¼‰å°±æ˜¯ç®¡ç†ï¼Œæ‰©å±•å’Œç»´æŠ¤å®¹å™¨åŒ–åº”ç”¨çš„å·¥å…·ï¼Œå½“å‰æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ Kubernetes å’Œ Docke Swarm ï¼Docker Desktop å·¥å…·å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒæä¾›è¿™ä¸¤ä¸ªç¼–æ’å·¥å…·ï¼å½“å‰ï¼ŒDocker Desktop ä»…æ”¯æŒåœ¨Windowså’ŒOSXç³»ç»Ÿä¸Šå®‰è£…ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨Linuxä¸Šå®‰è£…Dockerï¼Œä»¥åŠè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼\nå®‰è£…Docker å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Windowsæˆ–è€…Mac OSç³»ç»Ÿï¼Œè¯·å‚è€ƒä¸Šé¢çš„é“¾æ¥å®‰è£…å’Œä½¿ç”¨ Docker Desktopï¼Œä¸‹é¢æˆ‘ä»¬å°†å·²Ubuntu 18.04ç³»ç»Ÿä¸ºä¾‹æ¥å®‰è£…Dockerçš„ç¤¾åŒºç‰ˆæœ¬ï¼ˆdocker-ceï¼‰ï¼ã€€é…ç½®è½¯ä»¶æº æ›´æ–°aptåŒ…ç´¢å¼• $ sudo apt update å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ… $ sudo apt install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common æ·»åŠ Dockerå®˜æ–¹çš„GPGä¿¡æ¯ $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ Dockerçš„å®‰è£…æº $ sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu \\ $(lsb_release -cs) \\ stable\u0026#34; stableæ„æ€ä¸ºæ·»åŠ çš„æ˜¯ç¨³å®šç‰ˆæœ¬çš„æºï¼\nå®‰è£… æ›´æ–°è½¯ä»¶æº $ sudo apt update å®‰è£…æœ€æ–°ç‰ˆæœ¬çš„Dockerå¼•æ“å’Œcontainerd $ sudo apt install docker-ce docker-ce-cli containerd.io éªŒè¯å®‰è£… $ sudo docker run hello-world è¯¥å‘½ä»¤ä¼šä¸‹è½½ä¸€ä¸ªæµ‹è¯•é•œåƒå¹¶è¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œè¯¥å®¹å™¨ä¼šæ‰“å°ä¸€äº›ä¿¡æ¯åé€€å‡ºï¼ã€€è¡¥å……ï¼šã€€ä¸ºäº†è¿è¡Œdockerå‘½ä»¤ä¸éœ€è¦ä½¿ç”¨sudoï¼Œå¯ä»¥å°†å½“å‰ç”¨æˆ·åŠ å…¥docker\n$ sudo usermod -aG \u0026#34;docker\u0026#34; \u0026lt;username\u0026gt; åœ¨é‡æ–°ç™»å½•ç”¨æˆ·åï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨dockerå‘½ä»¤è¿›è¡Œæ“ä½œï¼\nè¿è¡Œå®¹å™¨ åœ¨ä¸Šé¢å®‰è£…dockerå¼•æ“çš„æœ€åä¸€ä¸ªéªŒè¯æ­¥éª¤ä¸­ï¼Œå…¶å®æˆ‘ä»¬å·²ç»è¿è¡Œäº†ä¸€ä¸ªå®¹å™¨ï¼Œè¿™é‡Œå†ç¤ºä¾‹å¦‚ä½•è¿è¡Œä¸€ä¸ªubuntuæ“ä½œç³»ç»Ÿçš„åŸºç¡€å®¹å™¨ï¼\nä»¥ä¸‹å‘½ä»¤å‡è®¾å·²ç»å°†å½“å‰ç”¨æˆ·æ·»åŠ åˆ°äº†dockerç»„ï¼\næ‹‰å–ï¼ˆPullï¼‰é•œåƒ $ docker image pull ubuntu:18.04 è¯¥å‘½ä»¤å°†ä»Dockerå®˜æ–¹çš„é•œåƒä»“åº“ï¼ˆDocker Hubï¼‰ä¸Šä¸‹è½½ä¸€ä¸ªå®˜æ–¹ç»´æŠ¤çš„Ubuntuçš„åŸºç¡€é•œåƒï¼Œæ ‡ç­¾ä¸º18.04ï¼ã€€è¿è¡Œå®¹å™¨ $ docker container run --rm -it ubuntu:18.04 root@451a1f6ed7c9:/# ä¸Šé¢çš„å‘½ä»¤ï¼Œå°†ç”¨ubuntu:18.04çš„é•œåƒè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼Œ--rmé€‰é¡¹æŒ‡ç¤ºåœ¨é€€å‡ºæˆ–åœæ­¢å®¹å™¨æ—¶è‡ªåŠ¨åˆ é™¤è¯¥å®¹å™¨ï¼Œ-ité€‰é¡¹è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªttyå¹¶ä¸å…¶äº¤äº’ï¼Œå› ä¸ºè¯¥å®¹å™¨é»˜è®¤è¿è¡Œçš„è¿›ç¨‹æ˜¯bashï¼Œè¿™æ ·æˆ‘ä»¬å¯ç›´æ¥åœ¨å®¹å™¨é‡Œè¿›è¡Œäº¤äº’ï¼\nåœ¨å®¹å™¨è¿è¡Œæ—¶ï¼Œå¯ä»¥æ‰“å¼€å¦ä¸€ä¸ªç»ˆç«¯ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰è¿è¡Œåœ¨è¯¥ä¸»æœºä¸Šçš„å®¹å™¨\ndocker container ls CONTAINER ID NAMES IMAGE CREATED ago STATUS PORTS COMMAND 451a1f6ed7c9 musing_diffie ubuntu:18.04 4 minutes ago ago Up 4 minutes \u0026#34;/bin/bash\u0026#34; å½“æˆ‘ä»¬åœ¨å®¹å™¨çš„åªèƒ½é«˜ç«¯é‡Œæ‰§è¡Œexitï¼Œæˆ–è€…åœ¨ä¸»æœºçš„å¦ä¸€ä¸ªç»ˆç«¯é‡Œæ‰§è¡Œdocker container stop musing_diffieï¼Œéƒ½å°†åœæ­¢å¹¶åˆ é™¤è¯¥å®¹å™¨ï¼\næ€»ç»“ è¿™é‡Œæˆ‘ä»¬ä»‹ç»äº†å®¹å™¨çš„åŸºæœ¬æ¦‚å¿µï¼Œä»¥åŠåœ¨Ubuntuç³»ç»Ÿä¸Šå®‰è£…Dockerï¼Œè¿è¡Œäº†ä¸€ä¸ªç®€å•çš„å®¹å™¨ï¼è¯¥ç³»åˆ—æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­æˆ‘ä¼šä»‹ç»å¦‚ä½•å®¹å™¨åŒ–æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼\n","date":"February 13, 2020","hero":"/zh/posts/container-tech/docker-intro/docker-banner.png","permalink":"/zh/posts/container-tech/docker-intro/","summary":"Docker Dockeræ˜¯ä¸€ä¸ªä¸ºå¼€å‘è€…å’Œè¿ç»´å·¥ç¨‹å¸ˆï¼ˆç³»ç»Ÿç®¡ç†å‘˜ï¼‰ä»¥å®¹å™¨çš„æ–¹å¼æ„å»ºï¼Œåˆ†äº«å’Œè¿è¡Œåº”ç”¨çš„å¹³å°ã€‚ä½¿ç”¨å®¹å™¨è¿›è¡Œåº”ç”¨éƒ¨ç½²çš„æ–¹å¼ï¼Œæˆ‘ä»¬æˆä¸ºå®¹å™¨åŒ–ã€‚\nå®¹å™¨åŒ–åº”ç”¨å…·æœ‰ä¸€ä¸‹ç‰¹æ€§ï¼Œä½¿å¾—å®¹å™¨åŒ–æ—¥ç›Šæµè¡Œï¼š\nçµæ´»ï¼šã€€å†å¤æ‚çš„åº”ç”¨éƒ½å¯ä»¥è¿›è¡Œå®¹å™¨åŒ–ï¼ è½»é‡ï¼šã€€å®¹å™¨ä½¿ç”¨ä½¿ç”¨å’Œå…±äº«ä¸»æœºçš„å†…æ ¸ï¼Œåœ¨ç³»ç»Ÿèµ„æºçš„åˆ©ç”¨æ¯”è™šæ‹Ÿæœºæ›´åŠ é«˜æ•ˆï¼ å¯ç§»æ¤ï¼šã€€å®¹å™¨å¯ä»¥æœ¬åœ°æ„å»ºï¼Œéƒ¨ç½²åˆ°äº‘ä¸Šï¼Œè¿è¡Œåœ¨ä»»ä½•åœ°æ–¹ï¼ æ¾è€¦åˆï¼šã€€å®¹å™¨æ˜¯é«˜åº¦è‡ªå°è£…çš„ï¼Œå¯ä»¥åœ¨ä¸å½±å“å…¶ä»–å®¹å™¨çš„æƒ…å†µä¸‹æ›¿æ¢å’Œå‡çº§å®¹å™¨ï¼ å¯æ‰©å±•ï¼šã€€å¯ä»¥åœ¨æ•´ä¸ªæ•°æ®ä¸­å¿ƒé‡Œå¢åŠ å’Œè‡ªåŠ¨åˆ†å‘å®¹å™¨å‰¯æœ¬ï¼ å®‰å…¨ï¼šã€€å®¹å™¨çº¦æŸå’Œéš”ç¦»åº”ç”¨è¿›ç¨‹ï¼Œè€Œæ— éœ€ç”¨æˆ·è¿›è¡Œä»»ä½•é…ç½®ï¼ é•œåƒå’Œå®¹å™¨ å…¶å®ï¼Œå®¹å™¨å°±æ˜¯è¿è¡Œçš„è¿›ç¨‹ï¼Œé™„å¸¦ä¸€äº›å°è£…çš„ç‰¹æ€§ï¼Œä½¿å…¶ä¸ä¸»æœºä¸Šå’Œå…¶ä»–å®¹å™¨çš„è¿›ç¨‹éš”ç¦»ï¼æ¯ä¸ªå®¹å™¨éƒ½åªè®¿é—®å®ƒè‡ªå·±ç§æœ‰çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè¿™æ˜¯å®¹å™¨éš”ç¦»å¾ˆé‡è¦çš„ä¸€æ–¹é¢ï¼è€ŒDockeré•œåƒå°±æä¾›äº†è¿™ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä¸€ä¸ªé•œåƒåŒ…å«è¿è¡Œè¯¥åº”ç”¨æ‰€æœ‰éœ€æ±‚ - ä»£ç æˆ–è€…äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿è¡Œæ—¶ï¼Œä¾èµ–åº“ï¼Œä»¥åŠå…¶ä»–éœ€è¦çš„æ–‡ä»¶ç³»ç»Ÿå¯¹è±¡ï¼\né€šè¿‡ä¸è™šæ‹Ÿæœºå¯¹æ¯”ï¼Œè™šæ‹Ÿæœºï¼ˆVMï¼‰é€šè¿‡ä¸€ä¸ªè™šæ‹Ÿæœºç®¡ç†ï¼ˆHypervisorï¼‰è¿è¡Œäº†å®Œæ•´çš„æ“ä½œç³»ç»Ÿæ¥è®¿é—®ä¸»æœºèµ„æºï¼é€šå¸¸è™šæ‹Ÿæœºä¼šäº§ç”Ÿå¤§é‡çš„å¼€é”€ï¼Œè¶…è¿‡äº†åº”ç”¨æœ¬èº«æ‰€éœ€è¦çš„å¼€é”€ï¼\nå®¹å™¨ç¼–æ’ å®¹å™¨åŒ–è¿‡ç¨‹çš„å¯ç§»æ¤æ€§å’Œå¯é‡å¤æ€§æ„å‘³ç€æˆ‘ä»¬æœ‰æœºä¼šè·¨äº‘å’Œæ•°æ®ä¸­å¿ƒç§»åŠ¨å’Œæ‰©å±•å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºï¼Œå®¹å™¨æœ‰æ•ˆåœ°ä¿è¯åº”ç”¨ç¨‹åºå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ä»¥ç›¸åŒçš„æ–¹å¼è¿è¡Œï¼Œè¿™ä½¿æˆ‘ä»¬å¯ä»¥å¿«é€Ÿæœ‰æ•ˆåœ°åˆ©ç”¨æ‰€æœ‰è¿™äº›ç¯å¢ƒï¼å½“æˆ‘ä»¬æ‰©å±•æˆ‘ä»¬çš„åº”ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä¸€äº›å·¥å…·æ¥å¸®åŠ©è‡ªåŠ¨ç»´æŠ¤è¿™äº›åº”ç”¨ï¼Œåœ¨å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸé‡Œï¼Œå¯ä»¥è‡ªåŠ¨æ›¿æ¢å¤±è´¥çš„å®¹å™¨ï¼Œç®¡ç†æ»šåŠ¨å‡çº§ï¼Œä»¥åŠé‡æ–°é…ç½®ï¼ã€€å®¹å™¨ç¼–æ’å™¨ï¼ˆOrchestratorï¼‰å°±æ˜¯ç®¡ç†ï¼Œæ‰©å±•å’Œç»´æŠ¤å®¹å™¨åŒ–åº”ç”¨çš„å·¥å…·ï¼Œå½“å‰æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯ Kubernetes å’Œ Docke Swarm ï¼Docker Desktop å·¥å…·å¯ä»¥åœ¨å¼€å‘ç¯å¢ƒæä¾›è¿™ä¸¤ä¸ªç¼–æ’å·¥å…·ï¼å½“å‰ï¼ŒDocker Desktop ä»…æ”¯æŒåœ¨Windowså’ŒOSXç³»ç»Ÿä¸Šå®‰è£…ï¼Œæœ¬æ–‡æ¥ä¸‹æ¥ä¸»è¦ä»‹ç»å¦‚ä½•åœ¨Linuxä¸Šå®‰è£…Dockerï¼Œä»¥åŠè¿è¡Œä¸€ä¸ªå®¹å™¨ï¼\nå®‰è£…Docker å¦‚æœä½ ä½¿ç”¨çš„æ˜¯Windowsæˆ–è€…Mac OSç³»ç»Ÿï¼Œè¯·å‚è€ƒä¸Šé¢çš„é“¾æ¥å®‰è£…å’Œä½¿ç”¨ Docker Desktopï¼Œä¸‹é¢æˆ‘ä»¬å°†å·²Ubuntu 18.04ç³»ç»Ÿä¸ºä¾‹æ¥å®‰è£…Dockerçš„ç¤¾åŒºç‰ˆæœ¬ï¼ˆdocker-ceï¼‰ï¼ã€€é…ç½®è½¯ä»¶æº æ›´æ–°aptåŒ…ç´¢å¼• $ sudo apt update å®‰è£…éœ€è¦çš„è½¯ä»¶åŒ… $ sudo apt install \\ apt-transport-https \\ ca-certificates \\ curl \\ gnupg-agent \\ software-properties-common æ·»åŠ Dockerå®˜æ–¹çš„GPGä¿¡æ¯ $ curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add - ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ·»åŠ Dockerçš„å®‰è£…æº $ sudo add-apt-repository \\ \u0026#34;deb [arch=amd64] https://download.","tags":["docker"],"title":"DOCKERå…¥é—¨"},{"categories":["Linux"],"contents":"åœ¨ä½¿ç”¨Ubuntu Linuxç³»ç»Ÿæ—¶ï¼Œç»å¸¸å‘ç°åœ¨å‡çº§Linuxå†…æ ¸ä¹‹åï¼Œæ—§ç‰ˆæœ¬çš„å†…æ ¸åŒ…ä¾æ—§ä¿ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œå æ®äº†ä¸€å®šçš„ç£ç›˜ç©ºé—´ã€‚ç³»ç»Ÿå¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤æ‰æ—§ç‰ˆæœ¬çš„å†…æ ¸ï¼Œæ˜¯å› ä¸ºä¿è¯åœ¨ä½¿ç”¨æ–°å†…æ ¸æ— æ³•å¯åŠ¨æ—¶ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨æ—§ç‰ˆæœ¬çš„å†…æ ¸æ¥å¯åŠ¨ç³»ç»Ÿã€‚å› æ­¤åœ¨ä½¿ç”¨æ–°ç‰ˆæœ¬å†…æ ¸å¯åŠ¨æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¥åˆ é™¤æ‰ä¸€äº›æ—§ç‰ˆæœ¬çš„å†…æ ¸åŒ…ï¼Œä»¥é‡Šæ”¾ä¸€å®šçš„ç£ç›˜ç©ºé—´ã€‚é‚£æˆ‘ä»¬å¦‚ä½•å®‰å…¨çš„åˆ é™¤æ—§ç‰ˆæœ¬çš„å†…æ ¸å‘¢ï¼Ÿ\nåˆ é™¤æ—§çš„å†…æ ¸æ˜ åƒ ä»¥ä¸‹æ˜¯åœ¨Ubunutä¸Šå®‰å…¨åˆ é™¤æ—§çš„Linuxå†…æ ¸æ˜ åƒæ­¥éª¤ï¼Œä½ ä¸å¿…é¡»ä»¥rootç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨sudoï¼ã€€æ­¥éª¤ä¸€ã€€- å¯åŠ¨åˆ°æ–°çš„å†…æ ¸ã€€é¦–å…ˆå¯åŠ¨åˆ°æ–°å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥éªŒè¯å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼š\n\u0026gt; uname -mrs \u0026gt; uname -a è¾“å‡ºæ ·ä¾‹å¦‚ä¸‹ï¼š\nLinux 4.4.0-117-generic x86_64\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„æ‰€æœ‰Linuxå†…æ ¸æ˜ åƒï¼š\n# dpkg --list | egrep -i --color \u0026#39;linux-image|linux-headers\u0026#39; è¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š\nii linux-headers-4.15.0-45 4.15.0-45.48 all Header files related to Linux kernel version 4.15.0 ii linux-headers-4.15.0-45-generic 4.15.0-45.48 amd64 Linux kernel headers for version 4.15.0 on 64 bit x86 SMP ii linux-headers-generic 4.15.0.45.47 amd64 Generic Linux kernel headers ii linux-image-4.15.0-45-generic 4.15.0-45.48 amd64 Signed kernel image generic ii linux-image-generic 4.15.0.45.47 amd64 Generic Linux kernel image rc linux-headers-4.15.0-22 4.15.0-22.24 all Header files related to Linux kernel version 4.15.0 rc linux-headers-4.15.0-22-generic 4.15.0-22.24 amd64 Linux kernel headers for version 4.15.0 on 64 bit x86 SMP rc linux-headers-generic 4.15.0.22.23 amd64 Generic Linux kernel headers rc linux-image-4.15.0-22-generic 4.15.0-22.24 amd64 Signed kernel image generic rc linux-image-generic 4.15.0.22.23 amd64 Generic Linux kernel image æ­¥éª¤äºŒã€€- åˆ é™¤ä¸æƒ³è¦æˆ–è€…ä¸ä½¿ç”¨çš„å†…æ ¸æ˜ åƒ ç„¶åå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä¸€ä¸ªä¸€ä¸ªåœ°åˆ é™¤æ‰æ—§çš„å†…æ ¸åŒ…ï¼š\n# apt-get --purge remove linux-image-4.15.0-22-generic æˆ–è€…ã€€$ sudo apt-get --purge remove linux-image-4.15.0-22-generic å¯¹äºè¾ƒæ–°çš„Ubunuå‘è¡Œç‰ˆçš„æç¤º åœ¨è¾ƒæ–°çš„ç³»ç»Ÿä¸Šï¼Œæ‰€æœ‰è¿‡æœŸçš„å†…æ ¸å’Œç›¸å…³å¤´æ–‡ä»¶åŒ…ä¼šè‡ªåŠ¨æ ‡è®°ä¸ºä¸å†ä½¿ç”¨çš„çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸€æ¡å‘½ä»¤ç›´æ¥æ¸…é™¤ï¼š\n$ sudo apt --purge autoremove ç›´æ¥ä½¿ç”¨ä¸€ä¸ªè„šæœ¬æ¥åˆ é™¤ã€€å¯ä»¥è€ƒè™‘ä½¿ç”¨å¦‚ä¸‹çš„ä¸€ä¸ªåŠŸå¤«è„šæœ¬æ¥æ¸…é™¤æ—§çš„å†…æ ¸åŒ…ï¼š\n#!/usr/bin/env bash v=\u0026#34;$(uname -r | awk -F \u0026#39;-virtual\u0026#39; \u0026#39;{ print $1}\u0026#39;)\u0026#34; i=\u0026#34;linux-headers-virtual|linux-image-virtual|linux-headers-${v}|linux-image-$(uname -r)\u0026#34; apt-get --purge remove $(dpkg --list | egrep -i \u0026#39;linux-image|linux-headers\u0026#39; | awk \u0026#39;/ii/{ print $2}\u0026#39; | egrep -v \u0026#34;$i\u0026#34;) ","date":"December 8, 2019","hero":"/zh/posts/linux/ubuntu-old-kernel/ubuntu-kernel.jpg","permalink":"/zh/posts/linux/ubuntu-old-kernel/","summary":"åœ¨ä½¿ç”¨Ubuntu Linuxç³»ç»Ÿæ—¶ï¼Œç»å¸¸å‘ç°åœ¨å‡çº§Linuxå†…æ ¸ä¹‹åï¼Œæ—§ç‰ˆæœ¬çš„å†…æ ¸åŒ…ä¾æ—§ä¿ç•™åœ¨ç³»ç»Ÿä¸­ï¼Œå æ®äº†ä¸€å®šçš„ç£ç›˜ç©ºé—´ã€‚ç³»ç»Ÿå¹¶ä¸ä¼šè‡ªåŠ¨åˆ é™¤æ‰æ—§ç‰ˆæœ¬çš„å†…æ ¸ï¼Œæ˜¯å› ä¸ºä¿è¯åœ¨ä½¿ç”¨æ–°å†…æ ¸æ— æ³•å¯åŠ¨æ—¶ï¼Œè¿˜å¯ä»¥é€‰æ‹©ä½¿ç”¨æ—§ç‰ˆæœ¬çš„å†…æ ¸æ¥å¯åŠ¨ç³»ç»Ÿã€‚å› æ­¤åœ¨ä½¿ç”¨æ–°ç‰ˆæœ¬å†…æ ¸å¯åŠ¨æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨æ¥åˆ é™¤æ‰ä¸€äº›æ—§ç‰ˆæœ¬çš„å†…æ ¸åŒ…ï¼Œä»¥é‡Šæ”¾ä¸€å®šçš„ç£ç›˜ç©ºé—´ã€‚é‚£æˆ‘ä»¬å¦‚ä½•å®‰å…¨çš„åˆ é™¤æ—§ç‰ˆæœ¬çš„å†…æ ¸å‘¢ï¼Ÿ\nåˆ é™¤æ—§çš„å†…æ ¸æ˜ åƒ ä»¥ä¸‹æ˜¯åœ¨Ubunutä¸Šå®‰å…¨åˆ é™¤æ—§çš„Linuxå†…æ ¸æ˜ åƒæ­¥éª¤ï¼Œä½ ä¸å¿…é¡»ä»¥rootç”¨æˆ·æ‰§è¡Œå‘½ä»¤ï¼Œæˆ–è€…ä½¿ç”¨sudoï¼ã€€æ­¥éª¤ä¸€ã€€- å¯åŠ¨åˆ°æ–°çš„å†…æ ¸ã€€é¦–å…ˆå¯åŠ¨åˆ°æ–°å®‰è£…çš„å†…æ ¸ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹çš„å‘½ä»¤æ¥éªŒè¯å½“å‰å†…æ ¸ç‰ˆæœ¬ï¼š\n\u0026gt; uname -mrs \u0026gt; uname -a è¾“å‡ºæ ·ä¾‹å¦‚ä¸‹ï¼š\nLinux 4.4.0-117-generic x86_64\nä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸­å·²ç»å®‰è£…çš„æ‰€æœ‰Linuxå†…æ ¸æ˜ åƒï¼š\n# dpkg --list | egrep -i --color \u0026#39;linux-image|linux-headers\u0026#39; è¾“å‡ºå¯èƒ½å¦‚ä¸‹ï¼š\nii linux-headers-4.15.0-45 4.15.0-45.48 all Header files related to Linux kernel version 4.15.0 ii linux-headers-4.15.0-45-generic 4.15.0-45.48 amd64 Linux kernel headers for version 4.15.0 on 64 bit x86 SMP ii linux-headers-generic 4.15.0.45.47 amd64 Generic Linux kernel headers ii linux-image-4.15.0-45-generic 4.15.0-45.48 amd64 Signed kernel image generic ii linux-image-generic 4.","tags":["ubuntu","kernel"],"title":"åœ¨UBUNTUä¸Šåˆ é™¤æ—§çš„å†…æ ¸"},{"categories":["OpenTool"],"contents":"Rcloneæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œäº‘å­˜å‚¨åŒæ­¥å·¥å…·ï¼Œå¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿå’Œäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´æˆ–è€…å¤šä¸ªäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´è®¿é—®å’ŒåŒæ­¥æ–‡ä»¶ï¼Œæ”¯æŒå¾ˆå¤šäº‘å­˜å‚¨æœåŠ¡åç«¯ã€‚\nRcloneæ”¯æŒçš„äº‘å­˜å‚¨æœåŠ¡ rcloneçš„å½“å‰ç‰ˆæœ¬ä¸ºv1.49.1ï¼Œæ”¯æŒä»¥ä¸‹äº‘å­˜å‚¨æœåŠ¡ï¼š\n1Fichier Alibaba Cloud (Aliyun) Object Storage System (OSS) Amazon Drive (See note) Amazon S3 Backblaze B2 Box Ceph C14 DigitalOcean Spaces Dreamhost Dropbox FTP Google Cloud Storage Google Drive Google Photos HTTP Hubic Jottacloud IBM COS S3 Koofr Memset Memstore Mega Microsoft Azure Blob Storage Microsoft OneDrive Minio Nextcloud OVH OpenDrive Openstack Swift Oracle Cloud Storage ownCloud pCloud premiumize.me put.io QingStor Rackspace Cloud Files rsync.net Scaleway SFTP Wasabi WebDAV Yandex Disk The local filesystem å½“å‰å¯¹äºGoogle Photosçš„æ”¯æŒæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå…·ä½“è¯·çœ‹æ–‡æ¡£ã€‚\nRclineçš„åŠŸèƒ½ï¼š\nå§‹ç»ˆæ£€æŸ¥MD5/SHA1å“ˆå¸Œå€¼ä¿è¯æ–‡ä»¶å®Œæ•´æ€§ ä¿ç•™æ–‡ä»¶æ—¶é—´æˆ³ åœ¨æ•´ä¸ªæ–‡ä»¶ä¸Šæ”¯æŒéƒ¨åˆ†åŒæ­¥ å¤åˆ¶æ¨¡å¼ä»…ä»…å¤åˆ¶æ–°çš„/ä¿®æ”¹çš„æ–‡ä»¶ æ£€æŸ¥æ¨¡å¼æ£€æŸ¥æ–‡ä»¶çš„å“ˆå¸Œç›¸ç­‰ åŒæ­¥ (å•ä¸€æ–¹å‘)ä½¿æ–‡ä»¶ç›®å½•ä¿æŒä¸€è‡´ å¯ä»¥åŒæ­¥åˆ°æˆ–è€…ä»ç½‘ç»œåŒæ­¥ æ”¯æŒåç«¯åŠ å¯† æ”¯æŒåç«¯ç¼“å­˜ æ”¯æŒåç«¯è”åˆ å¯é€‰çš„FUSEæŒ‚è½½ å¤šçº¿ç¨‹ä¸‹è½½åˆ°æœ¬åœ°ç£ç›˜ å¯ä»¥é€šè¿‡HTTP/WebDav/FTP/SFTP/dlnaä¸ºæœ¬åœ°æˆ–è€…è¿œç«¯æ–‡ä»¶æä¾›æœåŠ¡ å®éªŒæ€§çš„åŸºäºWebçš„å›¾å½¢ç•Œé¢ å®‰è£…Rclone å¯¹äºLinuxç¯å¢ƒï¼Œç”±äºrcloneæ˜¯ç”±Golangå¼€å‘ï¼Œå› æ­¤å®‰è£…éå¸¸ç®€å•ã€‚ç®¡å‘æä¾›äº†ç¼–è¯‘å¥½çš„äºŒè¿›åˆ¶å¯æ‰§è¡Œç¨‹åºï¼Œä»¥åŠRPMå’ŒDEBåŒ…ï¼Œå¯æ ¹æ®è‡ªå·±ç³»ç»Ÿçš„æƒ…å†µé€‰æ‹©ã€‚ä»¥ä¸‹æ¼”ç¤ºç›´æ¥ä¸‹è½½äºŒè¿›åˆ¶å¯æ‰§è¡Œæ–‡ä»¶çš„æ–¹å¼ã€‚\nä¸‹è½½åœ°å€ï¼š https://downloads.rclone.org/v1.49.1/rclone-v1.49.1-linux-amd64.zip\nâ¯ wget https://downloads.rclone.org/v1.49.1/rclone-v1.49.1-linux-amd64.zip â¯ unzip -qq rclone-v1.49.1-linux-amd64.zip â¯ sudo cp rclone-v1.49.1-linux-amd64/rclone /usr/local/bin/ â¯ sudo chmod +x /usr/local/bin/rclone é…ç½®äº‘å­˜å‚¨æœåŠ¡ Rcloneæ”¯æŒå¾ˆå¤šäº‘å­˜å‚¨æœåŠ¡ï¼Œä»¥ä¸‹ä¸¾ä¾‹é…ç½®ä¸¤ä¸ªæœåŠ¡Microsoft OneDriveå’ŒDropboxã€‚\nå¯¹äºå…¶ä»–çš„äº‘å­˜å‚¨æœåŠ¡ï¼Œå¯å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nMicrosoft OneDrive åœ¨å‘½ä»¤è¡Œç»ˆç«¯æ‰§è¡Œrclone config :\nâ¯ rclone config 2019/08/30 11:21:13 NOTICE: Config file \u0026#34;/home/mengz/.config/rclone/rclone.conf\u0026#34; not found - using defaults No remotes found - make a new one n) New remote s) Set configuration password q) Quit config n/s/q\u0026gt; n name\u0026gt; onedrive è¿™é‡Œä½¿ç”¨næ·»åŠ æ–°çš„è¿œç¨‹æœåŠ¡ï¼Œç„¶åç»™æœåŠ¡è®¾ç½®ä¸€ä¸ªåå­—ï¼Œè¿™é‡Œä½¿ç”¨äº†onedriveï¼Œæ¥ä¸‹æ¥éœ€è¦é€‰æ‹©å­˜å‚¨æœåŠ¡ï¼š\nType of storage to configure. Enter a string value. Press Enter for the default (\u0026#34;\u0026#34;). Choose a number from below, or type in your own value ... ... Storage\u0026gt; onedrive ... æˆ‘ä»¬é€‰æ‹©onedriveï¼Œæ¥ä¸‹æ¥æ˜¯è¯¢é—®client_idå’Œclient_secretï¼Œè¿™é‡Œç›´æ¥å›è½¦ï¼Œåé¢ä¼šé€šè¿‡æ‰“å¼€æµè§ˆå™¨æ¥æˆæƒï¼š\nMicrosoft App Client Id Leave blank normally. Enter a string value. Press Enter for the default (\u0026#34;\u0026#34;). client_id\u0026gt; Microsoft App Client Secret Leave blank normally. Enter a string value. Press Enter for the default (\u0026#34;\u0026#34;). client_secret\u0026gt; Edit advanced config? (y/n) y) Yes n) No y/n\u0026gt; n Remote config Use auto config? * Say Y if not sure * Say N if you are working on a remote or headless machine y) Yes n) No y/n\u0026gt; y If your browser doesn\\\u0026#39;t open automatically go to the following link: http://127.0.0.1:53682/auth Log in and authorize rclone for access Waiting for code... ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨ï¼Œè¯·æ±‚æœåŠ¡æˆæƒï¼ŒæˆæƒæˆåŠŸåè¿”å›ç»ˆç«¯ç»§ç»­ï¼š\nGot code Choose a number from below, or type in an existing value ... Your choice\u0026gt; 1 Found 1 drives, please select the one you want to use: 0: OneDrive (business) id=b!Eqwertyuiopasdfghjklzxcvbnm-7mnbvcxzlkjhgfdsapoiuytrewqk Chose drive to use:\u0026gt; 0 Found drive \u0026#39;root\u0026#39; of type \u0026#39;business\u0026#39;, URL: https://org-my.sharepoint.com/personal/you/Documents Is that okay? y) Yes n) No y/n\u0026gt; y -------------------- ... -------------------- y) Yes this is OK e) Edit this remote d) Delete this remote y/e/d\u0026gt; y Current remotes: Name Type ==== ==== onedrive onedrive e) Edit existing remote n) New remote d) Delete remote r) Rename remote c) Copy remote s) Set configuration password q) Quit config e/n/d/r/c/s/q\u0026gt; q è¿™æ ·å°±é…ç½®å¥½äº†OneDriveçš„è®¿é—®ï¼Œç°åœ¨åœ¨ç»ˆç«¯å¯ä»¥ä½¿ç”¨rcloneçš„æ“ä½œå‘½ä»¤æ¥æŸ¥çœ‹è¿œç¨‹å­˜å‚¨çš„å†…å®¹äº†ï¼š\nâ¯ rclone lsd onedrive: â¯ rclone copy ./file onedrive:Temp/ â¯ rclone ls onedrive:Temp/ 1452 file å…³äºOneDriveçš„è¯¦ç»†è¯¦ç»†ï¼Œå‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\nDropbox å…¶å®Dropboxçš„é…ç½®æ–¹å¼ä¸ä¸Šé¢å‡ ä¹ä¸€æ ·ï¼Œå°±ä¸åšå…·ä½“çš„å±•ç¤ºäº†ï¼Œåªæ˜¯è¦è¯´æ˜çš„ä¸€ç‚¹æ˜¯ï¼Œå¯¹äºåƒDropboxï¼ŒGoogle Driveä¹‹ç±»çš„æœåŠ¡ï¼Œéœ€è¦ä½ ç»ˆç«¯é…ç½®ç›¸åº”çš„ä»£ç†ï¼ˆä¹Ÿå°±æ˜¯å¯ä»¥ç§‘å­¦ä¸Šç½‘ï¼‰ï¼Œå¦åˆ™ä¼šæ— æ³•è®¿é—®ç›¸åº”çš„æœåŠ¡ã€‚\nå½“å‰é…ç½®å®Œæˆä¹‹åï¼Œè¿è¡Œå‘½ä»¤ rclone config å¯ä»¥çœ‹åˆ°å½“å‰é…ç½®äº†çš„è¿œç¨‹æœåŠ¡ï¼š\nâ¯ rclone config Current remotes: Name Type ==== ==== dropbox dropbox gdrive drive onedrive onedrive ç›¸åº”çš„é…ç½®æ–‡ä»¶ä½ç½®åœ¨ ~/.config/rclone/rclone.conf ã€‚\nåŸºäºWebçš„å›¾å½¢ç•Œé¢ åŸºäºWebçš„å›¾å½¢ç®¡ç†ç•Œé¢æ˜¯å®éªŒæ€§çš„åŠŸèƒ½ï¼Œå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤æ‰“å¼€ï¼š\nâ¯ rclone rcd --rc-web-gui\nå…¶ä¼šè‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨å¹¶è‡ªåŠ¨ç™»å½•ï¼Œ\nDashboard ï¼š æ˜¾ç¤ºRcloneçš„çŠ¶æ€ï¼Œå…¨å±€çŠ¶æ€ã€é€Ÿåº¦å’Œå…è®¸è®¾ç½®çš„å¸¦å®½ é…ç½® ï¼š å…è®¸æ·»åŠ æ–°çš„åç«¯é…ç½®ã€æ›´æ–°æˆ–è€…åˆ é™¤ç°æœ‰çš„é…ç½® Explorer ï¼š å…è®¸æµè§ˆé…ç½®çš„Rcloneè¿œç¨‹åç«¯ï¼Œå¹¶æ‰§è¡Œæ–‡ä»¶æ“ä½œ Backend ï¼š ç‰ˆæœ¬ä¿¡æ¯å’Œå„ç§åç«¯è®¾ç½® æ€»ç»“ Rcloneæäº†å¤§é‡çš„äº‘å­˜å‚¨æœåŠ¡æ”¯æŒï¼Œä¾›ç”¨æˆ·é€‰æ‹©ï¼Œä½¿å¾—ç”¨æˆ·æ–¹ä¾¿åœ¨å‘½ä»¤è¡Œç»ˆç«¯æ“ä½œäº‘å­˜å‚¨çš„æ–‡ä»¶å’Œç›®å½•ï¼ŒåŒæ—¶æä¾›äº†ä¸€ä¸ªå®éªŒæ€§çš„åŸºäºWebçš„å›¾åƒç•Œé¢ï¼Œä½¿ç”¨æ–¹ä¾¿ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥å°è¯•ä¸€ä¸‹ã€‚\næ›´å¤šçš„åŠŸèƒ½è¯·å‚è€ƒå®˜æ–¹ç½‘ç«™ã€‚\n","date":"August 30, 2019","hero":"/zh/posts/opentool/rclone-sync/rclone.png","permalink":"/zh/posts/opentool/rclone-sync/","summary":"Rcloneæ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œäº‘å­˜å‚¨åŒæ­¥å·¥å…·ï¼Œå¯ä»¥åœ¨æ–‡ä»¶ç³»ç»Ÿå’Œäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´æˆ–è€…å¤šä¸ªäº‘å­˜å‚¨æœåŠ¡ä¹‹é—´è®¿é—®å’ŒåŒæ­¥æ–‡ä»¶ï¼Œæ”¯æŒå¾ˆå¤šäº‘å­˜å‚¨æœåŠ¡åç«¯ã€‚\nRcloneæ”¯æŒçš„äº‘å­˜å‚¨æœåŠ¡ rcloneçš„å½“å‰ç‰ˆæœ¬ä¸ºv1.49.1ï¼Œæ”¯æŒä»¥ä¸‹äº‘å­˜å‚¨æœåŠ¡ï¼š\n1Fichier Alibaba Cloud (Aliyun) Object Storage System (OSS) Amazon Drive (See note) Amazon S3 Backblaze B2 Box Ceph C14 DigitalOcean Spaces Dreamhost Dropbox FTP Google Cloud Storage Google Drive Google Photos HTTP Hubic Jottacloud IBM COS S3 Koofr Memset Memstore Mega Microsoft Azure Blob Storage Microsoft OneDrive Minio Nextcloud OVH OpenDrive Openstack Swift Oracle Cloud Storage ownCloud pCloud premiumize.me put.io QingStor Rackspace Cloud Files rsync.net Scaleway SFTP Wasabi WebDAV Yandex Disk The local filesystem å½“å‰å¯¹äºGoogle Photosçš„æ”¯æŒæœ‰ä¸€å®šçš„é™åˆ¶ï¼Œå…·ä½“è¯·çœ‹æ–‡æ¡£ã€‚","tags":["cloud","rclone","linux"],"title":"RCLOUDä¸äº‘å­˜å‚¨åŒæ­¥"},{"categories":["Linux"],"contents":"æˆ‘ä»¬éƒ½çŸ¥é“åœ¨Linuxä¸Šé»˜è®¤éƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºrootçš„è¶…çº§ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯ä»¥ä¿®æ”¹ç³»ç»Ÿä¸Šçš„ä»»ä½•æ–‡ä»¶å’Œç›®å½•ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåˆ›å»ºä¸€äº›ä¸èƒ½è¢«åˆ é™¤/ä¿®æ”¹çš„æ–‡ä»¶å’Œç›®å½•å‘¢ï¼Ÿ\né‚£åœ¨Linuxç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªå‘½ä»¤chattrå¯ä»¥ç”¨æ¥ä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„å±æ€§ï¼Œé€šè¿‡è¯¥å‘½ä»¤å°±å¯ä»¥è®¾ç½®æ–‡ä»¶å’Œç›®å½•ä¸å¯åˆ é™¤ï¼Œç”šè‡³åŒ…æ‹¬rootä¹Ÿä¸èƒ½æ“ä½œã€‚\nåˆ›å»ºä¸å¯åˆ é™¤çš„æ–‡ä»¶ ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ç³»ç»Ÿä¸Šæ–°å»ºä¸€ä¸ªåä¸ºundeletable-fileçš„æ–‡ä»¶ï¼Œé€šè¿‡åäº†chattrè®¾ç½®å…¶å±æ€§ä¸ºä¸å¯ä¿®æ”¹çš„ï¼š\nâ¯ echo \u0026#34;some contents\u0026#34; â¯ ~/undeletable-file â¯ sudo chattr +i -V ~/undeletable-file chattr 1.43.8 (1-Jan-2018) Flags of /home/mengz/undeletable-file set as ----i-------------- â¯ rm -f ~/undeletable-file rm: cannot remove \u0026#39;undeletable-file\u0026#39;: Operation not permitted â¯ sudo rm -f ~/undeletable-file rm: cannot remove \u0026#39;undeletable-file\u0026#39;: Operation not permitted â¯ echo \u0026#34;change\u0026#34; â¯â¯ ~/undeletable-file bash: undeletable-file: Operation not permitted æ³¨æ„ ï¼š æ˜¯ç”¨å‘½ä»¤chatträ¿®æ”¹å±æ€§çš„æ—¶å€™éœ€è¦rootæƒé™ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨äº†sudo ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤lsattræ¥æŸ¥çœ‹å½“å‰æ–‡ä»¶çš„å±æ€§ï¼š\nâ¯ lsattr ~/undeletable-file ----i-------------- /home/mengz/undeletable-file è®¾ç½®ç›®å½•ä¸å¯ä¿®æ”¹ é’ˆå¯¹ç›®å½•ï¼ŒåŒæ ·æ˜¯ç”¨å‘½ä»¤chattrï¼Œæ˜¯ç”¨-Ré€‰é¡¹å¯ä»¥é€’å½’åœ°ä¿®æ”¹ç›®å½•å’Œå…¶æ–‡ä»¶çš„å±æ€§ï¼š\nâ¯ mkdir -p immutable-dir/{dir1,dir2} â¯ touch immutable-dir/dir1/file1 â¯ touch immutable-dir/dir2/file2 â¯ sudo chattr +i -RV immutable-dir/ chattr 1.43.8 (1-Jan-2018) Flags of immutable-dir/ set as ----i-------------- Flags of immutable-dir//dir1 set as ----i-------------- Flags of immutable-dir//dir1/file1 set as ----i-------------- Flags of immutable-dir//dir2 set as ----i-------------- Flags of immutable-dir//dir2/file2 set as ----i-------------- â¯ rm -rf immutable-dir/ rm: cannot remove \u0026#39;immutable-dir/dir1/file1\u0026#39;: Operation not permitted rm: cannot remove \u0026#39;immutable-dir/dir2/file2\u0026#39;: Operation not permitted â¯ sudo rm -f immutable-dir/dir1/file1 rm: cannot remove \u0026#39;immutable-dir/dir1/file1\u0026#39;: Operation not permitted è¦ä½¿æ–‡ä»¶æˆ–è€…ç›®å½•å¯ä¿®æ”¹ï¼Œæ˜¯ç”¨å‘½ä»¤chattråŠ ä¸Šé€‰é¡¹-i ï¼š\nâ¯ sudo chattr -i -RV immutable-dir/ chattr 1.43.8 (1-Jan-2018) Flags of immutable-dir/ set as ------------------- Flags of immutable-dir//dir1 set as ------------------- Flags of immutable-dir//dir1/file1 set as ------------------- Flags of immutable-dir//dir2 set as ------------------- Flags of immutable-dir//dir2/file2 set as ------------------- â¯ rm -rf immutable-dir/ ","date":"August 24, 2019","hero":"/zh/posts/linux/make-undeletable/linux-commands.jpg","permalink":"/zh/posts/linux/make-undeletable/","summary":"æˆ‘ä»¬éƒ½çŸ¥é“åœ¨Linuxä¸Šé»˜è®¤éƒ½ä¼šæœ‰ä¸€ä¸ªåä¸ºrootçš„è¶…çº§ç”¨æˆ·ï¼Œè¯¥ç”¨æˆ·å¯ä»¥ä¿®æ”¹ç³»ç»Ÿä¸Šçš„ä»»ä½•æ–‡ä»¶å’Œç›®å½•ï¼Œé‚£æˆ‘ä»¬æ€ä¹ˆåˆ›å»ºä¸€äº›ä¸èƒ½è¢«åˆ é™¤/ä¿®æ”¹çš„æ–‡ä»¶å’Œç›®å½•å‘¢ï¼Ÿ\né‚£åœ¨Linuxç³»ç»Ÿä¸­æœ‰ä¸€ä¸ªå‘½ä»¤chattrå¯ä»¥ç”¨æ¥ä¿®æ”¹æ–‡ä»¶å’Œç›®å½•çš„å±æ€§ï¼Œé€šè¿‡è¯¥å‘½ä»¤å°±å¯ä»¥è®¾ç½®æ–‡ä»¶å’Œç›®å½•ä¸å¯åˆ é™¤ï¼Œç”šè‡³åŒ…æ‹¬rootä¹Ÿä¸èƒ½æ“ä½œã€‚\nåˆ›å»ºä¸å¯åˆ é™¤çš„æ–‡ä»¶ ä¾‹å¦‚ï¼Œæˆ‘ä»¬åœ¨ç³»ç»Ÿä¸Šæ–°å»ºä¸€ä¸ªåä¸ºundeletable-fileçš„æ–‡ä»¶ï¼Œé€šè¿‡åäº†chattrè®¾ç½®å…¶å±æ€§ä¸ºä¸å¯ä¿®æ”¹çš„ï¼š\nâ¯ echo \u0026#34;some contents\u0026#34; â¯ ~/undeletable-file â¯ sudo chattr +i -V ~/undeletable-file chattr 1.43.8 (1-Jan-2018) Flags of /home/mengz/undeletable-file set as ----i-------------- â¯ rm -f ~/undeletable-file rm: cannot remove \u0026#39;undeletable-file\u0026#39;: Operation not permitted â¯ sudo rm -f ~/undeletable-file rm: cannot remove \u0026#39;undeletable-file\u0026#39;: Operation not permitted â¯ echo \u0026#34;change\u0026#34; â¯â¯ ~/undeletable-file bash: undeletable-file: Operation not permitted æ³¨æ„ ï¼š æ˜¯ç”¨å‘½ä»¤chatträ¿®æ”¹å±æ€§çš„æ—¶å€™éœ€è¦rootæƒé™ï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨äº†sudo ã€‚\næˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å‘½ä»¤lsattræ¥æŸ¥çœ‹å½“å‰æ–‡ä»¶çš„å±æ€§ï¼š\nâ¯ lsattr ~/undeletable-file ----i-------------- /home/mengz/undeletable-file è®¾ç½®ç›®å½•ä¸å¯ä¿®æ”¹ é’ˆå¯¹ç›®å½•ï¼ŒåŒæ ·æ˜¯ç”¨å‘½ä»¤chattrï¼Œæ˜¯ç”¨-Ré€‰é¡¹å¯ä»¥é€’å½’åœ°ä¿®æ”¹ç›®å½•å’Œå…¶æ–‡ä»¶çš„å±æ€§ï¼š","tags":["linux","command"],"title":"LINUXä¸Šåˆ›å»ºä¸å¯åˆ é™¤æ–‡ä»¶"},{"categories":["Linux"],"contents":"å¦‚ä»Šæœ‰å¾ˆå¤šç¬”è®°æœ¬ç”µè„‘éƒ½é…å¤‡äº†åŒæ˜¾å¡ï¼Œä¸€å—é›†æˆçš„ Intel æ˜¾å¡ï¼Œä¸€å—æ€§èƒ½æ›´å¥½ä¸€äº›çš„ NVIDIA æ˜¾å¡ã€‚\nå¯æ˜¯åœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­å¯èƒ½æ ¹æœ¬ç”¨ä¸ä¸Š NVIDIA çš„é‚£å—æ˜¾å¡ï¼Œé‚£ä¹ˆä¸ºäº†ä½¿è¿™æ ·çš„ç¬”è®°æœ¬ç”µè„‘æ›´çœç”µï¼Œé‚£ä¹ˆåœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­å¯ä»¥ç¦ç”¨ NVIDIA çš„æ˜¾å¡ï¼Œè€Œåªä½¿ç”¨é›†æˆçš„æ˜¾å¡ã€‚ Bumblebee å°±æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œåœ¨ Linux ä¸Šå®ç°äº† NVIDIA çš„ Optimus æŠ€æœ¯ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ NVIDIA çš„æ˜¾å¡ã€‚\næˆ‘çš„ç”µè„‘æ˜¯ Lenovo ThinkPad T440s ï¼Œé…å¤‡äº†å¦‚ä¸‹çš„ä¸¤å—æ˜¾å¡ï¼š\n1. 00:02.0 VGA compatible controller: Intel Corporation Haswell-ULT Integrated Graphics Controller (rev 09) 2. VGA compatible controller: NVIDIA Corporation GK208M [GeForce GT 730M] (rev ff) è€Œæˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ openSUSE Leap 42.1ï¼Œä¸‹é¢å°±çœ‹çœ‹å¦‚ä½•åœ¨è¯¥ç³»ç»Ÿä¸Šç¦ç”¨ NVIDIA çš„æ˜¾å¡ã€‚\nå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ… é¦–å…ˆæ·»åŠ å¦‚ä¸‹å®‰è£…æºï¼š\nsudo zypper ar -r http://download.opensuse.org/repositories/X11:/Bumblebee/openSUSE_Leap_42.1/X11:Bumblebee.repo\nåˆ·æ–°åï¼Œå®‰è£…å¦‚ä¸‹è½¯ä»¶åŒ…ï¼š\nbumblebee nvidia-bumblebee bbswitch bbswitch-kmp-default\nå¦‚æœä½ æ˜¯64ä½ç³»ç»Ÿï¼Œè¿˜è¯·å®‰è£…\nnvidia-bumblebee-32bit\nä¹‹åè¿˜éœ€è¦å°†ç”¨æˆ·æ·»åŠ å…¥ bumblebee å’Œ video ä¸¤ä¸ªç»„ï¼š\nsudo usermod -a bumblebee username\nsudo usermod -a video username\nå¯åŠ¨æœåŠ¡ å®‰è£…å®Œä»¥ä¸Šè½¯ä»¶åŒ…ä¹‹åï¼Œéœ€è¦å¯åŠ¨è¿ä¸ªæœåŠ¡ï¼š\nsudo systemctl enable bumblebeed\nsudo systemctl enable dkms\nç„¶åæ£€æŸ¥ /etc/modprobe.d/50-blacklist.conf æ–‡ä»¶ï¼Œç¡®ä¿ blacklist nouveau å­˜åœ¨ï¼ˆé™¤éä½ ç¡®å®šè¦ä½¿ç”¨ nouveau é©±åŠ¨ï¼‰ã€‚ ä¹‹å\nmkinitrd\né‡å¯ç³»ç»Ÿã€‚\næŸ¥çœ‹çŠ¶æ€ é‡å¯ä¹‹åï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹çŠ¶æ€\noptirun \u0026ndash;status\nå¦‚æœæ˜¾ç¤ºçš„ç»“æœæ˜¯ï¼š\nBumblebee status: Ready (3.2.1). X inactive. Discrete video card is off.\né‚£ä¹ˆæ­å–œï¼Œä½ å·²ç»é…ç½®æˆåŠŸå¹¶ä¸”ç¦ç”¨äº† NVIDIA çš„æ˜¾å¡ã€‚ å¦‚æœä½ æƒ³æµ‹è¯•ä½ çš„ NVIDIA çš„æ˜¾å¡ï¼Œå¯ä»¥è¿è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š\noptirun glxsheres\nè¿™æ˜¯å°†ä¼šå¯ç”¨ NVIDIA æ˜¾å¡æ¥è¿è¡Œè¯¥ç¨‹åºï¼Œæ‰€ä»¥å¦‚æœä½ æƒ³ä½¿ç”¨ NVIDIA çš„æ˜¾å¡æ¥è¿è¡ŒæŸä¸ªåº”ç”¨ç¨‹åºï¼Œè¯·ä½¿ç”¨ optirun å‘½ä»¤ã€‚\næ’é™¤é—®é¢˜ å¦‚æœä½ åœ¨ \u0026ldquo;optirun \u0026ndash;status\u0026rdquo; ä¸­å¾—åˆ°çš„ç»“æœæ˜¯ï¼š\nBumblebee status: Ready (3.2.1). X inactive. Discrete video card is on.\né‚£ä¹ˆé¦–å…ˆæ£€æŸ¥æ–‡ä»¶ /etc/modprobe.d/50-bbswitch.conf ï¼Œçœ‹æ˜¯æœ‰å¦‚ä¸‹å†…å®¹ï¼š\noptions bbswitch load_state=0\nç„¶åæ£€æŸ¥\nsudo systemctl -l status bumblebeed\nçœ‹æ˜¯å¦æœ‰ç±»ä¼¼å¦‚ä¸‹çš„ä¿¡æ¯\n/dev/dri/card0: failed to set DRM interface version 1.4: Permission denied\nå¦‚æœæœ‰ï¼Œé‚£ä¹ˆå¾€æ–‡ä»¶ /etc/bumblebee/xorg.conf.nvidia é‡Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š\nSection \u0026#34;Screen\u0026#34; Identifier \u0026#34;Default Screen\u0026#34; Device \u0026#34;DiscreteNvidia\u0026#34; EndSection ç„¶åé‡å¯è¯¥æœåŠ¡ã€‚\nåœ¨å…¶æ¬¡ï¼Œæ£€æŸ¥\ndmesg | grep -C 10 bbswitch\nçœ‹æ˜¯å¦æœ‰ç±»ä¼¼å¦‚ä¸‹å†…å®¹ï¼š\nACPI Warning: _SB_.PCI0.PEG_.VID_._DSM: Argument #4 type mismatch - Found [Buffer], ACPI requires [Package] (20150410/nsarguments-95)\nè¿™æ ·éœ€è¦åœ¨å¯åŠ¨å†…æ ¸å‚æ•°æ·»åŠ  \u0026ldquo;acpi_osi=!Windows 2013\u0026rdquo; åé‡å¯ç³»ç»Ÿã€‚\nå¦‚æœæƒ³äº†è§£æ›´å¤šçš„æƒ…å†µï¼Œè¯·æŸ¥çœ‹è€ƒ Github ä¸Šçš„ Bumblebee å’Œ bbswitch ä¸¤ä¸ªé¡¹ç›®ã€‚\n","date":"November 25, 2015","hero":"/zh/posts/linux/bumlebee-nvidia/bumblebee-nvidia.png","permalink":"/zh/posts/linux/bumlebee-nvidia/","summary":"å¦‚ä»Šæœ‰å¾ˆå¤šç¬”è®°æœ¬ç”µè„‘éƒ½é…å¤‡äº†åŒæ˜¾å¡ï¼Œä¸€å—é›†æˆçš„ Intel æ˜¾å¡ï¼Œä¸€å—æ€§èƒ½æ›´å¥½ä¸€äº›çš„ NVIDIA æ˜¾å¡ã€‚\nå¯æ˜¯åœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­å¯èƒ½æ ¹æœ¬ç”¨ä¸ä¸Š NVIDIA çš„é‚£å—æ˜¾å¡ï¼Œé‚£ä¹ˆä¸ºäº†ä½¿è¿™æ ·çš„ç¬”è®°æœ¬ç”µè„‘æ›´çœç”µï¼Œé‚£ä¹ˆåœ¨å¹³æ—¶çš„ä½¿ç”¨ä¸­å¯ä»¥ç¦ç”¨ NVIDIA çš„æ˜¾å¡ï¼Œè€Œåªä½¿ç”¨é›†æˆçš„æ˜¾å¡ã€‚ Bumblebee å°±æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œåœ¨ Linux ä¸Šå®ç°äº† NVIDIA çš„ Optimus æŠ€æœ¯ï¼Œåœ¨éœ€è¦çš„æ—¶å€™ä½¿ç”¨ NVIDIA çš„æ˜¾å¡ã€‚\næˆ‘çš„ç”µè„‘æ˜¯ Lenovo ThinkPad T440s ï¼Œé…å¤‡äº†å¦‚ä¸‹çš„ä¸¤å—æ˜¾å¡ï¼š\n1. 00:02.0 VGA compatible controller: Intel Corporation Haswell-ULT Integrated Graphics Controller (rev 09) 2. VGA compatible controller: NVIDIA Corporation GK208M [GeForce GT 730M] (rev ff) è€Œæˆ‘ä½¿ç”¨çš„ç³»ç»Ÿæ˜¯ openSUSE Leap 42.1ï¼Œä¸‹é¢å°±çœ‹çœ‹å¦‚ä½•åœ¨è¯¥ç³»ç»Ÿä¸Šç¦ç”¨ NVIDIA çš„æ˜¾å¡ã€‚\nå®‰è£…æ‰€éœ€çš„è½¯ä»¶åŒ… é¦–å…ˆæ·»åŠ å¦‚ä¸‹å®‰è£…æºï¼š\nsudo zypper ar -r http://download.opensuse.org/repositories/X11:/Bumblebee/openSUSE_Leap_42.1/X11:Bumblebee.repo\nåˆ·æ–°åï¼Œå®‰è£…å¦‚ä¸‹è½¯ä»¶åŒ…ï¼š\nbumblebee nvidia-bumblebee bbswitch bbswitch-kmp-default\nå¦‚æœä½ æ˜¯64ä½ç³»ç»Ÿï¼Œè¿˜è¯·å®‰è£…\nnvidia-bumblebee-32bit","tags":["opensuse","nvidia","linux"],"title":"BUMBLEBEEç¦ç”¨NVIDIAæ˜¾å¡"},{"categories":["Container"],"contents":"ç°åœ¨ Docker å¯æ‰€è°“æ˜¯æœ€ç«çš„å®¹å™¨æŠ€æœ¯äº†ï¼Œè‡³äºä»€ä¹ˆæ˜¯ Dockerï¼Œè¯·åˆ°å…¶å®˜æ–¹ç½‘ç«™æˆ–è€…ç»´åŸºç™¾ç§‘æŸ¥çœ‹ã€‚\nè¿™é‡Œæƒ³é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥çœ‹çœ‹æ€ä¹ˆé€šè¿‡ Dockerfile æ¥æ„å»ºä¸€ä¸ª Docker é•œåƒã€‚\næ„å»ºMariaDBå®¹å™¨é•œåƒ Docker æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥ç”Ÿäº§åº”ç”¨é•œåƒ:\né€šè¿‡å¯åŠ¨ä¸€ä¸ªåŸºç¡€å®¹å™¨ï¼ˆæ¯”å¦‚åŸºäºæŸç§ Linux å‘è¡Œç‰ˆçš„é•œåƒçš„å®¹å™¨ï¼‰ï¼Œç„¶ååœ¨å®¹å™¨é‡Œæ‰§è¡Œå„ç§å‘½ä»¤æ¥å®‰è£…ç›¸åº”çš„è½¯ä»¶åŒ…ï¼Œè¿›è¡Œé…ç½®åï¼Œå†é€šè¿‡ docker commit å‘½ä»¤æŠŠå·²ç»æ›´æ–°çš„å®¹å™¨ç”Ÿäº§ç›¸åº”çš„é•œåƒã€‚ é€šè¿‡ç¼–å†™ä¸€ä¸ª Dockerfile ï¼Œç„¶åä½¿ç”¨ docker build å‘½ä»¤æ¥æ„å»ºç›¸åº”çš„é•œåƒã€‚ ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ Dockerfile çš„æ–¹å¼ï¼Œå¯ä»¥æ›´å¥½çš„ç»´æŠ¤é•œåƒï¼Œå°†é•œåƒçš„ Dockerfile æäº¤åˆ°ç‰ˆæœ¬åº“ç®¡ç†ã€‚è¿˜å¯ä»¥åœ¨ Docker Hub é‡Œåˆ›å»ºé•œåƒçš„è‡ªåŠ¨æ„å»ºã€‚\nä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡å¦‚ä½•ç¼–å†™ Dockerfile æ¥æ„å»ºä¸€ä¸ª mariadb çš„é•œåƒï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¦‚ docker-mariadb ï¼Œç„¶åç¼–å†™ä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nFROM opensuse:13.2 MAINTAINER Mengz You \u0026lt;you.mengz@yahoo.com\u0026gt; ENV MARIADB_MAJOR 10.0 ENV MARIADB_VERSION 10.0.17 ENV MYSQL_ROOT_PASSWORD mysecretpassword ENV MYSQL_DATADIR /var/lib/mysql RUN zypper ar -f -r http://download.opensuse.org/repositories/server:/database/openSUSE_13.2/server:database.repo \\ \u0026amp;\u0026amp; zypper -n --gpg-auto-import-keys ref RUN zypper -n in --no-recommends mariadb-$MARIADB_VERSION net-tools \\ \u0026amp;\u0026amp; zypper clean --all RUN mkdir -p /var/lib/mysql \\ \u0026amp;\u0026amp; mkdir -p /var/log/mysql \\ \u0026amp;\u0026amp; chown mysql:mysql /var/log/mysql VOLUME /var/lib/mysql COPY docker-entrypoint.sh / ENTRYPOINT [\u0026#34;/docker-entrypoint.sh\u0026#34;] EXPOSE 3306 CMD [\u0026#34;mysqld_safe\u0026#34;] è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸Šé¢çš„ Dockerfile é‡Œç”¨åˆ°çš„æŒ‡ä»¤ï¼š\nFROM ï¼š æŒ‡æ˜ç”¨æ¥æ„å»ºè¯¥é•œåƒçš„åŸºç¡€é•œåƒï¼Œè¯¥ç¤ºä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨ Docker Hub å®˜æ–¹çš„ opensuse é•œåƒï¼Œæ ¼å¼ä¸º image[:tag] ï¼› MAINTAINER ï¼š æŒ‡æ˜è¯¥ Dockerfile çš„ç»´æŠ¤è€…ï¼› ENV ï¼š è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œåé¢çš„å‘½ä»¤å¯ä»¥ä½¿ç”¨è¿™äº›å˜é‡ã€‚ä¹Ÿå¯ä»¥åœ¨å¯åŠ¨å®¹å™¨æ—¶æ”¹å˜å…¶å€¼ï¼› RUN ï¼š æ‰§è¡Œå‘½ä»¤ï¼Œæ¯”å¦‚è®¾ç½®è½¯ä»¶æºï¼Œå®‰è£…ç›¸åº”çš„è½¯ä»¶åŒ…ï¼Œåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå°†ä¼šåœ¨æ„å»ºé•œåƒçš„æ—¶å€™å®‰è£… Mariadb çš„åŒ…ï¼Œç„¶åé…ç½®ä¸€äº›ä½¿ç”¨çš„ç›®å½•ï¼› VOLUME ï¼š è®¾ç½®ç›®å½•å·ï¼Œä½¿å¾—åœ¨è¿è¡Œå®¹å™¨çš„æ—¶å€™å¯ä»¥é€šè¿‡ -v å‚æ•°æ¥æŒ‡å®šæŒ‚è½½å’Œä¸»æœºåŒæ­¥çš„ç›®å½•ï¼› COPY ï¼š å°†æ„å»ºç›®å½•ä¸‹çš„è„šæœ¬æ”¾åˆ°é•œåƒé‡Œï¼Œç„¶åå¯ä»¥åœ¨å®¹å™¨ä¸­æ‰§è¡Œã€‚ä¸Šä¾‹ä¸­ï¼Œdocker-entrypoint.sh å°†åœ¨å¯åŠ¨å®¹å™¨æ—¶ä½œä¸ºå®¹å™¨å…¥å£ç‚¹æ‰§è¡Œï¼› ENTRYPOINT ï¼š é…ç½®å®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œæ¯ä¸ª Dockerfile ä¸­ä¹‹åº”è¯¥åªæœ‰ä¸€ä¸ª ENTRYPOINT ï¼› EXPOSE ï¼š é…ç½®å®¹å™¨æš´éœ²çš„æœåŠ¡ç«¯å£å·ï¼Œåœ¨å¯åŠ¨å®¹å™¨æ—¶ï¼Œå¦‚æœä½¿ç”¨ -P å‚æ•°ï¼ŒDocker ä¸»æœºå°†ä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªéšæœºç«¯å£è½¬å‘åˆ°åˆ¶å®šçš„ç«¯å£ï¼Œä¹Ÿå¯ä»¥é¢ä½¿ç”¨ -p åˆ¶å®šä¸»æœºçš„å…·ä½“ç«¯å£ï¼› CMD ï¼š ä¹Ÿæ˜¯å¯ä»¥åˆ¶å®šå®¹å™¨å¯åŠ¨æ—¶æ‰§è¡Œçš„å‘½ä»¤ï¼Œå…¶å’Œ ENTRYPOINT çš„åŒºåˆ«æ˜¯ï¼Œå…¶å¯ä»¥ä½œä¸º ENTRYPOINT çš„å‚æ•°ï¼Œå¦‚ä¸Šä¾‹ä¸­å¯åŠ¨å®¹å™¨æ—¶ï¼Œå…¶å®æ‰§è¡Œçš„æ˜¯ /docker-entrypint.sh mysqld_safeã€‚è¿˜æœ‰ä¸€ä¸ªåŒºåˆ«å°±æ˜¯ ENTRYPOINT åˆ¶å®šçš„å‘½ä»¤ä¸èƒ½è¢«å¯åŠ¨å®¹å™¨æ—¶çš„å‘½ä»¤è¦†ç›–ï¼Œè€Œ CMD æŒ‡å®šçš„å¯ä»¥è¢«è¦†ç›–ã€‚ ä»¥ä¸Šæ˜¯æœ¬ç¤ºä¾‹ä¸­ç”¨çš„æŒ‡ä»¤ï¼Œå…¶å® Dockerfile è¿˜æœ‰å…¶ä»–æŒ‡ä»¤ï¼Œè¯·å‚è€ƒ Dockerfile çš„æ–‡æ¡£ã€‚\nç”±äºæœ¬ä¾‹ä¸­æˆ‘ä»¬ä½¿ç”¨åˆ°äº†ä¸€ä¸ªè„šæœ¬æ¥ä½œä¸ºå®¹å™¨çš„å…¥å£å‘½ä»¤ï¼Œå› æ­¤è¿˜éœ€è¦åœ¨å½“å‰ç›®å½•ä¸‹å†™è¯¥è„šæœ¬æ–‡ä»¶ docker-entrypoint.sh ï¼š\n#!/bin/bash set -e if [ ! -d \u0026#34;$MYSQL_DATADIR/mysql\u0026#34; ]; then echo \u0026#39;Running mysql_install_db ...\u0026#39; mysql_install_db --datadir=\u0026#34;$MYSQL_DATADIR\u0026#34; echo \u0026#39;Finished mysql_install_db\u0026#39; tempSqlFile=\u0026#39;/tmp/mysql-first-time.sql\u0026#39; cat \u0026gt; \u0026#34;$tempSqlFile\u0026#34; \u0026lt;\u0026lt;-EOSQL DELETE FROM mysql.user ; CREATE USER \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;${MYSQL_ROOT_PASSWORD}\u0026#39; ; GRANT ALL ON *.* TO \u0026#39;root\u0026#39;@\u0026#39;%\u0026#39; WITH GRANT OPTION ; DROP DATABASE IF EXISTS test ; EOSQL if [ \u0026#34;$MYSQL_DATABASE\u0026#34; ]; then echo \u0026#34;CREATE DATABASE IF NOT EXISTS \\`$MYSQL_DATABASE\\` ;\u0026#34; \u0026gt;\u0026gt; \u0026#34;$tempSqlFile\u0026#34; fi if [ \u0026#34;$MYSQL_USER\u0026#34; -a \u0026#34;$MYSQL_PASSWORD\u0026#34; ]; then echo \u0026#34;CREATE USER \u0026#39;$MYSQL_USER\u0026#39;@\u0026#39;%\u0026#39; IDENTIFIED BY \u0026#39;$MYSQL_PASSWORD\u0026#39; ;\u0026#34; \u0026gt;\u0026gt; \u0026#34;$tempSqlFile\u0026#34; if [ \u0026#34;$MYSQL_DATABASE\u0026#34; ]; then echo \u0026#34;GRANT ALL ON \\`$MYSQL_DATABASE\\`.* TO \u0026#39;$MYSQL_USER\u0026#39;@\u0026#39;%\u0026#39; ;\u0026#34; \u0026gt;\u0026gt; \u0026#34;$tempSqlFile\u0026#34; fi fi echo \u0026#39;FLUSH PRIVILEGES ;\u0026#39; \u0026gt;\u0026gt; \u0026#34;$tempSqlFile\u0026#34; set -- \u0026#34;$@\u0026#34; --init-file=\u0026#34;$tempSqlFile\u0026#34; fi chown -R mysql:mysql \u0026#34;$MYSQL_DATADIR\u0026#34; exec \u0026#34;$@\u0026#34; è¯¥è„šæœ¬é€šè¿‡ç›¸åº”çš„ç¯å¢ƒå˜é‡æ¥åˆå§‹åŒ– mariadb å®ä¾‹ï¼Œåé¢æˆ‘ä»¬ä¼šç»™å‡ºå®¹å™¨è¿è¡Œçš„å‘½ä»¤ç¤ºä¾‹ã€‚\næœ€åï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡åœ¨å½“å‰ç›®å½•ä¸‹æ‰§è¡Œ docker build å‘½ä»¤æ¥æ„å»ºé•œåƒï¼Œå¦‚ï¼š\ndocker build -t docker-mariadb:latest .\nå¦‚æœæœ¬åœ°æ²¡æœ‰ opensuse çš„é•œåƒï¼Œé¦–å…ˆä¼šä¸‹è½½ opensuse çš„é•œåƒï¼Œç„¶åä¼šåŸºäº opensuse çš„é•œåƒï¼Œè¿è¡Œ Dockerfile é‡ŒæŒ‡å®šçš„å‘½ä»¤ï¼Œæœ€åä¼šç”Ÿæˆ docker-mariadb:latest é•œåƒï¼Œå¯ä»¥é€šè¿‡ docker images çœ‹åˆ°ã€‚\nè¿è¡ŒMariadbå®¹å™¨ é•œåƒç”Ÿæˆåï¼Œå¦‚ä½•æ¥è¿è¡Œè¯¥é•œåƒçš„å®¹å™¨å‘¢ï¼Ÿé€šè¿‡ä¸Šé¢çš„è„šæœ¬ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åœ¨å¯åŠ¨å®¹å™¨æ—¶å¯ä»¥æŒ‡å®šç›¸åº”çš„ç¯å¢ƒå˜é‡ï¼Œå¦‚ï¼š\ndocker run --name mydb -e MYSQL_USER=test -e MYSQL_PASSWORD=testpw -e MYSQL_DATABASE=testdb -p 13306:3306 -d docker-mariadb:latest\nè¯¥å‘½ä»¤ä¼šå¯åŠ¨ä¸€ä¸ªè¯¥é•œåƒçš„å®¹å™¨ï¼Œåä¸º \u0026lsquo;mydb\u0026rsquo;ï¼Œå®¹å™¨ä¸­çš„ mariadb ä¼šåœ¨å¯åŠ¨æ—¶åˆ›å»ºåä¸º \u0026rsquo;testdb\u0026rsquo; çš„æ•°æ®åº“å®ä¾‹ï¼Œåä¸º \u0026rsquo;test\u0026rsquo; çš„æ•°æ®åº“ç”¨æˆ·ï¼Œå…¶å¯†ç ä¸º \u0026rsquo;testpw\u0026rsquo;ã€‚\nè¿™æ—¶ä½ å°±å¯ä»¥é€šè¿‡åœ¨ä¸»æœºä¸Šè¿è¡Œä¸€ä¸‹å‘½ä»¤æ¥å°è¯•ç™»å½•æ•°æ®åº“äº†ï¼š\nmysql -h127.0.0.1 -P13306 -utest -ptestpw testdb\næ˜¯ä¸æ˜¯æ„Ÿè§‰é€šè¿‡ Dockerfile æ¥æ„å»º Docker é•œåƒæ˜¯å¦‚æ­¤çš„ç®€å•ã€‚æœ€åä½ å¯ä»¥å°†è¯¥ç›®å½•ä½œä¸ºä¸€ä¸ªé¡¹ç›® push åˆ° Githubï¼Œç„¶ååœ¨åˆ° Docker Hub å»åˆ›å»ºä¸€ä¸ªä»“åº“ï¼Œç„¶åé…ç½®åˆ° Github ä»£ç åº“ï¼Œæ¯å½“ä½  push æ›´æ–° Dockerfile åï¼Œéƒ½ä¼šè‡ªåŠ¨æ„å»ºé•œåƒã€‚å°±åƒæˆ‘çš„é•œåƒåº“ä¸€æ ·ï¼Œå½“ç„¶åœ¨ Docker Hub é‡Œè¿˜æœ‰æ¥è‡ªå…¨ä¸–ç•Œäººä»¬æ„å»ºçš„é•œåƒã€‚\n","date":"May 27, 2015","hero":"/zh/posts/container-tech/mariadb-docker/mariadb-docker.png","permalink":"/zh/posts/container-tech/mariadb-docker/","summary":"ç°åœ¨ Docker å¯æ‰€è°“æ˜¯æœ€ç«çš„å®¹å™¨æŠ€æœ¯äº†ï¼Œè‡³äºä»€ä¹ˆæ˜¯ Dockerï¼Œè¯·åˆ°å…¶å®˜æ–¹ç½‘ç«™æˆ–è€…ç»´åŸºç™¾ç§‘æŸ¥çœ‹ã€‚\nè¿™é‡Œæƒ³é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥çœ‹çœ‹æ€ä¹ˆé€šè¿‡ Dockerfile æ¥æ„å»ºä¸€ä¸ª Docker é•œåƒã€‚\næ„å»ºMariaDBå®¹å™¨é•œåƒ Docker æä¾›äº†ä¸¤ç§æ–¹æ³•æ¥ç”Ÿäº§åº”ç”¨é•œåƒ:\né€šè¿‡å¯åŠ¨ä¸€ä¸ªåŸºç¡€å®¹å™¨ï¼ˆæ¯”å¦‚åŸºäºæŸç§ Linux å‘è¡Œç‰ˆçš„é•œåƒçš„å®¹å™¨ï¼‰ï¼Œç„¶ååœ¨å®¹å™¨é‡Œæ‰§è¡Œå„ç§å‘½ä»¤æ¥å®‰è£…ç›¸åº”çš„è½¯ä»¶åŒ…ï¼Œè¿›è¡Œé…ç½®åï¼Œå†é€šè¿‡ docker commit å‘½ä»¤æŠŠå·²ç»æ›´æ–°çš„å®¹å™¨ç”Ÿäº§ç›¸åº”çš„é•œåƒã€‚ é€šè¿‡ç¼–å†™ä¸€ä¸ª Dockerfile ï¼Œç„¶åä½¿ç”¨ docker build å‘½ä»¤æ¥æ„å»ºç›¸åº”çš„é•œåƒã€‚ ç›¸æ¯”ç¬¬ä¸€ç§æ–¹å¼ï¼Œé€šè¿‡ Dockerfile çš„æ–¹å¼ï¼Œå¯ä»¥æ›´å¥½çš„ç»´æŠ¤é•œåƒï¼Œå°†é•œåƒçš„ Dockerfile æäº¤åˆ°ç‰ˆæœ¬åº“ç®¡ç†ã€‚è¿˜å¯ä»¥åœ¨ Docker Hub é‡Œåˆ›å»ºé•œåƒçš„è‡ªåŠ¨æ„å»ºã€‚\nä¸‹é¢è®©æˆ‘ä»¬é€šè¿‡å¦‚ä½•ç¼–å†™ Dockerfile æ¥æ„å»ºä¸€ä¸ª mariadb çš„é•œåƒï¼š\né¦–å…ˆåˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œå¦‚ docker-mariadb ï¼Œç„¶åç¼–å†™ä¸€ä¸ªåä¸º Dockerfile çš„æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š\nFROM opensuse:13.2 MAINTAINER Mengz You \u0026lt;you.mengz@yahoo.com\u0026gt; ENV MARIADB_MAJOR 10.0 ENV MARIADB_VERSION 10.0.17 ENV MYSQL_ROOT_PASSWORD mysecretpassword ENV MYSQL_DATADIR /var/lib/mysql RUN zypper ar -f -r http://download.opensuse.org/repositories/server:/database/openSUSE_13.2/server:database.repo \\ \u0026amp;\u0026amp; zypper -n --gpg-auto-import-keys ref RUN zypper -n in --no-recommends mariadb-$MARIADB_VERSION net-tools \\ \u0026amp;\u0026amp; zypper clean --all RUN mkdir -p /var/lib/mysql \\ \u0026amp;\u0026amp; mkdir -p /var/log/mysql \\ \u0026amp;\u0026amp; chown mysql:mysql /var/log/mysql VOLUME /var/lib/mysql COPY docker-entrypoint.","tags":["docker","mariadb"],"title":"DOCKERæ„å»ºMariaDB"},{"categories":["Linux"],"contents":"åŸºäº systemd çš„ Linux ç³»ç»Ÿä¸­æä¾›äº†ä¸€ä¸ªæ–°çš„åæ¥ hostnamectl æ¥ç®¡ç†ç³»ç»Ÿä¸»æœºåã€‚\nå½“ç„¶é™¤äº† hostnamectl ä¹‹å¤–ï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡åŸæ¥çš„ hostname å‘½ä»¤ä»¥åŠä¿®æ”¹ /etc/HOSTNAME æ¥ä¿®æ”¹ä¸»æœºåã€‚ä¸è¿‡ä½¿ç”¨ hostnamectl æ›´æ–¹ä¾¿ã€‚\nhostnamectlçš„è¯­æ³• hostnamectl [OPTIONS...] {COMMAND}\næœ‰å¦‚ä¸‹ options :\n\u0026ndash;static,\u0026ndash;transient,\u0026ndash;pretty å¦‚æœç”¨äº status å‘½ä»¤ï¼Œstatic æ˜¾ç¤ºå½“å‰çš„é™æ€ä¸»æœºå; transient æ˜¾ç¤ºä¸´æ—¶çš„ä¸»æœºåï¼Œä¸€èˆ¬ç”¨äºç½‘ç»œä¸´æ—¶è®¾ç½®; pretty æ˜¾ç¤ºè‰¯å¥½é˜…è¯»ä¸»æœºåï¼Œå¦‚\u0026quot;Sam\u0026rsquo;s Computer\u0026quot;ã€‚ H, \u0026ndash;host=user@hostname ç”¨æ¥æ“ä½œè¿œç¨‹ä¸»æœºã€‚ å‘½ä»¤ï¼š\nstatus ï¼š æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸»æœºåå’Œç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ \u0026ndash;static, \u0026ndash;transient, \u0026ndash;pretty ä»…æ˜¾ç¤ºæŒ‡å®šå†…å®¹ã€‚ set-hostname [NAME] ï¼š è®¾ç½®ç³»ç»Ÿä¸»æœºåï¼Œé»˜è®¤æ”¹å˜ prettyï¼Œstaticï¼ŒåŠ transient ã€‚ æŒ‡å®šç›¸åº”é€‰é¡¹åªæ”¹å˜ç›¸åº”ä¸»æœºåã€‚ set-icon-name [NAME] ï¼š è®¾ç½®ç³»ç»Ÿ Icon åï¼Œç”¨äºä¸€äº›å›¾å½¢åº”ç”¨æ¥å¯è§†åŒ–ä¸»æœºã€‚Icon åéœ€è¦ç¬¦åˆ Icon åè§„èŒƒã€‚ set-chassis [TYPE] ï¼š è®¾ç½® chassis ç±»å‹ï¼Œç”¨äºä¸€äº›å›¾å½¢åº”ç”¨æ¥å¯è§†åŒ–ä¸»æœºæˆ–è€…æ”¹å˜ç”¨æˆ·ç•Œé¢ã€‚å½“å‰è®¾ç½®ä»¥ä¸‹ç±»å‹ï¼š\u0026ldquo;desktop\u0026rdquo;ï¼Œ\u0026ldquo;laptop\u0026rdquo;ï¼Œ\u0026ldquo;server\u0026rdquo;ï¼Œ\u0026ldquo;tablet\u0026rdquo;ï¼Œ\u0026ldquo;handset\u0026rdquo;ï¼Œè¿˜æœ‰ \u0026ldquo;vm\u0026rdquo; å’Œ \u0026ldquo;container\u0026rdquo;ã€‚ ç¤ºä¾‹ æŸ¥çœ‹å½“å‰ä¸»æœºååŠç›¸å…³ä¿¡æ¯ï¼š $sudo hostnamectl status\nStatic hostname: mengz-dev.me\nIcon name: computer-laptop\nChassis: laptop\nMachine ID: 74fc18841ff54a7f8e09f6b58d4bad53\nBoot ID: ee3d24a9c1db41cf8f2696aeea513009\nOperating System: openSUSE 13.2 (Harlequin) (x86_64)\nCPE OS Name: cpe:/o:opensuse:opensuse:13.2\nKernel: Linux 3.16.7-21-desktop\nArchitecture: x86-64\nè®¾ç½®/æ”¹å˜é™æ€ä¸»æœºåï¼š $sudo hostnamectl set-hostname example-host.com\næ€»ä¹‹ï¼Œç›¸æ¯”ä½¿ç”¨ hostname å’Œä¿®æ”¹é…ç½®æ–‡ä»¶çš„æ–¹å¼ï¼Œä½¿ç”¨ hostnamectl æ›´æ–¹ä¾¿ã€‚\n","date":"May 17, 2015","hero":"/zh/posts/linux/systemd-hostnamectl/systemd-hostname.jpg","permalink":"/zh/posts/linux/systemd-hostnamectl/","summary":"åŸºäº systemd çš„ Linux ç³»ç»Ÿä¸­æä¾›äº†ä¸€ä¸ªæ–°çš„åæ¥ hostnamectl æ¥ç®¡ç†ç³»ç»Ÿä¸»æœºåã€‚\nå½“ç„¶é™¤äº† hostnamectl ä¹‹å¤–ï¼Œè¿˜æ˜¯å¯ä»¥é€šè¿‡åŸæ¥çš„ hostname å‘½ä»¤ä»¥åŠä¿®æ”¹ /etc/HOSTNAME æ¥ä¿®æ”¹ä¸»æœºåã€‚ä¸è¿‡ä½¿ç”¨ hostnamectl æ›´æ–¹ä¾¿ã€‚\nhostnamectlçš„è¯­æ³• hostnamectl [OPTIONS...] {COMMAND}\næœ‰å¦‚ä¸‹ options :\n\u0026ndash;static,\u0026ndash;transient,\u0026ndash;pretty å¦‚æœç”¨äº status å‘½ä»¤ï¼Œstatic æ˜¾ç¤ºå½“å‰çš„é™æ€ä¸»æœºå; transient æ˜¾ç¤ºä¸´æ—¶çš„ä¸»æœºåï¼Œä¸€èˆ¬ç”¨äºç½‘ç»œä¸´æ—¶è®¾ç½®; pretty æ˜¾ç¤ºè‰¯å¥½é˜…è¯»ä¸»æœºåï¼Œå¦‚\u0026quot;Sam\u0026rsquo;s Computer\u0026quot;ã€‚ H, \u0026ndash;host=user@hostname ç”¨æ¥æ“ä½œè¿œç¨‹ä¸»æœºã€‚ å‘½ä»¤ï¼š\nstatus ï¼š æ˜¾ç¤ºå½“å‰ç³»ç»Ÿä¸»æœºåå’Œç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥ä½¿ç”¨ \u0026ndash;static, \u0026ndash;transient, \u0026ndash;pretty ä»…æ˜¾ç¤ºæŒ‡å®šå†…å®¹ã€‚ set-hostname [NAME] ï¼š è®¾ç½®ç³»ç»Ÿä¸»æœºåï¼Œé»˜è®¤æ”¹å˜ prettyï¼Œstaticï¼ŒåŠ transient ã€‚ æŒ‡å®šç›¸åº”é€‰é¡¹åªæ”¹å˜ç›¸åº”ä¸»æœºåã€‚ set-icon-name [NAME] ï¼š è®¾ç½®ç³»ç»Ÿ Icon åï¼Œç”¨äºä¸€äº›å›¾å½¢åº”ç”¨æ¥å¯è§†åŒ–ä¸»æœºã€‚Icon åéœ€è¦ç¬¦åˆ Icon åè§„èŒƒã€‚ set-chassis [TYPE] ï¼š è®¾ç½® chassis ç±»å‹ï¼Œç”¨äºä¸€äº›å›¾å½¢åº”ç”¨æ¥å¯è§†åŒ–ä¸»æœºæˆ–è€…æ”¹å˜ç”¨æˆ·ç•Œé¢ã€‚å½“å‰è®¾ç½®ä»¥ä¸‹ç±»å‹ï¼š\u0026ldquo;desktop\u0026rdquo;ï¼Œ\u0026ldquo;laptop\u0026rdquo;ï¼Œ\u0026ldquo;server\u0026rdquo;ï¼Œ\u0026ldquo;tablet\u0026rdquo;ï¼Œ\u0026ldquo;handset\u0026rdquo;ï¼Œè¿˜æœ‰ \u0026ldquo;vm\u0026rdquo; å’Œ \u0026ldquo;container\u0026rdquo;ã€‚ ç¤ºä¾‹ æŸ¥çœ‹å½“å‰ä¸»æœºååŠç›¸å…³ä¿¡æ¯ï¼š $sudo hostnamectl status","tags":["systemd","hostname","opensuse"],"title":"HOSTNAMECTLç®¡ç†ä¸»æœºå"},{"categories":["Linux"],"contents":"è‡ªå·±åœ¨ä½¿ç”¨ opensuseï¼Œè‡ªå·±éå¸¸å–œæ¬¢ opensuse çš„åŒ…ç®¡ç†å‘½ä»¤è¡Œå·¥å…· zypperã€‚è¿™é‡Œåšä¸€ä¸ªç¬”è®°ï¼Œä¹Ÿå¸Œæœ›èƒ½çœ‹åˆ°è¿™ä¸ªç¯‡æ–‡ç« çš„æœ‹å‹èƒ½å¤Ÿå¿«é€Ÿåœ°æŒæ¡ zypper çš„ç”¨æ³•ã€‚\nCentOS å’Œ Redhat ä½¿ç”¨çš„æ˜¯ yum ä½œä¸ºå‘½ä»¤è¡Œçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚\nDebian å’Œ Ubuntu ä½¿ç”¨çš„æ˜¯ apt-getã€‚\nåœ¨ Debian/Ubuntu ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å·¥å…· - aptitude ã€‚\nåŒæ ·ï¼Œåœ¨ SUSE/opensuse Linux ä¸Šï¼Œzypper å°±æ˜¯å…¶å‘½ä»¤è¡Œçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚\nä»é«˜å±‚æ¬¡çš„è§’åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ zypper å‘½ä»¤ç®¡ç†ä¸¤ç§ä¸åŒçš„ä¸œè¥¿ï¼š\nç®¡ç†è½¯ä»¶åŒ…ï¼š ä½¿ç”¨ zypper æ¥å®‰è£…ï¼Œåˆ é™¤ï¼Œæ›´æ–°ä»¥åŠæŸ¥è¯¢æœ¬åœ°çš„æˆ–è€…è¿œç«¯åª’ä½“ä¸Šçš„è½¯ä»¶åŒ…ã€‚ ç®¡ç†è½¯ä»¶æºï¼š ä¹Ÿå¯ä»¥ä½¿ç”¨ zypper ç®¡ç†è½¯ä»¶æºä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œæ·»åŠ ï¼Œåˆ é™¤ï¼Œæ‰“å¼€æˆ–è€…å…³é—­æŸä¸ªè½¯ä»¶æºã€‚å®ƒè¿˜å¯ä»¥è®¾ç½®åœ¨å®‰è£…è¿‡ç¨‹ä¸­è½¯ä»¶æºçš„ä¼˜å…ˆçº§ã€‚ I. ä½¿ç”¨ zypper ç®¡ç†è½¯ä»¶åŒ… 1. å®‰è£…è½¯ä»¶åŒ… ä½¿ç”¨å¦‚ä¸‹è¯­æ³•å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼š\nzypper install \u0026lt;package name\u0026gt;\nå¦‚ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤æ¥å®‰è£… ç«ç‹æµè§ˆå™¨ å’Œå®ƒçš„ä¾èµ–ï¼š\n# zypper install MozillaFirefox Loading repository data... Reading installed packages... Resolving package dependencies... The following NEW packages are going to be installed: MozillaFirefox MozillaFirefox-branding-SLED The following packages are not supported by their vendor: MozillaFirefox MozillaFirefox-branding-SLED 2 new packages to install. Overall download size: 964.0 KiB. After the operation, additional 3.4 MiB will be used. Continue? [y/n/?] (y): y Retrieving package MozillaFirefox-3.6.16-0.2.1.x86_64 (1/2), 949.0 KiB (3.4 MiB unpacked) Retrieving: MozillaFirefox-3.6.16-0.2.1.x86_64.rpm [done] Installing: MozillaFirefox-3.6.16-0.2.1 [done] Retrieving package MozillaFirefox-branding-SLED-3.5-1.1.5.x86_64 (2/2), 15.0 KiB (34.0 KiB unpacked) Retrieving: MozillaFirefox-branding-SLED-3.5-1.1.5.x86_64.rpm [done] Installing: MozillaFirefox-branding-SLED-3.5-1.1.5 [done] 2. å®‰è£…æºä»£ç åŒ… ä½¿ç”¨ source-install é€‰é¡¹æ¥ä»è½¯ä»¶æºå®‰è£…æºä»£ç åŒ…ï¼Œå¦‚ä¸‹ï¼š\n# zypper source-install apache2-mod_nss Reading installed packages... Loading repository data... Resolving package dependencies... Retrieving package mozilla-nss-devel-3.12.8-1.2.1.x86_64 (2/3), 473.0 KiB (2.6 MiB unpacked) Retrieving: mozilla-nss-devel-3.12.8-1.2.1.x86_64.rpm [done] Installing: mozilla-nss-devel-3.12.8-1.2.1 [done] Retrieving: apache2-mod_nss-1.0.8-17.5.src.rpm [done] 3. æ›´æ–°è½¯ä»¶åŒ… ä¸€æ—¦å®‰è£…äº†ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œå½“æœ‰å¯ç”¨çš„æ–°ç‰ˆæœ¬æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨æ›´æ–°å‘½ä»¤æ¥å‡çº§ç›¸åº”çš„è½¯ä»¶åŒ…ã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä»…ä»…æ›´æ–°ç«ç‹æµè§ˆå™¨è½¯ä»¶åŒ…ï¼š\nzypper update MozillaFirefox\nè€Œä¸‹é¢çš„ç¤ºä¾‹å°†å‡çº§å®‰è£…åœ¨ç³»ç»Ÿä¸Šçš„æ‰€æœ‰å¯æ›´æ–°çš„è½¯ä»¶åŒ…åˆ°å…¶æœ€æ–°ç‰ˆæœ¬ï¼š\nzypper update\nä½ ä¹Ÿå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æ¥æŸ¥çœ‹æ‰€æœ‰çš„å¯ç”¨æ›´æ–°ï¼š\nzypper list-updates\n4. ç³»ç»Ÿå‘è¡Œç‰ˆçš„å‡çº§ è¦åœ¨ç³»ç»Ÿä¸Šæ‰§è¡Œå®Œæ•´çš„å‘è¡Œç‰ˆå‡çº§ï¼Œåƒä¸‹é¢ä¸€æ ·ä½¿ç”¨ dup é€‰é¡¹ï¼š\n# zypper dup Warning: You are about to do a distribution upgrade with all enabled repositories. Make sure these repositories are compatible before you continue. See \u0026#39;man zypper\u0026#39; for more information about this command. Loading repository data... Reading installed packages... Computing distribution upgrade... The following NEW packages are going to be installed: drbd-xen libsoftokn3-32bit mozilla-nspr-32bit mozilla-nss-32bit mozilla-nss-certs-32bit suseRegister xen yast2-registration yast2-registration-branding-SLE The following packages are going to be upgraded: libfreebl3-32bit libnsssharedhelper0 libnsssharedhelper0-32bit The following packages are going to change vendor: libfreebl3-32bit SUSE LINUX Products GmbH, Nuernberg, Germany -\u0026gt; openSUSE Build Service libnsssharedhelper0 SUSE LINUX Products GmbH, Nuernberg, Germany -\u0026gt; openSUSE Build Service libnsssharedhelper0-32bit SUSE LINUX Products GmbH, Nuernberg, Germany -\u0026gt; openSUSE Build Service 5. åˆ é™¤è½¯ä»¶åŒ… è¦åˆ é™¤è½¯ä»¶åŒ…ï¼Œä½¿ç”¨ remove å‘½ä»¤é€‰é¡¹ï¼Œè¿™ä¹Ÿä¼šåˆ é™¤æ‰æ‰€æœ‰çš„ä¾èµ–ã€‚\n# zypper remove MozillaFirefox Loading repository data... Reading installed packages... Resolving package dependencies... The following packages are going to be REMOVED: MozillaFirefox MozillaFirefox-branding-SLED 2 packages to remove. After the operation, 3.4 MiB will be freed. Continue? [y/n/?] (y): y Removing MozillaFirefox-branding-SLED-3.5-1.1.5 [done] Removing MozillaFirefox-3.6.16-0.2.1 [done] 6. æœç´¢ä¸€ä¸ªæŒ‡å®šçš„è½¯ä»¶åŒ… è¦ä»è½¯ä»¶æºæœç´¢ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚ä½ ä¹Ÿå¯ä»¥åœ¨å…³é”®å­—ä¸­ä½¿ç”¨é€šé…ç¬¦ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å°†æœç´¢æ‰€æœ‰ä»¥â€œusbâ€å¼€å¤´çš„è½¯ä»¶åŒ…ï¼š\n# zypper search usb* Loading repository data... Reading installed packages... S | Name | Summary | Type --+----------------+----------------------------------------------------------------+-------- | usb_modeswitch | A mode switching tool for controlling multiple-device USB gear | package i | usbutils | Tools and libraries for USB devices | package 7. æŸ¥çœ‹è½¯ä»¶åŒ…è¯¦ç»†ä¿¡æ¯ ä½¿ç”¨ info å‘½ä»¤é€‰é¡¹æ¥æ˜¾ç¤ºä¸€ä¸ªè½¯ä»¶åŒ…çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¦‚ï¼š\n# zypper info usbutils Loading repository data... Reading installed packages... Information for package usbutils: Repository: @System Name: usbutils Version: 0.73-38.19 Arch: x86_64 Vendor: SUSE LINUX Products GmbH, Nuernberg, Germany Support Level: unknown Installed: Yes Status: up-to-date Installed Size: 461.0 KiB Summary: Tools and libraries for USB devices Description: This package contains a utility for inspecting devices connected to USB ports. It requires kernel version 2.3.99-pre7 or newer, or the USB backport which was introduced in 2.2.18 (supporting the /proc/bus/usb interface). 8. å®‰è£…è¡¥ä¸ ä½ å¯ä»¥ä½¿ç”¨ zypper æ¥å®‰è£…è¡¥ä¸åˆ°ä½ ç³»ç»Ÿã€‚\né¦–å…ˆï¼Œä½¿ç”¨ patches å‘½ä»¤é€‰é¡¹æ¥æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„è¡¥ä¸ï¼š\nzypper pathces\nç„¶åï¼Œä½¿ç”¨ pathc å‘½ä»¤é€‰é¡¹æ¥å®‰è£…æŒ‡å®šçš„è¡¥ä¸ï¼š\nzypper patch \u0026lt;patch name\u0026gt;\n9. é”å®šæŒ‡å®šè½¯ä»¶åŒ… åŒ…é”å®šé˜»æ­¢ç³»ç»Ÿä¸Šçš„åŒ…è¢«æ›´æ”¹ã€‚ä¸€æ—¦è®¾ç½®äº†é”ï¼Œä½ ä¸èƒ½åˆ é™¤ï¼Œå‡çº§é”å®šçš„è½¯ä»¶åŒ…ã€‚\nä¸‹é¢çš„ç¤ºä¾‹å±•ç¤ºäº†å¦‚ä½•è®¾ç½®åŒ…é”å®šå’Œåœ¨éœ€è¦çš„æ—¶å€™ç§»é™¤é”ã€‚\nä½¿ç”¨ al å‘½ä»¤é€‰é¡¹æ¥ä¸ºä¸€ä¸ªè½¯ä»¶åŒ…åŠ é”ï¼Œal è¡¨ç¤º â€œAdd Lockâ€\n# zypper al ypbind Specified lock has been successfully added. è¦æ˜¾ç¤ºæ‰€æœ‰è¢«é”å®šçš„è½¯ä»¶åŒ…ï¼Œä½¿ç”¨ ll å‘½ä»¤é€‰é¡¹ï¼Œä»£è¡¨ â€œList Locksâ€ã€‚ä¸‹é¢çš„å‘½ä»¤è¾“å‡ºè¯´æ˜ â€œypbindâ€ è½¯ä»¶åŒ…æ˜¯é”å®šçŠ¶æ€ï¼Œä½ ä¸èƒ½åˆ é™¤å’Œå‡çº§è¯¥åŒ…ã€‚\n# zypper al ypbind Specified lock has been successfully added. # zypper ll # | Name | Type | Repository --+--------+---------+----------- 1 | ypbind | package | (any) 10. ç§»é™¤åŒ…é”å®š ä½¿ç”¨ rl å‘½ä»¤é€‰é¡¹æ¥ç§»é™¤å¯¹ä¸€ä¸ªåŒ…çš„é”å®šï¼Œrl ä»£è¡¨ â€œRemove Lockâ€\n# zypper rl ypbind Loading repository data... Reading installed packages... 1 lock has been successfully removed. ç„¶åå†æ¬¡æŸ¥çœ‹é”å®šçš„åŒ…æ—¶ï¼Œå·²ç»æ²¡æœ‰é”å®šçš„åŒ…äº†\n# zypper ll There are no package locks defined. II. ç®¡ç†è½¯ä»¶æº 11. æ·»åŠ è½¯ä»¶æº ä½¿ç”¨ RUI æ¥æ·»åŠ è½¯ä»¶æºçš„é€šç”¨æ ¼å¼å¦‚ä¸‹ï¼š\nzypper addrepo \u0026lt;options\u0026gt; \u0026lt;URI\u0026gt; \u0026lt;alias\u0026gt;\nä¾‹å¦‚ï¼š\n# zypper addrepo --check --refresh --name \u0026#34;Mozilla-repo\u0026#34; http://download.opensuse.org/repositories/mozilla/SLE_11/ \u0026#34;Mozillarepo\u0026#34; Adding repository \u0026#39;Mozilla-repo\u0026#39; [done] Repository \u0026#39;Mozilla-repo\u0026#39; successfully added Enabled: Yes Autorefresh: Yes URI: http://download.opensuse.org/repositories/mozilla/SLE_11/ 12. åˆ›å»ºä¸€ä¸ªæœ¬åœ°æº ä½ ä¹Ÿå¯ä»¥åœ¨ä½ çš„æœºå™¨ä¸Šä»ä¸€ä¸ªæœ¬åœ°çš„ç›®å½•æ¥åˆ›å»ºä¸€ä¸ªæœ¬åœ°æºï¼Œå¦‚ä¸‹çš„å‘½ä»¤åˆ›å»ºäº†ä¸€ä¸ªå« myrepo çš„æœ¬åœ°æºï¼š\n# zypper addrepo /var/stormgt/dsminst mylocalrepo Adding repository \u0026#39;mylocalrepo\u0026#39; [done] Repository \u0026#39;mylocalrepo\u0026#39; successfully added Enabled: Yes Autorefresh: No URI: dir:///var/stormgt/dsminst # zypper search --repo mylocalrepo Loading repository data... Reading installed packages... S | Name | Summary | Type --+-------------+-----------------------------------------+-------- i | TIVsm-API | the API | package i | TIVsm-API64 | the API | package i | TIVsm-BA | the Backup Archive Client | package i | gskcrypt32 | IBM GSKit Cryptography Runtime | package i | gskcrypt64 | IBM GSKit Cryptography Runtime | package i | gskssl32 | IBM GSKit SSL Runtime With Acme Toolkit | package i | gskssl64 | IBM GSKit SSL Runtime With Acme Toolkit | package ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸Šé¢çš„å‘½ä»¤æ·»åŠ  NFS æˆ–è€… FTP ç›®å½•åˆ°æºã€‚\n13. æŸ¥çœ‹è½¯ä»¶æº å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹é‚£æ‰€æœ‰æ·»åŠ çš„è½¯ä»¶æºï¼š\n# zypper lr # | Alias | Name | Enabled | Refresh --+--------------------------------------------------+--------------------------------------------------+---------+-------- 1 | Mozillarepo | Mozilla-repo | Yes | Yes 2 | SUSE-Linux-Enterprise-Server-11-SP1 11.1.1-1.152 | SUSE-Linux-Enterprise-Server-11-SP1 11.1.1-1.152 | Yes | Yes è¦æŸ¥çœ‹å®Œæ•´çš„ RUI ï¼Œä½¿ç”¨ï¼š\n# zypper lr --uri # | Alias | Name | Enabled | Refresh | URI --+--------------------------------------------------+--------------------------------------------------+---------+---------+---------------------------------------------------------- 1 | Mozillarepo | Mozilla-repo | Yes | Yes | http://download.opensuse.org/repositories/mozilla/SLE_11/ 2 | SUSE-Linux-Enterprise-Server-11-SP1 11.1.1-1.152 | SUSE-Linux-Enterprise-Server-11-SP1 11.1.1-1.152 | Yes | Yes | http://19.106.65.64/FUSELinux/600RC0 14. åœ¨æŒ‡å®šçš„æºé‡Œæœç´¢è½¯ä»¶åŒ… åƒåˆ—å‡ºä¸€ä¸ªè½¯ä»¶æºé‡Œçš„æ‰€æœ‰è½¯ä»¶åŒ…ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š\n# zypper search --repo Mozillarepo Loading repository data... Reading installed packages... S | Name | Summary | Type --+--------------------------------------+-------------------------------------------------------------------------+----------- i | MozillaFirefox | Mozilla Firefox Web Browser | package i | MozillaFirefox-branding-SLED | SLED branding of MozillaFirefox | package | MozillaFirefox-branding-openSUSE | openSUSE branding of MozillaFirefox | package | MozillaFirefox-branding-openSUSE | openSUSE branding of MozillaFirefox 15. é‡å‘½åä¸€ä¸ªè½¯ä»¶æº ä½¿ç”¨ renamerepo å‘½ä»¤é€‰é¡¹æ¥é‡å‘½åä¸€ä¸ªè½¯ä»¶æºã€‚\nä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œåä¸º â€œmylocalrepoâ€ çš„è½¯ä»¶æºè¢«é‡å‘½åä¸º â€œLOCALRPM-Repoâ€\n# zypper renamerepo mylocalrepo LOCALRPM-Repo Repository \u0026#39;mylocalrepo\u0026#39; renamed to \u0026#39;LOCALRPM-Repo\u0026#39;. 16. åˆ é™¤è½¯ä»¶æº ä½¿ç”¨ removerepo å‘½ä»¤é€‰é¡¹æ¥åˆ é™¤è½¯ä»¶æºï¼š\n# zypper removerepo LOCALRPM-Repo Removing repository \u0026#39;mylocalrepo\u0026#39; [done] Repository \u0026#39;mylocalrepo\u0026#39; has been removed. 17. å¤‡ä»½è½¯ä»¶æº å¯ä»¥ä½¿ç”¨ lr å‘½ä»¤çš„ export é€‰é¡¹æ¥å°†æ‰€æœ‰æ·»åŠ çš„è½¯ä»¶æºå¤‡ä»½åˆ°ä¸€ä¸ªæ–‡ä»¶ï¼š\n# zypper lr --export /var/tmp/backup.repo Repositories have been successfully exported to /var/tmp/backup.repo. 18. ä»å¤‡ä»½æ·»åŠ è½¯ä»¶æº å¦‚æœä½ æœ‰ä¹‹å‰å¯¼å‡ºçš„è½¯ä»¶æºå¤‡ä»½æ–‡ä»¶ï¼Œé‚£å¯ä»¥ä½¿ç”¨ addrepo å‘½ä»¤æ¥æ·»åŠ å¤‡ä»½çš„è½¯ä»¶æºï¼š\nzypper addrepo /var/tmp/backup.repo\n19. æ‰“å¼€æˆ–å…³é—­è½¯ä»¶æº å¯ä»¥ä½¿ç”¨ modifyrepo å‘½ä»¤çš„ -d é€‰é¡¹æ¥å…³é—­ä¸€ä¸ªè½¯ä»¶æºï¼š\n# zypper modifyrepo -d Mozillarepo Repository \u0026#39;Mozillarepo\u0026#39; has been successfully disabled. ä½¿ç”¨ -e é€‰é¡¹æ¥æ‰“å¼€ä¸€ä¸ªå…³é—­çš„è½¯ä»¶æºï¼š\n# zypper modifyrepo -e Mozillarepo Repository \u0026#39;Mozillarepo\u0026#39; has been successfully enabled. 20. åˆ·æ–°è½¯ä»¶æº å½“è½¯ä»¶æºè¿‡æœŸæ—¶ï¼Œåˆ·æ–°è½¯ä»¶æºæ˜¯éå¸¸é‡è¦çš„ã€‚ä½ å¯ä»¥åƒä¸‹é¢ä¸€æ ·æ‰§è¡Œä¸€ä¸ªæ‰‹åŠ¨çš„åˆ·æ–°ï¼Œä¹Ÿå¯ä»¥è®¾ç½®å½“éœ€è¦æ—¶è‡ªåŠ¨åˆ·æ–°ï¼š\n# zypper refresh Mozillarepo Repository \u0026#39;Mozilla-repo\u0026#39; is up to date. Specified repositories have been refreshed. ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æ¥è®¾ç½®è‡ªåŠ¨åˆ·æ–°ï¼š\n# zypper modifyrepo --refresh mylocalrepo Autorefresh has been enabled for repository \u0026#39;mylocalrepo\u0026#39;. ã€è¯‘è€…æ³¨ã€‘ å…¶å®è¿™é‡Œåªæ˜¯ç¤ºä¾‹äº† zypper çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼Œzypper æ˜¯ä¸€ä¸ªå¾ˆå¼ºå¤§çš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ï¼Œè¯·æŸ¥çœ‹ Portal:Zypper è·å–æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚\n","date":"April 27, 2015","hero":"/zh/posts/linux/opensuse-zypper/opensuse-zypper.png","permalink":"/zh/posts/linux/opensuse-zypper/","summary":"è‡ªå·±åœ¨ä½¿ç”¨ opensuseï¼Œè‡ªå·±éå¸¸å–œæ¬¢ opensuse çš„åŒ…ç®¡ç†å‘½ä»¤è¡Œå·¥å…· zypperã€‚è¿™é‡Œåšä¸€ä¸ªç¬”è®°ï¼Œä¹Ÿå¸Œæœ›èƒ½çœ‹åˆ°è¿™ä¸ªç¯‡æ–‡ç« çš„æœ‹å‹èƒ½å¤Ÿå¿«é€Ÿåœ°æŒæ¡ zypper çš„ç”¨æ³•ã€‚\nCentOS å’Œ Redhat ä½¿ç”¨çš„æ˜¯ yum ä½œä¸ºå‘½ä»¤è¡Œçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚\nDebian å’Œ Ubuntu ä½¿ç”¨çš„æ˜¯ apt-getã€‚\nåœ¨ Debian/Ubuntu ä¸Šè¿˜æœ‰å¦ä¸€ä¸ªè½¯ä»¶åŒ…ç®¡ç†å·¥å…· - aptitude ã€‚\nåŒæ ·ï¼Œåœ¨ SUSE/opensuse Linux ä¸Šï¼Œzypper å°±æ˜¯å…¶å‘½ä»¤è¡Œçš„è½¯ä»¶åŒ…ç®¡ç†å·¥å…·ã€‚\nä»é«˜å±‚æ¬¡çš„è§’åº¦ï¼Œä½ å¯ä»¥ä½¿ç”¨ zypper å‘½ä»¤ç®¡ç†ä¸¤ç§ä¸åŒçš„ä¸œè¥¿ï¼š\nç®¡ç†è½¯ä»¶åŒ…ï¼š ä½¿ç”¨ zypper æ¥å®‰è£…ï¼Œåˆ é™¤ï¼Œæ›´æ–°ä»¥åŠæŸ¥è¯¢æœ¬åœ°çš„æˆ–è€…è¿œç«¯åª’ä½“ä¸Šçš„è½¯ä»¶åŒ…ã€‚ ç®¡ç†è½¯ä»¶æºï¼š ä¹Ÿå¯ä»¥ä½¿ç”¨ zypper ç®¡ç†è½¯ä»¶æºä¿¡æ¯ï¼Œä½ å¯ä»¥åœ¨å‘½ä»¤è¡Œæ·»åŠ ï¼Œåˆ é™¤ï¼Œæ‰“å¼€æˆ–è€…å…³é—­æŸä¸ªè½¯ä»¶æºã€‚å®ƒè¿˜å¯ä»¥è®¾ç½®åœ¨å®‰è£…è¿‡ç¨‹ä¸­è½¯ä»¶æºçš„ä¼˜å…ˆçº§ã€‚ I. ä½¿ç”¨ zypper ç®¡ç†è½¯ä»¶åŒ… 1. å®‰è£…è½¯ä»¶åŒ… ä½¿ç”¨å¦‚ä¸‹è¯­æ³•å®‰è£…ä¸€ä¸ªè½¯ä»¶åŒ…ï¼š\nzypper install \u0026lt;package name\u0026gt;\nå¦‚ï¼Œæ‰§è¡Œä¸€ä¸‹å‘½ä»¤æ¥å®‰è£… ç«ç‹æµè§ˆå™¨ å’Œå®ƒçš„ä¾èµ–ï¼š\n# zypper install MozillaFirefox Loading repository data... Reading installed packages... Resolving package dependencies... The following NEW packages are going to be installed: MozillaFirefox MozillaFirefox-branding-SLED The following packages are not supported by their vendor: MozillaFirefox MozillaFirefox-branding-SLED 2 new packages to install.","tags":["opensuse","zypper"],"title":"OPENSUSEä¸Šçš„ZYPPERåŒ…ç®¡ç†å™¨"},{"categories":["Linux"],"contents":"è¿™æ˜¯æˆ‘åœ¨ä½¿ç”¨openSuSEè¿‡ç¨‹ä¸­å­¦ä¹ å’Œä½¿ç”¨systemdæ¥ç®¡ç†ç³»ç»Ÿçš„ä¸€äº›ç¬”è®°ã€‚ é¦–å…ˆé‚£å°±è®©æˆ‘ä»¬æ¥å…ˆçœ‹çœ‹ä»€ä¹ˆæ˜¯systemdï¼š\nSystemd Systemdæ˜¯Linuxä¸‹çš„ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥åˆå§‹åŒ–ç³»ç»Ÿã€‚åƒSysVä¸€æ ·ï¼Œå…¶å°†ä¼šè¢«Linuxå†…æ ¸å¯åŠ¨ã€‚ åœ¨opneSuSEä¸Šï¼Œsystemdå°†ä¼šæ˜¯ç³»ç»Ÿè¿›ç¨‹å·ä¸º1çš„è¿›ç¨‹ï¼Œå…¶è´Ÿè´£åˆå§‹åŒ–ç³»ç»Ÿå’Œå¯åŠ¨ç³»ç»ŸæœåŠ¡ã€‚\nopenSuSEä»12.3ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨systemdä½œä¸ºé»˜è®¤çš„ç³»ç»Ÿåˆå§‹åŒ–ç¨‹åºä»£æ›¿äº†SysVã€‚ æƒ³äº†è§£systemdå’ŒSysVçš„å¯¹äºï¼Œå¯ä»¥å‚çœ‹è¿™é‡Œã€‚\nç”¨sytemctlè¿›è¡Œç³»ç»Ÿç®¡ç† systemdæä¾›äº†systemctlå‘½ä»¤æ¥è¿›è¡Œç³»ç»ŸæœåŠ¡ç®¡ç†ï¼Œå…¶è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š\nsystemctl [é€šç”¨é€‰é¡¹] å­å‘½ä»¤ [å­å‘½ä»¤é€‰é¡¹]\nåœ¨ç³»ç»Ÿä¸Šç®¡ç†æœåŠ¡ åƒSysVä¸€æ ·ï¼Œé€šè¿‡å­å‘½ä»¤start|stop|restartç­‰æ¥ç®¡ç†æœåŠ¡ï¼š\nsystemctl start|stop|status|restart|reload|\u0026hellip; \u0026lt;æœåŠ¡å\u0026gt;.service\nå¦‚æŸ¥çœ‹å½“å‰cronæœåŠ¡çš„çŠ¶æ€ï¼š\n# systemctl status cron.service cron.service - Command Scheduler Loaded: loaded (/usr/lib/systemd/system/cron.service; enabled) Active: active (running) since Mon 2015-01-26 15:50:21 CST; 3 days ago Main PID: 1247 (cron) CGroup: /system.slice/cron.service â””â”€1247 /usr/sbin/cron -n\nsystemctlæ”¯æŒä¸€æ¬¡æ“ä½œå¤šä¸ªæœåŠ¡ï¼Œåªè¦åœ¨å­å‘½ä»¤åæ·»åŠ å¤šä¸ªæœåŠ¡åå³å¯ã€‚\nä½¿ç”¨enable|disableæ¥è®¾ç½®å¼€å¯è‡ªåŠ¨å¯åŠ¨æˆ–è€…ä¸å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼š\nsystemctl enable|disable \u0026lt;æœåŠ¡å\u0026gt;.service\nSystemdçš„å¯åŠ¨ç›®æ ‡ åœ¨SysVçš„å¯åŠ¨ç³»ç»Ÿä¸Šï¼Œç”¨å¯åŠ¨çº§åˆ«ï¼ˆrunlevelï¼‰æ¥è¡¨ç¤ºç³»ç»Ÿçš„å¯åŠ¨çŠ¶æ€ï¼Œå·²ç»å“ªäº›æœåŠ¡ä¼´éšè¿™çº§åˆ«ä¸€èµ·å¯åŠ¨ã€‚ å¦‚ 0 ï¼ˆå…³é—­ç³»ç»Ÿï¼‰ï¼Œ3 ï¼ˆå¤šç”¨æˆ·å¸¦ç½‘ç»œï¼‰ï¼Œ5 ï¼ˆå¤šç”¨æˆ·å¸¦ç½‘ç»œï¼Œæ˜¾ç¤ºå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰ã€‚\nè€Œåœ¨Systemdä¸Šï¼Œç”¨ç›®æ ‡ï¼ˆtargetï¼‰è¡¨ç¤ºè¿™ä¸ªæ¦‚å¿µï¼Œå¦‚ graphical.target æä¾›äº†å¤šç”¨æˆ·å¸¦ç½‘ï¼Œæ˜¾ç¤ºå›¾åƒç”¨æˆ·ç•Œé¢çš„å¯åŠ¨ç›®æ ‡ï¼Œå°±ç›¸å½“ä¸level 5ã€‚ systemdæä¾›äº†å¾ˆå¤šå†…ç½®çš„ç›®æ ‡å•å…ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š\n# systemctl list-unit-files \u0026ndash;type=target\nä¸ºäº†å’ŒSysVå…¼å®¹ï¼Œsystemæä¾›äº†å¦‚ä¸‹çš„å¯åŠ¨ç›®æ ‡ï¼š\nSysVçš„è¿è¡Œçº§åˆ« Systemdçš„å¯åŠ¨ç›®æ ‡ æè¿° 0 runlevel0.target, halt.target, poweroff.target å…³é—­ç³»ç»Ÿ 1,S runlevel1.target, rescue.target å•ç”¨æˆ·æ¨¡å¼ 2 runlevel2.target, multi-user.target å¤šç”¨æˆ·æ— ç½‘ç»œæ¨¡å¼ 3 runlevel3.target å¤šç”¨æˆ·å¸¦ç½‘ç»œæ¨¡å¼ 4 runlevel4.target æœªå®šä¹‰ 5 runlevel5.target, graphical.target å›¾å½¢æ¨¡å¼ 6 runlevel6.target, reboot.target é‡å¯ ç”¨systemctlæ¥æ“ä½œç›®æ ‡ åŒæ ·å¯ä»¥ä½¿ç”¨systemctlæ¥æ“ä½œå¯åŠ¨ç›®æ ‡ï¼Œå¦‚æ›´æ”¹å½“å‰ç›®æ ‡ï¼š\nsystemctl isolate \u0026lt;ç›®æ ‡å\u0026gt;.target\nè¿™ç±»ä¼¼åœ¨SysVä¸Šä½¿ç”¨telinit Xåˆ°æŸä¸ªè¿è¡Œçº§åˆ«ã€‚ ç™»å½•åˆ°é»˜è®¤ç›®æ ‡ï¼š\nsystemctl default\nè·å–å½“å‰æ¿€æ´»çš„ç›®æ ‡ï¼š\nsystemctl list-units \u0026ndash;type=target\næ˜¾ç¤ºæŸä¸ªç›®æ ‡çš„ä¾èµ–ï¼š\nsystemctl show -p \u0026ldquo;Requires\u0026rdquo; \u0026lt;ç›®æ ‡å\u0026gt;.target systemctl show -p \u0026ldquo;Wants\u0026rdquo; \u0026lt;ç›®æ ‡å\u0026gt;.target\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„æ–¹å¼æ¥ä¿®æ”¹é»˜è®¤çš„å¯åŠ¨ç›®æ ‡ï¼š\nln -sf /lib/systemd/system/\u0026lt;ç›®æ ‡å\u0026gt;.target /etc/systemd/system/default.target\nè¿™é‡Œåªæ˜¯ç®€å•åœ°ä»‹ç»äº†ä¸‹systemdåœ¨ç³»ç»Ÿç®¡ç†çš„ä¸€äº›åŸºæœ¬ç”¨æ³•ï¼Œsystemdè¿˜æœ‰å¾ˆå¤šçš„é«˜çº§åº”ç”¨ï¼Œæ¯”å¦‚è‡ªå®šç›®æ ‡ç­‰ç­‰ã€‚ æƒ³äº†è§£æ›´å¤šå…³äºsystemdï¼Œè¯·å‚è€ƒå¦‚ä¸‹é“¾æ¥ï¼š\nhttp://www.freedesktop.org/wiki/Software/systemd http://0pointer.de/blog/projects\næœ€ååœ¨ç»™ä¸€ä¸ªå‘½ä»¤systemd-analyze plotï¼Œå…¶å¯ä»¥ç”Ÿæˆç³»ç»ŸæœåŠ¡å¯åŠ¨æ—¶é—´çš„ä¸€ä¸ªSVGå›¾ï¼Œå¦‚ï¼š\nsystemd-analyze plot \u0026gt; startup-time.svg\n","date":"January 29, 2015","hero":"/zh/posts/linux/systemd-systemctl/systemd.webp","permalink":"/zh/posts/linux/systemd-systemctl/","summary":"è¿™æ˜¯æˆ‘åœ¨ä½¿ç”¨openSuSEè¿‡ç¨‹ä¸­å­¦ä¹ å’Œä½¿ç”¨systemdæ¥ç®¡ç†ç³»ç»Ÿçš„ä¸€äº›ç¬”è®°ã€‚ é¦–å…ˆé‚£å°±è®©æˆ‘ä»¬æ¥å…ˆçœ‹çœ‹ä»€ä¹ˆæ˜¯systemdï¼š\nSystemd Systemdæ˜¯Linuxä¸‹çš„ä¸€ä¸ªç¨‹åºï¼Œç”¨æ¥åˆå§‹åŒ–ç³»ç»Ÿã€‚åƒSysVä¸€æ ·ï¼Œå…¶å°†ä¼šè¢«Linuxå†…æ ¸å¯åŠ¨ã€‚ åœ¨opneSuSEä¸Šï¼Œsystemdå°†ä¼šæ˜¯ç³»ç»Ÿè¿›ç¨‹å·ä¸º1çš„è¿›ç¨‹ï¼Œå…¶è´Ÿè´£åˆå§‹åŒ–ç³»ç»Ÿå’Œå¯åŠ¨ç³»ç»ŸæœåŠ¡ã€‚\nopenSuSEä»12.3ç‰ˆæœ¬å¼€å§‹ï¼Œç”¨systemdä½œä¸ºé»˜è®¤çš„ç³»ç»Ÿåˆå§‹åŒ–ç¨‹åºä»£æ›¿äº†SysVã€‚ æƒ³äº†è§£systemdå’ŒSysVçš„å¯¹äºï¼Œå¯ä»¥å‚çœ‹è¿™é‡Œã€‚\nç”¨sytemctlè¿›è¡Œç³»ç»Ÿç®¡ç† systemdæä¾›äº†systemctlå‘½ä»¤æ¥è¿›è¡Œç³»ç»ŸæœåŠ¡ç®¡ç†ï¼Œå…¶è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š\nsystemctl [é€šç”¨é€‰é¡¹] å­å‘½ä»¤ [å­å‘½ä»¤é€‰é¡¹]\nåœ¨ç³»ç»Ÿä¸Šç®¡ç†æœåŠ¡ åƒSysVä¸€æ ·ï¼Œé€šè¿‡å­å‘½ä»¤start|stop|restartç­‰æ¥ç®¡ç†æœåŠ¡ï¼š\nsystemctl start|stop|status|restart|reload|\u0026hellip; \u0026lt;æœåŠ¡å\u0026gt;.service\nå¦‚æŸ¥çœ‹å½“å‰cronæœåŠ¡çš„çŠ¶æ€ï¼š\n# systemctl status cron.service cron.service - Command Scheduler Loaded: loaded (/usr/lib/systemd/system/cron.service; enabled) Active: active (running) since Mon 2015-01-26 15:50:21 CST; 3 days ago Main PID: 1247 (cron) CGroup: /system.slice/cron.service â””â”€1247 /usr/sbin/cron -n\nsystemctlæ”¯æŒä¸€æ¬¡æ“ä½œå¤šä¸ªæœåŠ¡ï¼Œåªè¦åœ¨å­å‘½ä»¤åæ·»åŠ å¤šä¸ªæœåŠ¡åå³å¯ã€‚\nä½¿ç”¨enable|disableæ¥è®¾ç½®å¼€å¯è‡ªåŠ¨å¯åŠ¨æˆ–è€…ä¸å¯åŠ¨ä¸€ä¸ªæœåŠ¡ï¼š\nsystemctl enable|disable \u0026lt;æœåŠ¡å\u0026gt;.service\nSystemdçš„å¯åŠ¨ç›®æ ‡ åœ¨SysVçš„å¯åŠ¨ç³»ç»Ÿä¸Šï¼Œç”¨å¯åŠ¨çº§åˆ«ï¼ˆrunlevelï¼‰æ¥è¡¨ç¤ºç³»ç»Ÿçš„å¯åŠ¨çŠ¶æ€ï¼Œå·²ç»å“ªäº›æœåŠ¡ä¼´éšè¿™çº§åˆ«ä¸€èµ·å¯åŠ¨ã€‚ å¦‚ 0 ï¼ˆå…³é—­ç³»ç»Ÿï¼‰ï¼Œ3 ï¼ˆå¤šç”¨æˆ·å¸¦ç½‘ç»œï¼‰ï¼Œ5 ï¼ˆå¤šç”¨æˆ·å¸¦ç½‘ç»œï¼Œæ˜¾ç¤ºå›¾å½¢ç”¨æˆ·ç•Œé¢ï¼‰ã€‚\nè€Œåœ¨Systemdä¸Šï¼Œç”¨ç›®æ ‡ï¼ˆtargetï¼‰è¡¨ç¤ºè¿™ä¸ªæ¦‚å¿µï¼Œå¦‚ graphical.target æä¾›äº†å¤šç”¨æˆ·å¸¦ç½‘ï¼Œæ˜¾ç¤ºå›¾åƒç”¨æˆ·ç•Œé¢çš„å¯åŠ¨ç›®æ ‡ï¼Œå°±ç›¸å½“ä¸level 5ã€‚ systemdæä¾›äº†å¾ˆå¤šå†…ç½®çš„ç›®æ ‡å•å…ƒï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ï¼š\n# systemctl list-unit-files \u0026ndash;type=target","tags":["systemd","linux"],"title":"SYSTEMCTLç®¡ç†ç³»ç»ŸæœåŠ¡"},{"categories":["Programming"],"contents":"ä»Šå¤©åœ¨å†™ä¸€ä¸ª shell è„šæœ¬çš„æ—¶å€™é‡åˆ°äº†å¦‚ä¸‹çš„é”™è¯¯ï¼š\nline 225: unexpected EOF while looking for matching `â€â€˜\nline 233: syntax error: unexpected end of file\nå¯æ˜¯è®¤çœŸæŸ¥çœ‹å®ƒæç¤ºå‡ºé”™çš„è¡Œæ—¶ï¼Œå´å‘ç°(\u0026quot;)å·æ˜¯é…å¯¹çš„ã€‚\n225è¡Œæ˜¯å¦‚ä¸‹çš„ä»£ç :\nif [ ${options} = \u0026#34;ALL\u0026#34; ]; then å¾ˆæ˜æ˜¾æŠ¥é”™çš„è¡Œæ•°ä¸å¯¹ï¼Œç”±äºå‰é¢çš„ä»£ç æ¯”è¾ƒå¤šï¼Œä¸€è¡Œè¡Œçœ‹ä¹Ÿä¸å®¹æ˜“çœ‹é”™é”™è¯¯ã€‚ æ—¢ç„¶è¯´æ–‡ä»¶ç»“å°¾æœ‰é—®é¢˜ï¼Œäºæ˜¯æˆ‘åœ¨æ–‡ä»¶å°¾åŠ ä¸Šä¸€ä¸ª(\u0026quot;)ç¬¦å·ï¼Œå†è¿è¡Œã€‚ç°åœ¨æç¤ºç»™å‡ºäº†æ­£ç¡®çš„é”™è¯¯è¡Œå·ã€‚\nåŸæ¥æ˜¯å‰é¢æœ‰è¿™æ ·çš„ä»£ç :\necho \u0026#34;${PACKAGENAME\u0026#34; \u0026gt;\u0026gt; ${file} æ˜¯å˜é‡çš„å¼•ç”¨æ—¶å°‘äº†ç›¸åº”çš„ (}) å·ã€‚\næ‰€ä»¥ï¼Œå¦‚æœä»¥åé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•åŠ ä¸€äº›ç¬¦å·æ¥è°ƒè¯•ï¼Œä¹Ÿè®¸ä¼šæœ‰å¸®åŠ©ã€‚\n","date":"February 13, 2011","hero":"/images/default-hero.jpg","permalink":"/zh/posts/programming/shell-debug/","summary":"ä»Šå¤©åœ¨å†™ä¸€ä¸ª shell è„šæœ¬çš„æ—¶å€™é‡åˆ°äº†å¦‚ä¸‹çš„é”™è¯¯ï¼š\nline 225: unexpected EOF while looking for matching `â€â€˜\nline 233: syntax error: unexpected end of file\nå¯æ˜¯è®¤çœŸæŸ¥çœ‹å®ƒæç¤ºå‡ºé”™çš„è¡Œæ—¶ï¼Œå´å‘ç°(\u0026quot;)å·æ˜¯é…å¯¹çš„ã€‚\n225è¡Œæ˜¯å¦‚ä¸‹çš„ä»£ç :\nif [ ${options} = \u0026#34;ALL\u0026#34; ]; then å¾ˆæ˜æ˜¾æŠ¥é”™çš„è¡Œæ•°ä¸å¯¹ï¼Œç”±äºå‰é¢çš„ä»£ç æ¯”è¾ƒå¤šï¼Œä¸€è¡Œè¡Œçœ‹ä¹Ÿä¸å®¹æ˜“çœ‹é”™é”™è¯¯ã€‚ æ—¢ç„¶è¯´æ–‡ä»¶ç»“å°¾æœ‰é—®é¢˜ï¼Œäºæ˜¯æˆ‘åœ¨æ–‡ä»¶å°¾åŠ ä¸Šä¸€ä¸ª(\u0026quot;)ç¬¦å·ï¼Œå†è¿è¡Œã€‚ç°åœ¨æç¤ºç»™å‡ºäº†æ­£ç¡®çš„é”™è¯¯è¡Œå·ã€‚\nåŸæ¥æ˜¯å‰é¢æœ‰è¿™æ ·çš„ä»£ç :\necho \u0026#34;${PACKAGENAME\u0026#34; \u0026gt;\u0026gt; ${file} æ˜¯å˜é‡çš„å¼•ç”¨æ—¶å°‘äº†ç›¸åº”çš„ (}) å·ã€‚\næ‰€ä»¥ï¼Œå¦‚æœä»¥åé‡åˆ°ç±»ä¼¼çš„é—®é¢˜ï¼Œå¯ä»¥å°è¯•åŠ ä¸€äº›ç¬¦å·æ¥è°ƒè¯•ï¼Œä¹Ÿè®¸ä¼šæœ‰å¸®åŠ©ã€‚","tags":["shell","debug"],"title":"è°ƒè¯•Shellè„šæœ¬é”™è¯¯"},{"categories":["Linux"],"contents":"å‰æ®µæ—¶é—´ï¼Œå‘ç°æ¯æ¬¡å¼€æœºåä¸€æ®µæ—¶é—´æœºå™¨å°±ä¼šå¾ˆæ…¢ï¼Œä¼¼ä¹åœ¨è·‘äº›ä»€ä¹ˆä»»åŠ¡ï¼Œäºæ˜¯æŸ¥çœ‹ç³»ç»Ÿä»»åŠ¡ï¼Œå‘ç°æœ‰updatadbï¼ˆä¸ºlocateæ„å»ºæ•°æ®ç´¢å¼•ï¼‰åœ¨è¿è¡Œã€‚è¿™äº›ä»»åŠ¡æ˜¯ç”± cron è§¦å‘çš„ã€‚\näºæ˜¯æˆ‘ç”¨crontabå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„cronä»»åŠ¡åˆ—è¡¨ï¼Œå¯æ˜¯å¾—åˆ°å¦‚ä¸‹è¿”å›ï¼š\n$sudo crontab -u root -l\nrootâ€™s password:\nno crontab for root\nå¯æ˜¯æˆ‘å‘ç°åœ¨*/etc/cron.daily/ç›®å½•ä¸‹æœ‰ä¸€äº›è„šæœ¬ï¼Œ å…¶ä¸­å°±æœ‰ä¸€ä¸ªsuse-updatedb*ã€‚é‚£äº›è¿›ç¨‹å°±æ˜¯ç”±è¿™ä¸ªè„šæœ¬å¯åŠ¨çš„ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘æŸ¥çœ‹äº†ä¸€ä¸‹*/etc/crontab*æ–‡ä»¶:\n-*/15 * * * * root test -x /usr/lib/cron/run-crons \u0026amp;\u0026amp; /usr/lib/cron/run-crons \u0026gt;/dev/null 2\u0026gt;\u0026amp;1\nè¿™è¯´æ˜ç³»ç»Ÿä¼šæ¯15åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ /usr/lib/cron/run-crons è„šæœ¬ï¼Œæ¥ç€æŸ¥çœ‹äº†ä¸€ä¸‹é‚£ä¸ªè„šæœ¬ï¼Œå…¶ä¸­å‘ç°äº†ä¸€è¡Œæ³¨é‡Šï¼š\n# if DAILY_TIME set, run only at a fixed time of day\nè€ŒDAILY_TIMEè¿™ä¸ªå˜é‡åº”è¯¥åœ¨*/etc/sysconfig/cron*é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šï¼Œåœ¨æ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š\n## Type: string\n## Default: â€œâ€\n#\n# At which time cron.daily should start. Default is 15 minutes after booting\n# the system. Example setting would be â€œ14:00â€³.\n# Due to the fact that cron script runs only every 15 minutes,\n# it will only run on xx:00, xx:15, xx:30, xx:45, not at the accurate time\n# you set.\nDAILY_TIME=\u0026quot;\u0026quot;\nä¹Ÿå°±æ˜¯è¯´å¦‚æœæ²¡æœ‰æŒ‡å®šDAILY_TIMEï¼Œåˆ™cron.dailyå°†åœ¨ç³»ç»Ÿå¯åŠ¨åçš„15åˆ†é’Ÿè§¦å‘ï¼Œå¹¶ä¸”å¦‚æœè¦æŒ‡å®šç‰¹å®šæ—¶é—´ï¼Œä¹Ÿåªèƒ½æŒ‡å®šåœ¨æ¯å°æ—¶çš„00/15/30/45åˆ†é’Ÿã€‚\näºæ˜¯æˆ‘æŠŠè¿™ä¸ªæ—¶é—´è®¾å®šä¸º01:45ï¼Œè¿™æ ·å°±åœ¨æ¯å¤©çš„å‡Œæ™¨1ç‚¹45åˆ†çš„æ—¶å€™æ‰ä¼šè§¦å‘é‚£äº›cronä»»åŠ¡ã€‚\nä¸è¿‡æˆ‘çœ‹äº†ä¸‹*/usr/lib/cron/run-crons*ï¼Œè¿˜æ˜¯æ²¡æœ‰å®Œå…¨å¼„æ˜ç™½è¿™ä¸ªcronæ¡†æ¶æ˜¯å¦‚ä½•å»æŒ‰ç…§æŒ‡å®šæ—¶é—´è§¦å‘çš„ã€‚ å¥½åƒopenSUSE 11.4å°†ä½¿ç”¨æ–°çš„cronie 1.4.4æ›¿ä»£ç°åœ¨çš„vixie-cron 4.1ï¼Œçœ‹çœ‹è¿™é‡ŒSDB:Cronã€‚\n","date":"February 2, 2011","hero":"/zh/posts/linux/opensuse-cronjob/cron-job.webp","permalink":"/zh/posts/linux/opensuse-cronjob/","summary":"å‰æ®µæ—¶é—´ï¼Œå‘ç°æ¯æ¬¡å¼€æœºåä¸€æ®µæ—¶é—´æœºå™¨å°±ä¼šå¾ˆæ…¢ï¼Œä¼¼ä¹åœ¨è·‘äº›ä»€ä¹ˆä»»åŠ¡ï¼Œäºæ˜¯æŸ¥çœ‹ç³»ç»Ÿä»»åŠ¡ï¼Œå‘ç°æœ‰updatadbï¼ˆä¸ºlocateæ„å»ºæ•°æ®ç´¢å¼•ï¼‰åœ¨è¿è¡Œã€‚è¿™äº›ä»»åŠ¡æ˜¯ç”± cron è§¦å‘çš„ã€‚\näºæ˜¯æˆ‘ç”¨crontabå‘½ä»¤æ¥æŸ¥çœ‹å½“å‰çš„cronä»»åŠ¡åˆ—è¡¨ï¼Œå¯æ˜¯å¾—åˆ°å¦‚ä¸‹è¿”å›ï¼š\n$sudo crontab -u root -l\nrootâ€™s password:\nno crontab for root\nå¯æ˜¯æˆ‘å‘ç°åœ¨*/etc/cron.daily/ç›®å½•ä¸‹æœ‰ä¸€äº›è„šæœ¬ï¼Œ å…¶ä¸­å°±æœ‰ä¸€ä¸ªsuse-updatedb*ã€‚é‚£äº›è¿›ç¨‹å°±æ˜¯ç”±è¿™ä¸ªè„šæœ¬å¯åŠ¨çš„ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘æŸ¥çœ‹äº†ä¸€ä¸‹*/etc/crontab*æ–‡ä»¶:\n-*/15 * * * * root test -x /usr/lib/cron/run-crons \u0026amp;\u0026amp; /usr/lib/cron/run-crons \u0026gt;/dev/null 2\u0026gt;\u0026amp;1\nè¿™è¯´æ˜ç³»ç»Ÿä¼šæ¯15åˆ†é’Ÿè°ƒç”¨ä¸€æ¬¡ /usr/lib/cron/run-crons è„šæœ¬ï¼Œæ¥ç€æŸ¥çœ‹äº†ä¸€ä¸‹é‚£ä¸ªè„šæœ¬ï¼Œå…¶ä¸­å‘ç°äº†ä¸€è¡Œæ³¨é‡Šï¼š\n# if DAILY_TIME set, run only at a fixed time of day\nè€ŒDAILY_TIMEè¿™ä¸ªå˜é‡åº”è¯¥åœ¨*/etc/sysconfig/cron*é…ç½®æ–‡ä»¶é‡ŒæŒ‡å®šï¼Œåœ¨æ–‡ä»¶ä¸­æœ‰è¿™ä¹ˆä¸€æ®µï¼š\n## Type: string\n## Default: â€œâ€\n#\n# At which time cron.daily should start. Default is 15 minutes after booting\n# the system. Example setting would be â€œ14:00â€³.","tags":["opensuse"],"title":"OPENSUSEä¸Šçš„å®šæ—¶ä»»åŠ¡"},{"categories":["Linux"],"contents":"é€šå¸¸ï¼Œä½ ä¹Ÿè®¸ä¸éœ€è¦çŸ¥é“ä½ ä½¿ç”¨äº†ä»€ä¹ˆæ ·çš„ç¡¬ä»¶ â€” ä½ ä¹Ÿè®¸æ‹¥æœ‰çš„æ˜¯ä¸€å°æ¥è‡ªæ¯”è¾ƒå°ä¸€ç‚¹å…¬å¸çš„ç»„è£…æœºæˆ–è€…ä¸€å°äºŒæ‰‹æœºã€‚æœ¬æœˆï¼Œæˆ‘å°†ä»‹ç»ä½ å¯ä»¥ç”¨æ¥æŸ¥çœ‹ä½ å®‰è£…çš„ç¡¬ä»¶çš„å·¥å…·ã€‚ ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨lshw â€” åˆ—ä¸¾ç¡¬ä»¶å·¥å…·ã€‚å¦‚æœä½ ä½¿ç”¨æ™®é€šç”¨æˆ·æ‰§è¡Œï¼Œå®ƒä¼šè­¦å‘Šä½ éœ€è¦ä½¿ç”¨rootæ‰§è¡Œã€‚å› æ­¤ï¼Œä»¥sudo lshwæ‰§è¡Œã€‚ä½ å°†å¯ä»¥çœ‹åˆ°å±å¹•ä¸Šæ˜¾ç¤ºä½ ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ç¬¬ä¸€æ®µå°†æ˜¯å¸¸è§„ä¿¡æ¯ï¼Œçœ‹èµ·æ¥å°±åƒä¸‹é¢è¿™æ ·ï¼š\njbernard-eeepc\ndescription: Notebook\nproduct: 700\nvendor: ASUSTeK Computer INC.\nversion: 0129\nserial: EeePC-1234567890\nwidth: 32 bits\ncapabilities: smbios-2.5 dmi-2.5 smp-1.4 smp\nconfiguration: boot=normal chassis=notebook\ncpus=1 uuid=XXXXXX-XXXXX-XXXXX-XXXXX\nè¿™æ˜¯æˆ‘åœ¨æˆ‘çš„ASUS EeePCæ‰§è¡Œçš„ç»“æœã€‚ä½ å¯ä»¥çœ‹åˆ°ç”Ÿäº§å•†æ˜¯ASUSTeK, BIOSçš„ç‰ˆæœ¬æ˜¯0129ï¼Œ ä»¥åŠè¿™æ˜¯ä¸€å°32ä½çš„å•ä¸€CPUæœºå™¨ã€‚æ›´å¤šçš„ä¿¡æ¯ä»¥ä¸‹é¢çš„åˆ†ç±»æ¥è¯´æ˜ï¼š\ncore\nfirmware - motherboard and BIOS information\ncpu - CPU information\ncache - cache information\nmemory - memory information\nbank - specific bank memory information\npci - PCI bus information\ndisplay - PCI display adapter\nmultimedia - PCI audio adapter\npci - other PCI devices\nnetwork - PCI network adapter\nusb - USB devices\nide - IDE information\ndisk - individual disks\nvolume - volumes on this disk\nå¯¹äºå¤šå°‘ä¿¡æ¯å¯ç”¨çš„æƒ³æ³•ï¼Œä»¥ä¸‹å†…å­˜æ®µæ˜¾ç¤ºäº†æˆ‘çš„EeePCçš„å†…å­˜ä¿¡æ¯ï¼š\n*-memory\ndescription: System Memory\nphysical id: 1f slot: System board or motherboard\nsize: 512MiB\n*-bank\ndescription: DIMM DDR2 Synchronous 400 MHz (2.5 ns)\nproduct: PartNum0\nvendor: Manufacturer0\nphysical id: 0\nserial: SerNum0\nslot: DIMM0\nsize: 512MiB\nwidth: 64 bits\nclock: 400MHz (2.5ns)\nè¿™æ˜¯ä¸€ä¸ªåŸºæœ¬çš„é›†ä¸­æˆä¸€ä¸ªå‘½ä»¤çš„å·¥å…·ï¼Œæ‰§è¡Œä¸€æ¬¡ï¼Œå®ƒå¯ä»¥å¾—åˆ°ç³»ç»Ÿçš„æ‰€æœ‰ä¿¡æ¯ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ åªæƒ³çŸ¥é“æŒ‡å®šå­ç³»ç»Ÿçš„ä¿¡æ¯ï¼Œæ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®æ˜¯æœ‰ä¸€æ•´å¥—çš„å·¥å…·çš„ï¼Œå½“ä½ éœ€è¦ä¸€äº›æŒ‡å®šçš„ä¿¡æ¯æˆ–è€…æƒ³åœ¨ä¸€ä¸ªè„šæœ¬åšä¸€äº›ç³»ç»ŸæŸ¥è¯¢æ—¶ï¼Œè¿™äº›å·¥å…·å°†æ›´æœ‰ç”¨ã€‚ ä½ ä¹Ÿè®¸åªæƒ³çœ‹çœ‹CPUï¼Œlscpuå·¥å…·æä¾›äº†ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š\nArchitecture: i686\nCPU op-mode(s): 32-bit\nCPU(s): 1\nThread(s) per core: 1\nCore(s) per socket: 1\nCPU socket(s): 1\nVendor ID: GenuineIntel\nCPU family: 6\nModel: 13\nStepping: 8\nCPU MHz: 571.427\nä½ å¯ä»¥ä»ä¸­çœ‹å‡ºç”Ÿäº§å‚å®¶ï¼Œæ˜¯å¦æ˜¯32ä½è¿˜æ˜¯64ä½çš„ï¼Œå‡†ç¡®çš„ç‰ˆæœ¬å’Œå‹å·ï¼Œä»¥åŠå½“å‰CPUé¢‘ç‡ã€‚ å¦‚æœä½ æƒ³çŸ¥é“ä½ çš„æ˜¾å¡æ˜¯å¦è¢«X11æ”¯æŒï¼Œæˆ–è€…ä½ æ˜¯å¦éœ€è¦ç¬¬ä¸‰æ–¹é©±åŠ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨lspciã€‚è¯¥å·¥å…·ç»™å‡ºäº†æ‰€æœ‰æ’åœ¨ä½ çš„PCIæ€»çº¿çš„è®¾å¤‡çš„ä¿¡æ¯ã€‚è¾“å‡ºç±»ä¼¼ä¸‹é¢ï¼š\n00:02.0 VGA compatible controller: Intel Corporation\nMobile 915GM/GMS/910GML Express Graphics Controller (rev 04)\n00:02.1 Display controller: Intel Corporation\nMobile 915GM/GMS/910GML Express Graphics Controller (rev 04)\nè¿™ä¸ªä¿¡æ¯æ˜¾ç¤ºäº†åœ¨æˆ‘çš„EeePCä¸Šçš„æ˜¾å¡æ§åˆ¶å™¨æ˜¯ä¸€ä¸ªIntelæ§åˆ¶å™¨ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³ï¼Œä½ ç°åœ¨å°±å¯ä»¥åˆ°Googleæœç´¢å…³äºä½ çš„æ˜¾å¡çš„ä¿¡æ¯ä»¥åŠæ€æ ·æœ€å¤§é™åº¦çš„é…ç½®å®ƒã€‚å¦‚æœä½ æƒ³çœ‹çœ‹ä½ ç³»ç»Ÿä¸Šçš„USBè®¾å¤‡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨lsusbã€‚åœ¨æˆ‘çš„EeePCä¸Šï¼Œæ‹¥æœ‰ä¸€ä¸ªSDå¡ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š\nBus 001 Device 002: ID 0951:1606 Kingston Technology\nå¦‚æœä½ å¯¹ç¡¬ç›˜å­ç³»ç»Ÿæ„Ÿå…´è¶£ï¼Œä½ å¯ä»¥ä½¿ç”¨blkidå·¥å…·æ¥æŸ¥çœ‹ã€‚è¯¥å·¥å…·æ‰“å°å‡ºæ‰€æœ‰å¯ç”¨çš„æ–‡ä»¶ç³»ç»Ÿï¼Œç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºï¼š\n/dev/sda1: UUID=\u0026ldquo;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\u0026rdquo; TYPE=\u0026ldquo;ext2\u0026rdquo;\n/dev/sda2: UUID=\u0026ldquo;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\u0026rdquo; TYPE=\u0026ldquo;swap\u0026rdquo;\n/dev/sda3: UUID=\u0026ldquo;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\u0026rdquo; TYPE=\u0026ldquo;ext2\u0026rdquo;\n/dev/sdb1: UUID=\u0026ldquo;XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\u0026rdquo; TYPE=\u0026ldquo;ext2\u0026rdquo;\nç”¨è¿™ä¸ªå·¥å…·ï¼Œä½ å¯ä»¥äº†è§£åˆ°ä»€ä¹ˆè®¾å¤‡å¯ç”¨ä»¥åŠä»€ä¹ˆæ–‡ä»¶ç³»ç»Ÿæ­£ç”¨åœ¨å®ƒä»¬ä¸Šé¢ã€‚å¦‚æœä½ æƒ³åœ¨*/etc/fstab*é‡Œçš„æ¡ç›®ä½¿ç”¨UUIDï¼Œé‚£ç›¸å…³è”çš„UUIDæ˜¯å¯ç”¨çš„ã€‚\nç°åœ¨ä½ çŸ¥é“ä½ çš„ç³»ç»Ÿä½¿ç”¨äº†ä»€ä¹ˆæ ·çš„ç¡¬ä»¶ï¼Œæœ€åéœ€è¦æ£€æŸ¥çš„æ˜¯çœ‹çœ‹æ˜¯å¦ä½ çš„å†…æ ¸å®é™…ä¸Šæ­£åœ¨ä½¿ç”¨å¯ç”¨ç¡¬ä»¶ã€‚åœ¨å¤§éƒ¨åˆ†ç°åœ¨çš„å‘è¡Œç‰ˆæœ¬ä¸­ï¼Œå†…æ ¸æ˜¯è¢«ç¼–è¯‘æ¥ä½¿ç”¨æ¨¡å—çš„ã€‚ä½ å¯ä»¥ä½¿ç”¨lsmodå‘½ä»¤æ¥æŸ¥çœ‹å“ªä¸ªæ¨¡å—è¢«åŠ è½½äº†ã€‚ä½ å°†å¾—åˆ°åƒä¸‹é¢çš„ä¸€ä¸ªåˆ«è¡¨ï¼š\nagpgartÂ 31788 2 drm,intel_agp\nlpÂ 7028 0\nvideoÂ 17375 1 i915\noutputÂ 1871 1 video\nä½ å¯ä»¥çœ‹åˆ°agpgartæ¨¡å—æ‹¥æœ‰31788å­—èŠ‚çš„å¤§å°ï¼Œä»¥åŠè¢«drmå’Œintel_agpæ¨¡å—ä½¿ç”¨ã€‚\nç°åœ¨ï¼Œå¸Œæœ›ä½ å¯ä»¥é…ç½®å’Œä¼˜åŒ–ä½ çš„ç¡¬ä»¶ï¼Œä½¿ä½ æœ€å¤§çš„ä½¿ç”¨å®ƒä»¬ã€‚å¦‚æœä½ å‘ç°æœ‰å…¶ä»–çš„å·¥å…·è¿™é‡Œæ²¡æœ‰æåˆ°ï¼Œæˆ‘å¾ˆæ„¿æ„å¾—çŸ¥å®ƒä»¬ã€‚\n","date":"November 19, 2010","hero":"/zh/posts/linux/what-hardware/linux-hardware.jpg","permalink":"/zh/posts/linux/what-hardware/","summary":"é€šå¸¸ï¼Œä½ ä¹Ÿè®¸ä¸éœ€è¦çŸ¥é“ä½ ä½¿ç”¨äº†ä»€ä¹ˆæ ·çš„ç¡¬ä»¶ â€” ä½ ä¹Ÿè®¸æ‹¥æœ‰çš„æ˜¯ä¸€å°æ¥è‡ªæ¯”è¾ƒå°ä¸€ç‚¹å…¬å¸çš„ç»„è£…æœºæˆ–è€…ä¸€å°äºŒæ‰‹æœºã€‚æœ¬æœˆï¼Œæˆ‘å°†ä»‹ç»ä½ å¯ä»¥ç”¨æ¥æŸ¥çœ‹ä½ å®‰è£…çš„ç¡¬ä»¶çš„å·¥å…·ã€‚ ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨lshw â€” åˆ—ä¸¾ç¡¬ä»¶å·¥å…·ã€‚å¦‚æœä½ ä½¿ç”¨æ™®é€šç”¨æˆ·æ‰§è¡Œï¼Œå®ƒä¼šè­¦å‘Šä½ éœ€è¦ä½¿ç”¨rootæ‰§è¡Œã€‚å› æ­¤ï¼Œä»¥sudo lshwæ‰§è¡Œã€‚ä½ å°†å¯ä»¥çœ‹åˆ°å±å¹•ä¸Šæ˜¾ç¤ºä½ ç³»ç»Ÿçš„ä¿¡æ¯ã€‚ç¬¬ä¸€æ®µå°†æ˜¯å¸¸è§„ä¿¡æ¯ï¼Œçœ‹èµ·æ¥å°±åƒä¸‹é¢è¿™æ ·ï¼š\njbernard-eeepc\ndescription: Notebook\nproduct: 700\nvendor: ASUSTeK Computer INC.\nversion: 0129\nserial: EeePC-1234567890\nwidth: 32 bits\ncapabilities: smbios-2.5 dmi-2.5 smp-1.4 smp\nconfiguration: boot=normal chassis=notebook\ncpus=1 uuid=XXXXXX-XXXXX-XXXXX-XXXXX\nè¿™æ˜¯æˆ‘åœ¨æˆ‘çš„ASUS EeePCæ‰§è¡Œçš„ç»“æœã€‚ä½ å¯ä»¥çœ‹åˆ°ç”Ÿäº§å•†æ˜¯ASUSTeK, BIOSçš„ç‰ˆæœ¬æ˜¯0129ï¼Œ ä»¥åŠè¿™æ˜¯ä¸€å°32ä½çš„å•ä¸€CPUæœºå™¨ã€‚æ›´å¤šçš„ä¿¡æ¯ä»¥ä¸‹é¢çš„åˆ†ç±»æ¥è¯´æ˜ï¼š\ncore\nfirmware - motherboard and BIOS information\ncpu - CPU information\ncache - cache information\nmemory - memory information\nbank - specific bank memory information\npci - PCI bus information\ndisplay - PCI display adapter","tags":["linux","hardware"],"title":"æŸ¥çœ‹ç¡¬ä»¶ä¿¡æ¯"},{"categories":["Programming"],"contents":"è®°å¾—ä»¥å‰å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•æ—¶å°±äº†è§£äº†å†’æ³¡æ’åºç®—æ³•ï¼Œ å‰å‡ å¤©çš„ä¸€ä¸ªé¢è¯•ä¹Ÿè¢«é—®åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚äºæ˜¯å›æ¥åå°±åˆæ¸©ä¹ äº†ä¸€éï¼Œè¿˜äº†è§£åˆ°äº†ä¸€ç§å†’æ³¡çš„æ”¹è‰¯ç®—æ³•ï¼Œå«åšé¸¡å°¾é…’(cocktail)æ’åºç®—æ³•ï¼Œå…¶å®ç°æ˜¯é€šè¿‡ä¸¤ä¸ªå¾ªç¯åˆ†åˆ«ä»ä¸¤ç«¯è¿›è¡Œå†’æ³¡ã€‚\né€šå¸¸å®ç° template\u0026lt; typename T \u0026gt; void cocktail_sort(T array[], int n) { int bottom = 0; int top = n â€“ 1; bool swapped = true; while (swapped) { swapped = false; for ( int i = bottom; i \u0026lt; top; i++ ) { if ( array[i] \u0026gt; array[i+1] ) { swap(array[i], array[i+1]); swapped = true; } } topâ€“; // top is a larger one for ( int i = top; i \u0026gt; bottom; iâ€“ ) { if ( array[i] \u0026lt; array[i-1] ) { swap(array[i], array[i-1]); swapped = true; } } bottom++; // bottom is a smaller one } } // end, cocktail_sort æ”¹è‰¯å®ç° æˆ‘åœ¨ç½‘ä¸Šæœç´¢çš„å®ç°åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸Šé¢çš„å®ç°æ–¹æ³•ã€‚ æˆ‘å°±æƒ³ä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä¸¤ç«¯ä¸€èµ·è¿›è¡Œå†’æ³¡å‘¢ï¼Ÿäºæ˜¯æˆ‘å®ç°äº†ä¸‹é¢è¿™æ ·çš„æ”¹è‰¯çš„cocktailç®—æ³•å®ç°ï¼Œæš‚ä¸”å–åä¸ºbi_bubble_sortï¼Œå‡å°‘äº†å¾ªç¯æ¯”è¾ƒçš„æ¬¡æ•°ï¼š\ntemplate\u0026lt; typename T \u0026gt; void bi_bubble_sort(T *array, int n) { int top = 0; int bottom = n â€“ 1; bool swapped = true; while (swapped) { swapped = false; int i = top; int j = bottom; for (i = top, j = bottom; i \u0026lt; bottom || j \u0026gt; top; i++, jâ€“) { if (array[i] \u0026gt; array[i+1]) { swap(array[i], array[i+1]); swapped |= true; } if (array[j] \u0026lt; array[j-1]) { swap(array[j], array[j-1]); swapped |= true; } } top++; bottomâ€“; } } // end, bi_bubble_sort ä¸è¿‡å†’æ³¡æ’åºåœ¨æ’åºç®—æ³•ä¸­æ˜¯æ•ˆç‡æ¯”è¾ƒå·®çš„ç®—æ³•äº†ï¼Œå®é™…ä¸­åº”è¯¥å¾ˆå°‘åº”ç”¨ï¼Œå‘µå‘µï¼\n","date":"October 27, 2010","hero":"/images/default-hero.jpg","permalink":"/zh/posts/programming/cocktail-improve/","summary":"è®°å¾—ä»¥å‰å­¦ä¹ æ•°æ®ç»“æ„å’Œç®—æ³•æ—¶å°±äº†è§£äº†å†’æ³¡æ’åºç®—æ³•ï¼Œ å‰å‡ å¤©çš„ä¸€ä¸ªé¢è¯•ä¹Ÿè¢«é—®åˆ°äº†è¿™ä¸ªé—®é¢˜ã€‚äºæ˜¯å›æ¥åå°±åˆæ¸©ä¹ äº†ä¸€éï¼Œè¿˜äº†è§£åˆ°äº†ä¸€ç§å†’æ³¡çš„æ”¹è‰¯ç®—æ³•ï¼Œå«åšé¸¡å°¾é…’(cocktail)æ’åºç®—æ³•ï¼Œå…¶å®ç°æ˜¯é€šè¿‡ä¸¤ä¸ªå¾ªç¯åˆ†åˆ«ä»ä¸¤ç«¯è¿›è¡Œå†’æ³¡ã€‚\né€šå¸¸å®ç° template\u0026lt; typename T \u0026gt; void cocktail_sort(T array[], int n) { int bottom = 0; int top = n â€“ 1; bool swapped = true; while (swapped) { swapped = false; for ( int i = bottom; i \u0026lt; top; i++ ) { if ( array[i] \u0026gt; array[i+1] ) { swap(array[i], array[i+1]); swapped = true; } } topâ€“; // top is a larger one for ( int i = top; i \u0026gt; bottom; iâ€“ ) { if ( array[i] \u0026lt; array[i-1] ) { swap(array[i], array[i-1]); swapped = true; } } bottom++; // bottom is a smaller one } } // end, cocktail_sort æ”¹è‰¯å®ç° æˆ‘åœ¨ç½‘ä¸Šæœç´¢çš„å®ç°åŸºæœ¬ä¸Šéƒ½æ˜¯ä¸Šé¢çš„å®ç°æ–¹æ³•ã€‚ æˆ‘å°±æƒ³ä¸ºä»€ä¹ˆä¸åœ¨ä¸€ä¸ªå¾ªç¯ä¸­ä¸¤ç«¯ä¸€èµ·è¿›è¡Œå†’æ³¡å‘¢ï¼Ÿäºæ˜¯æˆ‘å®ç°äº†ä¸‹é¢è¿™æ ·çš„æ”¹è‰¯çš„cocktailç®—æ³•å®ç°ï¼Œæš‚ä¸”å–åä¸ºbi_bubble_sortï¼Œå‡å°‘äº†å¾ªç¯æ¯”è¾ƒçš„æ¬¡æ•°ï¼š","tags":["algorithm","cpp"],"title":"æ”¹è‰¯é¸¡å°¾é…’æ’åºç®—æ³•"},{"categories":["DEVOPS"],"contents":"å®¹å™¨ Docker è¶Šæ¥è¶Šå—å¼€å‘è€…å’Œè¿ç»´äººå‘˜çš„å–œçˆ±ï¼Œæ›´æ˜¯ä½œä¸ºå®è·µ DevOps çš„ä¸€ä¸ªä¸­è¦å·¥å…·ã€‚åŒæ—¶ Gitlab æä¾›äº†å…è´¹çš„ä»£ç ç®¡ç†æœåŠ¡ï¼Œå…¶ gitlab-ci æ›´æ˜¯æä¾›äº†å¼ºå¤§çš„è‡ªåŠ¨åŒ– CI/CD æµç¨‹åŠŸèƒ½ã€‚\næœ¬æ–‡ä»¥ä¸€ä¸ªé™æ€ç«™ç‚¹çš„ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ gitlab-ci å’Œ docker è¿›è¡Œå®¹å™¨é•œåƒçš„æ„å»ºï¼Œä»¥åŠå¦‚ä½•å°†é•œåƒè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚\nç¼–å†™Dockerfile é¦–å…ˆåœ¨ä»£ç åº“ä¸­å¢åŠ  Dockerfile ï¼Œç”¨äºæè¿°å¦‚ä½•æ„å»ºåº”ç”¨çš„å®¹å™¨é•œåƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº Hugo çš„é™æ€ç«™ç‚¹åº”ç”¨çš„ç¤ºä¾‹ï¼š\nFROM mengzyou/hugo:latest as builder COPY . /app/ RUN hugo FROM nginx:1.16-alpine RUN set -x \\ \u0026amp;\u0026amp; rm -f /etc/nginx/conf.d/default.conf \\ \u0026amp;\u0026amp; mkdir -p /usr/share/nginx/html COPY --from=builder /app/nginx-default.conf /etc/nginx/conf.d/default.conf COPY --from=builder /app/public/ /usr/share/nginx/html å…¶å®éå¸¸ç®€å•ï¼Œä½¿ç”¨äº†å¤šé˜¶æ®µæ„å»ºï¼Œä»¥ mengzyou/hugo ä½œä¸ºæ„å»ºé•œåƒï¼Œç„¶åå°†ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‹·è´åˆ° nginx é•œåƒä¸­ï¼Œæœ€ç»ˆç”Ÿæˆé™æ€ç«™ç‚¹çš„é•œåƒã€‚\né…ç½®Gitlab-ciæ„å»ºå®¹å™¨é•œåƒ è¯¥é˜¶æ®µï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  .gitlab-ci.yml æ–‡ä»¶ï¼Œç¤ºä¾‹å†…å®¹å¦‚ä¸‹ï¼š\nvariables: DOCKER_DRIVER: overlay2 CI_REGISTRY_IMAGE: ${CI_REGISTRY}/mengzyou/app before_script: - echo $CI_JOB_NAME - echo $CI_PROJECT_DIR stages: - build build:docker: stage: build variables: DOCKER_HOST: tcp://docker:2375 image: docker:stable services: - docker:dind script: - echo \u0026#34;Building image - $CI_REGISTRY_IMAGE:latest\u0026#34; - echo \u0026#34;$CI_REGISTRY_PASSWORD\u0026#34; | docker login -u \u0026#34;$CI_REGISTRY_USER\u0026#34; --password-stdin $CI_REGISTRY - docker image build --force-rm --no-cache -t $CI_REGISTRY_IMAGE:latest . - docker image push $CI_REGISTRY_IMAGE:latest only: - master å…¶ä¸­æœ‰å‡ ä¸ªå˜é‡æ˜¯éœ€è¦åœ¨ä»£ç åº“çš„ Gitlab ä¸Šè¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\nå› ä¸ºç›´æ¥æ˜¯ç”¨äº† Gitlab æä¾›çš„å®¹å™¨é•œåƒæœåŠ¡ï¼Œæ„å»ºå®Œæˆçš„é•œåƒéœ€è¦æ¨é€åˆ°è¯¥é•œåƒä»“åº“æœåŠ¡ï¼Œæ‰€ä»¥éœ€è¦é…ç½®ç›¸åº”çš„ä»“åº“åœ°å€ï¼Œç”¨æˆ·åå’Œç™»å½•å¯†ç ï¼š\nCI_REGISTRY : ä»“åº“åœ°å€ï¼Œå¦‚ registry.gitlab.com CI_REGISTRY_USER : Gitlab çš„è®¿é—®ç”¨æˆ·å CI_REGISTRY_PASSWORD : Gitlab çš„è®¿é—®å¯†ç  è¿™æ ·åœ¨æ¨é€é•œåƒä¹‹å‰ï¼Œéœ€è¦è¿›è¡Œä¸€æ¬¡ç™»å½•æ“ä½œã€‚æ›´å¤šå…³äºå¦‚ä½•æ˜¯ç”¨ Gitlab å®¹å™¨é•œåƒä»“åº“å¯å‚è€ƒ https://docs.gitlab.com/ee/user/project/container_registry.html ã€‚\nè¯¥ pipeline å·¥ä½œä½¿ç”¨äº† Gitlab Runner çš„ docker æ‰§è¡Œå™¨ï¼Œå¦‚æœæ˜¯è‡ªå·±å®‰è£…å’Œæ³¨å†Œ gitlab-runner ï¼Œè¯·å‚è€ƒå…¶æ–‡æ¡£ã€‚è¿™é‡Œç›´æ¥æ˜¯ç”¨äº† Gitlab.com åˆ†äº«çš„ Runner ã€‚\nå®‰è£…ç”¨äºéƒ¨ç½²çš„gitlab-runner ä¸ºäº†åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šä½¿ç”¨ gitlab-ci è¿›è¡Œè‡ªåŠ¨éƒ¨ç½²ï¼ˆè¿è¡Œå®¹å™¨ï¼‰ï¼Œéœ€è¦åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå®‰è£…å’Œæ³¨å†Œ gitlab-runner ã€‚ç”±äºç›®æ ‡æœåŠ¡å™¨ä¸Šè¿è¡Œå®¹å™¨ï¼Œå› æ­¤åº”è¯¥é¦–å…ˆå®‰è£…å¥½ Docker ç¯å¢ƒï¼ŒåŒæ—¶ gitlab-runner ä¹Ÿç›´æ¥æ˜¯ç”¨å®¹å™¨è¿è¡Œï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥æœ¬åœ°è¿è¡Œï¼Œå…·ä½“å¯ä»¥æŸ¥çœ‹ gitlab-runner çš„æ–‡æ¡£ï¼‰ã€‚\nå®‰è£…æ³¨å†ŒRunner å¯ä»¥ä½¿ç”¨ docker-compose æ¥éƒ¨ç½² gitlab-runner å®¹å™¨ï¼Œåœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šçš„ ~/gitalb/ ç›®å½•ä¸‹ç¼–å†™å¦‚ä¸‹ docker-compose.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;2.4\u0026#39; services: runner: image: gitlab/gitlab-runner:alpine-v11.11.0 container_name: gitlab_runner restart: always network_mode: bridge volumes: - ./config/:/etc/gitlab-runner/ - /var/run/docker.sock:/var/run/docker.sock åˆ›å»ºç›®å½• config ç”¨äºä¿å­˜ runner çš„é…ç½®:\nmkdir config\nç„¶åå¯åŠ¨ runner å®¹å™¨ï¼š\ndocker-compose up -d runner\næ³¨å†Œ runner ä¹‹å‰éœ€è¦åœ¨ Gitlab é¡¹ç›®çš„ CI/CD é…ç½®ä¸­ï¼ˆè®¾ç½® \u0026gt; CI/CD \u0026gt; Runnerï¼‰æŸ¥çœ‹æ³¨å†Œ URL å’Œä»¤ç‰Œï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š\næ¥ä¸‹æ¥ï¼Œè¿è¡Œä¸€ä¸‹å‘½ä»¤è¿›è¡Œ runner çš„æ³¨å†Œ:\ndocker-compose exec runner gitlab-runner register \\ --url https://gitlab.com/ \\ --registration-token $REGISTRATION_TOKEN \\ --executor docker \\ --description \u0026#34;app-deployment-runner\u0026#34; \\ --tag-list \u0026#34;deploy,docker\u0026#34; \\ --docker-image \u0026#34;mengzyou/docker:19.03\u0026#34; \\ --docker-volumes /var/run/docker.sock:/var/run/docker.sock æ³¨æ„ : ä¸Šé¢çš„ $REGISTRATION_TOKEN éœ€è¦æ›¿æ¢æˆçœŸå®çš„ä»¤ç‰Œå€¼ã€‚\nä¸Šé¢çš„å‘½ä»¤æ³¨å†Œäº†ä¸€ä¸ªé»˜è®¤ä½¿ç”¨ mengzyou/docker é•œåƒè¿è¡Œå®¹å™¨çš„æ‰§è¡Œå™¨ï¼ŒåŒæ—¶æŒ‚è½½äº† /var/run/docker.sockï¼Œå› ä¸ºé»˜è®¤æ‰§è¡Œå®¹å™¨é‡Œçš„ docker å°†æˆ¿å±‹ä¸»æœºä¸Šçš„ docker æœåŠ¡ã€‚\né…ç½®Gitlab-ciè¿›è¡Œè‡ªåŠ¨éƒ¨ç½² åœ¨ .gitlab-ci.yml ä¸­å¢åŠ éƒ¨ç½²çš„å·¥ä½œï¼š\nstages: - build - deploy deoploy:docker: stage: deploy script: - echo \u0026#34;Deploy try_app - $CI_REGISTRY_IMAGE:latest\u0026#34; - echo \u0026#34;$CI_REGISTRY_PASSWORD\u0026#34; | docker login -u \u0026#34;$CI_REGISTRY_USER\u0026#34; --password-stdin $CI_REGISTRY - docker rm -f try_app || true - docker image pull $CI_REGISTRY_IMAGE:latest - docker container run --name try_app -p 80:80 -d $CI_REGISTRY_IMAGE:latest only: - master tags: - deploy - docker å½“ç„¶ï¼Œä¹Ÿå¯ä»¥å†™éƒ¨ç½²è„šæœ¬æ¥æ‰§è¡Œéƒ¨ç½²çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ docker-compose é€šè¿‡ docker-compose.yml æ–‡ä»¶æ¥æ‰§è¡Œï¼Œä¾‹å¦‚ï¼š\ndeoploy:docker: stage: deploy script: - echo \u0026#34;Deploy ${CD_COMPOSE_PROJECT}_app - $CI_REGISTRY_IMAGE:latest\u0026#34; - echo \u0026#34;$CI_REGISTRY_PASSWORD\u0026#34; | docker login -u \u0026#34;$CI_REGISTRY_USER\u0026#34; --password-stdin $CI_REGISTRY - docker image pull $CI_REGISTRY_IMAGE:latest - mkdir -p /tmp/${CD_COMPOSE_PROJECT} \u0026amp;\u0026amp; cp ${CI_PROJECT_DIR}/docker-compose.prod.yml /tmp/${CD_COMPOSE_PROJECT}/docker-compose.yml - cd /tmp/${CD_COMPOSE_PROJECT} \u0026amp;\u0026amp; docker-compose up -d myblog only: - master tags: - deploy - docker å…¶ä¸­å¯ä»¥å®šä¹‰ CD_COMPOSE_PROJECT å˜é‡æ¥æŒ‡å®š docker-compose çš„é¡¹ç›®åï¼Œç›¸åº”çš„åœ¨ä»£ç æ ¹ç›®å½•å¢åŠ  docker-compose.prod.yml æ–‡ä»¶ï¼š\nversion: \u0026#39;2.4\u0026#39; networks: web: external: true services: app: image: \u0026#34;registry.gitlab.com/mengzyou/app:latest\u0026#34; networks: - web restart: unless-stopped mem_limit: 256M labels: - \u0026#34;traefik.enable=true\u0026#34; - \u0026#34;traefik.docker.network=web\u0026#34; - \u0026#34;traefik.backend=app\u0026#34; - \u0026#34;traefik.frontend.rule=Host:app.mengz.me;PathPrefix:/\u0026#34; - \u0026#34;traefik.frontend.redirect.entryPoint=https\u0026#34; - \u0026#34;traefik.frontend.redirect.permanent=true\u0026#34; - \u0026#34;traefik.port=80\u0026#34; ä¸Šé¢çš„ docker-composle æ–‡ä»¶è¿˜å®šä¹‰äº† traefik ç›¸å…³çš„å‚æ•°ï¼Œè¿™è¦æ±‚åœ¨ç›®æ ‡æœåŠ¡å™¨ä¸Šå·²ç»è¿è¡Œäº†ç›¸åº”çš„ traefik æœåŠ¡ä½œä¸º Web ä»£ç†ã€‚\nå®Œæˆä»¥ä¸Šæ­¥éª¤ä¹‹åï¼Œæ¯æ¬¡æ¨é€ master åˆ†æ”¯ï¼Œéƒ½ä¼šè§¦å‘ç›¸åº”çš„ gitlab CI/CD pipeline æ¥æ‰§è¡Œæ¯ä¸ªé˜¶æ®µçš„ CI/CD å·¥ä½œï¼Œå¦‚ä¸‹å›¾ï¼š\næ€»ç»“ ä»¥ä¸Šä»…ä»…è¿›è¡Œäº†ä¸€ä¸ªç®€å•åº”ç”¨çš„ CI/CD ç¤ºä¾‹ï¼Œä¸»è¦æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ gitlab-ci å’Œ docker æ¥è¿›è¡Œ CI/CD æµç¨‹ã€‚\nå¯¹äºä¸åŒçš„é¡¹ç›®ï¼Œå¦‚ä½•æ„å»ºï¼Ÿå¦‚ä½•éƒ¨ç½²ï¼Œæƒ…å†µéƒ½å¯èƒ½ä¸ä¸€æ ·ï¼Œéœ€è¦æ ¹æ®ä¸åŒçš„åœºæ™¯æ¥ç¼–å†™ .gitlab-ci.yml æ–‡ä»¶ï¼Œéœ€è¦è¿›ä¸€æ­¥é˜…è¯»ç›¸åº”çš„æ–‡æ¡£ ã€‚\n","date":"January 1, 0001","hero":"/zh/posts/devops/gitlab-ci-docker/gitlab-ci-docker.png","permalink":"/zh/posts/devops/gitlab-ci-docker/","summary":"å®¹å™¨ Docker è¶Šæ¥è¶Šå—å¼€å‘è€…å’Œè¿ç»´äººå‘˜çš„å–œçˆ±ï¼Œæ›´æ˜¯ä½œä¸ºå®è·µ DevOps çš„ä¸€ä¸ªä¸­è¦å·¥å…·ã€‚åŒæ—¶ Gitlab æä¾›äº†å…è´¹çš„ä»£ç ç®¡ç†æœåŠ¡ï¼Œå…¶ gitlab-ci æ›´æ˜¯æä¾›äº†å¼ºå¤§çš„è‡ªåŠ¨åŒ– CI/CD æµç¨‹åŠŸèƒ½ã€‚\næœ¬æ–‡ä»¥ä¸€ä¸ªé™æ€ç«™ç‚¹çš„ç¤ºä¾‹æ¥è¯´æ˜å¦‚ä½•ä½¿ç”¨ gitlab-ci å’Œ docker è¿›è¡Œå®¹å™¨é•œåƒçš„æ„å»ºï¼Œä»¥åŠå¦‚ä½•å°†é•œåƒè‡ªåŠ¨åŒ–éƒ¨ç½²åˆ°ç›®æ ‡æœåŠ¡å™¨ä¸Šã€‚\nç¼–å†™Dockerfile é¦–å…ˆåœ¨ä»£ç åº“ä¸­å¢åŠ  Dockerfile ï¼Œç”¨äºæè¿°å¦‚ä½•æ„å»ºåº”ç”¨çš„å®¹å™¨é•œåƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäº Hugo çš„é™æ€ç«™ç‚¹åº”ç”¨çš„ç¤ºä¾‹ï¼š\nFROM mengzyou/hugo:latest as builder COPY . /app/ RUN hugo FROM nginx:1.16-alpine RUN set -x \\ \u0026amp;\u0026amp; rm -f /etc/nginx/conf.d/default.conf \\ \u0026amp;\u0026amp; mkdir -p /usr/share/nginx/html COPY --from=builder /app/nginx-default.conf /etc/nginx/conf.d/default.conf COPY --from=builder /app/public/ /usr/share/nginx/html å…¶å®éå¸¸ç®€å•ï¼Œä½¿ç”¨äº†å¤šé˜¶æ®µæ„å»ºï¼Œä»¥ mengzyou/hugo ä½œä¸ºæ„å»ºé•œåƒï¼Œç„¶åå°†ç”Ÿæˆçš„é™æ€æ–‡ä»¶æ‹·è´åˆ° nginx é•œåƒä¸­ï¼Œæœ€ç»ˆç”Ÿæˆé™æ€ç«™ç‚¹çš„é•œåƒã€‚\né…ç½®Gitlab-ciæ„å»ºå®¹å™¨é•œåƒ è¯¥é˜¶æ®µï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•æ·»åŠ  .gitlab-ci.yml æ–‡ä»¶ï¼Œç¤ºä¾‹å†…å®¹å¦‚ä¸‹ï¼š\nvariables: DOCKER_DRIVER: overlay2 CI_REGISTRY_IMAGE: ${CI_REGISTRY}/mengzyou/app before_script: - echo $CI_JOB_NAME - echo $CI_PROJECT_DIR stages: - build build:docker: stage: build variables: DOCKER_HOST: tcp://docker:2375 image: docker:stable services: - docker:dind script: - echo \u0026#34;Building image - $CI_REGISTRY_IMAGE:latest\u0026#34; - echo \u0026#34;$CI_REGISTRY_PASSWORD\u0026#34; | docker login -u \u0026#34;$CI_REGISTRY_USER\u0026#34; --password-stdin $CI_REGISTRY - docker image build --force-rm --no-cache -t $CI_REGISTRY_IMAGE:latest .","tags":["gitlab","cicd","docker"],"title":"GITLAB CIè‡ªåŠ¨éƒ¨ç½²å®¹å™¨åº”ç”¨"}]