<!doctype html><html lang=zh><head><title>DOCKER构建MariaDB</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/application.fb9df7e952c9dccf496d00faec07de633aae460f909bbba4b5e0ad22f5887d73.css integrity="sha256-+5336VLJ3M9JbQD67AfeYzquRg+Qm7ukteCtIvWIfXM="><link rel=icon type=image/png href=/images/site/favicon_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png><meta property="og:title" content="DOCKER构建MariaDB"><meta property="og:description" content="使用Dockerfile构建并运行MariaDB数据库"><meta property="og:type" content="article"><meta property="og:url" content="/zh/posts/container-tech/mariadb-docker/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2015-05-27T23:09:00+08:00"><meta property="article:modified_time" content="2015-05-27T23:09:00+08:00"><meta name=description content="使用Dockerfile构建并运行MariaDB数据库"><script src=https://cdn.counter.dev/script.js data-id=2905461c-37df-49f9-a4ca-0ea1ba64543a data-utcoffset=1></script></head><body class="type-posts kind-page" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/zh/><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png alt=Logo>
Mengz's Space ...</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme"></a>
<a class="dropdown-item nav-link" href=# data-scheme=dark><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a>
<a class="dropdown-item nav-link" href=# data-scheme=system><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/zh/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/zh/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/k8s/>Kubernetes</a><ul><li><a href=/zh/posts/k8s/health-checks/ title=K8S健康检查最佳实践>K8S健康检查最佳实践</a></li><li><a href=/zh/posts/k8s/kubectl-plugins/ title=扩展你的KUBECTL功能>扩展你的KUBECTL功能</a></li><li><a href=/zh/posts/k8s/lightweight-k3s/ title=轻量级Kubernetes集群-K3S>轻量级Kubernetes集群-K3S</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/linux/>LINUX</a><ul><li><a href=/zh/posts/linux/bumlebee-nvidia/ title=BUMBLEBEE禁用NVIDIA显卡>BUMBLEBEE禁用NVIDIA显卡</a></li><li><a href=/zh/posts/linux/systemd-hostnamectl/ title=HOSTNAMECTL管理主机名>HOSTNAMECTL管理主机名</a></li><li><a href=/zh/posts/linux/make-undeletable/ title=LINUX上创建不可删除文件>LINUX上创建不可删除文件</a></li><li><a href=/zh/posts/linux/network-packets/ title=LINUX上统计网络接口数据包>LINUX上统计网络接口数据包</a></li><li><a href=/zh/posts/linux/opensuse-zypper/ title=OPENSUSE上的ZYPPER包管理器>OPENSUSE上的ZYPPER包管理器</a></li><li><a href=/zh/posts/linux/opensuse-cronjob/ title=OPENSUSE上的定时任务>OPENSUSE上的定时任务</a></li><li><a href=/zh/posts/linux/systemd-systemctl/ title=SYSTEMCTL管理系统服务>SYSTEMCTL管理系统服务</a></li><li><a href=/zh/posts/linux/systemd-timer/ title=SYSTEMD定时服务>SYSTEMD定时服务</a></li><li><a href=/zh/posts/linux/opensuse-upgrade/ title="升级OPENSUSE LEAP">升级OPENSUSE LEAP</a></li><li><a href=/zh/posts/linux/wireguard-vpn/ title=在LINUX上配置WIREGUARD>在LINUX上配置WIREGUARD</a></li><li><a href=/zh/posts/linux/ubuntu-old-kernel/ title=在UBUNTU上删除旧的内核>在UBUNTU上删除旧的内核</a></li><li><a href=/zh/posts/linux/what-hardware/ title=查看硬件信息>查看硬件信息</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/windows/>Windows</a><ul><li><a href=/zh/posts/windows/windows10-wsl2/ title=Windows10上安装WSL2>Windows10上安装WSL2</a></li><li><a href=/zh/posts/windows/windows10-virtio-image/ title=加载virtio驱动的Windows10安装镜像>加载virtio驱动的Windows10安装镜像</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/zh/posts/container-tech/>容器技术</a><ul class=active><li><a href=/zh/posts/container-tech/docker-live-restore/ title="DOCKER LIVERESTORE特性">DOCKER LIVERESTORE特性</a></li><li><a href=/zh/posts/container-tech/docker-sbom/ title="DOCKER SBOM镜像物料清单">DOCKER SBOM镜像物料清单</a></li><li><a href=/zh/posts/container-tech/dockerfile-best/ title=DOCKERFILE构建最佳实践>DOCKERFILE构建最佳实践</a></li><li><a href=/zh/posts/container-tech/docker-intro/ title=DOCKER入门>DOCKER入门</a></li><li><a class=active href=/zh/posts/container-tech/mariadb-docker/ title=DOCKER构建MariaDB>DOCKER构建MariaDB</a></li><li><a href=/zh/posts/container-tech/docker-container-app/ title=DOCKER构建容器化应用>DOCKER构建容器化应用</a></li><li><a href=/zh/posts/container-tech/docker-wechat/ title=DOCKER运行微信桌面客户端>DOCKER运行微信桌面客户端</a></li><li><a href=/zh/posts/container-tech/docker-desktop-windows/ title="WINDOWS上的DOCKER DESKTOP">WINDOWS上的DOCKER DESKTOP</a></li><li><a href=/zh/posts/container-tech/docker-compose-v2/ title="开始使用DOCKER COMPOSE V2">开始使用DOCKER COMPOSE V2</a></li><li><a href=/zh/posts/container-tech/smallest-web-container/ title=最小化静态WEB容器实践>最小化静态WEB容器实践</a></li><li><a href=/zh/posts/container-tech/docker-mqtt-broker/ title=本地环境运行MQTT容器>本地环境运行MQTT容器</a></li><li><a href=/zh/posts/container-tech/docker-context-remote/ title=管理远程DOCKER主机>管理远程DOCKER主机</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/devops/>开发运维</a><ul><li><a href=/zh/posts/devops/github-actions/ title="GITHUB ACTIONS工作流">GITHUB ACTIONS工作流</a></li><li><a href=/zh/posts/devops/gitlab-ci-docker/ title="GITLAB CI自动部署容器应用">GITLAB CI自动部署容器应用</a></li><li><a href=/zh/posts/devops/k3s-terraform-ansible/ title=IaC示例-TERRAFORM&amp;ANSIBLE创建K3S集群>IaC示例-TERRAFORM&amp;ANSIBLE创建K3S集群</a></li><li><a href=/zh/posts/devops/tf-rover/ title=TF执行计划可视化>TF执行计划可视化</a></li><li><a href=/zh/posts/devops/tf-aws-lightsail/ title="TF管理AWS LIGHTSAIL实例">TF管理AWS LIGHTSAIL实例</a></li><li><a href=/zh/posts/devops/single-application-cicd/ title=一体化CI/CD平台>一体化CI/CD平台</a></li><li><a href=/zh/posts/devops/open-gitops/ title="解读OPEN GITOPS 1.0">解读OPEN GITOPS 1.0</a></li><li><a href=/zh/posts/devops/tf-cloud/ title="迁移本地项目到TF CLOUD">迁移本地项目到TF CLOUD</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/opentool/>开源工具</a><ul><li><a href=/zh/posts/opentool/diun-intro/ title=DIUN-容器镜像更新通知>DIUN-容器镜像更新通知</a></li><li><a href=/zh/posts/opentool/rclone-sync/ title=RCLOUD与云存储同步>RCLOUD与云存储同步</a></li><li><a href=/zh/posts/opentool/find-files/ title=文件系统查找工具>文件系统查找工具</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/programming/>编程</a><ul><li><a href=/zh/posts/programming/cocktail-improve/ title=改良鸡尾酒排序算法>改良鸡尾酒排序算法</a></li><li><a href=/zh/posts/programming/shell-debug/ title=调试Shell脚本错误>调试Shell脚本错误</a></li></ul></li><li><a href=/zh/posts/markdown-sample/ title=Markdown示例>Markdown示例</a></li><li><a href=/zh/posts/shortcodes/ title=短代码示例>短代码示例</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/zh/posts/container-tech/mariadb-docker/mariadb-docker.png)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/mengzyou_hu94ee2a0121294b6b0424034f13ce004a_66548_120x120_fit_box_3.png alt="Author Image"><h5 class=author-name>You Mengzhe</h5><p>2015年5月27日星期三</p></div><div class=title><h1>DOCKER构建MariaDB</h1></div><div class=taxonomy-terms><ul style=padding-left:0><li class=rounded><a href=/zh/tags/docker/ class="btn, btn-sm">docker</a></li><li class=rounded><a href=/zh/tags/mariadb/ class="btn, btn-sm">mariadb</a></li></ul></div><div class=post-content id=post-content><p>现在 <a href=https://www.docker.com target=_blank rel=noopener>Docker</a> 可所谓是最火的容器技术了，至于什么是 Docker，请到其<a href=https://www.docker.com target=_blank rel=noopener>官方网站</a>或者<a href=http://zh.wikipedia.org/wiki/Docker_%28%E8%BB%9F%E9%AB%94%29 target=_blank rel=noopener>维基百科</a>查看。<br>这里想通过一个示例来看看怎么通过 <a href=https://docs.docker.com/reference/builder/ target=_blank rel=noopener>Dockerfile</a> 来构建一个 Docker 镜像。</p><h2 id=构建mariadb容器镜像>构建MariaDB容器镜像</h2><p>Docker 提供了两种方法来生产应用镜像:</p><ol><li>通过启动一个基础容器（比如基于某种 Linux 发行版的镜像的容器），然后在容器里执行各种命令来安装相应的软件包，进行配置后，再通过 <a href=https://docs.docker.com/reference/commandline/cli/#commit target=_blank rel=noopener>docker commit</a> 命令把已经更新的容器生产相应的镜像。</li><li>通过编写一个 Dockerfile ，然后使用 <a href=https://docs.docker.com/reference/commandline/cli/#build target=_blank rel=noopener>docker build</a> 命令来构建相应的镜像。</li></ol><p>相比第一种方式，通过 Dockerfile 的方式，可以更好的维护镜像，将镜像的 Dockerfile 提交到版本库管理。还可以在 <a href=https://hub.docker.com/ target=_blank rel=noopener>Docker Hub</a> 里创建镜像的自动构建。</p><p>下面让我们通过如何编写 Dockerfile 来构建一个 <a href=https://mariadb.org/ target=_blank rel=noopener>mariadb</a> 的镜像：</p><p>首先创建一个目录，如 <code>docker-mariadb</code> ，然后编写一个名为 <em>Dockerfile</em> 的文件，内容如下：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-dockerfile data-lang=dockerfile><span style=display:flex><span><span style=color:#66d9ef>FROM</span><span style=color:#e6db74> opensuse:13.2</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>MAINTAINER</span><span style=color:#e6db74> Mengz You &lt;you.mengz@yahoo.com&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> MARIADB_MAJOR 10.0<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> MARIADB_VERSION 10.0.17<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> MYSQL_ROOT_PASSWORD mysecretpassword<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENV</span> MYSQL_DATADIR /var/lib/mysql<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> zypper ar -f -r http://download.opensuse.org/repositories/server:/database/openSUSE_13.2/server:database.repo <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> zypper -n --gpg-auto-import-keys ref<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> zypper -n in --no-recommends mariadb-$MARIADB_VERSION net-tools <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> zypper clean --all<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>RUN</span> mkdir -p /var/lib/mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> mkdir -p /var/log/mysql <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>  <span style=color:#f92672>&amp;&amp;</span> chown mysql:mysql /var/log/mysql<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>VOLUME</span><span style=color:#e6db74> /var/lib/mysql</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>COPY</span> docker-entrypoint.sh /<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>ENTRYPOINT</span> [<span style=color:#e6db74>&#34;/docker-entrypoint.sh&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>EXPOSE</span><span style=color:#e6db74> 3306</span><span style=color:#960050;background-color:#1e0010>
</span></span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010></span><span style=color:#66d9ef>CMD</span> [<span style=color:#e6db74>&#34;mysqld_safe&#34;</span>]<span style=color:#960050;background-color:#1e0010>
</span></span></span></code></pre></div><p>让我们来看看上面的 Dockerfile 里用到的指令：</p><ul><li><strong>FROM</strong> ： 指明用来构建该镜像的基础镜像，该示例中我们使用 Docker Hub 官方的 <a href=https://registry.hub.docker.com/_/opensuse/ target=_blank rel=noopener>opensuse</a> 镜像，格式为 <code>image[:tag]</code> ；</li><li><strong>MAINTAINER</strong> ： 指明该 Dockerfile 的维护者；</li><li><strong>ENV</strong> ： 设置环境变量，后面的命令可以使用这些变量。也可以在启动容器时改变其值；</li><li><strong>RUN</strong> ： 执行命令，比如设置软件源，安装相应的软件包，在上面的例子中，将会在构建镜像的时候安装 Mariadb 的包，然后配置一些使用的目录；</li><li><strong>VOLUME</strong> ： 设置目录卷，使得在运行容器的时候可以通过 <code>-v</code> 参数来指定挂载和主机同步的目录；</li><li><strong>COPY</strong> ： 将构建目录下的脚本放到镜像里，然后可以在容器中执行。上例中，<code>docker-entrypoint.sh</code> 将在启动容器时作为容器入口点执行；</li><li><strong>ENTRYPOINT</strong> ： 配置容器启动时执行的命令，每个 Dockerfile 中之应该只有一个 ENTRYPOINT ；</li><li><strong>EXPOSE</strong> ： 配置容器暴露的服务端口号，在启动容器时，如果使用 <code>-P</code> 参数，Docker 主机将会自动分配一个随机端口转发到制定的端口，也可以额使用 <code>-p</code> 制定主机的具体端口；</li><li><strong>CMD</strong> ： 也是可以制定容器启动时执行的命令，其和 ENTRYPOINT 的区别是，其可以作为 ENTRYPOINT 的参数，如上例中启动容器时，其实执行的是 <code>/docker-entrypint.sh mysqld_safe</code>。还有一个区别就是 ENTRYPOINT 制定的命令不能被启动容器时的命令覆盖，而 CMD 指定的可以被覆盖。</li></ul><p>以上是本示例中用的指令，其实 Dockerfile 还有其他指令，请参考 Dockerfile 的<a href=https://docs.docker.com/reference/builder/ target=_blank rel=noopener>文档</a>。</p><p>由于本例中我们使用到了一个脚本来作为容器的入口命令，因此还需要在当前目录下写该脚本文件 <code>docker-entrypoint.sh</code> ：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#75715e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>set -e
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> ! -d <span style=color:#e6db74>&#34;</span>$MYSQL_DATADIR<span style=color:#e6db74>/mysql&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#39;Running mysql_install_db ...&#39;</span>
</span></span><span style=display:flex><span>  mysql_install_db --datadir<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$MYSQL_DATADIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#39;Finished mysql_install_db&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  tempSqlFile<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;/tmp/mysql-first-time.sql&#39;</span>
</span></span><span style=display:flex><span>  cat &gt; <span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span> <span style=color:#e6db74>&lt;&lt;-EOSQL
</span></span></span><span style=display:flex><span><span style=color:#e6db74>DELETE FROM mysql.user ;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>CREATE USER &#39;root&#39;@&#39;%&#39; IDENTIFIED BY &#39;${MYSQL_ROOT_PASSWORD}&#39; ;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>GRANT ALL ON *.* TO &#39;root&#39;@&#39;%&#39; WITH GRANT OPTION ;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>DROP DATABASE IF EXISTS test ;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>EOSQL</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$MYSQL_DATABASE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;CREATE DATABASE IF NOT EXISTS \`</span>$MYSQL_DATABASE<span style=color:#e6db74>\` ;&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$MYSQL_USER<span style=color:#e6db74>&#34;</span> -a <span style=color:#e6db74>&#34;</span>$MYSQL_PASSWORD<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>    echo <span style=color:#e6db74>&#34;CREATE USER &#39;</span>$MYSQL_USER<span style=color:#e6db74>&#39;@&#39;%&#39; IDENTIFIED BY &#39;</span>$MYSQL_PASSWORD<span style=color:#e6db74>&#39; ;&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>[</span> <span style=color:#e6db74>&#34;</span>$MYSQL_DATABASE<span style=color:#e6db74>&#34;</span> <span style=color:#f92672>]</span>; <span style=color:#66d9ef>then</span>
</span></span><span style=display:flex><span>      echo <span style=color:#e6db74>&#34;GRANT ALL ON \`</span>$MYSQL_DATABASE<span style=color:#e6db74>\`.* TO &#39;</span>$MYSQL_USER<span style=color:#e6db74>&#39;@&#39;%&#39; ;&#34;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  echo <span style=color:#e6db74>&#39;FLUSH PRIVILEGES ;&#39;</span> &gt;&gt; <span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>  set -- <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span> --init-file<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;</span>$tempSqlFile<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>chown -R mysql:mysql <span style=color:#e6db74>&#34;</span>$MYSQL_DATADIR<span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>exec <span style=color:#e6db74>&#34;</span>$@<span style=color:#e6db74>&#34;</span>
</span></span></code></pre></div><p>该脚本通过相应的环境变量来初始化 mariadb 实例，后面我们会给出容器运行的命令示例。</p><p>最后，我们就可以通过在当前目录下执行 <code>docker build</code> 命令来构建镜像，如：</p><p><code>docker build -t docker-mariadb:latest .</code></p><p>如果本地没有 opensuse 的镜像，首先会下载 opensuse 的镜像，然后会基于 opensuse 的镜像，运行 Dockerfile 里指定的命令，最后会生成 <strong>docker-mariadb:latest</strong> 镜像，可以通过 <code>docker images</code> 看到。</p><h2 id=运行mariadb容器>运行Mariadb容器</h2><p>镜像生成后，如何来运行该镜像的容器呢？通过上面的脚本，我们可以看到，我们在启动容器时可以指定相应的环境变量，如：</p><p><code>docker run --name mydb -e MYSQL_USER=test -e MYSQL_PASSWORD=testpw -e MYSQL_DATABASE=testdb -p 13306:3306 -d docker-mariadb:latest</code></p><p>该命令会启动一个该镜像的容器，名为 &lsquo;mydb&rsquo;，容器中的 mariadb 会在启动时创建名为 &rsquo;testdb&rsquo; 的数据库实例，名为 &rsquo;test&rsquo; 的数据库用户，其密码为 &rsquo;testpw&rsquo;。<br>这时你就可以通过在主机上运行一下命令来尝试登录数据库了：</p><p><code>mysql -h127.0.0.1 -P13306 -utest -ptestpw testdb</code></p><p>是不是感觉通过 Dockerfile 来构建 Docker 镜像是如此的简单。最后你可以将该目录作为一个项目 push 到 <a href=https://github.com target=_blank rel=noopener>Github</a>，然后在到 Docker Hub 去创建一个仓库，然后配置到 Github 代码库，每当你 push 更新 Dockerfile 后，都会自动构建镜像。就像<a href=https://registry.hub.docker.com/u/mengzyou/ target=_blank rel=noopener>我的镜像库</a>一样，当然在 Docker Hub 里还有来自全世界人们构建的镜像。</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=%2fzh%2fposts%2fcontainer-tech%2fmariadb-docker%2f" target=_blank><i class="fab fa-facebook"></i></a>
<a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=%2fzh%2fposts%2fcontainer-tech%2fmariadb-docker%2f&text=DOCKER%e6%9e%84%e5%bb%baMariaDB&via=Mengz%27s%20Space%20..." target=_blank><i class="fab fa-twitter"></i></a>
<a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=%2fzh%2fposts%2fcontainer-tech%2fmariadb-docker%2f&title=DOCKER%e6%9e%84%e5%bb%baMariaDB" target=_blank><i class="fab fa-linkedin"></i></a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/zh/posts/container-tech/docker-intro/ title=DOCKER入门 class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>DOCKER入门</div></a></div><div class="col-md-6 next-article"><a href=/zh/posts/container-tech/docker-container-app/ title=DOCKER构建容器化应用 class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>DOCKER构建容器化应用</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#构建mariadb容器镜像>构建MariaDB容器镜像</a></li><li><a href=#运行mariadb容器>运行Mariadb容器</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/zh/#about>关于</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#experiences>工作经历</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#education>教育</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#recent-posts>近期文章</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#accomplishments>技能学习</a></li><li class=nav-item><a class=smooth-scroll href=https://live.mengz.dev/>LiveTerm</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:mengz.you@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>mengz.you@outlook.com</span></a></li><li><a href=https://github.com/mengzyou target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>mengzyou</span></a></li><li><a href=https://www.linkedin.com/in/mengzyou target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>You Mengzhe</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2023 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.d06ddacd4080231ac954a78539ea5f5a1921ebbd740618450ead7a0e8466dfda.js integrity="sha256-0G3azUCAIxrJVKeFOepfWhkh6710BhhFDq16DoRm39o=" defer></script></body></html>