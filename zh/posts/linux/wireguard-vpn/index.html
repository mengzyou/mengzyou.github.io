<!doctype html><html lang=zh><head><title>在LINUX上配置WIREGUARD</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.fb9df7e952c9dccf496d00faec07de633aae460f909bbba4b5e0ad22f5887d73.css integrity="sha256-+5336VLJ3M9JbQD67AfeYzquRg+Qm7ukteCtIvWIfXM="><link rel=icon type=image/png href=/images/site/favicon_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png><meta property="og:url" content="/zh/posts/linux/wireguard-vpn/"><meta property="og:site_name" content="Mengz's Space ..."><meta property="og:title" content="在LINUX上配置WIREGUARD"><meta property="og:description" content="什么是 WireGuard ？ 其官方宣称是快速、现代以及安全的VPN隧道（Fast, Modern, Secure VPN Tunnel）。
WireGuard使用了最先进的加密技术，相比 IPSec 更简单更精简，而且拥有几乎超越 OpenVPN 的性能。其最初是针对Linux内核发布的，但是现在已经跨平台（Windows, MacOS, BSD, Android, iOS等）可部署。
接下来这篇How To系列文章，就来一步步在Ubuntu (Linux)上安装和配置WireGuard VPN，其中一台云主机运行Ubuntu-20.04用作VPN服务器，另一台本地的linux桌面环境作为VPN客户端。
服务器端安装WireGuard 这里我们的服务器使用的是操作系统为Ubuntu 20.04的云主机，对于如何创建并配置一台云主机，可以选择 [DigitalOcean]（https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04）。
这里我们我们已经配置好一台Ubuntu 20.04的云主机，并且可以通过SSH访问。首先对系统进行安全更新
$ sudo apt update $ sudo apt upgrade 接下来直接使用APT安装WireGuard软件包
$ sudo apt install wireguard 会同时安装 wireguard-tools 软件包，我们需要使用其工具进行相关的配置。
配置WireGuard服务端 进入root权限进行操作，为服务端生产私有/公共密钥对
$ sudo -i \# cd /etc/wireguard/ \# umask 077 \# wg genkey | tee privatekey | wg pubkey &amp;gt; publickey 执行完上述命令后，我们会在目录 /etc/wireguard/ 下生产两个密钥文件 privatekey 和 publickey 。"><meta property="og:locale" content="zh"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-12-03T11:56:29+08:00"><meta property="article:modified_time" content="2020-12-03T11:56:29+08:00"><meta property="article:tag" content="Wireguard"><meta property="article:tag" content="Vpn"><meta name=description content="在LINUX上配置WIREGUARD"><script src=https://cdn.counter.dev/script.js data-id=2905461c-37df-49f9-a4ca-0ea1ba64543a data-utcoffset=1></script></head><body class="type-posts kind-page" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/zh/><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png alt=Logo>
Mengz's Space ...</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/zh/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/zh/posts/ data-filter=all>Posts</a></li><div class=subtree><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/k8s/>Kubernetes</a><ul><li><a href=/zh/posts/k8s/health-checks/ title=K8S健康检查最佳实践>K8S健康检查最佳实践</a></li><li><a href=/zh/posts/k8s/kubectl-plugins/ title=扩展你的KUBECTL功能>扩展你的KUBECTL功能</a></li><li><a href=/zh/posts/k8s/lightweight-k3s/ title=轻量级Kubernetes集群-K3S>轻量级Kubernetes集群-K3S</a></li></ul></li><li><i class="fas fa-minus-circle"></i><a class=active href=/zh/posts/linux/>LINUX</a><ul class=active><li><a href=/zh/posts/linux/bumlebee-nvidia/ title=BUMBLEBEE禁用NVIDIA显卡>BUMBLEBEE禁用NVIDIA显卡</a></li><li><a href=/zh/posts/linux/systemd-hostnamectl/ title=HOSTNAMECTL管理主机名>HOSTNAMECTL管理主机名</a></li><li><a href=/zh/posts/linux/make-undeletable/ title=LINUX上创建不可删除文件>LINUX上创建不可删除文件</a></li><li><a href=/zh/posts/linux/network-packets/ title=LINUX上统计网络接口数据包>LINUX上统计网络接口数据包</a></li><li><a href=/zh/posts/linux/opensuse-zypper/ title=OPENSUSE上的ZYPPER包管理器>OPENSUSE上的ZYPPER包管理器</a></li><li><a href=/zh/posts/linux/opensuse-cronjob/ title=OPENSUSE上的定时任务>OPENSUSE上的定时任务</a></li><li><a href=/zh/posts/linux/systemd-systemctl/ title=SYSTEMCTL管理系统服务>SYSTEMCTL管理系统服务</a></li><li><a href=/zh/posts/linux/systemd-timer/ title=SYSTEMD定时服务>SYSTEMD定时服务</a></li><li><a href=/zh/posts/linux/opensuse-upgrade/ title="升级OPENSUSE LEAP">升级OPENSUSE LEAP</a></li><li><a class=active href=/zh/posts/linux/wireguard-vpn/ title=在LINUX上配置WIREGUARD>在LINUX上配置WIREGUARD</a></li><li><a href=/zh/posts/linux/ubuntu-old-kernel/ title=在UBUNTU上删除旧的内核>在UBUNTU上删除旧的内核</a></li><li><a href=/zh/posts/linux/what-hardware/ title=查看硬件信息>查看硬件信息</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/windows/>Windows</a><ul><li><a href=/zh/posts/windows/windows10-wsl2/ title=Windows10上安装WSL2>Windows10上安装WSL2</a></li><li><a href=/zh/posts/windows/windows10-virtio-image/ title=加载virtio驱动的Windows10安装镜像>加载virtio驱动的Windows10安装镜像</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/container-tech/>容器技术</a><ul><li><a href=/zh/posts/container-tech/docker-live-restore/ title="DOCKER LIVERESTORE特性">DOCKER LIVERESTORE特性</a></li><li><a href=/zh/posts/container-tech/docker-sbom/ title="DOCKER SBOM镜像物料清单">DOCKER SBOM镜像物料清单</a></li><li><a href=/zh/posts/container-tech/dockerfile-best/ title=DOCKERFILE构建最佳实践>DOCKERFILE构建最佳实践</a></li><li><a href=/zh/posts/container-tech/docker-intro/ title=DOCKER入门>DOCKER入门</a></li><li><a href=/zh/posts/container-tech/mariadb-docker/ title=DOCKER构建MariaDB>DOCKER构建MariaDB</a></li><li><a href=/zh/posts/container-tech/docker-container-app/ title=DOCKER构建容器化应用>DOCKER构建容器化应用</a></li><li><a href=/zh/posts/container-tech/docker-wechat/ title=DOCKER运行微信桌面客户端>DOCKER运行微信桌面客户端</a></li><li><a href=/zh/posts/container-tech/docker-desktop-windows/ title="WINDOWS上的DOCKER DESKTOP">WINDOWS上的DOCKER DESKTOP</a></li><li><a href=/zh/posts/container-tech/docker-compose-v2/ title="开始使用DOCKER COMPOSE V2">开始使用DOCKER COMPOSE V2</a></li><li><a href=/zh/posts/container-tech/smallest-web-container/ title=最小化静态WEB容器实践>最小化静态WEB容器实践</a></li><li><a href=/zh/posts/container-tech/docker-mqtt-broker/ title=本地环境运行MQTT容器>本地环境运行MQTT容器</a></li><li><a href=/zh/posts/container-tech/docker-context-remote/ title=管理远程DOCKER主机>管理远程DOCKER主机</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/devops/>开发运维</a><ul><li><a href=/zh/posts/devops/github-actions/ title="GITHUB ACTIONS工作流">GITHUB ACTIONS工作流</a></li><li><a href=/zh/posts/devops/gitlab-ci-docker/ title="GITLAB CI自动部署容器应用">GITLAB CI自动部署容器应用</a></li><li><a href=/zh/posts/devops/k3s-terraform-ansible/ title=IaC示例-TERRAFORM&amp;ANSIBLE创建K3S集群>IaC示例-TERRAFORM&amp;ANSIBLE创建K3S集群</a></li><li><a href=/zh/posts/devops/tf-rover/ title=TF执行计划可视化>TF执行计划可视化</a></li><li><a href=/zh/posts/devops/tf-aws-lightsail/ title="TF管理AWS LIGHTSAIL实例">TF管理AWS LIGHTSAIL实例</a></li><li><a href=/zh/posts/devops/single-application-cicd/ title=一体化CI/CD平台>一体化CI/CD平台</a></li><li><a href=/zh/posts/devops/open-gitops/ title="解读OPEN GITOPS 1.0">解读OPEN GITOPS 1.0</a></li><li><a href=/zh/posts/devops/tf-cloud/ title="迁移本地项目到TF CLOUD">迁移本地项目到TF CLOUD</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/opentool/>开源工具</a><ul><li><a href=/zh/posts/opentool/diun-intro/ title=DIUN-容器镜像更新通知>DIUN-容器镜像更新通知</a></li><li><a href=/zh/posts/opentool/rclone-sync/ title=RCLOUD与云存储同步>RCLOUD与云存储同步</a></li><li><a href=/zh/posts/opentool/find-files/ title=文件系统查找工具>文件系统查找工具</a></li></ul></li><li><i class="fas fa-plus-circle"></i><a href=/zh/posts/programming/>编程</a><ul><li><a href=/zh/posts/programming/cocktail-improve/ title=改良鸡尾酒排序算法>改良鸡尾酒排序算法</a></li><li><a href=/zh/posts/programming/shell-debug/ title=调试Shell脚本错误>调试Shell脚本错误</a></li></ul></li><li><a href=/zh/posts/markdown-sample/ title=Markdown示例>Markdown示例</a></li><li><a href=/zh/posts/shortcodes/ title=短代码示例>短代码示例</a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class=content><div class="container p-0 read-area"><div class="hero-area col-sm-12" id=hero-area style=background-image:url(/images/default-hero.jpg)></div><div class=page-content><div class="author-profile ml-auto align-self-lg-center"><img class=rounded-circle src=/images/author/mengzyou_huc2c98b30dea57d312a21b09cfacc124e_6244_120x120_fit_q75_h2_box_2.webp alt="Author Image"><h5 class=author-name>You Mengzhe</h5><p>2020年12月3日星期四</p></div><div class=title><h1>在LINUX上配置WIREGUARD</h1></div><div class=taxonomy-terms><ul style=padding-left:0><li class=rounded><a href=/zh/tags/wireguard/ class="btn, btn-sm">wireguard</a></li><li class=rounded><a href=/zh/tags/vpn/ class="btn, btn-sm">vpn</a></li></ul></div><div class=post-content id=post-content><p>什么是 <a href=https://www.wireguard.com/ target=_blank rel=noopener>WireGuard</a> ？ 其官方宣称是快速、现代以及安全的<a href=https://zh.wikipedia.org/zh-cn/%E8%99%9B%E6%93%AC%E7%A7%81%E4%BA%BA%E7%B6%B2%E8%B7%AF target=_blank rel=noopener>VPN</a>隧道（Fast, Modern, Secure VPN Tunnel）。<br>WireGuard使用了最先进的加密技术，相比 <a href=https://zh.wikipedia.org/zh-cn/IPsec target=_blank rel=noopener>IPSec</a> 更简单更精简，而且拥有几乎超越 <a href=https://zh.wikipedia.org/zh-cn/OpenVPN target=_blank rel=noopener>OpenVPN</a> 的性能。其最初是针对Linux内核发布的，但是现在已经跨平台（Windows, MacOS, BSD, Android, iOS等）可部署。</p><p>接下来这篇<em>How To</em>系列文章，就来一步步在Ubuntu (Linux)上安装和配置WireGuard VPN，其中一台云主机运行Ubuntu-20.04用作VPN服务器，另一台本地的linux桌面环境作为VPN客户端。</p><h2 id=服务器端安装wireguard>服务器端安装WireGuard</h2><p>这里我们的服务器使用的是操作系统为Ubuntu 20.04的云主机，对于如何创建并配置一台云主机，可以选择 [DigitalOcean]（https://www.digitalocean.com/community/tutorials/initial-server-setup-with-ubuntu-20-04）。</p><p>这里我们我们已经配置好一台Ubuntu 20.04的云主机，并且可以通过SSH访问。首先对系统进行安全更新</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt update
</span></span><span style=display:flex><span>$ sudo apt upgrade
</span></span></code></pre></div><p>接下来直接使用APT安装WireGuard软件包</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo apt install wireguard
</span></span></code></pre></div><p>会同时安装 <code>wireguard-tools</code> 软件包，我们需要使用其工具进行相关的配置。</p><h2 id=配置wireguard服务端>配置WireGuard服务端</h2><p>进入<strong>root</strong>权限进行操作，为服务端生产私有/公共密钥对</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo -i
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> cd /etc/wireguard/
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> umask <span style=color:#ae81ff>077</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> wg genkey | tee privatekey | wg pubkey &gt; publickey
</span></span></code></pre></div><p>执行完上述命令后，我们会在目录 <em>/etc/wireguard/</em> 下生产两个密钥文件 <em>privatekey</em> 和 <em>publickey</em> 。</p><p>接下来我们需要创建一个接口配置文件，命名为 <em>wg0.conf</em>，编辑并添加如下内容</p><pre tabindex=0><code class=language-conf data-lang=conf>[Interface]
## VPN server private IP address ##
Address = 192.168.6.1/24
 
## VPN server port ##
ListenPort = 4114
 
## VPN server&#39;s private key i.e. /etc/wireguard/privatekey ##
PrivateKey = xxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre><p>其中 <strong>Address</strong> 指定该网络接口的IP地址，可自己设定一个子网的地址，<strong>ListenPort</strong> 指定WG的UDP监听端口（客户端将需要配置该端口进行连接），<strong>PrivateKey</strong> 就是上面生成的私有密钥的内容。</p><p>如果你的系统开启了UFW防火墙，记住要配置ufw允许以上端口（4114），例如</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo ufw status
</span></span><span style=display:flex><span>Status: active
</span></span><span style=display:flex><span>$ sudo ufw allow 4114/udp
</span></span></code></pre></div><p>我们这里使用的是云主机，则需要在云控制台配置相应的安全组/防火墙开放 <code>4114/udp</code> 端口的访问。</p><p>接下来，执行以下命令启动WireGuard服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo systemctl enable wg-quick@wg0
</span></span><span style=display:flex><span>$ sudo systemctl start wg-quick@wg0
</span></span><span style=display:flex><span>$ sudo systemcl status wg-quick@wg0
</span></span></code></pre></div><p>最后一个命令是查看wg服务的运行状态的，例如返回如下</p><pre tabindex=0><code>● wg-quick@wg0.service - WireGuard via wg-quick(8) for wg0
     Loaded: loaded (/lib/systemd/system/wg-quick@.service; enabled; vendor preset: enabled)
     Active: active (exited) since Thu 2020-12-03 06:48:02 UTC; 5s ago
       Docs: man:wg-quick(8)
             man:wg(8)
             https://www.wireguard.com/
             https://www.wireguard.com/quickstart/
             https://git.zx2c4.com/wireguard-tools/about/src/man/wg-quick.8
             https://git.zx2c4.com/wireguard-tools/about/src/man/wg.8
    Process: 3606 ExecStart=/usr/bin/wg-quick up wg0 (code=exited, status=0/SUCCESS)
   Main PID: 3606 (code=exited, status=0/SUCCESS)
      Tasks: 0 (limit: 682)
     Memory: 800.0K
     CGroup: /system.slice/system-wg\x2dquick.slice/wg-quick@wg0.service
</code></pre><p>而且系统里增加了一个虚拟的网络接口</p><pre tabindex=0><code>3: wg0: &lt;POINTOPOINT,NOARP,UP,LOWER_UP&gt; mtu 1380 qdisc noqueue state UNKNOWN group default qlen 1000
    link/none 
    inet 192.168.40.1/24 scope global wg0
       valid_lft forever preferred_lft forever
</code></pre><p>还可以通过wg命令显示接口信息</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo wg
</span></span><span style=display:flex><span>interface: wg0
</span></span><span style=display:flex><span>  public key: rQYpYVpgPYdYYVrlgF52S/M8vrht+rkqSmn5ayVAG0I<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  private key: <span style=color:#f92672>(</span>hidden<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  listening port: <span style=color:#ae81ff>4114</span>
</span></span></code></pre></div><h2 id=配置客户端连接wg>配置客户端连接WG</h2><p>完成服务器断的配置，并成功启动之后，我们需要配置本地客户端来连接该VPN，我本地使用的是 [openSUSE] 桌面环境，首先需要安装 wireguard-tools，其他 Linux 系统也是类似的</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ sudo zypper in wireguard-tools
</span></span><span style=display:flex><span>正在加载软件源数据...
</span></span><span style=display:flex><span>正在读取已安装的软件包...
</span></span><span style=display:flex><span>正在解决软件包依赖关系...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>将安装以下 <span style=color:#ae81ff>1</span> 个新软件包：
</span></span><span style=display:flex><span>  wireguard-tools
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> 个软件包将新装.
</span></span><span style=display:flex><span>总下载大小：72.4 KiB。已缓存：0 B。 操作完成后，将使用额外的 140.7 KiB。
</span></span><span style=display:flex><span>继续吗？ <span style=color:#f92672>[</span>y/n/v/...? 显示全部选项<span style=color:#f92672>]</span> <span style=color:#f92672>(</span>y<span style=color:#f92672>)</span>: y
</span></span></code></pre></div><p>一样地需要创建私有/公共密钥对</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo -i
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> cd /etc/wireguard/
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> umask <span style=color:#ae81ff>077</span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>\#</span> wg genkey | tee privatekey | wg pubkey &gt; publickey
</span></span></code></pre></div><p>创建 <em>/etc/wireguard/wg0.conf</em> 文件，配置如下</p><pre tabindex=0><code class=language-conf data-lang=conf>[Interface]
## This Desktop/client&#39;s private key ##
PrivateKey = &lt;client private key&gt;
 
## Client ip address ##
Address = 192.168.40.10/24
 
[Peer]
## public key ##
PublicKey = &lt;Server public key&gt;
 
## set ACL ##
AllowedIPs = 192.168.40.0/24
 
## Your Ubuntu 20.04 LTS server&#39;s public IPv4/IPv6 address and port ##
Endpoint = 35.220.179.202:4114
 
##  Key connection alive ##
PersistentKeepalive = 15
</code></pre><p>注意需要分别配置接口（也就是客户端自己）的私有密钥，还要配置连接服务端（peer）的公共密钥，还有连接服务端的IP和端口信息。</p><p>启动连接</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ sudo systemctl start wg-quick@wg0.service
</span></span><span style=display:flex><span>❯ sudo wg
</span></span><span style=display:flex><span>interface: wg0
</span></span><span style=display:flex><span>  public key: 1abmCvigQqhXYLOkvjrU864dOyJHN9bf6Ya0GP4tXzs<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  private key: <span style=color:#f92672>(</span>hidden<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>  listening port: <span style=color:#ae81ff>54147</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>peer: rQYpYVpgPYdYYVrlgF52S/M8vrht+rkqSmn5ayVAG0I<span style=color:#f92672>=</span>
</span></span><span style=display:flex><span>  endpoint: 35.220.179.202:4114
</span></span><span style=display:flex><span>  allowed ips: 192.168.40.0/24
</span></span><span style=display:flex><span>  latest handshake: <span style=color:#ae81ff>4</span> seconds ago
</span></span><span style=display:flex><span>  transfer: <span style=color:#ae81ff>92</span> B received, <span style=color:#ae81ff>180</span> B sent
</span></span><span style=display:flex><span>  persistent keepalive: every <span style=color:#ae81ff>15</span> seconds
</span></span></code></pre></div><p>这个时候还不能通过VPN直接访问服务器端，想要客户端和服务端可以通过VPN的私有网络互相访问，这个时候需要到服务端添加[Peer]的配置，服务端向文件 <em>/etc/wireguard/wg0.conf</em> 添加以下内容</p><pre tabindex=0><code class=language-conf data-lang=conf>[Peer]
PublicKey = +pztufezkYV8ujhJI2N2Q5SW5yuuTXzHmytrGdJjziE=
AllowedIPs = 192.168.40.10/32
</code></pre><p>重启服务器，客户端服务</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ sudo systemctl restart wg-quick@wg0
</span></span></code></pre></div><p>这个时候就建立了一个P-to-P的VPN网络，可以使用私有IP互相访问</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>❯ ping 192.168.40.1
</span></span><span style=display:flex><span>PING 192.168.40.1 <span style=color:#f92672>(</span>192.168.40.1<span style=color:#f92672>)</span> 56<span style=color:#f92672>(</span>84<span style=color:#f92672>)</span> bytes of data.
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.40.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>51.8 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.40.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>55.0 ms
</span></span><span style=display:flex><span><span style=color:#ae81ff>64</span> bytes from 192.168.40.1: icmp_seq<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span> ttl<span style=color:#f92672>=</span><span style=color:#ae81ff>64</span> time<span style=color:#f92672>=</span>58.6 ms
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>客户端还不能通过VPN网络访问互联网，要想所有VPN的客户端都可以通过该服务器来访问互联网，还需要在服务器上配置相应的NAT，IP转发规则。</p><h2 id=总结>总结</h2><p>这里仅仅通过示例，在Linux上使用 <a href=https://www.wireguard.com/ target=_blank rel=noopener>WireGuard</a> 创建了一个端到端（客户端/服务器）VPN网络，让客户端和服务器可以通过VPN私有IP地址互相访问。想了解更多关于WireGuard的信息，请访问其官网 <a href=https://www.wireguard.com/ target=_blank rel=noopener>https://www.wireguard.com/</a> 。</p></div><div class="row pl-3 pr-3"><div class="col-md-6 share-buttons"><strong>Share on:</strong>
<a class="btn btn-sm facebook-btn" href="https://www.facebook.com/sharer.php?u=%2fzh%2fposts%2flinux%2fwireguard-vpn%2f" target=_blank><i class="fab fa-facebook"></i>
</a><a class="btn btn-sm twitter-btn" href="https://twitter.com/share?url=%2fzh%2fposts%2flinux%2fwireguard-vpn%2f&text=%e5%9c%a8LINUX%e4%b8%8a%e9%85%8d%e7%bd%aeWIREGUARD&via=Mengz%27s%20Space%20..." target=_blank><i class="fab fa-twitter"></i>
</a><a class="btn btn-sm linkedin-btn" href="https://www.linkedin.com/shareArticle?url=%2fzh%2fposts%2flinux%2fwireguard-vpn%2f&title=%e5%9c%a8LINUX%e4%b8%8a%e9%85%8d%e7%bd%aeWIREGUARD" target=_blank><i class="fab fa-linkedin"></i></a></div></div><hr><div class="row next-prev-navigator"><div class="col-md-6 previous-article"><a href=/zh/posts/linux/opensuse-upgrade/ title="升级OPENSUSE LEAP" class="btn btn-outline-info"><div><i class="fas fa-chevron-circle-left"></i> Prev</div><div class=next-prev-text>升级OPENSUSE LEAP</div></a></div><div class="col-md-6 next-article"><a href=/zh/posts/linux/ubuntu-old-kernel/ title=在UBUNTU上删除旧的内核 class="btn btn-outline-info"><div>Next <i class="fas fa-chevron-circle-right"></i></div><div class=next-prev-text>在UBUNTU上删除旧的内核</div></a></div></div><hr></div></div></div><a id=scroll-to-top class=btn><i class="fas fa-chevron-circle-up"></i></a></section><section class=toc-section id=toc-section><div class=toc-holder><h5 class="text-center pl-3">Table of Contents</h5><hr><div class=toc><nav id=TableOfContents><ul><li><a href=#服务器端安装wireguard>服务器端安装WireGuard</a></li><li><a href=#配置wireguard服务端>配置WireGuard服务端</a></li><li><a href=#配置客户端连接wg>配置客户端连接WG</a></li><li><a href=#总结>总结</a></li></ul></nav></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/zh/#about>关于</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#experiences>工作经历</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#education>教育</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#recent-posts>近期文章</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#accomplishments>技能学习</a></li><li class=nav-item><a class=smooth-scroll href=https://live.mengz.dev/>LiveTerm</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:mengz.you@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>mengz.you@outlook.com</span></a></li><li><a href=https://github.com/mengzyou target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>mengzyou</span></a></li><li><a href=https://www.linkedin.com/in/mengzyou target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>You Mengzhe</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2024 - Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.74035eba644bbae33efea73e1508acb9c99d04231c848dda7fa8ce5dd16fff9e.js integrity="sha256-dANeumRLuuM+/qc+FQisucmdBCMchI3af6jOXdFv/54=" defer></script><script src=https://storage.ko-fi.com/cdn/scripts/overlay-widget.js></script><script>kofiWidgetOverlay.draw("mengz",{type:"floating-chat","floating-chat.donateButton.text":"Buy me a book","floating-chat.donateButton.text-color":"#f9fafc","floating-chat.donateButton.background-color":"#248aaa"})</script></body></html>