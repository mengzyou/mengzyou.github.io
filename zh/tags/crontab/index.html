<!doctype html><html lang=zh><head><title>crontab</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><link rel=stylesheet href=/application.fb9df7e952c9dccf496d00faec07de633aae460f909bbba4b5e0ad22f5887d73.css integrity="sha256-+5336VLJ3M9JbQD67AfeYzquRg+Qm7ukteCtIvWIfXM="><link rel=icon type=image/png href=/images/site/favicon_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png><meta property="og:title" content="crontab"><meta property="og:description" content><meta property="og:type" content="website"><meta property="og:url" content="/zh/tags/crontab/"><script src=https://cdn.counter.dev/script.js data-id=2905461c-37df-49f9-a4ca-0ea1ba64543a data-utcoffset=1></script></head><body class="type-tags kind-term" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<span class=navbar-toggler-icon></span></button>
<a class=navbar-brand href=/zh/><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png alt=Logo>
Mengz's Space ...</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme"></a>
<a class="dropdown-item nav-link" href=# data-scheme=dark><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a>
<a class="dropdown-item nav-link" href=# data-scheme=system><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/zh/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/zh/tags data-filter=all>Tags</a></li><div class="subtree taxonomy-terms"><li><a class=taxonomy-term href=/zh/tags/algorithm/ data-taxonomy-term=algorithm><span class=taxonomy-label>algorithm</span></a></li><li><a class=taxonomy-term href=/zh/tags/ansible/ data-taxonomy-term=ansible><span class=taxonomy-label>ansible</span></a></li><li><a class=taxonomy-term href=/zh/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>aws</span></a></li><li><a class=taxonomy-term href=/zh/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>cicd</span></a></li><li><a class=taxonomy-term href=/zh/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>cloud</span></a></li><li><a class=taxonomy-term href=/zh/tags/cluster/ data-taxonomy-term=cluster><span class=taxonomy-label>cluster</span></a></li><li><a class=taxonomy-term href=/zh/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>cncf</span></a></li><li><a class=taxonomy-term href=/zh/tags/command/ data-taxonomy-term=command><span class=taxonomy-label>command</span></a></li><li><a class=taxonomy-term href=/zh/tags/compose/ data-taxonomy-term=compose><span class=taxonomy-label>compose</span></a></li><li><a class=taxonomy-term href=/zh/tags/contianer/ data-taxonomy-term=contianer><span class=taxonomy-label>contianer</span></a></li><li><a class=taxonomy-term href=/zh/tags/cotainer/ data-taxonomy-term=cotainer><span class=taxonomy-label>cotainer</span></a></li><li><a class=taxonomy-term href=/zh/tags/cpp/ data-taxonomy-term=cpp><span class=taxonomy-label>cpp</span></a></li><li><a class="taxonomy-term active" href=/zh/tags/crontab/ data-taxonomy-term=crontab><span class=taxonomy-label>crontab</span></a></li><li><a class=taxonomy-term href=/zh/tags/debug/ data-taxonomy-term=debug><span class=taxonomy-label>debug</span></a></li><li><a class=taxonomy-term href=/zh/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>docker</span></a></li><li><a class=taxonomy-term href=/zh/tags/find/ data-taxonomy-term=find><span class=taxonomy-label>find</span></a></li><li><a class=taxonomy-term href=/zh/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>github</span></a></li><li><a class=taxonomy-term href=/zh/tags/gitlab/ data-taxonomy-term=gitlab><span class=taxonomy-label>gitlab</span></a></li><li><a class=taxonomy-term href=/zh/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>gitops</span></a></li><li><a class=taxonomy-term href=/zh/tags/hardware/ data-taxonomy-term=hardware><span class=taxonomy-label>hardware</span></a></li><li><a class=taxonomy-term href=/zh/tags/hostname/ data-taxonomy-term=hostname><span class=taxonomy-label>hostname</span></a></li><li><a class=taxonomy-term href=/zh/tags/k3s/ data-taxonomy-term=k3s><span class=taxonomy-label>k3s</span></a></li><li><a class=taxonomy-term href=/zh/tags/kernel/ data-taxonomy-term=kernel><span class=taxonomy-label>kernel</span></a></li><li><a class=taxonomy-term href=/zh/tags/kubectl/ data-taxonomy-term=kubectl><span class=taxonomy-label>kubectl</span></a></li><li><a class=taxonomy-term href=/zh/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>kubernetes</span></a></li><li><a class=taxonomy-term href=/zh/tags/linux/ data-taxonomy-term=linux><span class=taxonomy-label>linux</span></a></li><li><a class=taxonomy-term href=/zh/tags/mariadb/ data-taxonomy-term=mariadb><span class=taxonomy-label>mariadb</span></a></li><li><a class=taxonomy-term href=/zh/tags/mqtt/ data-taxonomy-term=mqtt><span class=taxonomy-label>mqtt</span></a></li><li><a class=taxonomy-term href=/zh/tags/network/ data-taxonomy-term=network><span class=taxonomy-label>network</span></a></li><li><a class=taxonomy-term href=/zh/tags/nvidia/ data-taxonomy-term=nvidia><span class=taxonomy-label>nvidia</span></a></li><li><a class=taxonomy-term href=/zh/tags/opensuse/ data-taxonomy-term=opensuse><span class=taxonomy-label>opensuse</span></a></li><li><a class=taxonomy-term href=/zh/tags/rclone/ data-taxonomy-term=rclone><span class=taxonomy-label>rclone</span></a></li><li><a class=taxonomy-term href=/zh/tags/sbom/ data-taxonomy-term=sbom><span class=taxonomy-label>sbom</span></a></li><li><a class=taxonomy-term href=/zh/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>security</span></a></li><li><a class=taxonomy-term href=/zh/tags/shell/ data-taxonomy-term=shell><span class=taxonomy-label>shell</span></a></li><li><a class=taxonomy-term href=/zh/tags/slack/ data-taxonomy-term=slack><span class=taxonomy-label>slack</span></a></li><li><a class=taxonomy-term href=/zh/tags/systemd/ data-taxonomy-term=systemd><span class=taxonomy-label>systemd</span></a></li><li><a class=taxonomy-term href=/zh/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>terraform</span></a></li><li><a class=taxonomy-term href=/zh/tags/terrafrom/ data-taxonomy-term=terrafrom><span class=taxonomy-label>terrafrom</span></a></li><li><a class=taxonomy-term href=/zh/tags/ubuntu/ data-taxonomy-term=ubuntu><span class=taxonomy-label>ubuntu</span></a></li><li><a class=taxonomy-term href=/zh/tags/virtualization/ data-taxonomy-term=virtualization><span class=taxonomy-label>virtualization</span></a></li><li><a class=taxonomy-term href=/zh/tags/vpn/ data-taxonomy-term=vpn><span class=taxonomy-label>vpn</span></a></li><li><a class=taxonomy-term href=/zh/tags/web/ data-taxonomy-term=web><span class=taxonomy-label>web</span></a></li><li><a class=taxonomy-term href=/zh/tags/wechat/ data-taxonomy-term=wechat><span class=taxonomy-label>wechat</span></a></li><li><a class=taxonomy-term href=/zh/tags/windows/ data-taxonomy-term=windows><span class=taxonomy-label>windows</span></a></li><li><a class=taxonomy-term href=/zh/tags/wireguard/ data-taxonomy-term=wireguard><span class=taxonomy-label>wireguard</span></a></li><li><a class=taxonomy-term href=/zh/tags/wsl/ data-taxonomy-term=wsl><span class=taxonomy-label>wsl</span></a></li><li><a class=taxonomy-term href=/zh/tags/zypper/ data-taxonomy-term=zypper><span class=taxonomy-label>zypper</span></a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid post-card-holder" id=post-card-holder><div class=post-card><a href=/zh/posts/linux/systemd-timer/ class=post-card-link><div class=card><div class=card-head><img class=card-img-top src=/zh/posts/linux/systemd-timer/systemd.webp alt="Hero Image"></div><div class=card-body><h5 class=card-title>SYSTEMD定时服务</h5><p class="card-text post-summary">我上一篇文章中介绍的locate文件查找命令，需要依赖updatedb更新索引才能快速查找文件，因此需要定时运行该命令来更新文件索引。我们知道在Linux和类Unix系统上通常使用crontab来创建定时任务。
在Ubuntu上我们使用apt install mlocate之后，会安装一个脚本文件到 /etc/cron.daily/mlocate，也就是通过Cron机制来每天执行updatedb。然而在我的openSUSE上却并未发现有相关的Crontab配置，但我发现索引文件还是在每天的零点进行了更新，那这个定时任务是谁来执行的呢？
我通过查找与mlocate相关的文件，发现了以下几个文件：
❯ locate "mlocate" /etc/systemd/system/timers.target.wants/mlocate.timer /usr/lib/systemd/system/mlocate.service /usr/lib/systemd/system/mlocate.timer 原来在openSUSE系统上，使用的是Systemd的定时单元来实现的。Systemd是一种Linux系统服务管理程序，在我之前的文章在OPENSUSE上使用SYSTEMCTL管理系统服务中介绍过。
那这里我们将重点介绍下Systemd的定时服务（systemd timer unit）。
systemd定时单元 类似与Cron，systemd的定时单元在Linux系统上提供了机制来调度任务，相比于Cron机制，其他具有以下特性（在使用systemd作为初始化和服务管理的系统上）：
调度的任务可以依赖于其他systemd服务 可以使用systemctl命令来管理定时单元，类似与管理systemd服务 除了类似Cron的循环实时定时任务（realtime）之外，还支持一种基于非时间事件触发的任务（monotonic） 定时单元记录日志到systemd的日志系统（journal），因此方便于统一监控和诊断 systemd定时任务的类型 上面的特性中，我们提到其支持两种类型 - realtime 和 monotonic
Realtime - 类似于Cron，这种类型的定时任务由定义的绝对时间来触发，在配置文件中通过 OnCalendar 选项来定义 Monotonic - 这种类型的定时任务将会在指定的事件（例如系统启动，服务激活）一定时间后触发，在配置文件中通过 OnBootSec 和 OnUnitActiveSec ，OnStartupSec 等选项来定义，并且该类型的定时任务触发时间不是固定的，在每一次系统重启之后都会被重置 systemd定时任务的配置 在文章开始，我们在寻找mlocate更新文件索引的定时任务时看到，有文件 /usr/lib/systemd/system/mlocate.timer ，没错，就是通过以 .timer 作为扩展名的systemd单元文件来定义systemd的定时单元的
[Unit] Description=Daily locate database update Documentation=man:updatedb [Timer] OnCalendar=daily AccuracySec=12h Unit=mlocate.service Persistent=true [Install] WantedBy=timers.target 可以看到文件格式与systemd服务的单元文件类似，不过需要 [Timer] 段，在该段定义了如下选项
OnCalendar=daily，意思是每天触发 AccuracySec=12h，意思是由于某些原因需要推测执行的时间 Unit=mlocate.service，这里就是指定了需要执行的任务服务 Persistent=true，指定如果由于关机等原因到时了为能执行任务的情况下，启动会立即触发该任务 那该定时单元指定了 mlocate.service 作为触发执行的任务，也就是 /usr/lib/systemd/system/mlocate.</p></div><div class=card-footer><span class=float-left>December 3, 2021</span>
<a href=/zh/posts/linux/systemd-timer/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div></div><div class=paginator></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/zh/#about>关于</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#experiences>工作经历</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#education>教育</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#recent-posts>近期文章</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#accomplishments>技能学习</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:mengz.you@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>mengz.you@outlook.com</span></a></li><li><a href=https://github.com/mengzyou target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>mengzyou</span></a></li><li><a href=https://www.linkedin.com/in/mengzyou target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>You Mengzhe</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2023 Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.d06ddacd4080231ac954a78539ea5f5a1921ebbd740618450ead7a0e8466dfda.js integrity="sha256-0G3azUCAIxrJVKeFOepfWhkh6710BhhFDq16DoRm39o=" defer></script></body></html>