<!doctype html><html lang=zh><head><title>Docker</title>
<meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=X-UA-Compatible content="ie=edge"><link rel=stylesheet href=/application.fb9df7e952c9dccf496d00faec07de633aae460f909bbba4b5e0ad22f5887d73.css integrity="sha256-+5336VLJ3M9JbQD67AfeYzquRg+Qm7ukteCtIvWIfXM="><link rel=icon type=image/png href=/images/site/favicon_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png><meta property="og:url" content="/zh/tags/docker/"><meta property="og:site_name" content="Mengz's Space ..."><meta property="og:title" content="Docker"><meta property="og:locale" content="zh"><meta property="og:type" content="website"><script src=https://cdn.counter.dev/script.js data-id=2905461c-37df-49f9-a4ca-0ea1ba64543a data-utcoffset=1></script></head><body class="type-tags kind-term" data-spy=scroll data-target=#TableOfContents data-offset=80><div class="container-fluid bg-dimmed wrapper"><nav class="navbar navbar-expand-xl top-navbar final-navbar shadow"><div class=container><button class="navbar-toggler navbar-light" id=sidebar-toggler type=button>
<span class=navbar-toggler-icon></span>
</button>
<a class=navbar-brand href=/zh/><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png alt=Logo>
Mengz's Space ...</a>
<button class="navbar-toggler navbar-light" id=toc-toggler type=button>
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse lang-selector" id=top-nav-items><ul class="navbar-nav ml-auto"><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href=# id=themeSelector role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false><img id=navbar-theme-icon-svg src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme"></a><div id=themeMenu class="dropdown-menu dropdown-menu-icons-only" aria-labelledby=themeSelector><a class="dropdown-item nav-link" href=# data-scheme=light><img class=menu-icon-center src=/icons/sun-svgrepo-com.svg width=20 alt="Light Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=dark><img class=menu-icon-center src=/icons/moon-svgrepo-com.svg width=20 alt="Dark Theme">
</a><a class="dropdown-item nav-link" href=# data-scheme=system><img class=menu-icon-center src=/icons/computer-svgrepo-com.svg width=20 alt="System Theme"></a></div></li></ul></div></div><img src=/images/site/main-logo_hu69a4da50b288ac7c5f97b1e1012a418e_8650_42x0_resize_box_3.png class=d-none id=main-logo alt=Logo>
<img src=/images/site/inverted-logo_hu3d2f89ed4395f8e4a11f46415bebb510_10034_42x0_resize_box_3.png class=d-none id=inverted-logo alt="Inverted Logo"></nav><section class=sidebar-section id=sidebar-section><div class=sidebar-holder><div class=sidebar id=sidebar><form class=mx-auto method=get action=/zh/search><input type=text name=keyword placeholder=Search data-search id=search-box></form><div class=sidebar-tree><ul class=tree id=tree><li id=list-heading><a href=/zh/tags data-filter=all>Tags</a></li><div class="subtree taxonomy-terms"><li><a class=taxonomy-term href=/zh/tags/algorithm/ data-taxonomy-term=algorithm><span class=taxonomy-label>Algorithm</span></a></li><li><a class=taxonomy-term href=/zh/tags/ansible/ data-taxonomy-term=ansible><span class=taxonomy-label>Ansible</span></a></li><li><a class=taxonomy-term href=/zh/tags/aws/ data-taxonomy-term=aws><span class=taxonomy-label>Aws</span></a></li><li><a class=taxonomy-term href=/zh/tags/cicd/ data-taxonomy-term=cicd><span class=taxonomy-label>Cicd</span></a></li><li><a class=taxonomy-term href=/zh/tags/cloud/ data-taxonomy-term=cloud><span class=taxonomy-label>Cloud</span></a></li><li><a class=taxonomy-term href=/zh/tags/cluster/ data-taxonomy-term=cluster><span class=taxonomy-label>Cluster</span></a></li><li><a class=taxonomy-term href=/zh/tags/cncf/ data-taxonomy-term=cncf><span class=taxonomy-label>Cncf</span></a></li><li><a class=taxonomy-term href=/zh/tags/command/ data-taxonomy-term=command><span class=taxonomy-label>Command</span></a></li><li><a class=taxonomy-term href=/zh/tags/compose/ data-taxonomy-term=compose><span class=taxonomy-label>Compose</span></a></li><li><a class=taxonomy-term href=/zh/tags/contianer/ data-taxonomy-term=contianer><span class=taxonomy-label>Contianer</span></a></li><li><a class=taxonomy-term href=/zh/tags/cotainer/ data-taxonomy-term=cotainer><span class=taxonomy-label>Cotainer</span></a></li><li><a class=taxonomy-term href=/zh/tags/cpp/ data-taxonomy-term=cpp><span class=taxonomy-label>Cpp</span></a></li><li><a class=taxonomy-term href=/zh/tags/crontab/ data-taxonomy-term=crontab><span class=taxonomy-label>Crontab</span></a></li><li><a class=taxonomy-term href=/zh/tags/debug/ data-taxonomy-term=debug><span class=taxonomy-label>Debug</span></a></li><li><a class="taxonomy-term active" href=/zh/tags/docker/ data-taxonomy-term=docker><span class=taxonomy-label>Docker</span></a></li><li><a class=taxonomy-term href=/zh/tags/find/ data-taxonomy-term=find><span class=taxonomy-label>Find</span></a></li><li><a class=taxonomy-term href=/zh/tags/github/ data-taxonomy-term=github><span class=taxonomy-label>Github</span></a></li><li><a class=taxonomy-term href=/zh/tags/gitlab/ data-taxonomy-term=gitlab><span class=taxonomy-label>Gitlab</span></a></li><li><a class=taxonomy-term href=/zh/tags/gitops/ data-taxonomy-term=gitops><span class=taxonomy-label>Gitops</span></a></li><li><a class=taxonomy-term href=/zh/tags/hardware/ data-taxonomy-term=hardware><span class=taxonomy-label>Hardware</span></a></li><li><a class=taxonomy-term href=/zh/tags/hostname/ data-taxonomy-term=hostname><span class=taxonomy-label>Hostname</span></a></li><li><a class=taxonomy-term href=/zh/tags/k3s/ data-taxonomy-term=k3s><span class=taxonomy-label>K3s</span></a></li><li><a class=taxonomy-term href=/zh/tags/kernel/ data-taxonomy-term=kernel><span class=taxonomy-label>Kernel</span></a></li><li><a class=taxonomy-term href=/zh/tags/kubectl/ data-taxonomy-term=kubectl><span class=taxonomy-label>Kubectl</span></a></li><li><a class=taxonomy-term href=/zh/tags/kubernetes/ data-taxonomy-term=kubernetes><span class=taxonomy-label>Kubernetes</span></a></li><li><a class=taxonomy-term href=/zh/tags/linux/ data-taxonomy-term=linux><span class=taxonomy-label>Linux</span></a></li><li><a class=taxonomy-term href=/zh/tags/mariadb/ data-taxonomy-term=mariadb><span class=taxonomy-label>Mariadb</span></a></li><li><a class=taxonomy-term href=/zh/tags/mqtt/ data-taxonomy-term=mqtt><span class=taxonomy-label>Mqtt</span></a></li><li><a class=taxonomy-term href=/zh/tags/network/ data-taxonomy-term=network><span class=taxonomy-label>Network</span></a></li><li><a class=taxonomy-term href=/zh/tags/nvidia/ data-taxonomy-term=nvidia><span class=taxonomy-label>Nvidia</span></a></li><li><a class=taxonomy-term href=/zh/tags/opensuse/ data-taxonomy-term=opensuse><span class=taxonomy-label>Opensuse</span></a></li><li><a class=taxonomy-term href=/zh/tags/rclone/ data-taxonomy-term=rclone><span class=taxonomy-label>Rclone</span></a></li><li><a class=taxonomy-term href=/zh/tags/sbom/ data-taxonomy-term=sbom><span class=taxonomy-label>Sbom</span></a></li><li><a class=taxonomy-term href=/zh/tags/security/ data-taxonomy-term=security><span class=taxonomy-label>Security</span></a></li><li><a class=taxonomy-term href=/zh/tags/shell/ data-taxonomy-term=shell><span class=taxonomy-label>Shell</span></a></li><li><a class=taxonomy-term href=/zh/tags/slack/ data-taxonomy-term=slack><span class=taxonomy-label>Slack</span></a></li><li><a class=taxonomy-term href=/zh/tags/systemd/ data-taxonomy-term=systemd><span class=taxonomy-label>Systemd</span></a></li><li><a class=taxonomy-term href=/zh/tags/terraform/ data-taxonomy-term=terraform><span class=taxonomy-label>Terraform</span></a></li><li><a class=taxonomy-term href=/zh/tags/terrafrom/ data-taxonomy-term=terrafrom><span class=taxonomy-label>Terrafrom</span></a></li><li><a class=taxonomy-term href=/zh/tags/ubuntu/ data-taxonomy-term=ubuntu><span class=taxonomy-label>Ubuntu</span></a></li><li><a class=taxonomy-term href=/zh/tags/virtualization/ data-taxonomy-term=virtualization><span class=taxonomy-label>Virtualization</span></a></li><li><a class=taxonomy-term href=/zh/tags/vpn/ data-taxonomy-term=vpn><span class=taxonomy-label>Vpn</span></a></li><li><a class=taxonomy-term href=/zh/tags/web/ data-taxonomy-term=web><span class=taxonomy-label>Web</span></a></li><li><a class=taxonomy-term href=/zh/tags/wechat/ data-taxonomy-term=wechat><span class=taxonomy-label>Wechat</span></a></li><li><a class=taxonomy-term href=/zh/tags/windows/ data-taxonomy-term=windows><span class=taxonomy-label>Windows</span></a></li><li><a class=taxonomy-term href=/zh/tags/wireguard/ data-taxonomy-term=wireguard><span class=taxonomy-label>Wireguard</span></a></li><li><a class=taxonomy-term href=/zh/tags/wsl/ data-taxonomy-term=wsl><span class=taxonomy-label>Wsl</span></a></li><li><a class=taxonomy-term href=/zh/tags/zypper/ data-taxonomy-term=zypper><span class=taxonomy-label>Zypper</span></a></li></div></ul></div></div></div></section><section class=content-section id=content-section><div class="content container-fluid" id=content><div class="container-fluid post-card-holder" id=post-card-holder><div class=post-card><a href=/zh/posts/devops/gitlab-ci-docker/ class=post-card-link><div class=card><div class=card-head><img class=card-img-top src=/images/default-hero.jpg alt="Hero Image"></div><div class=card-body><h5 class=card-title>GITLAB CI自动部署容器应用</h5><p class="card-text post-summary">容器 Docker 越来越受开发者和运维人员的喜爱，更是作为实践 DevOps 的一个中要工具。同时 Gitlab 提供了免费的代码管理服务，其 gitlab-ci 更是提供了强大的自动化 CI/CD 流程功能。
本文以一个静态站点的示例来说明如何使用 gitlab-ci 和 docker 进行容器镜像的构建，以及如何将镜像自动化部署到目标服务器上。
编写Dockerfile 首先在代码库中增加 Dockerfile ，用于描述如何构建应用的容器镜像。以下是一个基于 Hugo 的静态站点应用的示例：
FROM mengzyou/hugo:latest as builder COPY . /app/ RUN hugo FROM nginx:1.16-alpine RUN set -x \ && rm -f /etc/nginx/conf.d/default.conf \ && mkdir -p /usr/share/nginx/html COPY --from=builder /app/nginx-default.conf /etc/nginx/conf.d/default.conf COPY --from=builder /app/public/ /usr/share/nginx/html 其实非常简单，使用了多阶段构建，以 mengzyou/hugo 作为构建镜像，然后将生成的静态文件拷贝到 nginx 镜像中，最终生成静态站点的镜像。
配置Gitlab-ci构建容器镜像 该阶段，在项目根目录添加 .gitlab-ci.yml 文件，示例内容如下：
variables: DOCKER_DRIVER: overlay2 CI_REGISTRY_IMAGE: ${CI_REGISTRY}/mengzyou/app before_script: - echo $CI_JOB_NAME - echo $CI_PROJECT_DIR stages: - build build:docker: stage: build variables: DOCKER_HOST: tcp://docker:2375 image: docker:stable services: - docker:dind script: - echo "Building image - $CI_REGISTRY_IMAGE:latest" - echo "$CI_REGISTRY_PASSWORD" | docker login -u "$CI_REGISTRY_USER" --password-stdin $CI_REGISTRY - docker image build --force-rm --no-cache -t $CI_REGISTRY_IMAGE:latest .</p></div><div class=card-footer><span class=float-left>July 30, 2019</span>
<a href=/zh/posts/devops/gitlab-ci-docker/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div><div class=post-card><a href=/zh/posts/container-tech/mariadb-docker/ class=post-card-link><div class=card><div class=card-head><img class=card-img-top src=/images/default-hero.jpg alt="Hero Image"></div><div class=card-body><h5 class=card-title>DOCKER构建MariaDB</h5><p class="card-text post-summary">现在 Docker 可所谓是最火的容器技术了，至于什么是 Docker，请到其官方网站或者维基百科查看。
这里想通过一个示例来看看怎么通过 Dockerfile 来构建一个 Docker 镜像。
构建MariaDB容器镜像 Docker 提供了两种方法来生产应用镜像:
通过启动一个基础容器（比如基于某种 Linux 发行版的镜像的容器），然后在容器里执行各种命令来安装相应的软件包，进行配置后，再通过 docker commit 命令把已经更新的容器生产相应的镜像。 通过编写一个 Dockerfile ，然后使用 docker build 命令来构建相应的镜像。 相比第一种方式，通过 Dockerfile 的方式，可以更好的维护镜像，将镜像的 Dockerfile 提交到版本库管理。还可以在 Docker Hub 里创建镜像的自动构建。
下面让我们通过如何编写 Dockerfile 来构建一个 mariadb 的镜像：
首先创建一个目录，如 docker-mariadb ，然后编写一个名为 Dockerfile 的文件，内容如下：
FROM opensuse:13.2 MAINTAINER Mengz You &lt;you.mengz@yahoo.com> ENV MARIADB_MAJOR 10.0 ENV MARIADB_VERSION 10.0.17 ENV MYSQL_ROOT_PASSWORD mysecretpassword ENV MYSQL_DATADIR /var/lib/mysql RUN zypper ar -f -r http://download.opensuse.org/repositories/server:/database/openSUSE_13.2/server:database.repo \ && zypper -n --gpg-auto-import-keys ref RUN zypper -n in --no-recommends mariadb-$MARIADB_VERSION net-tools \ && zypper clean --all RUN mkdir -p /var/lib/mysql \ && mkdir -p /var/log/mysql \ && chown mysql:mysql /var/log/mysql VOLUME /var/lib/mysql COPY docker-entrypoint.</p></div><div class=card-footer><span class=float-left>May 27, 2015</span>
<a href=/zh/posts/container-tech/mariadb-docker/ class="float-right btn btn-outline-info btn-sm">Read</a></div></div></a></div></div><div class=paginator><ul class="pagination pagination-default"><li class=page-item><a href=/zh/tags/docker/ aria-label=First class=page-link role=button><span aria-hidden=true>&#171;&#171;</span></a></li><li class=page-item><a href=/zh/tags/docker/ aria-label=Previous class=page-link role=button><span aria-hidden=true>&#171;</span></a></li><li class=page-item><a href=/zh/tags/docker/ aria-label="Page 1" class=page-link role=button>1</a></li><li class="page-item active"><a aria-current=page aria-label="Page 2" class=page-link role=button>2</a></li><li class="page-item disabled"><a aria-disabled=true aria-label=Next class=page-link role=button tabindex=-1><span aria-hidden=true>&#187;</span></a></li><li class="page-item disabled"><a aria-disabled=true aria-label=Last class=page-link role=button tabindex=-1><span aria-hidden=true>&#187;&#187;</span></a></li></ul></div></div></section></div><footer id=footer class="container-fluid text-center align-content-center footer pb-2"><div class="container pt-5"><div class="row text-left"><div class="col-md-4 col-sm-12"><h5>Navigation</h5><ul><li class=nav-item><a class=smooth-scroll href=/zh/#about>关于</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#skills>技能</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#experiences>工作经历</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#education>教育</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#recent-posts>近期文章</a></li><li class=nav-item><a class=smooth-scroll href=/zh/#accomplishments>技能学习</a></li><li class=nav-item><a class=smooth-scroll href=https://live.mengz.dev/>LiveTerm</a></li></ul></div><div class="col-md-4 col-sm-12"><h5>Contact me:</h5><ul><li><a href=mailto:mengz.you@outlook.com target=_blank rel=noopener><span><i class="fas fa-envelope"></i></span> <span>mengz.you@outlook.com</span></a></li><li><a href=https://github.com/mengzyou target=_blank rel=noopener><span><i class="fab fa-github"></i></span> <span>mengzyou</span></a></li><li><a href=https://www.linkedin.com/in/mengzyou target=_blank rel=noopener><span><i class="fab fa-linkedin"></i></span> <span>You Mengzhe</span></a></li></ul></div></div></div><hr><div class=container><div class="row text-left"><div class=col-md-4><a id=theme href=https://github.com/hugo-toha/toha target=_blank rel=noopener><img src=/images/theme-logo_hu8376fd15465fef26ffe66b6bcf0ca686_13669_32x0_resize_box_3.png alt="Toha Theme Logo">
Toha</a></div><div class="col-md-4 text-center">© 2024 - Copyright.</div><div class="col-md-4 text-right"><a id=hugo href=https://gohugo.io/ target=_blank rel=noopener>Powered by
<img src=/images/hugo-logo.svg alt="Hugo Logo" height=18></a></div></div></div></footer><script src=/application.74035eba644bbae33efea73e1508acb9c99d04231c848dda7fa8ce5dd16fff9e.js integrity="sha256-dANeumRLuuM+/qc+FQisucmdBCMchI3af6jOXdFv/54=" defer></script><script src=https://storage.ko-fi.com/cdn/scripts/overlay-widget.js></script><script>kofiWidgetOverlay.draw("mengz",{type:"floating-chat","floating-chat.donateButton.text":"Buy me a book","floating-chat.donateButton.text-color":"#f9fafc","floating-chat.donateButton.background-color":"#248aaa"})</script></body></html>